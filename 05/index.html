<!DOCTYPE html>
<html lang="en">
<head>
  <title>PHYSCI 70: Intro to Digital Fabrication </title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@300;600&display=swap" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <link href="./style.css" rel="stylesheet">
</head>
<body>

  <script>
    var elmnt = document.getElementById("luther");
    function LutherStop() {
      elmnt.scrollIntoView();
    }
  </script>

  <div class="container-fluid" id="top">
    <div id="navbar">
      <a rel="nofollow" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;star button&quot;,&quot;repository_id&quot;:333920522,&quot;auth_type&quot;:&quot;LOG_IN&quot;,&quot;originating_url&quot;:&quot;https://github.com/lcooke238/PS70?_pjax=%23js-repo-pjax-container&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="5e033e252785b7cbd74f75488d82a0e6bfc953491fcbad2e9796ff8b775bc564" href="../index.html" height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25zm0 2.445L6.615 5.5a.75.75 0 01-.564.41l-3.097.45 2.24 2.184a.75.75 0 01.216.664l-.528 3.084 2.769-1.456a.75.75 0 01.698 0l2.77 1.456-.53-3.084a.75.75 0 01.216-.664l2.24-2.183-3.096-.45a.75.75 0 01-.564-.41L8 2.694v.001z"></path></svg>
      <span>
        Home
</span></a>
    <a rel="nofollow" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;star button&quot;,&quot;repository_id&quot;:333920522,&quot;auth_type&quot;:&quot;LOG_IN&quot;,&quot;originating_url&quot;:&quot;https://github.com/lcooke238/PS70?_pjax=%23js-repo-pjax-container&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="5e033e252785b7cbd74f75488d82a0e6bfc953491fcbad2e9796ff8b775bc564" href="../01_intro/index.html" height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25zm0 2.445L6.615 5.5a.75.75 0 01-.564.41l-3.097.45 2.24 2.184a.75.75 0 01.216.664l-.528 3.084 2.769-1.456a.75.75 0 01.698 0l2.77 1.456-.53-3.084a.75.75 0 01.216-.664l2.24-2.183-3.096-.45a.75.75 0 01-.564-.41L8 2.694v.001z"></path></svg>
      <span>
        About
</span></a>
  <a rel="nofollow" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;star button&quot;,&quot;repository_id&quot;:333920522,&quot;auth_type&quot;:&quot;LOG_IN&quot;,&quot;originating_url&quot;:&quot;https://github.com/lcooke238/PS70?_pjax=%23js-repo-pjax-container&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="5e033e252785b7cbd74f75488d82a0e6bfc953491fcbad2e9796ff8b775bc564" href="../15/index.html" height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25zm0 2.445L6.615 5.5a.75.75 0 01-.564.41l-3.097.45 2.24 2.184a.75.75 0 01.216.664l-.528 3.084 2.769-1.456a.75.75 0 01.698 0l2.77 1.456-.53-3.084a.75.75 0 01.216-.664l2.24-2.183-3.096-.45a.75.75 0 01-.564-.41L8 2.694v.001z"></path></svg>
      <span>
        Project
</span></a>
  <a rel="nofollow" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;star button&quot;,&quot;repository_id&quot;:333920522,&quot;auth_type&quot;:&quot;LOG_IN&quot;,&quot;originating_url&quot;:&quot;https://github.com/lcooke238/PS70?_pjax=%23js-repo-pjax-container&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="5e033e252785b7cbd74f75488d82a0e6bfc953491fcbad2e9796ff8b775bc564" href="../06/index.html" height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25zm0 2.445L6.615 5.5a.75.75 0 01-.564.41l-3.097.45 2.24 2.184a.75.75 0 01.216.664l-.528 3.084 2.769-1.456a.75.75 0 01.698 0l2.77 1.456-.53-3.084a.75.75 0 01.216-.664l2.24-2.183-3.096-.45a.75.75 0 01-.564-.41L8 2.694v.001z"></path></svg>
      <span>
        This Week
</span></a>
  </div>

  <div class="row" style="margin-top: 30px;">
    <div class="col-xl-12" style="margin-top: 30px; text-align: center;">
      <h3>3D Design and Printing</h3>
    </div>
  </div> 

  <div class="row" style="margin-top: 6vh; margin-bottom: 6vh;">
    <div class="col-xl-12">
      <p style="font-size: 1.9vw; width: 95%; text-align: left; padding-left: 5%;"> This week, we worked with photogrammetry and 3D modeling to start 3D printing. First on the docet was to scan something using a photogrammetry app. I chose to use Qlone, mostly because it was the only app that permitted me to export any sort of result from the app without having to pay. I chose to model something small, because I needed to fit an object on the provided printout mat that would not obscure the corners of the surface. So, I chose my chapstick. </p>
    </div>
  </div>

  <div class="row" style="margin-top: 6vh; margin-bottom: 6vh;">
    <div class="col-md-8">
      <p style="font-size: 1.9vw; width: 95%; text-align: left; padding-left: 5%;"> To do this, I placed my chapstick on the mat and spun my phone around the entire object until the app told me that it had captured every single point on the hemisphere of my object. This process was quite frustrating, and it took me multiple tries to get something remotely decent. But, after a few tries, I managed to scan what I could only describe as the Roblox version of my chapstick. You can certainly tell what it is, but the shape is quite...crude to be honest.  </p>
    </div>
    <div class="col-sm-4">
       <img id="portrait" src="./New Qlone.gif" class="img-responsive margin" style="width:100%; height: auto;" alt="basic motor circuit">
    </div>
  </div>

  <div class="row" style="margin-top: 6vh; margin-bottom: 6vh;">
    <div class="col-xl-12">
      <p style="font-size: 1.9vw; width: 95%; text-align: left; padding-left: 5%;"> My next task was to start modelling for my final project. Right now, I am really intrigued by this funky water bottle humidifier that, in addition to sensing humidity and detecting certain sounds, will spray water at you if it hears you cough or clear your throat. To do this, I plan on rigging a spray bottle from the drugstore, so I am not really set on what or if I will need 3D modelled parts. Thus, I don't exactly have any models to share. I am still brainstorming though, so if I discover that I would benefit from a 3D modelled part I will definitely add it here.  </p>
    </div>
  </div>

  <div class="row" style="margin-top: 6vh; margin-bottom: 6vh;">
    <div class="col-xl-12">
      <p style="font-size: 1.9vw; width: 95%; text-align: left; padding-left: 5%;"> Now, for my printed object, I could finally go back to my initial design idea of a rotating square vase and print it out. I started with the general design from week 2. Like I said in my week 2 writeup, trying to design a piece like this using laser cut parts would not work without hand-cutting grooves into the z-axis of the walls. Using a full 3D model and printing it out, I could rotate the walls without having to worry about the whole structure disassembling by layer because the plastic would be bonded together in the location I wanted. </p>
    </div>
  </div>

  <div class="row" style="margin-top: 6vh; margin-bottom: 6vh;">
    <div class="col-md-8">
      <p style="font-size: 1.9vw; width: 95%; text-align: left; padding-left: 5%;"> Similar to my first week 2 sketch, I started by sketching the square base on fusion 360. I set the wall thickness, layer height, and side rotation angle to parameters in my project, allowing the entire thing to be scaled as needed with ease. In my planar sketch, I created a center point in the square, and an inner square to mark the end of the wall area. From there, I extruded the inner base as one body before extruding the first wall layer as its own body. With this first body extruded, building the next wall segment simply was a matter of copying.</p>
    </div>
    <div class="col-sm-4">
      <img id="portrait" src="./one part small.png" class="img-responsive margin" style="width:100%; height: auto;" alt="basic motor circuit">
    </div>
  </div>


  <div class="row" style="margin-top: 6vh; margin-bottom: 6vh;">
    <div class="col-sm-4">
      <img id="portrait" src="./rotateboxfull.PNG" class="img-responsive margin" style="width:100%; height: auto;" alt="basic motor circuit">
      <a class="btn btn-sm  btn-block tooltipped tooltipped-s" rel="nofollow" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;star button&quot;,&quot;repository_id&quot;:333920522,&quot;auth_type&quot;:&quot;LOG_IN&quot;,&quot;originating_url&quot;:&quot;https://github.com/lcooke238/PS70?_pjax=%23js-repo-pjax-container&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="5e033e252785b7cbd74f75488d82a0e6bfc953491fcbad2e9796ff8b775bc564" download href="./vase4.stl" height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25zm0 2.445L6.615 5.5a.75.75 0 01-.564.41l-3.097.45 2.24 2.184a.75.75 0 01.216.664l-.528 3.084 2.769-1.456a.75.75 0 01.698 0l2.77 1.456-.53-3.084a.75.75 0 01.216-.664l2.24-2.183-3.096-.45a.75.75 0 01-.564-.41L8 2.694v.001z"></path></svg>
      <span>
        Download my STL file
</span></a>
      <a class="btn btn-sm  btn-block tooltipped tooltipped-s" rel="nofollow" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;star button&quot;,&quot;repository_id&quot;:333920522,&quot;auth_type&quot;:&quot;LOG_IN&quot;,&quot;originating_url&quot;:&quot;https://github.com/lcooke238/PS70?_pjax=%23js-repo-pjax-container&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="5e033e252785b7cbd74f75488d82a0e6bfc953491fcbad2e9796ff8b775bc564" download href="./spin_box.f3d" height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25zm0 2.445L6.615 5.5a.75.75 0 01-.564.41l-3.097.45 2.24 2.184a.75.75 0 01.216.664l-.528 3.084 2.769-1.456a.75.75 0 01.698 0l2.77 1.456-.53-3.084a.75.75 0 01.216-.664l2.24-2.183-3.096-.45a.75.75 0 01-.564-.41L8 2.694v.001z"></path></svg>
      <span>
        Download my f3d file
</span></a>
<a class="btn btn-sm  btn-block tooltipped tooltipped-s" target="_blank" rel="nofollow" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;star button&quot;,&quot;repository_id&quot;:333920522,&quot;auth_type&quot;:&quot;LOG_IN&quot;,&quot;originating_url&quot;:&quot;https://github.com/lcooke238/PS70?_pjax=%23js-repo-pjax-container&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="5e033e252785b7cbd74f75488d82a0e6bfc953491fcbad2e9796ff8b775bc564" download href="./Cooke_Lauren_Vase1.gcode" height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25zm0 2.445L6.615 5.5a.75.75 0 01-.564.41l-3.097.45 2.24 2.184a.75.75 0 01.216.664l-.528 3.084 2.769-1.456a.75.75 0 01.698 0l2.77 1.456-.53-3.084a.75.75 0 01.216-.664l2.24-2.183-3.096-.45a.75.75 0 01-.564-.41L8 2.694v.001z"></path></svg>
      <span>
        Download my gcode file
</span></a>
    </div>
    
    <div class="col-md-8">
      <p style="font-size: 1.9vw; width: 95%; text-align: left; padding-left: 5%;"> I pressed 'm' in fusion, moved the center of rotation to the centerpoint of my planar sketch, raised the segment by the height of my wall segment parameter, and rotated the wall by my angle parameter. I wanted to complete at least one 90 degree rotation around the center point with my walls to get the full rotation effect, so I continued to copy my walls in larger and larger segments as the wall grew. For example, after this two-part wall was completed, I copied both walls as one entity, rotating and raising both pieces by double the parametrized amounts. With a wall of four segments, i did the same, creating an eight segment wall, etc. Using this method, I built 18 layers of wall (copying the last two segments from the top two segments of my previous copy). Check out my model at the bottom of the page! </p>
    </div>
  </div>
      </div>

      <div class="row" style="margin-top: 2vh; margin-bottom: 6vh;">
      <div class="col-md-8">
         <p style="font-size: 1.9vw; width: 95%; text-align: left; padding-left: 5%;"> From there, I imported my final stl file into prusa slicer, and scaled the model down to a size that could be printed with supports in under an hour. Because this model needs so much support, I had to scale my model down to mere millimeters to meet these requirements. I am excited to see what the model looks like in real life! </p>
      </div>
      <div class="col-sm-4">
      <img id="portrait" src="./sliced.PNG" class="img-responsive margin" style="width:90%; height: auto;" alt="basic motor circuit">
    </div>
    </div>





   <div class="row" style="margin-top: 6vh; margin-bottom: 6vh;">
     <div class="col-xl-10">
        <div class="render-shell js-render-shell" data-color="0x4183c4">
        

        <!-- render viewport -->
        <div id="solid-viewer" width=40% class="render-viewport" data-file="https://raw.githubusercontent.com/lcooke238/PS70/736e0fd673f09083d320a5f4ba489ae07dec81c1/05/vase4.stl"><canvas width=40% height=100%></canvas></div>
        <!-- /render viewport -->

      </div>

<script type="text/javascript"> !function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/assets/",r(r.s=14)}([function(e,t,r){var i;
  /*!
   * jQuery JavaScript Library v3.5.1
   * https://jquery.com/
   *
   * Includes Sizzle.js
   * https://sizzlejs.com/
   *
   * Copyright JS Foundation and other contributors
   * Released under the MIT license
   * https://jquery.org/license
   *
   * Date: 2020-05-04T22:49Z
   */
  !function(t,r){"use strict";"object"==typeof e.exports?e.exports=t.document?r(t,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return r(e)}:r(t)}("undefined"!=typeof window?window:this,(function(r,n){"use strict";var o=[],a=Object.getPrototypeOf,s=o.slice,l=o.flat?function(e){return o.flat.call(e)}:function(e){return o.concat.apply([],e)},c=o.push,u=o.indexOf,h={},f=h.toString,p=h.hasOwnProperty,d=p.toString,m=d.call(Object),g={},v=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},y=function(e){return null!=e&&e===e.window},x=r.document,b={type:!0,src:!0,nonce:!0,noModule:!0};function w(e,t,r){var i,n,o=(r=r||x).createElement("script");if(o.text=e,t)for(i in b)(n=t[i]||t.getAttribute&&t.getAttribute(i))&&o.setAttribute(i,n);r.head.appendChild(o).parentNode.removeChild(o)}function S(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?h[f.call(e)]||"object":typeof e}var _=function(e,t){return new _.fn.init(e,t)};function M(e){var t=!!e&&"length"in e&&e.length,r=S(e);return!v(e)&&!y(e)&&("array"===r||0===t||"number"==typeof t&&t>0&&t-1 in e)}_.fn=_.prototype={jquery:"3.5.1",constructor:_,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=_.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return _.each(this,e)},map:function(e){return this.pushStack(_.map(this,(function(t,r){return e.call(t,r,t)})))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(_.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(_.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,r=+e+(e<0?t:0);return this.pushStack(r>=0&&r<t?[this[r]]:[])},end:function(){return this.prevObject||this.constructor()},push:c,sort:o.sort,splice:o.splice},_.extend=_.fn.extend=function(){var e,t,r,i,n,o,a=arguments[0]||{},s=1,l=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[s]||{},s++),"object"==typeof a||v(a)||(a={}),s===l&&(a=this,s--);s<l;s++)if(null!=(e=arguments[s]))for(t in e)i=e[t],"__proto__"!==t&&a!==i&&(c&&i&&(_.isPlainObject(i)||(n=Array.isArray(i)))?(r=a[t],o=n&&!Array.isArray(r)?[]:n||_.isPlainObject(r)?r:{},n=!1,a[t]=_.extend(c,o,i)):void 0!==i&&(a[t]=i));return a},_.extend({expando:"jQuery"+("3.5.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,r;return!(!e||"[object Object]"!==f.call(e))&&(!(t=a(e))||"function"==typeof(r=p.call(t,"constructor")&&t.constructor)&&d.call(r)===m)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,r){w(e,{nonce:t&&t.nonce},r)},each:function(e,t){var r,i=0;if(M(e))for(r=e.length;i<r&&!1!==t.call(e[i],i,e[i]);i++);else for(i in e)if(!1===t.call(e[i],i,e[i]))break;return e},makeArray:function(e,t){var r=t||[];return null!=e&&(M(Object(e))?_.merge(r,"string"==typeof e?[e]:e):c.call(r,e)),r},inArray:function(e,t,r){return null==t?-1:u.call(t,e,r)},merge:function(e,t){for(var r=+t.length,i=0,n=e.length;i<r;i++)e[n++]=t[i];return e.length=n,e},grep:function(e,t,r){for(var i=[],n=0,o=e.length,a=!r;n<o;n++)!t(e[n],n)!==a&&i.push(e[n]);return i},map:function(e,t,r){var i,n,o=0,a=[];if(M(e))for(i=e.length;o<i;o++)null!=(n=t(e[o],o,r))&&a.push(n);else for(o in e)null!=(n=t(e[o],o,r))&&a.push(n);return l(a)},guid:1,support:g}),"function"==typeof Symbol&&(_.fn[Symbol.iterator]=o[Symbol.iterator]),_.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(e,t){h["[object "+t+"]"]=t.toLowerCase()}));var T=
  /*!
  * Sizzle CSS Selector Engine v2.3.5
  * https://sizzlejs.com/
  *
  * Copyright JS Foundation and other contributors
  * Released under the MIT license
  * https://js.foundation/
  *
  * Date: 2020-03-14
  */
  function(e){var t,r,i,n,o,a,s,l,c,u,h,f,p,d,m,g,v,y,x,b="sizzle"+1*new Date,w=e.document,S=0,_=0,M=le(),T=le(),C=le(),A=le(),E=function(e,t){return e===t&&(h=!0),0},D={}.hasOwnProperty,L=[],P=L.pop,R=L.push,F=L.push,O=L.slice,U=function(e,t){for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},N="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",V="[\\x20\\t\\r\\n\\f]",k="(?:\\\\[\\da-fA-F]{1,6}"+V+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",z="\\["+V+"*("+k+")(?:"+V+"*([*^$|!~]?=)"+V+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+k+"))|)"+V+"*\\]",B=":("+k+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+z+")*)|.*)\\)|)",I=new RegExp(V+"+","g"),j=new RegExp("^"+V+"+|((?:^|[^\\\\])(?:\\\\.)*)"+V+"+$","g"),G=new RegExp("^"+V+"*,"+V+"*"),H=new RegExp("^"+V+"*([>+~]|"+V+")"+V+"*"),W=new RegExp(V+"|>"),X=new RegExp(B),q=new RegExp("^"+k+"$"),Y={ID:new RegExp("^#("+k+")"),CLASS:new RegExp("^\\.("+k+")"),TAG:new RegExp("^("+k+"|[*])"),ATTR:new RegExp("^"+z),PSEUDO:new RegExp("^"+B),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+V+"*(even|odd|(([+-]|)(\\d*)n|)"+V+"*(?:([+-]|)"+V+"*(\\d+)|))"+V+"*\\)|)","i"),bool:new RegExp("^(?:"+N+")$","i"),needsContext:new RegExp("^"+V+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+V+"*((?:-\\d)?\\d*)"+V+"*\\)|)(?=[^-]|$)","i")},K=/HTML$/i,$=/^(?:input|select|textarea|button)$/i,Q=/^h\d$/i,Z=/^[^{]+\{\s*\[native \w/,J=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+V+"?|\\\\([^\\r\\n\\f])","g"),re=function(e,t){var r="0x"+e.slice(1)-65536;return t||(r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320))},ie=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ne=function(e,t){return t?"\0"===e?"ï¿½":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){f()},ae=be((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{F.apply(L=O.call(w.childNodes),w.childNodes),L[w.childNodes.length].nodeType}catch(e){F={apply:L.length?function(e,t){R.apply(e,O.call(t))}:function(e,t){for(var r=e.length,i=0;e[r++]=t[i++];);e.length=r-1}}}function se(e,t,i,n){var o,s,c,u,h,d,v,y=t&&t.ownerDocument,w=t?t.nodeType:9;if(i=i||[],"string"!=typeof e||!e||1!==w&&9!==w&&11!==w)return i;if(!n&&(f(t),t=t||p,m)){if(11!==w&&(h=J.exec(e)))if(o=h[1]){if(9===w){if(!(c=t.getElementById(o)))return i;if(c.id===o)return i.push(c),i}else if(y&&(c=y.getElementById(o))&&x(t,c)&&c.id===o)return i.push(c),i}else{if(h[2])return F.apply(i,t.getElementsByTagName(e)),i;if((o=h[3])&&r.getElementsByClassName&&t.getElementsByClassName)return F.apply(i,t.getElementsByClassName(o)),i}if(r.qsa&&!A[e+" "]&&(!g||!g.test(e))&&(1!==w||"object"!==t.nodeName.toLowerCase())){if(v=e,y=t,1===w&&(W.test(e)||H.test(e))){for((y=ee.test(e)&&ve(t.parentNode)||t)===t&&r.scope||((u=t.getAttribute("id"))?u=u.replace(ie,ne):t.setAttribute("id",u=b)),s=(d=a(e)).length;s--;)d[s]=(u?"#"+u:":scope")+" "+xe(d[s]);v=d.join(",")}try{return F.apply(i,y.querySelectorAll(v)),i}catch(t){A(e,!0)}finally{u===b&&t.removeAttribute("id")}}}return l(e.replace(j,"$1"),t,i,n)}function le(){var e=[];return function t(r,n){return e.push(r+" ")>i.cacheLength&&delete t[e.shift()],t[r+" "]=n}}function ce(e){return e[b]=!0,e}function ue(e){var t=p.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function he(e,t){for(var r=e.split("|"),n=r.length;n--;)i.attrHandle[r[n]]=t}function fe(e,t){var r=t&&e,i=r&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(i)return i;if(r)for(;r=r.nextSibling;)if(r===t)return-1;return e?1:-1}function pe(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function de(e){return function(t){var r=t.nodeName.toLowerCase();return("input"===r||"button"===r)&&t.type===e}}function me(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&ae(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function ge(e){return ce((function(t){return t=+t,ce((function(r,i){for(var n,o=e([],r.length,t),a=o.length;a--;)r[n=o[a]]&&(r[n]=!(i[n]=r[n]))}))}))}function ve(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in r=se.support={},o=se.isXML=function(e){var t=e.namespaceURI,r=(e.ownerDocument||e).documentElement;return!K.test(t||r&&r.nodeName||"HTML")},f=se.setDocument=function(e){var t,n,a=e?e.ownerDocument||e:w;return a!=p&&9===a.nodeType&&a.documentElement?(d=(p=a).documentElement,m=!o(p),w!=p&&(n=p.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",oe,!1):n.attachEvent&&n.attachEvent("onunload",oe)),r.scope=ue((function(e){return d.appendChild(e).appendChild(p.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),r.attributes=ue((function(e){return e.className="i",!e.getAttribute("className")})),r.getElementsByTagName=ue((function(e){return e.appendChild(p.createComment("")),!e.getElementsByTagName("*").length})),r.getElementsByClassName=Z.test(p.getElementsByClassName),r.getById=ue((function(e){return d.appendChild(e).id=b,!p.getElementsByName||!p.getElementsByName(b).length})),r.getById?(i.filter.ID=function(e){var t=e.replace(te,re);return function(e){return e.getAttribute("id")===t}},i.find.ID=function(e,t){if(void 0!==t.getElementById&&m){var r=t.getElementById(e);return r?[r]:[]}}):(i.filter.ID=function(e){var t=e.replace(te,re);return function(e){var r=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return r&&r.value===t}},i.find.ID=function(e,t){if(void 0!==t.getElementById&&m){var r,i,n,o=t.getElementById(e);if(o){if((r=o.getAttributeNode("id"))&&r.value===e)return[o];for(n=t.getElementsByName(e),i=0;o=n[i++];)if((r=o.getAttributeNode("id"))&&r.value===e)return[o]}return[]}}),i.find.TAG=r.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):r.qsa?t.querySelectorAll(e):void 0}:function(e,t){var r,i=[],n=0,o=t.getElementsByTagName(e);if("*"===e){for(;r=o[n++];)1===r.nodeType&&i.push(r);return i}return o},i.find.CLASS=r.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&m)return t.getElementsByClassName(e)},v=[],g=[],(r.qsa=Z.test(p.querySelectorAll))&&(ue((function(e){var t;d.appendChild(e).innerHTML="<a id='"+b+"'></a><select id='"+b+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&g.push("[*^$]="+V+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||g.push("\\["+V+"*(?:value|"+N+")"),e.querySelectorAll("[id~="+b+"-]").length||g.push("~="),(t=p.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||g.push("\\["+V+"*name"+V+"*="+V+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||g.push(":checked"),e.querySelectorAll("a#"+b+"+*").length||g.push(".#.+[+~]"),e.querySelectorAll("\\\f"),g.push("[\\r\\n\\f]")})),ue((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=p.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&g.push("name"+V+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&g.push(":enabled",":disabled"),d.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&g.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),g.push(",.*:")}))),(r.matchesSelector=Z.test(y=d.matches||d.webkitMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector||d.msMatchesSelector))&&ue((function(e){r.disconnectedMatch=y.call(e,"*"),y.call(e,"[s!='']:x"),v.push("!=",B)})),g=g.length&&new RegExp(g.join("|")),v=v.length&&new RegExp(v.join("|")),t=Z.test(d.compareDocumentPosition),x=t||Z.test(d.contains)?function(e,t){var r=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(r.contains?r.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},E=t?function(e,t){if(e===t)return h=!0,0;var i=!e.compareDocumentPosition-!t.compareDocumentPosition;return i||(1&(i=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!r.sortDetached&&t.compareDocumentPosition(e)===i?e==p||e.ownerDocument==w&&x(w,e)?-1:t==p||t.ownerDocument==w&&x(w,t)?1:u?U(u,e)-U(u,t):0:4&i?-1:1)}:function(e,t){if(e===t)return h=!0,0;var r,i=0,n=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!n||!o)return e==p?-1:t==p?1:n?-1:o?1:u?U(u,e)-U(u,t):0;if(n===o)return fe(e,t);for(r=e;r=r.parentNode;)a.unshift(r);for(r=t;r=r.parentNode;)s.unshift(r);for(;a[i]===s[i];)i++;return i?fe(a[i],s[i]):a[i]==w?-1:s[i]==w?1:0},p):p},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(f(e),r.matchesSelector&&m&&!A[t+" "]&&(!v||!v.test(t))&&(!g||!g.test(t)))try{var i=y.call(e,t);if(i||r.disconnectedMatch||e.document&&11!==e.document.nodeType)return i}catch(e){A(t,!0)}return se(t,p,null,[e]).length>0},se.contains=function(e,t){return(e.ownerDocument||e)!=p&&f(e),x(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=p&&f(e);var n=i.attrHandle[t.toLowerCase()],o=n&&D.call(i.attrHandle,t.toLowerCase())?n(e,t,!m):void 0;return void 0!==o?o:r.attributes||!m?e.getAttribute(t):(o=e.getAttributeNode(t))&&o.specified?o.value:null},se.escape=function(e){return(e+"").replace(ie,ne)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,i=[],n=0,o=0;if(h=!r.detectDuplicates,u=!r.sortStable&&e.slice(0),e.sort(E),h){for(;t=e[o++];)t===e[o]&&(n=i.push(o));for(;n--;)e.splice(i[n],1)}return u=null,e},n=se.getText=function(e){var t,r="",i=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)r+=n(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[i++];)r+=n(t);return r},(i=se.selectors={cacheLength:50,createPseudo:ce,match:Y,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,re),e[3]=(e[3]||e[4]||e[5]||"").replace(te,re),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,r=!e[6]&&e[2];return Y.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":r&&X.test(r)&&(t=a(r,!0))&&(t=r.indexOf(")",r.length-t)-r.length)&&(e[0]=e[0].slice(0,t),e[2]=r.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,re).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=M[e+" "];return t||(t=new RegExp("(^|"+V+")"+e+"("+V+"|$)"))&&M(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,r){return function(i){var n=se.attr(i,e);return null==n?"!="===t:!t||(n+="","="===t?n===r:"!="===t?n!==r:"^="===t?r&&0===n.indexOf(r):"*="===t?r&&n.indexOf(r)>-1:"$="===t?r&&n.slice(-r.length)===r:"~="===t?(" "+n.replace(I," ")+" ").indexOf(r)>-1:"|="===t&&(n===r||n.slice(0,r.length+1)===r+"-"))}},CHILD:function(e,t,r,i,n){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===i&&0===n?function(e){return!!e.parentNode}:function(t,r,l){var c,u,h,f,p,d,m=o!==a?"nextSibling":"previousSibling",g=t.parentNode,v=s&&t.nodeName.toLowerCase(),y=!l&&!s,x=!1;if(g){if(o){for(;m;){for(f=t;f=f[m];)if(s?f.nodeName.toLowerCase()===v:1===f.nodeType)return!1;d=m="only"===e&&!d&&"nextSibling"}return!0}if(d=[a?g.firstChild:g.lastChild],a&&y){for(x=(p=(c=(u=(h=(f=g)[b]||(f[b]={}))[f.uniqueID]||(h[f.uniqueID]={}))[e]||[])[0]===S&&c[1])&&c[2],f=p&&g.childNodes[p];f=++p&&f&&f[m]||(x=p=0)||d.pop();)if(1===f.nodeType&&++x&&f===t){u[e]=[S,p,x];break}}else if(y&&(x=p=(c=(u=(h=(f=t)[b]||(f[b]={}))[f.uniqueID]||(h[f.uniqueID]={}))[e]||[])[0]===S&&c[1]),!1===x)for(;(f=++p&&f&&f[m]||(x=p=0)||d.pop())&&((s?f.nodeName.toLowerCase()!==v:1!==f.nodeType)||!++x||(y&&((u=(h=f[b]||(f[b]={}))[f.uniqueID]||(h[f.uniqueID]={}))[e]=[S,x]),f!==t)););return(x-=n)===i||x%i==0&&x/i>=0}}},PSEUDO:function(e,t){var r,n=i.pseudos[e]||i.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return n[b]?n(t):n.length>1?(r=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?ce((function(e,r){for(var i,o=n(e,t),a=o.length;a--;)e[i=U(e,o[a])]=!(r[i]=o[a])})):function(e){return n(e,0,r)}):n}},pseudos:{not:ce((function(e){var t=[],r=[],i=s(e.replace(j,"$1"));return i[b]?ce((function(e,t,r,n){for(var o,a=i(e,null,n,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))})):function(e,n,o){return t[0]=e,i(t,null,o,r),t[0]=null,!r.pop()}})),has:ce((function(e){return function(t){return se(e,t).length>0}})),contains:ce((function(e){return e=e.replace(te,re),function(t){return(t.textContent||n(t)).indexOf(e)>-1}})),lang:ce((function(e){return q.test(e||"")||se.error("unsupported lang: "+e),e=e.replace(te,re).toLowerCase(),function(t){var r;do{if(r=m?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(r=r.toLowerCase())===e||0===r.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(t){var r=e.location&&e.location.hash;return r&&r.slice(1)===t.id},root:function(e){return e===d},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:me(!1),disabled:me(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return Q.test(e.nodeName)},input:function(e){return $.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ge((function(){return[0]})),last:ge((function(e,t){return[t-1]})),eq:ge((function(e,t,r){return[r<0?r+t:r]})),even:ge((function(e,t){for(var r=0;r<t;r+=2)e.push(r);return e})),odd:ge((function(e,t){for(var r=1;r<t;r+=2)e.push(r);return e})),lt:ge((function(e,t,r){for(var i=r<0?r+t:r>t?t:r;--i>=0;)e.push(i);return e})),gt:ge((function(e,t,r){for(var i=r<0?r+t:r;++i<t;)e.push(i);return e}))}}).pseudos.nth=i.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[t]=pe(t);for(t in{submit:!0,reset:!0})i.pseudos[t]=de(t);function ye(){}function xe(e){for(var t=0,r=e.length,i="";t<r;t++)i+=e[t].value;return i}function be(e,t,r){var i=t.dir,n=t.next,o=n||i,a=r&&"parentNode"===o,s=_++;return t.first?function(t,r,n){for(;t=t[i];)if(1===t.nodeType||a)return e(t,r,n);return!1}:function(t,r,l){var c,u,h,f=[S,s];if(l){for(;t=t[i];)if((1===t.nodeType||a)&&e(t,r,l))return!0}else for(;t=t[i];)if(1===t.nodeType||a)if(u=(h=t[b]||(t[b]={}))[t.uniqueID]||(h[t.uniqueID]={}),n&&n===t.nodeName.toLowerCase())t=t[i]||t;else{if((c=u[o])&&c[0]===S&&c[1]===s)return f[2]=c[2];if(u[o]=f,f[2]=e(t,r,l))return!0}return!1}}function we(e){return e.length>1?function(t,r,i){for(var n=e.length;n--;)if(!e[n](t,r,i))return!1;return!0}:e[0]}function Se(e,t,r,i,n){for(var o,a=[],s=0,l=e.length,c=null!=t;s<l;s++)(o=e[s])&&(r&&!r(o,i,n)||(a.push(o),c&&t.push(s)));return a}function _e(e,t,r,i,n,o){return i&&!i[b]&&(i=_e(i)),n&&!n[b]&&(n=_e(n,o)),ce((function(o,a,s,l){var c,u,h,f=[],p=[],d=a.length,m=o||function(e,t,r){for(var i=0,n=t.length;i<n;i++)se(e,t[i],r);return r}(t||"*",s.nodeType?[s]:s,[]),g=!e||!o&&t?m:Se(m,f,e,s,l),v=r?n||(o?e:d||i)?[]:a:g;if(r&&r(g,v,s,l),i)for(c=Se(v,p),i(c,[],s,l),u=c.length;u--;)(h=c[u])&&(v[p[u]]=!(g[p[u]]=h));if(o){if(n||e){if(n){for(c=[],u=v.length;u--;)(h=v[u])&&c.push(g[u]=h);n(null,v=[],c,l)}for(u=v.length;u--;)(h=v[u])&&(c=n?U(o,h):f[u])>-1&&(o[c]=!(a[c]=h))}}else v=Se(v===a?v.splice(d,v.length):v),n?n(null,a,v,l):F.apply(a,v)}))}function Me(e){for(var t,r,n,o=e.length,a=i.relative[e[0].type],s=a||i.relative[" "],l=a?1:0,u=be((function(e){return e===t}),s,!0),h=be((function(e){return U(t,e)>-1}),s,!0),f=[function(e,r,i){var n=!a&&(i||r!==c)||((t=r).nodeType?u(e,r,i):h(e,r,i));return t=null,n}];l<o;l++)if(r=i.relative[e[l].type])f=[be(we(f),r)];else{if((r=i.filter[e[l].type].apply(null,e[l].matches))[b]){for(n=++l;n<o&&!i.relative[e[n].type];n++);return _e(l>1&&we(f),l>1&&xe(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(j,"$1"),r,l<n&&Me(e.slice(l,n)),n<o&&Me(e=e.slice(n)),n<o&&xe(e))}f.push(r)}return we(f)}return ye.prototype=i.filters=i.pseudos,i.setFilters=new ye,a=se.tokenize=function(e,t){var r,n,o,a,s,l,c,u=T[e+" "];if(u)return t?0:u.slice(0);for(s=e,l=[],c=i.preFilter;s;){for(a in r&&!(n=G.exec(s))||(n&&(s=s.slice(n[0].length)||s),l.push(o=[])),r=!1,(n=H.exec(s))&&(r=n.shift(),o.push({value:r,type:n[0].replace(j," ")}),s=s.slice(r.length)),i.filter)!(n=Y[a].exec(s))||c[a]&&!(n=c[a](n))||(r=n.shift(),o.push({value:r,type:a,matches:n}),s=s.slice(r.length));if(!r)break}return t?s.length:s?se.error(e):T(e,l).slice(0)},s=se.compile=function(e,t){var r,n=[],o=[],s=C[e+" "];if(!s){for(t||(t=a(e)),r=t.length;r--;)(s=Me(t[r]))[b]?n.push(s):o.push(s);(s=C(e,function(e,t){var r=t.length>0,n=e.length>0,o=function(o,a,s,l,u){var h,d,g,v=0,y="0",x=o&&[],b=[],w=c,_=o||n&&i.find.TAG("*",u),M=S+=null==w?1:Math.random()||.1,T=_.length;for(u&&(c=a==p||a||u);y!==T&&null!=(h=_[y]);y++){if(n&&h){for(d=0,a||h.ownerDocument==p||(f(h),s=!m);g=e[d++];)if(g(h,a||p,s)){l.push(h);break}u&&(S=M)}r&&((h=!g&&h)&&v--,o&&x.push(h))}if(v+=y,r&&y!==v){for(d=0;g=t[d++];)g(x,b,a,s);if(o){if(v>0)for(;y--;)x[y]||b[y]||(b[y]=P.call(l));b=Se(b)}F.apply(l,b),u&&!o&&b.length>0&&v+t.length>1&&se.uniqueSort(l)}return u&&(S=M,c=w),x};return r?ce(o):o}(o,n))).selector=e}return s},l=se.select=function(e,t,r,n){var o,l,c,u,h,f="function"==typeof e&&e,p=!n&&a(e=f.selector||e);if(r=r||[],1===p.length){if((l=p[0]=p[0].slice(0)).length>2&&"ID"===(c=l[0]).type&&9===t.nodeType&&m&&i.relative[l[1].type]){if(!(t=(i.find.ID(c.matches[0].replace(te,re),t)||[])[0]))return r;f&&(t=t.parentNode),e=e.slice(l.shift().value.length)}for(o=Y.needsContext.test(e)?0:l.length;o--&&(c=l[o],!i.relative[u=c.type]);)if((h=i.find[u])&&(n=h(c.matches[0].replace(te,re),ee.test(l[0].type)&&ve(t.parentNode)||t))){if(l.splice(o,1),!(e=n.length&&xe(l)))return F.apply(r,n),r;break}}return(f||s(e,p))(n,t,!m,r,!t||ee.test(e)&&ve(t.parentNode)||t),r},r.sortStable=b.split("").sort(E).join("")===b,r.detectDuplicates=!!h,f(),r.sortDetached=ue((function(e){return 1&e.compareDocumentPosition(p.createElement("fieldset"))})),ue((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||he("type|href|height|width",(function(e,t,r){if(!r)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),r.attributes&&ue((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||he("value",(function(e,t,r){if(!r&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),ue((function(e){return null==e.getAttribute("disabled")}))||he(N,(function(e,t,r){var i;if(!r)return!0===e[t]?t.toLowerCase():(i=e.getAttributeNode(t))&&i.specified?i.value:null})),se}(r);_.find=T,_.expr=T.selectors,_.expr[":"]=_.expr.pseudos,_.uniqueSort=_.unique=T.uniqueSort,_.text=T.getText,_.isXMLDoc=T.isXML,_.contains=T.contains,_.escapeSelector=T.escape;var C=function(e,t,r){for(var i=[],n=void 0!==r;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(n&&_(e).is(r))break;i.push(e)}return i},A=function(e,t){for(var r=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&r.push(e);return r},E=_.expr.match.needsContext;function D(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var L=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function P(e,t,r){return v(t)?_.grep(e,(function(e,i){return!!t.call(e,i,e)!==r})):t.nodeType?_.grep(e,(function(e){return e===t!==r})):"string"!=typeof t?_.grep(e,(function(e){return u.call(t,e)>-1!==r})):_.filter(t,e,r)}_.filter=function(e,t,r){var i=t[0];return r&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?_.find.matchesSelector(i,e)?[i]:[]:_.find.matches(e,_.grep(t,(function(e){return 1===e.nodeType})))},_.fn.extend({find:function(e){var t,r,i=this.length,n=this;if("string"!=typeof e)return this.pushStack(_(e).filter((function(){for(t=0;t<i;t++)if(_.contains(n[t],this))return!0})));for(r=this.pushStack([]),t=0;t<i;t++)_.find(e,n[t],r);return i>1?_.uniqueSort(r):r},filter:function(e){return this.pushStack(P(this,e||[],!1))},not:function(e){return this.pushStack(P(this,e||[],!0))},is:function(e){return!!P(this,"string"==typeof e&&E.test(e)?_(e):e||[],!1).length}});var R,F=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(_.fn.init=function(e,t,r){var i,n;if(!e)return this;if(r=r||R,"string"==typeof e){if(!(i="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:F.exec(e))||!i[1]&&t)return!t||t.jquery?(t||r).find(e):this.constructor(t).find(e);if(i[1]){if(t=t instanceof _?t[0]:t,_.merge(this,_.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:x,!0)),L.test(i[1])&&_.isPlainObject(t))for(i in t)v(this[i])?this[i](t[i]):this.attr(i,t[i]);return this}return(n=x.getElementById(i[2]))&&(this[0]=n,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):v(e)?void 0!==r.ready?r.ready(e):e(_):_.makeArray(e,this)}).prototype=_.fn,R=_(x);var O=/^(?:parents|prev(?:Until|All))/,U={children:!0,contents:!0,next:!0,prev:!0};function N(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}_.fn.extend({has:function(e){var t=_(e,this),r=t.length;return this.filter((function(){for(var e=0;e<r;e++)if(_.contains(this,t[e]))return!0}))},closest:function(e,t){var r,i=0,n=this.length,o=[],a="string"!=typeof e&&_(e);if(!E.test(e))for(;i<n;i++)for(r=this[i];r&&r!==t;r=r.parentNode)if(r.nodeType<11&&(a?a.index(r)>-1:1===r.nodeType&&_.find.matchesSelector(r,e))){o.push(r);break}return this.pushStack(o.length>1?_.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?u.call(_(e),this[0]):u.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(_.uniqueSort(_.merge(this.get(),_(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),_.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return C(e,"parentNode")},parentsUntil:function(e,t,r){return C(e,"parentNode",r)},next:function(e){return N(e,"nextSibling")},prev:function(e){return N(e,"previousSibling")},nextAll:function(e){return C(e,"nextSibling")},prevAll:function(e){return C(e,"previousSibling")},nextUntil:function(e,t,r){return C(e,"nextSibling",r)},prevUntil:function(e,t,r){return C(e,"previousSibling",r)},siblings:function(e){return A((e.parentNode||{}).firstChild,e)},children:function(e){return A(e.firstChild)},contents:function(e){return null!=e.contentDocument&&a(e.contentDocument)?e.contentDocument:(D(e,"template")&&(e=e.content||e),_.merge([],e.childNodes))}},(function(e,t){_.fn[e]=function(r,i){var n=_.map(this,t,r);return"Until"!==e.slice(-5)&&(i=r),i&&"string"==typeof i&&(n=_.filter(i,n)),this.length>1&&(U[e]||_.uniqueSort(n),O.test(e)&&n.reverse()),this.pushStack(n)}}));var V=/[^\x20\t\r\n\f]+/g;function k(e){return e}function z(e){throw e}function B(e,t,r,i){var n;try{e&&v(n=e.promise)?n.call(e).done(t).fail(r):e&&v(n=e.then)?n.call(e,t,r):t.apply(void 0,[e].slice(i))}catch(e){r.apply(void 0,[e])}}_.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return _.each(e.match(V)||[],(function(e,r){t[r]=!0})),t}(e):_.extend({},e);var t,r,i,n,o=[],a=[],s=-1,l=function(){for(n=n||e.once,i=t=!0;a.length;s=-1)for(r=a.shift();++s<o.length;)!1===o[s].apply(r[0],r[1])&&e.stopOnFalse&&(s=o.length,r=!1);e.memory||(r=!1),t=!1,n&&(o=r?[]:"")},c={add:function(){return o&&(r&&!t&&(s=o.length-1,a.push(r)),function t(r){_.each(r,(function(r,i){v(i)?e.unique&&c.has(i)||o.push(i):i&&i.length&&"string"!==S(i)&&t(i)}))}(arguments),r&&!t&&l()),this},remove:function(){return _.each(arguments,(function(e,t){for(var r;(r=_.inArray(t,o,r))>-1;)o.splice(r,1),r<=s&&s--})),this},has:function(e){return e?_.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return n=a=[],o=r="",this},disabled:function(){return!o},lock:function(){return n=a=[],r||t||(o=r=""),this},locked:function(){return!!n},fireWith:function(e,r){return n||(r=[e,(r=r||[]).slice?r.slice():r],a.push(r),t||l()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!i}};return c},_.extend({Deferred:function(e){var t=[["notify","progress",_.Callbacks("memory"),_.Callbacks("memory"),2],["resolve","done",_.Callbacks("once memory"),_.Callbacks("once memory"),0,"resolved"],["reject","fail",_.Callbacks("once memory"),_.Callbacks("once memory"),1,"rejected"]],i="pending",n={state:function(){return i},always:function(){return o.done(arguments).fail(arguments),this},catch:function(e){return n.then(null,e)},pipe:function(){var e=arguments;return _.Deferred((function(r){_.each(t,(function(t,i){var n=v(e[i[4]])&&e[i[4]];o[i[1]]((function(){var e=n&&n.apply(this,arguments);e&&v(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[i[0]+"With"](this,n?[e]:arguments)}))})),e=null})).promise()},then:function(e,i,n){var o=0;function a(e,t,i,n){return function(){var s=this,l=arguments,c=function(){var r,c;if(!(e<o)){if((r=i.apply(s,l))===t.promise())throw new TypeError("Thenable self-resolution");c=r&&("object"==typeof r||"function"==typeof r)&&r.then,v(c)?n?c.call(r,a(o,t,k,n),a(o,t,z,n)):(o++,c.call(r,a(o,t,k,n),a(o,t,z,n),a(o,t,k,t.notifyWith))):(i!==k&&(s=void 0,l=[r]),(n||t.resolveWith)(s,l))}},u=n?c:function(){try{c()}catch(r){_.Deferred.exceptionHook&&_.Deferred.exceptionHook(r,u.stackTrace),e+1>=o&&(i!==z&&(s=void 0,l=[r]),t.rejectWith(s,l))}};e?u():(_.Deferred.getStackHook&&(u.stackTrace=_.Deferred.getStackHook()),r.setTimeout(u))}}return _.Deferred((function(r){t[0][3].add(a(0,r,v(n)?n:k,r.notifyWith)),t[1][3].add(a(0,r,v(e)?e:k)),t[2][3].add(a(0,r,v(i)?i:z))})).promise()},promise:function(e){return null!=e?_.extend(e,n):n}},o={};return _.each(t,(function(e,r){var a=r[2],s=r[5];n[r[1]]=a.add,s&&a.add((function(){i=s}),t[3-e][2].disable,t[3-e][3].disable,t[0][2].lock,t[0][3].lock),a.add(r[3].fire),o[r[0]]=function(){return o[r[0]+"With"](this===o?void 0:this,arguments),this},o[r[0]+"With"]=a.fireWith})),n.promise(o),e&&e.call(o,o),o},when:function(e){var t=arguments.length,r=t,i=Array(r),n=s.call(arguments),o=_.Deferred(),a=function(e){return function(r){i[e]=this,n[e]=arguments.length>1?s.call(arguments):r,--t||o.resolveWith(i,n)}};if(t<=1&&(B(e,o.done(a(r)).resolve,o.reject,!t),"pending"===o.state()||v(n[r]&&n[r].then)))return o.then();for(;r--;)B(n[r],a(r),o.reject);return o.promise()}});var I=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;_.Deferred.exceptionHook=function(e,t){r.console&&r.console.warn&&e&&I.test(e.name)&&r.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},_.readyException=function(e){r.setTimeout((function(){throw e}))};var j=_.Deferred();function G(){x.removeEventListener("DOMContentLoaded",G),r.removeEventListener("load",G),_.ready()}_.fn.ready=function(e){return j.then(e).catch((function(e){_.readyException(e)})),this},_.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--_.readyWait:_.isReady)||(_.isReady=!0,!0!==e&&--_.readyWait>0||j.resolveWith(x,[_]))}}),_.ready.then=j.then,"complete"===x.readyState||"loading"!==x.readyState&&!x.documentElement.doScroll?r.setTimeout(_.ready):(x.addEventListener("DOMContentLoaded",G),r.addEventListener("load",G));var H=function(e,t,r,i,n,o,a){var s=0,l=e.length,c=null==r;if("object"===S(r))for(s in n=!0,r)H(e,t,s,r[s],!0,o,a);else if(void 0!==i&&(n=!0,v(i)||(a=!0),c&&(a?(t.call(e,i),t=null):(c=t,t=function(e,t,r){return c.call(_(e),r)})),t))for(;s<l;s++)t(e[s],r,a?i:i.call(e[s],s,t(e[s],r)));return n?e:c?t.call(e):l?t(e[0],r):o},W=/^-ms-/,X=/-([a-z])/g;function q(e,t){return t.toUpperCase()}function Y(e){return e.replace(W,"ms-").replace(X,q)}var K=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function $(){this.expando=_.expando+$.uid++}$.uid=1,$.prototype={cache:function(e){var t=e[this.expando];return t||(t={},K(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,r){var i,n=this.cache(e);if("string"==typeof t)n[Y(t)]=r;else for(i in t)n[Y(i)]=t[i];return n},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][Y(t)]},access:function(e,t,r){return void 0===t||t&&"string"==typeof t&&void 0===r?this.get(e,t):(this.set(e,t,r),void 0!==r?r:t)},remove:function(e,t){var r,i=e[this.expando];if(void 0!==i){if(void 0!==t){r=(t=Array.isArray(t)?t.map(Y):(t=Y(t))in i?[t]:t.match(V)||[]).length;for(;r--;)delete i[t[r]]}(void 0===t||_.isEmptyObject(i))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!_.isEmptyObject(t)}};var Q=new $,Z=new $,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ee=/[A-Z]/g;function te(e,t,r){var i;if(void 0===r&&1===e.nodeType)if(i="data-"+t.replace(ee,"-$&").toLowerCase(),"string"==typeof(r=e.getAttribute(i))){try{r=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:J.test(e)?JSON.parse(e):e)}(r)}catch(e){}Z.set(e,t,r)}else r=void 0;return r}_.extend({hasData:function(e){return Z.hasData(e)||Q.hasData(e)},data:function(e,t,r){return Z.access(e,t,r)},removeData:function(e,t){Z.remove(e,t)},_data:function(e,t,r){return Q.access(e,t,r)},_removeData:function(e,t){Q.remove(e,t)}}),_.fn.extend({data:function(e,t){var r,i,n,o=this[0],a=o&&o.attributes;if(void 0===e){if(this.length&&(n=Z.get(o),1===o.nodeType&&!Q.get(o,"hasDataAttrs"))){for(r=a.length;r--;)a[r]&&0===(i=a[r].name).indexOf("data-")&&(i=Y(i.slice(5)),te(o,i,n[i]));Q.set(o,"hasDataAttrs",!0)}return n}return"object"==typeof e?this.each((function(){Z.set(this,e)})):H(this,(function(t){var r;if(o&&void 0===t)return void 0!==(r=Z.get(o,e))||void 0!==(r=te(o,e))?r:void 0;this.each((function(){Z.set(this,e,t)}))}),null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each((function(){Z.remove(this,e)}))}}),_.extend({queue:function(e,t,r){var i;if(e)return t=(t||"fx")+"queue",i=Q.get(e,t),r&&(!i||Array.isArray(r)?i=Q.access(e,t,_.makeArray(r)):i.push(r)),i||[]},dequeue:function(e,t){t=t||"fx";var r=_.queue(e,t),i=r.length,n=r.shift(),o=_._queueHooks(e,t);"inprogress"===n&&(n=r.shift(),i--),n&&("fx"===t&&r.unshift("inprogress"),delete o.stop,n.call(e,(function(){_.dequeue(e,t)}),o)),!i&&o&&o.empty.fire()},_queueHooks:function(e,t){var r=t+"queueHooks";return Q.get(e,r)||Q.access(e,r,{empty:_.Callbacks("once memory").add((function(){Q.remove(e,[t+"queue",r])}))})}}),_.fn.extend({queue:function(e,t){var r=2;return"string"!=typeof e&&(t=e,e="fx",r--),arguments.length<r?_.queue(this[0],e):void 0===t?this:this.each((function(){var r=_.queue(this,e,t);_._queueHooks(this,e),"fx"===e&&"inprogress"!==r[0]&&_.dequeue(this,e)}))},dequeue:function(e){return this.each((function(){_.dequeue(this,e)}))},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var r,i=1,n=_.Deferred(),o=this,a=this.length,s=function(){--i||n.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)(r=Q.get(o[a],e+"queueHooks"))&&r.empty&&(i++,r.empty.add(s));return s(),n.promise(t)}});var re=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ie=new RegExp("^(?:([+-])=|)("+re+")([a-z%]*)$","i"),ne=["Top","Right","Bottom","Left"],oe=x.documentElement,ae=function(e){return _.contains(e.ownerDocument,e)},se={composed:!0};oe.getRootNode&&(ae=function(e){return _.contains(e.ownerDocument,e)||e.getRootNode(se)===e.ownerDocument});var le=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ae(e)&&"none"===_.css(e,"display")};function ce(e,t,r,i){var n,o,a=20,s=i?function(){return i.cur()}:function(){return _.css(e,t,"")},l=s(),c=r&&r[3]||(_.cssNumber[t]?"":"px"),u=e.nodeType&&(_.cssNumber[t]||"px"!==c&&+l)&&ie.exec(_.css(e,t));if(u&&u[3]!==c){for(l/=2,c=c||u[3],u=+l||1;a--;)_.style(e,t,u+c),(1-o)*(1-(o=s()/l||.5))<=0&&(a=0),u/=o;u*=2,_.style(e,t,u+c),r=r||[]}return r&&(u=+u||+l||0,n=r[1]?u+(r[1]+1)*r[2]:+r[2],i&&(i.unit=c,i.start=u,i.end=n)),n}var ue={};function he(e){var t,r=e.ownerDocument,i=e.nodeName,n=ue[i];return n||(t=r.body.appendChild(r.createElement(i)),n=_.css(t,"display"),t.parentNode.removeChild(t),"none"===n&&(n="block"),ue[i]=n,n)}function fe(e,t){for(var r,i,n=[],o=0,a=e.length;o<a;o++)(i=e[o]).style&&(r=i.style.display,t?("none"===r&&(n[o]=Q.get(i,"display")||null,n[o]||(i.style.display="")),""===i.style.display&&le(i)&&(n[o]=he(i))):"none"!==r&&(n[o]="none",Q.set(i,"display",r)));for(o=0;o<a;o++)null!=n[o]&&(e[o].style.display=n[o]);return e}_.fn.extend({show:function(){return fe(this,!0)},hide:function(){return fe(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each((function(){le(this)?_(this).show():_(this).hide()}))}});var pe,de,me=/^(?:checkbox|radio)$/i,ge=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,ve=/^$|^module$|\/(?:java|ecma)script/i;pe=x.createDocumentFragment().appendChild(x.createElement("div")),(de=x.createElement("input")).setAttribute("type","radio"),de.setAttribute("checked","checked"),de.setAttribute("name","t"),pe.appendChild(de),g.checkClone=pe.cloneNode(!0).cloneNode(!0).lastChild.checked,pe.innerHTML="<textarea>x</textarea>",g.noCloneChecked=!!pe.cloneNode(!0).lastChild.defaultValue,pe.innerHTML="<option></option>",g.option=!!pe.lastChild;var ye={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function xe(e,t){var r;return r=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&D(e,t)?_.merge([e],r):r}function be(e,t){for(var r=0,i=e.length;r<i;r++)Q.set(e[r],"globalEval",!t||Q.get(t[r],"globalEval"))}ye.tbody=ye.tfoot=ye.colgroup=ye.caption=ye.thead,ye.th=ye.td,g.option||(ye.optgroup=ye.option=[1,"<select multiple='multiple'>","</select>"]);var we=/<|&#?\w+;/;function Se(e,t,r,i,n){for(var o,a,s,l,c,u,h=t.createDocumentFragment(),f=[],p=0,d=e.length;p<d;p++)if((o=e[p])||0===o)if("object"===S(o))_.merge(f,o.nodeType?[o]:o);else if(we.test(o)){for(a=a||h.appendChild(t.createElement("div")),s=(ge.exec(o)||["",""])[1].toLowerCase(),l=ye[s]||ye._default,a.innerHTML=l[1]+_.htmlPrefilter(o)+l[2],u=l[0];u--;)a=a.lastChild;_.merge(f,a.childNodes),(a=h.firstChild).textContent=""}else f.push(t.createTextNode(o));for(h.textContent="",p=0;o=f[p++];)if(i&&_.inArray(o,i)>-1)n&&n.push(o);else if(c=ae(o),a=xe(h.appendChild(o),"script"),c&&be(a),r)for(u=0;o=a[u++];)ve.test(o.type||"")&&r.push(o);return h}var _e=/^key/,Me=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Te=/^([^.]*)(?:\.(.+)|)/;function Ce(){return!0}function Ae(){return!1}function Ee(e,t){return e===function(){try{return x.activeElement}catch(e){}}()==("focus"===t)}function De(e,t,r,i,n,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof r&&(i=i||r,r=void 0),t)De(e,s,r,i,t[s],o);return e}if(null==i&&null==n?(n=r,i=r=void 0):null==n&&("string"==typeof r?(n=i,i=void 0):(n=i,i=r,r=void 0)),!1===n)n=Ae;else if(!n)return e;return 1===o&&(a=n,(n=function(e){return _().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=_.guid++)),e.each((function(){_.event.add(this,t,n,i,r)}))}function Le(e,t,r){r?(Q.set(e,t,!1),_.event.add(e,t,{namespace:!1,handler:function(e){var i,n,o=Q.get(this,t);if(1&e.isTrigger&&this[t]){if(o.length)(_.event.special[t]||{}).delegateType&&e.stopPropagation();else if(o=s.call(arguments),Q.set(this,t,o),i=r(this,t),this[t](),o!==(n=Q.get(this,t))||i?Q.set(this,t,!1):n={},o!==n)return e.stopImmediatePropagation(),e.preventDefault(),n.value}else o.length&&(Q.set(this,t,{value:_.event.trigger(_.extend(o[0],_.Event.prototype),o.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Q.get(e,t)&&_.event.add(e,t,Ce)}_.event={global:{},add:function(e,t,r,i,n){var o,a,s,l,c,u,h,f,p,d,m,g=Q.get(e);if(K(e))for(r.handler&&(r=(o=r).handler,n=o.selector),n&&_.find.matchesSelector(oe,n),r.guid||(r.guid=_.guid++),(l=g.events)||(l=g.events=Object.create(null)),(a=g.handle)||(a=g.handle=function(t){return void 0!==_&&_.event.triggered!==t.type?_.event.dispatch.apply(e,arguments):void 0}),c=(t=(t||"").match(V)||[""]).length;c--;)p=m=(s=Te.exec(t[c])||[])[1],d=(s[2]||"").split(".").sort(),p&&(h=_.event.special[p]||{},p=(n?h.delegateType:h.bindType)||p,h=_.event.special[p]||{},u=_.extend({type:p,origType:m,data:i,handler:r,guid:r.guid,selector:n,needsContext:n&&_.expr.match.needsContext.test(n),namespace:d.join(".")},o),(f=l[p])||((f=l[p]=[]).delegateCount=0,h.setup&&!1!==h.setup.call(e,i,d,a)||e.addEventListener&&e.addEventListener(p,a)),h.add&&(h.add.call(e,u),u.handler.guid||(u.handler.guid=r.guid)),n?f.splice(f.delegateCount++,0,u):f.push(u),_.event.global[p]=!0)},remove:function(e,t,r,i,n){var o,a,s,l,c,u,h,f,p,d,m,g=Q.hasData(e)&&Q.get(e);if(g&&(l=g.events)){for(c=(t=(t||"").match(V)||[""]).length;c--;)if(p=m=(s=Te.exec(t[c])||[])[1],d=(s[2]||"").split(".").sort(),p){for(h=_.event.special[p]||{},f=l[p=(i?h.delegateType:h.bindType)||p]||[],s=s[2]&&new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=f.length;o--;)u=f[o],!n&&m!==u.origType||r&&r.guid!==u.guid||s&&!s.test(u.namespace)||i&&i!==u.selector&&("**"!==i||!u.selector)||(f.splice(o,1),u.selector&&f.delegateCount--,h.remove&&h.remove.call(e,u));a&&!f.length&&(h.teardown&&!1!==h.teardown.call(e,d,g.handle)||_.removeEvent(e,p,g.handle),delete l[p])}else for(p in l)_.event.remove(e,p+t[c],r,i,!0);_.isEmptyObject(l)&&Q.remove(e,"handle events")}},dispatch:function(e){var t,r,i,n,o,a,s=new Array(arguments.length),l=_.event.fix(e),c=(Q.get(this,"events")||Object.create(null))[l.type]||[],u=_.event.special[l.type]||{};for(s[0]=l,t=1;t<arguments.length;t++)s[t]=arguments[t];if(l.delegateTarget=this,!u.preDispatch||!1!==u.preDispatch.call(this,l)){for(a=_.event.handlers.call(this,l,c),t=0;(n=a[t++])&&!l.isPropagationStopped();)for(l.currentTarget=n.elem,r=0;(o=n.handlers[r++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!1!==o.namespace&&!l.rnamespace.test(o.namespace)||(l.handleObj=o,l.data=o.data,void 0!==(i=((_.event.special[o.origType]||{}).handle||o.handler).apply(n.elem,s))&&!1===(l.result=i)&&(l.preventDefault(),l.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,l),l.result}},handlers:function(e,t){var r,i,n,o,a,s=[],l=t.delegateCount,c=e.target;if(l&&c.nodeType&&!("click"===e.type&&e.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==e.type||!0!==c.disabled)){for(o=[],a={},r=0;r<l;r++)void 0===a[n=(i=t[r]).selector+" "]&&(a[n]=i.needsContext?_(n,this).index(c)>-1:_.find(n,this,null,[c]).length),a[n]&&o.push(i);o.length&&s.push({elem:c,handlers:o})}return c=this,l<t.length&&s.push({elem:c,handlers:t.slice(l)}),s},addProp:function(e,t){Object.defineProperty(_.Event.prototype,e,{enumerable:!0,configurable:!0,get:v(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[_.expando]?e:new _.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return me.test(t.type)&&t.click&&D(t,"input")&&Le(t,"click",Ce),!1},trigger:function(e){var t=this||e;return me.test(t.type)&&t.click&&D(t,"input")&&Le(t,"click"),!0},_default:function(e){var t=e.target;return me.test(t.type)&&t.click&&D(t,"input")&&Q.get(t,"click")||D(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},_.removeEvent=function(e,t,r){e.removeEventListener&&e.removeEventListener(t,r)},_.Event=function(e,t){if(!(this instanceof _.Event))return new _.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ce:Ae,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&_.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[_.expando]=!0},_.Event.prototype={constructor:_.Event,isDefaultPrevented:Ae,isPropagationStopped:Ae,isImmediatePropagationStopped:Ae,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ce,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ce,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ce,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},_.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&_e.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Me.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},_.event.addProp),_.each({focus:"focusin",blur:"focusout"},(function(e,t){_.event.special[e]={setup:function(){return Le(this,e,Ee),!1},trigger:function(){return Le(this,e),!0},delegateType:t}})),_.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(e,t){_.event.special[e]={delegateType:t,bindType:t,handle:function(e){var r,i=this,n=e.relatedTarget,o=e.handleObj;return n&&(n===i||_.contains(i,n))||(e.type=o.origType,r=o.handler.apply(this,arguments),e.type=t),r}}})),_.fn.extend({on:function(e,t,r,i){return De(this,e,t,r,i)},one:function(e,t,r,i){return De(this,e,t,r,i,1)},off:function(e,t,r){var i,n;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,_(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(n in e)this.off(n,t,e[n]);return this}return!1!==t&&"function"!=typeof t||(r=t,t=void 0),!1===r&&(r=Ae),this.each((function(){_.event.remove(this,e,r,t)}))}});var Pe=/<script|<style|<link/i,Re=/checked\s*(?:[^=]|=\s*.checked.)/i,Fe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Oe(e,t){return D(e,"table")&&D(11!==t.nodeType?t:t.firstChild,"tr")&&_(e).children("tbody")[0]||e}function Ue(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Ne(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Ve(e,t){var r,i,n,o,a,s;if(1===t.nodeType){if(Q.hasData(e)&&(s=Q.get(e).events))for(n in Q.remove(t,"handle events"),s)for(r=0,i=s[n].length;r<i;r++)_.event.add(t,n,s[n][r]);Z.hasData(e)&&(o=Z.access(e),a=_.extend({},o),Z.set(t,a))}}function ke(e,t){var r=t.nodeName.toLowerCase();"input"===r&&me.test(e.type)?t.checked=e.checked:"input"!==r&&"textarea"!==r||(t.defaultValue=e.defaultValue)}function ze(e,t,r,i){t=l(t);var n,o,a,s,c,u,h=0,f=e.length,p=f-1,d=t[0],m=v(d);if(m||f>1&&"string"==typeof d&&!g.checkClone&&Re.test(d))return e.each((function(n){var o=e.eq(n);m&&(t[0]=d.call(this,n,o.html())),ze(o,t,r,i)}));if(f&&(o=(n=Se(t,e[0].ownerDocument,!1,e,i)).firstChild,1===n.childNodes.length&&(n=o),o||i)){for(s=(a=_.map(xe(n,"script"),Ue)).length;h<f;h++)c=n,h!==p&&(c=_.clone(c,!0,!0),s&&_.merge(a,xe(c,"script"))),r.call(e[h],c,h);if(s)for(u=a[a.length-1].ownerDocument,_.map(a,Ne),h=0;h<s;h++)c=a[h],ve.test(c.type||"")&&!Q.access(c,"globalEval")&&_.contains(u,c)&&(c.src&&"module"!==(c.type||"").toLowerCase()?_._evalUrl&&!c.noModule&&_._evalUrl(c.src,{nonce:c.nonce||c.getAttribute("nonce")},u):w(c.textContent.replace(Fe,""),c,u))}return e}function Be(e,t,r){for(var i,n=t?_.filter(t,e):e,o=0;null!=(i=n[o]);o++)r||1!==i.nodeType||_.cleanData(xe(i)),i.parentNode&&(r&&ae(i)&&be(xe(i,"script")),i.parentNode.removeChild(i));return e}_.extend({htmlPrefilter:function(e){return e},clone:function(e,t,r){var i,n,o,a,s=e.cloneNode(!0),l=ae(e);if(!(g.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||_.isXMLDoc(e)))for(a=xe(s),i=0,n=(o=xe(e)).length;i<n;i++)ke(o[i],a[i]);if(t)if(r)for(o=o||xe(e),a=a||xe(s),i=0,n=o.length;i<n;i++)Ve(o[i],a[i]);else Ve(e,s);return(a=xe(s,"script")).length>0&&be(a,!l&&xe(e,"script")),s},cleanData:function(e){for(var t,r,i,n=_.event.special,o=0;void 0!==(r=e[o]);o++)if(K(r)){if(t=r[Q.expando]){if(t.events)for(i in t.events)n[i]?_.event.remove(r,i):_.removeEvent(r,i,t.handle);r[Q.expando]=void 0}r[Z.expando]&&(r[Z.expando]=void 0)}}}),_.fn.extend({detach:function(e){return Be(this,e,!0)},remove:function(e){return Be(this,e)},text:function(e){return H(this,(function(e){return void 0===e?_.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append:function(){return ze(this,arguments,(function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Oe(this,e).appendChild(e)}))},prepend:function(){return ze(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Oe(this,e);t.insertBefore(e,t.firstChild)}}))},before:function(){return ze(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after:function(){return ze(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(_.cleanData(xe(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map((function(){return _.clone(this,e,t)}))},html:function(e){return H(this,(function(e){var t=this[0]||{},r=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Pe.test(e)&&!ye[(ge.exec(e)||["",""])[1].toLowerCase()]){e=_.htmlPrefilter(e);try{for(;r<i;r++)1===(t=this[r]||{}).nodeType&&(_.cleanData(xe(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith:function(){var e=[];return ze(this,arguments,(function(t){var r=this.parentNode;_.inArray(this,e)<0&&(_.cleanData(xe(this)),r&&r.replaceChild(t,this))}),e)}}),_.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(e,t){_.fn[e]=function(e){for(var r,i=[],n=_(e),o=n.length-1,a=0;a<=o;a++)r=a===o?this:this.clone(!0),_(n[a])[t](r),c.apply(i,r.get());return this.pushStack(i)}}));var Ie=new RegExp("^("+re+")(?!px)[a-z%]+$","i"),je=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=r),t.getComputedStyle(e)},Ge=function(e,t,r){var i,n,o={};for(n in t)o[n]=e.style[n],e.style[n]=t[n];for(n in i=r.call(e),t)e.style[n]=o[n];return i},He=new RegExp(ne.join("|"),"i");function We(e,t,r){var i,n,o,a,s=e.style;return(r=r||je(e))&&(""!==(a=r.getPropertyValue(t)||r[t])||ae(e)||(a=_.style(e,t)),!g.pixelBoxStyles()&&Ie.test(a)&&He.test(t)&&(i=s.width,n=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=r.width,s.width=i,s.minWidth=n,s.maxWidth=o)),void 0!==a?a+"":a}function Xe(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(u){c.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",u.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",oe.appendChild(c).appendChild(u);var e=r.getComputedStyle(u);i="1%"!==e.top,l=12===t(e.marginLeft),u.style.right="60%",a=36===t(e.right),n=36===t(e.width),u.style.position="absolute",o=12===t(u.offsetWidth/3),oe.removeChild(c),u=null}}function t(e){return Math.round(parseFloat(e))}var i,n,o,a,s,l,c=x.createElement("div"),u=x.createElement("div");u.style&&(u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",g.clearCloneStyle="content-box"===u.style.backgroundClip,_.extend(g,{boxSizingReliable:function(){return e(),n},pixelBoxStyles:function(){return e(),a},pixelPosition:function(){return e(),i},reliableMarginLeft:function(){return e(),l},scrollboxSize:function(){return e(),o},reliableTrDimensions:function(){var e,t,i,n;return null==s&&(e=x.createElement("table"),t=x.createElement("tr"),i=x.createElement("div"),e.style.cssText="position:absolute;left:-11111px",t.style.height="1px",i.style.height="9px",oe.appendChild(e).appendChild(t).appendChild(i),n=r.getComputedStyle(t),s=parseInt(n.height)>3,oe.removeChild(e)),s}}))}();var qe=["Webkit","Moz","ms"],Ye=x.createElement("div").style,Ke={};function $e(e){var t=_.cssProps[e]||Ke[e];return t||(e in Ye?e:Ke[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),r=qe.length;r--;)if((e=qe[r]+t)in Ye)return e}(e)||e)}var Qe=/^(none|table(?!-c[ea]).+)/,Ze=/^--/,Je={position:"absolute",visibility:"hidden",display:"block"},et={letterSpacing:"0",fontWeight:"400"};function tt(e,t,r){var i=ie.exec(t);return i?Math.max(0,i[2]-(r||0))+(i[3]||"px"):t}function rt(e,t,r,i,n,o){var a="width"===t?1:0,s=0,l=0;if(r===(i?"border":"content"))return 0;for(;a<4;a+=2)"margin"===r&&(l+=_.css(e,r+ne[a],!0,n)),i?("content"===r&&(l-=_.css(e,"padding"+ne[a],!0,n)),"margin"!==r&&(l-=_.css(e,"border"+ne[a]+"Width",!0,n))):(l+=_.css(e,"padding"+ne[a],!0,n),"padding"!==r?l+=_.css(e,"border"+ne[a]+"Width",!0,n):s+=_.css(e,"border"+ne[a]+"Width",!0,n));return!i&&o>=0&&(l+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-l-s-.5))||0),l}function it(e,t,r){var i=je(e),n=(!g.boxSizingReliable()||r)&&"border-box"===_.css(e,"boxSizing",!1,i),o=n,a=We(e,t,i),s="offset"+t[0].toUpperCase()+t.slice(1);if(Ie.test(a)){if(!r)return a;a="auto"}return(!g.boxSizingReliable()&&n||!g.reliableTrDimensions()&&D(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===_.css(e,"display",!1,i))&&e.getClientRects().length&&(n="border-box"===_.css(e,"boxSizing",!1,i),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+rt(e,t,r||(n?"border":"content"),o,i,a)+"px"}function nt(e,t,r,i,n){return new nt.prototype.init(e,t,r,i,n)}_.extend({cssHooks:{opacity:{get:function(e,t){if(t){var r=We(e,"opacity");return""===r?"1":r}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var n,o,a,s=Y(t),l=Ze.test(t),c=e.style;if(l||(t=$e(s)),a=_.cssHooks[t]||_.cssHooks[s],void 0===r)return a&&"get"in a&&void 0!==(n=a.get(e,!1,i))?n:c[t];"string"===(o=typeof r)&&(n=ie.exec(r))&&n[1]&&(r=ce(e,t,n),o="number"),null!=r&&r==r&&("number"!==o||l||(r+=n&&n[3]||(_.cssNumber[s]?"":"px")),g.clearCloneStyle||""!==r||0!==t.indexOf("background")||(c[t]="inherit"),a&&"set"in a&&void 0===(r=a.set(e,r,i))||(l?c.setProperty(t,r):c[t]=r))}},css:function(e,t,r,i){var n,o,a,s=Y(t);return Ze.test(t)||(t=$e(s)),(a=_.cssHooks[t]||_.cssHooks[s])&&"get"in a&&(n=a.get(e,!0,r)),void 0===n&&(n=We(e,t,i)),"normal"===n&&t in et&&(n=et[t]),""===r||r?(o=parseFloat(n),!0===r||isFinite(o)?o||0:n):n}}),_.each(["height","width"],(function(e,t){_.cssHooks[t]={get:function(e,r,i){if(r)return!Qe.test(_.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?it(e,t,i):Ge(e,Je,(function(){return it(e,t,i)}))},set:function(e,r,i){var n,o=je(e),a=!g.scrollboxSize()&&"absolute"===o.position,s=(a||i)&&"border-box"===_.css(e,"boxSizing",!1,o),l=i?rt(e,t,i,s,o):0;return s&&a&&(l-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(o[t])-rt(e,t,"border",!1,o)-.5)),l&&(n=ie.exec(r))&&"px"!==(n[3]||"px")&&(e.style[t]=r,r=_.css(e,t)),tt(0,r,l)}}})),_.cssHooks.marginLeft=Xe(g.reliableMarginLeft,(function(e,t){if(t)return(parseFloat(We(e,"marginLeft"))||e.getBoundingClientRect().left-Ge(e,{marginLeft:0},(function(){return e.getBoundingClientRect().left})))+"px"})),_.each({margin:"",padding:"",border:"Width"},(function(e,t){_.cssHooks[e+t]={expand:function(r){for(var i=0,n={},o="string"==typeof r?r.split(" "):[r];i<4;i++)n[e+ne[i]+t]=o[i]||o[i-2]||o[0];return n}},"margin"!==e&&(_.cssHooks[e+t].set=tt)})),_.fn.extend({css:function(e,t){return H(this,(function(e,t,r){var i,n,o={},a=0;if(Array.isArray(t)){for(i=je(e),n=t.length;a<n;a++)o[t[a]]=_.css(e,t[a],!1,i);return o}return void 0!==r?_.style(e,t,r):_.css(e,t)}),e,t,arguments.length>1)}}),_.Tween=nt,nt.prototype={constructor:nt,init:function(e,t,r,i,n,o){this.elem=e,this.prop=r,this.easing=n||_.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=o||(_.cssNumber[r]?"":"px")},cur:function(){var e=nt.propHooks[this.prop];return e&&e.get?e.get(this):nt.propHooks._default.get(this)},run:function(e){var t,r=nt.propHooks[this.prop];return this.options.duration?this.pos=t=_.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),r&&r.set?r.set(this):nt.propHooks._default.set(this),this}},nt.prototype.init.prototype=nt.prototype,nt.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=_.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){_.fx.step[e.prop]?_.fx.step[e.prop](e):1!==e.elem.nodeType||!_.cssHooks[e.prop]&&null==e.elem.style[$e(e.prop)]?e.elem[e.prop]=e.now:_.style(e.elem,e.prop,e.now+e.unit)}}},nt.propHooks.scrollTop=nt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},_.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},_.fx=nt.prototype.init,_.fx.step={};var ot,at,st=/^(?:toggle|show|hide)$/,lt=/queueHooks$/;function ct(){at&&(!1===x.hidden&&r.requestAnimationFrame?r.requestAnimationFrame(ct):r.setTimeout(ct,_.fx.interval),_.fx.tick())}function ut(){return r.setTimeout((function(){ot=void 0})),ot=Date.now()}function ht(e,t){var r,i=0,n={height:e};for(t=t?1:0;i<4;i+=2-t)n["margin"+(r=ne[i])]=n["padding"+r]=e;return t&&(n.opacity=n.width=e),n}function ft(e,t,r){for(var i,n=(pt.tweeners[t]||[]).concat(pt.tweeners["*"]),o=0,a=n.length;o<a;o++)if(i=n[o].call(r,t,e))return i}function pt(e,t,r){var i,n,o=0,a=pt.prefilters.length,s=_.Deferred().always((function(){delete l.elem})),l=function(){if(n)return!1;for(var t=ot||ut(),r=Math.max(0,c.startTime+c.duration-t),i=1-(r/c.duration||0),o=0,a=c.tweens.length;o<a;o++)c.tweens[o].run(i);return s.notifyWith(e,[c,i,r]),i<1&&a?r:(a||s.notifyWith(e,[c,1,0]),s.resolveWith(e,[c]),!1)},c=s.promise({elem:e,props:_.extend({},t),opts:_.extend(!0,{specialEasing:{},easing:_.easing._default},r),originalProperties:t,originalOptions:r,startTime:ot||ut(),duration:r.duration,tweens:[],createTween:function(t,r){var i=_.Tween(e,c.opts,t,r,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(i),i},stop:function(t){var r=0,i=t?c.tweens.length:0;if(n)return this;for(n=!0;r<i;r++)c.tweens[r].run(1);return t?(s.notifyWith(e,[c,1,0]),s.resolveWith(e,[c,t])):s.rejectWith(e,[c,t]),this}}),u=c.props;for(!function(e,t){var r,i,n,o,a;for(r in e)if(n=t[i=Y(r)],o=e[r],Array.isArray(o)&&(n=o[1],o=e[r]=o[0]),r!==i&&(e[i]=o,delete e[r]),(a=_.cssHooks[i])&&"expand"in a)for(r in o=a.expand(o),delete e[i],o)r in e||(e[r]=o[r],t[r]=n);else t[i]=n}(u,c.opts.specialEasing);o<a;o++)if(i=pt.prefilters[o].call(c,e,u,c.opts))return v(i.stop)&&(_._queueHooks(c.elem,c.opts.queue).stop=i.stop.bind(i)),i;return _.map(u,ft,c),v(c.opts.start)&&c.opts.start.call(e,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),_.fx.timer(_.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c}_.Animation=_.extend(pt,{tweeners:{"*":[function(e,t){var r=this.createTween(e,t);return ce(r.elem,e,ie.exec(t),r),r}]},tweener:function(e,t){v(e)?(t=e,e=["*"]):e=e.match(V);for(var r,i=0,n=e.length;i<n;i++)r=e[i],pt.tweeners[r]=pt.tweeners[r]||[],pt.tweeners[r].unshift(t)},prefilters:[function(e,t,r){var i,n,o,a,s,l,c,u,h="width"in t||"height"in t,f=this,p={},d=e.style,m=e.nodeType&&le(e),g=Q.get(e,"fxshow");for(i in r.queue||(null==(a=_._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,f.always((function(){f.always((function(){a.unqueued--,_.queue(e,"fx").length||a.empty.fire()}))}))),t)if(n=t[i],st.test(n)){if(delete t[i],o=o||"toggle"===n,n===(m?"hide":"show")){if("show"!==n||!g||void 0===g[i])continue;m=!0}p[i]=g&&g[i]||_.style(e,i)}if((l=!_.isEmptyObject(t))||!_.isEmptyObject(p))for(i in h&&1===e.nodeType&&(r.overflow=[d.overflow,d.overflowX,d.overflowY],null==(c=g&&g.display)&&(c=Q.get(e,"display")),"none"===(u=_.css(e,"display"))&&(c?u=c:(fe([e],!0),c=e.style.display||c,u=_.css(e,"display"),fe([e]))),("inline"===u||"inline-block"===u&&null!=c)&&"none"===_.css(e,"float")&&(l||(f.done((function(){d.display=c})),null==c&&(u=d.display,c="none"===u?"":u)),d.display="inline-block")),r.overflow&&(d.overflow="hidden",f.always((function(){d.overflow=r.overflow[0],d.overflowX=r.overflow[1],d.overflowY=r.overflow[2]}))),l=!1,p)l||(g?"hidden"in g&&(m=g.hidden):g=Q.access(e,"fxshow",{display:c}),o&&(g.hidden=!m),m&&fe([e],!0),f.done((function(){for(i in m||fe([e]),Q.remove(e,"fxshow"),p)_.style(e,i,p[i])}))),l=ft(m?g[i]:0,i,f),i in g||(g[i]=l.start,m&&(l.end=l.start,l.start=0))}],prefilter:function(e,t){t?pt.prefilters.unshift(e):pt.prefilters.push(e)}}),_.speed=function(e,t,r){var i=e&&"object"==typeof e?_.extend({},e):{complete:r||!r&&t||v(e)&&e,duration:e,easing:r&&t||t&&!v(t)&&t};return _.fx.off?i.duration=0:"number"!=typeof i.duration&&(i.duration in _.fx.speeds?i.duration=_.fx.speeds[i.duration]:i.duration=_.fx.speeds._default),null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){v(i.old)&&i.old.call(this),i.queue&&_.dequeue(this,i.queue)},i},_.fn.extend({fadeTo:function(e,t,r,i){return this.filter(le).css("opacity",0).show().end().animate({opacity:t},e,r,i)},animate:function(e,t,r,i){var n=_.isEmptyObject(e),o=_.speed(t,r,i),a=function(){var t=pt(this,_.extend({},e),o);(n||Q.get(this,"finish"))&&t.stop(!0)};return a.finish=a,n||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(e,t,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each((function(){var t=!0,n=null!=e&&e+"queueHooks",o=_.timers,a=Q.get(this);if(n)a[n]&&a[n].stop&&i(a[n]);else for(n in a)a[n]&&a[n].stop&&lt.test(n)&&i(a[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(r),t=!1,o.splice(n,1));!t&&r||_.dequeue(this,e)}))},finish:function(e){return!1!==e&&(e=e||"fx"),this.each((function(){var t,r=Q.get(this),i=r[e+"queue"],n=r[e+"queueHooks"],o=_.timers,a=i?i.length:0;for(r.finish=!0,_.queue(this,e,[]),n&&n.stop&&n.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<a;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete r.finish}))}}),_.each(["toggle","show","hide"],(function(e,t){var r=_.fn[t];_.fn[t]=function(e,i,n){return null==e||"boolean"==typeof e?r.apply(this,arguments):this.animate(ht(t,!0),e,i,n)}})),_.each({slideDown:ht("show"),slideUp:ht("hide"),slideToggle:ht("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(e,t){_.fn[e]=function(e,r,i){return this.animate(t,e,r,i)}})),_.timers=[],_.fx.tick=function(){var e,t=0,r=_.timers;for(ot=Date.now();t<r.length;t++)(e=r[t])()||r[t]!==e||r.splice(t--,1);r.length||_.fx.stop(),ot=void 0},_.fx.timer=function(e){_.timers.push(e),_.fx.start()},_.fx.interval=13,_.fx.start=function(){at||(at=!0,ct())},_.fx.stop=function(){at=null},_.fx.speeds={slow:600,fast:200,_default:400},_.fn.delay=function(e,t){return e=_.fx&&_.fx.speeds[e]||e,t=t||"fx",this.queue(t,(function(t,i){var n=r.setTimeout(t,e);i.stop=function(){r.clearTimeout(n)}}))},function(){var e=x.createElement("input"),t=x.createElement("select").appendChild(x.createElement("option"));e.type="checkbox",g.checkOn=""!==e.value,g.optSelected=t.selected,(e=x.createElement("input")).value="t",e.type="radio",g.radioValue="t"===e.value}();var dt,mt=_.expr.attrHandle;_.fn.extend({attr:function(e,t){return H(this,_.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){_.removeAttr(this,e)}))}}),_.extend({attr:function(e,t,r){var i,n,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?_.prop(e,t,r):(1===o&&_.isXMLDoc(e)||(n=_.attrHooks[t.toLowerCase()]||(_.expr.match.bool.test(t)?dt:void 0)),void 0!==r?null===r?void _.removeAttr(e,t):n&&"set"in n&&void 0!==(i=n.set(e,r,t))?i:(e.setAttribute(t,r+""),r):n&&"get"in n&&null!==(i=n.get(e,t))?i:null==(i=_.find.attr(e,t))?void 0:i)},attrHooks:{type:{set:function(e,t){if(!g.radioValue&&"radio"===t&&D(e,"input")){var r=e.value;return e.setAttribute("type",t),r&&(e.value=r),t}}}},removeAttr:function(e,t){var r,i=0,n=t&&t.match(V);if(n&&1===e.nodeType)for(;r=n[i++];)e.removeAttribute(r)}}),dt={set:function(e,t,r){return!1===t?_.removeAttr(e,r):e.setAttribute(r,r),r}},_.each(_.expr.match.bool.source.match(/\w+/g),(function(e,t){var r=mt[t]||_.find.attr;mt[t]=function(e,t,i){var n,o,a=t.toLowerCase();return i||(o=mt[a],mt[a]=n,n=null!=r(e,t,i)?a:null,mt[a]=o),n}}));var gt=/^(?:input|select|textarea|button)$/i,vt=/^(?:a|area)$/i;function yt(e){return(e.match(V)||[]).join(" ")}function xt(e){return e.getAttribute&&e.getAttribute("class")||""}function bt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(V)||[]}_.fn.extend({prop:function(e,t){return H(this,_.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[_.propFix[e]||e]}))}}),_.extend({prop:function(e,t,r){var i,n,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&_.isXMLDoc(e)||(t=_.propFix[t]||t,n=_.propHooks[t]),void 0!==r?n&&"set"in n&&void 0!==(i=n.set(e,r,t))?i:e[t]=r:n&&"get"in n&&null!==(i=n.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){var t=_.find.attr(e,"tabindex");return t?parseInt(t,10):gt.test(e.nodeName)||vt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),g.optSelected||(_.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),_.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){_.propFix[this.toLowerCase()]=this})),_.fn.extend({addClass:function(e){var t,r,i,n,o,a,s,l=0;if(v(e))return this.each((function(t){_(this).addClass(e.call(this,t,xt(this)))}));if((t=bt(e)).length)for(;r=this[l++];)if(n=xt(r),i=1===r.nodeType&&" "+yt(n)+" "){for(a=0;o=t[a++];)i.indexOf(" "+o+" ")<0&&(i+=o+" ");n!==(s=yt(i))&&r.setAttribute("class",s)}return this},removeClass:function(e){var t,r,i,n,o,a,s,l=0;if(v(e))return this.each((function(t){_(this).removeClass(e.call(this,t,xt(this)))}));if(!arguments.length)return this.attr("class","");if((t=bt(e)).length)for(;r=this[l++];)if(n=xt(r),i=1===r.nodeType&&" "+yt(n)+" "){for(a=0;o=t[a++];)for(;i.indexOf(" "+o+" ")>-1;)i=i.replace(" "+o+" "," ");n!==(s=yt(i))&&r.setAttribute("class",s)}return this},toggleClass:function(e,t){var r=typeof e,i="string"===r||Array.isArray(e);return"boolean"==typeof t&&i?t?this.addClass(e):this.removeClass(e):v(e)?this.each((function(r){_(this).toggleClass(e.call(this,r,xt(this),t),t)})):this.each((function(){var t,n,o,a;if(i)for(n=0,o=_(this),a=bt(e);t=a[n++];)o.hasClass(t)?o.removeClass(t):o.addClass(t);else void 0!==e&&"boolean"!==r||((t=xt(this))&&Q.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":Q.get(this,"__className__")||""))}))},hasClass:function(e){var t,r,i=0;for(t=" "+e+" ";r=this[i++];)if(1===r.nodeType&&(" "+yt(xt(r))+" ").indexOf(t)>-1)return!0;return!1}});var wt=/\r/g;_.fn.extend({val:function(e){var t,r,i,n=this[0];return arguments.length?(i=v(e),this.each((function(r){var n;1===this.nodeType&&(null==(n=i?e.call(this,r,_(this).val()):e)?n="":"number"==typeof n?n+="":Array.isArray(n)&&(n=_.map(n,(function(e){return null==e?"":e+""}))),(t=_.valHooks[this.type]||_.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,n,"value")||(this.value=n))}))):n?(t=_.valHooks[n.type]||_.valHooks[n.nodeName.toLowerCase()])&&"get"in t&&void 0!==(r=t.get(n,"value"))?r:"string"==typeof(r=n.value)?r.replace(wt,""):null==r?"":r:void 0}}),_.extend({valHooks:{option:{get:function(e){var t=_.find.attr(e,"value");return null!=t?t:yt(_.text(e))}},select:{get:function(e){var t,r,i,n=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],l=a?o+1:n.length;for(i=o<0?l:a?o:0;i<l;i++)if(((r=n[i]).selected||i===o)&&!r.disabled&&(!r.parentNode.disabled||!D(r.parentNode,"optgroup"))){if(t=_(r).val(),a)return t;s.push(t)}return s},set:function(e,t){for(var r,i,n=e.options,o=_.makeArray(t),a=n.length;a--;)((i=n[a]).selected=_.inArray(_.valHooks.option.get(i),o)>-1)&&(r=!0);return r||(e.selectedIndex=-1),o}}}}),_.each(["radio","checkbox"],(function(){_.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=_.inArray(_(e).val(),t)>-1}},g.checkOn||(_.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})})),g.focusin="onfocusin"in r;var St=/^(?:focusinfocus|focusoutblur)$/,_t=function(e){e.stopPropagation()};_.extend(_.event,{trigger:function(e,t,i,n){var o,a,s,l,c,u,h,f,d=[i||x],m=p.call(e,"type")?e.type:e,g=p.call(e,"namespace")?e.namespace.split("."):[];if(a=f=s=i=i||x,3!==i.nodeType&&8!==i.nodeType&&!St.test(m+_.event.triggered)&&(m.indexOf(".")>-1&&(g=m.split("."),m=g.shift(),g.sort()),c=m.indexOf(":")<0&&"on"+m,(e=e[_.expando]?e:new _.Event(m,"object"==typeof e&&e)).isTrigger=n?2:3,e.namespace=g.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=i),t=null==t?[e]:_.makeArray(t,[e]),h=_.event.special[m]||{},n||!h.trigger||!1!==h.trigger.apply(i,t))){if(!n&&!h.noBubble&&!y(i)){for(l=h.delegateType||m,St.test(l+m)||(a=a.parentNode);a;a=a.parentNode)d.push(a),s=a;s===(i.ownerDocument||x)&&d.push(s.defaultView||s.parentWindow||r)}for(o=0;(a=d[o++])&&!e.isPropagationStopped();)f=a,e.type=o>1?l:h.bindType||m,(u=(Q.get(a,"events")||Object.create(null))[e.type]&&Q.get(a,"handle"))&&u.apply(a,t),(u=c&&a[c])&&u.apply&&K(a)&&(e.result=u.apply(a,t),!1===e.result&&e.preventDefault());return e.type=m,n||e.isDefaultPrevented()||h._default&&!1!==h._default.apply(d.pop(),t)||!K(i)||c&&v(i[m])&&!y(i)&&((s=i[c])&&(i[c]=null),_.event.triggered=m,e.isPropagationStopped()&&f.addEventListener(m,_t),i[m](),e.isPropagationStopped()&&f.removeEventListener(m,_t),_.event.triggered=void 0,s&&(i[c]=s)),e.result}},simulate:function(e,t,r){var i=_.extend(new _.Event,r,{type:e,isSimulated:!0});_.event.trigger(i,null,t)}}),_.fn.extend({trigger:function(e,t){return this.each((function(){_.event.trigger(e,t,this)}))},triggerHandler:function(e,t){var r=this[0];if(r)return _.event.trigger(e,t,r,!0)}}),g.focusin||_.each({focus:"focusin",blur:"focusout"},(function(e,t){var r=function(e){_.event.simulate(t,e.target,_.event.fix(e))};_.event.special[t]={setup:function(){var i=this.ownerDocument||this.document||this,n=Q.access(i,t);n||i.addEventListener(e,r,!0),Q.access(i,t,(n||0)+1)},teardown:function(){var i=this.ownerDocument||this.document||this,n=Q.access(i,t)-1;n?Q.access(i,t,n):(i.removeEventListener(e,r,!0),Q.remove(i,t))}}}));var Mt=r.location,Tt={guid:Date.now()},Ct=/\?/;_.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new r.DOMParser).parseFromString(e,"text/xml")}catch(e){t=void 0}return t&&!t.getElementsByTagName("parsererror").length||_.error("Invalid XML: "+e),t};var At=/\[\]$/,Et=/\r?\n/g,Dt=/^(?:submit|button|image|reset|file)$/i,Lt=/^(?:input|select|textarea|keygen)/i;function Pt(e,t,r,i){var n;if(Array.isArray(t))_.each(t,(function(t,n){r||At.test(e)?i(e,n):Pt(e+"["+("object"==typeof n&&null!=n?t:"")+"]",n,r,i)}));else if(r||"object"!==S(t))i(e,t);else for(n in t)Pt(e+"["+n+"]",t[n],r,i)}_.param=function(e,t){var r,i=[],n=function(e,t){var r=v(t)?t():t;i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==r?"":r)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!_.isPlainObject(e))_.each(e,(function(){n(this.name,this.value)}));else for(r in e)Pt(r,e[r],t,n);return i.join("&")},_.fn.extend({serialize:function(){return _.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var e=_.prop(this,"elements");return e?_.makeArray(e):this})).filter((function(){var e=this.type;return this.name&&!_(this).is(":disabled")&&Lt.test(this.nodeName)&&!Dt.test(e)&&(this.checked||!me.test(e))})).map((function(e,t){var r=_(this).val();return null==r?null:Array.isArray(r)?_.map(r,(function(e){return{name:t.name,value:e.replace(Et,"\r\n")}})):{name:t.name,value:r.replace(Et,"\r\n")}})).get()}});var Rt=/%20/g,Ft=/#.*$/,Ot=/([?&])_=[^&]*/,Ut=/^(.*?):[ \t]*([^\r\n]*)$/gm,Nt=/^(?:GET|HEAD)$/,Vt=/^\/\//,kt={},zt={},Bt="*/".concat("*"),It=x.createElement("a");function jt(e){return function(t,r){"string"!=typeof t&&(r=t,t="*");var i,n=0,o=t.toLowerCase().match(V)||[];if(v(r))for(;i=o[n++];)"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(r)):(e[i]=e[i]||[]).push(r)}}function Gt(e,t,r,i){var n={},o=e===zt;function a(s){var l;return n[s]=!0,_.each(e[s]||[],(function(e,s){var c=s(t,r,i);return"string"!=typeof c||o||n[c]?o?!(l=c):void 0:(t.dataTypes.unshift(c),a(c),!1)})),l}return a(t.dataTypes[0])||!n["*"]&&a("*")}function Ht(e,t){var r,i,n=_.ajaxSettings.flatOptions||{};for(r in t)void 0!==t[r]&&((n[r]?e:i||(i={}))[r]=t[r]);return i&&_.extend(!0,e,i),e}It.href=Mt.href,_.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Mt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Mt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Bt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":_.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ht(Ht(e,_.ajaxSettings),t):Ht(_.ajaxSettings,e)},ajaxPrefilter:jt(kt),ajaxTransport:jt(zt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var i,n,o,a,s,l,c,u,h,f,p=_.ajaxSetup({},t),d=p.context||p,m=p.context&&(d.nodeType||d.jquery)?_(d):_.event,g=_.Deferred(),v=_.Callbacks("once memory"),y=p.statusCode||{},b={},w={},S="canceled",M={readyState:0,getResponseHeader:function(e){var t;if(c){if(!a)for(a={};t=Ut.exec(o);)a[t[1].toLowerCase()+" "]=(a[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=a[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return c?o:null},setRequestHeader:function(e,t){return null==c&&(e=w[e.toLowerCase()]=w[e.toLowerCase()]||e,b[e]=t),this},overrideMimeType:function(e){return null==c&&(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(c)M.always(e[M.status]);else for(t in e)y[t]=[y[t],e[t]];return this},abort:function(e){var t=e||S;return i&&i.abort(t),T(0,t),this}};if(g.promise(M),p.url=((e||p.url||Mt.href)+"").replace(Vt,Mt.protocol+"//"),p.type=t.method||t.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(V)||[""],null==p.crossDomain){l=x.createElement("a");try{l.href=p.url,l.href=l.href,p.crossDomain=It.protocol+"//"+It.host!=l.protocol+"//"+l.host}catch(e){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=_.param(p.data,p.traditional)),Gt(kt,p,t,M),c)return M;for(h in(u=_.event&&p.global)&&0==_.active++&&_.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Nt.test(p.type),n=p.url.replace(Ft,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(Rt,"+")):(f=p.url.slice(n.length),p.data&&(p.processData||"string"==typeof p.data)&&(n+=(Ct.test(n)?"&":"?")+p.data,delete p.data),!1===p.cache&&(n=n.replace(Ot,"$1"),f=(Ct.test(n)?"&":"?")+"_="+Tt.guid+++f),p.url=n+f),p.ifModified&&(_.lastModified[n]&&M.setRequestHeader("If-Modified-Since",_.lastModified[n]),_.etag[n]&&M.setRequestHeader("If-None-Match",_.etag[n])),(p.data&&p.hasContent&&!1!==p.contentType||t.contentType)&&M.setRequestHeader("Content-Type",p.contentType),M.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Bt+"; q=0.01":""):p.accepts["*"]),p.headers)M.setRequestHeader(h,p.headers[h]);if(p.beforeSend&&(!1===p.beforeSend.call(d,M,p)||c))return M.abort();if(S="abort",v.add(p.complete),M.done(p.success),M.fail(p.error),i=Gt(zt,p,t,M)){if(M.readyState=1,u&&m.trigger("ajaxSend",[M,p]),c)return M;p.async&&p.timeout>0&&(s=r.setTimeout((function(){M.abort("timeout")}),p.timeout));try{c=!1,i.send(b,T)}catch(e){if(c)throw e;T(-1,e)}}else T(-1,"No Transport");function T(e,t,a,l){var h,f,x,b,w,S=t;c||(c=!0,s&&r.clearTimeout(s),i=void 0,o=l||"",M.readyState=e>0?4:0,h=e>=200&&e<300||304===e,a&&(b=function(e,t,r){for(var i,n,o,a,s=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(n in s)if(s[n]&&s[n].test(i)){l.unshift(n);break}if(l[0]in r)o=l[0];else{for(n in r){if(!l[0]||e.converters[n+" "+l[0]]){o=n;break}a||(a=n)}o=o||a}if(o)return o!==l[0]&&l.unshift(o),r[o]}(p,M,a)),!h&&_.inArray("script",p.dataTypes)>-1&&(p.converters["text script"]=function(){}),b=function(e,t,r,i){var n,o,a,s,l,c={},u=e.dataTypes.slice();if(u[1])for(a in e.converters)c[a.toLowerCase()]=e.converters[a];for(o=u.shift();o;)if(e.responseFields[o]&&(r[e.responseFields[o]]=t),!l&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=u.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(!(a=c[l+" "+o]||c["* "+o]))for(n in c)if((s=n.split(" "))[1]===o&&(a=c[l+" "+s[0]]||c["* "+s[0]])){!0===a?a=c[n]:!0!==c[n]&&(o=s[0],u.unshift(s[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}(p,b,M,h),h?(p.ifModified&&((w=M.getResponseHeader("Last-Modified"))&&(_.lastModified[n]=w),(w=M.getResponseHeader("etag"))&&(_.etag[n]=w)),204===e||"HEAD"===p.type?S="nocontent":304===e?S="notmodified":(S=b.state,f=b.data,h=!(x=b.error))):(x=S,!e&&S||(S="error",e<0&&(e=0))),M.status=e,M.statusText=(t||S)+"",h?g.resolveWith(d,[f,S,M]):g.rejectWith(d,[M,S,x]),M.statusCode(y),y=void 0,u&&m.trigger(h?"ajaxSuccess":"ajaxError",[M,p,h?f:x]),v.fireWith(d,[M,S]),u&&(m.trigger("ajaxComplete",[M,p]),--_.active||_.event.trigger("ajaxStop")))}return M},getJSON:function(e,t,r){return _.get(e,t,r,"json")},getScript:function(e,t){return _.get(e,void 0,t,"script")}}),_.each(["get","post"],(function(e,t){_[t]=function(e,r,i,n){return v(r)&&(n=n||i,i=r,r=void 0),_.ajax(_.extend({url:e,type:t,dataType:n,data:r,success:i},_.isPlainObject(e)&&e))}})),_.ajaxPrefilter((function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")})),_._evalUrl=function(e,t,r){return _.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){_.globalEval(e,t,r)}})},_.fn.extend({wrapAll:function(e){var t;return this[0]&&(v(e)&&(e=e.call(this[0])),t=_(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner:function(e){return v(e)?this.each((function(t){_(this).wrapInner(e.call(this,t))})):this.each((function(){var t=_(this),r=t.contents();r.length?r.wrapAll(e):t.append(e)}))},wrap:function(e){var t=v(e);return this.each((function(r){_(this).wrapAll(t?e.call(this,r):e)}))},unwrap:function(e){return this.parent(e).not("body").each((function(){_(this).replaceWith(this.childNodes)})),this}}),_.expr.pseudos.hidden=function(e){return!_.expr.pseudos.visible(e)},_.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},_.ajaxSettings.xhr=function(){try{return new r.XMLHttpRequest}catch(e){}};var Wt={0:200,1223:204},Xt=_.ajaxSettings.xhr();g.cors=!!Xt&&"withCredentials"in Xt,g.ajax=Xt=!!Xt,_.ajaxTransport((function(e){var t,i;if(g.cors||Xt&&!e.crossDomain)return{send:function(n,o){var a,s=e.xhr();if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(a in e.xhrFields)s[a]=e.xhrFields[a];for(a in e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest"),n)s.setRequestHeader(a,n[a]);t=function(e){return function(){t&&(t=i=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?o(0,"error"):o(s.status,s.statusText):o(Wt[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=t(),i=s.onerror=s.ontimeout=t("error"),void 0!==s.onabort?s.onabort=i:s.onreadystatechange=function(){4===s.readyState&&r.setTimeout((function(){t&&i()}))},t=t("abort");try{s.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort:function(){t&&t()}}})),_.ajaxPrefilter((function(e){e.crossDomain&&(e.contents.script=!1)})),_.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return _.globalEval(e),e}}}),_.ajaxPrefilter("script",(function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")})),_.ajaxTransport("script",(function(e){var t,r;if(e.crossDomain||e.scriptAttrs)return{send:function(i,n){t=_("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",r=function(e){t.remove(),r=null,e&&n("error"===e.type?404:200,e.type)}),x.head.appendChild(t[0])},abort:function(){r&&r()}}}));var qt,Yt=[],Kt=/(=)\?(?=&|$)|\?\?/;_.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Yt.pop()||_.expando+"_"+Tt.guid++;return this[e]=!0,e}}),_.ajaxPrefilter("json jsonp",(function(e,t,i){var n,o,a,s=!1!==e.jsonp&&(Kt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Kt.test(e.data)&&"data");if(s||"jsonp"===e.dataTypes[0])return n=e.jsonpCallback=v(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,s?e[s]=e[s].replace(Kt,"$1"+n):!1!==e.jsonp&&(e.url+=(Ct.test(e.url)?"&":"?")+e.jsonp+"="+n),e.converters["script json"]=function(){return a||_.error(n+" was not called"),a[0]},e.dataTypes[0]="json",o=r[n],r[n]=function(){a=arguments},i.always((function(){void 0===o?_(r).removeProp(n):r[n]=o,e[n]&&(e.jsonpCallback=t.jsonpCallback,Yt.push(n)),a&&v(o)&&o(a[0]),a=o=void 0})),"script"})),g.createHTMLDocument=((qt=x.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===qt.childNodes.length),_.parseHTML=function(e,t,r){return"string"!=typeof e?[]:("boolean"==typeof t&&(r=t,t=!1),t||(g.createHTMLDocument?((i=(t=x.implementation.createHTMLDocument("")).createElement("base")).href=x.location.href,t.head.appendChild(i)):t=x),o=!r&&[],(n=L.exec(e))?[t.createElement(n[1])]:(n=Se([e],t,o),o&&o.length&&_(o).remove(),_.merge([],n.childNodes)));var i,n,o},_.fn.load=function(e,t,r){var i,n,o,a=this,s=e.indexOf(" ");return s>-1&&(i=yt(e.slice(s)),e=e.slice(0,s)),v(t)?(r=t,t=void 0):t&&"object"==typeof t&&(n="POST"),a.length>0&&_.ajax({url:e,type:n||"GET",dataType:"html",data:t}).done((function(e){o=arguments,a.html(i?_("<div>").append(_.parseHTML(e)).find(i):e)})).always(r&&function(e,t){a.each((function(){r.apply(this,o||[e.responseText,t,e])}))}),this},_.expr.pseudos.animated=function(e){return _.grep(_.timers,(function(t){return e===t.elem})).length},_.offset={setOffset:function(e,t,r){var i,n,o,a,s,l,c=_.css(e,"position"),u=_(e),h={};"static"===c&&(e.style.position="relative"),s=u.offset(),o=_.css(e,"top"),l=_.css(e,"left"),("absolute"===c||"fixed"===c)&&(o+l).indexOf("auto")>-1?(a=(i=u.position()).top,n=i.left):(a=parseFloat(o)||0,n=parseFloat(l)||0),v(t)&&(t=t.call(e,r,_.extend({},s))),null!=t.top&&(h.top=t.top-s.top+a),null!=t.left&&(h.left=t.left-s.left+n),"using"in t?t.using.call(e,h):("number"==typeof h.top&&(h.top+="px"),"number"==typeof h.left&&(h.left+="px"),u.css(h))}},_.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each((function(t){_.offset.setOffset(this,e,t)}));var t,r,i=this[0];return i?i.getClientRects().length?(t=i.getBoundingClientRect(),r=i.ownerDocument.defaultView,{top:t.top+r.pageYOffset,left:t.left+r.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,r,i=this[0],n={top:0,left:0};if("fixed"===_.css(i,"position"))t=i.getBoundingClientRect();else{for(t=this.offset(),r=i.ownerDocument,e=i.offsetParent||r.documentElement;e&&(e===r.body||e===r.documentElement)&&"static"===_.css(e,"position");)e=e.parentNode;e&&e!==i&&1===e.nodeType&&((n=_(e).offset()).top+=_.css(e,"borderTopWidth",!0),n.left+=_.css(e,"borderLeftWidth",!0))}return{top:t.top-n.top-_.css(i,"marginTop",!0),left:t.left-n.left-_.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent;e&&"static"===_.css(e,"position");)e=e.offsetParent;return e||oe}))}}),_.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(e,t){var r="pageYOffset"===t;_.fn[e]=function(i){return H(this,(function(e,i,n){var o;if(y(e)?o=e:9===e.nodeType&&(o=e.defaultView),void 0===n)return o?o[t]:e[i];o?o.scrollTo(r?o.pageXOffset:n,r?n:o.pageYOffset):e[i]=n}),e,i,arguments.length)}})),_.each(["top","left"],(function(e,t){_.cssHooks[t]=Xe(g.pixelPosition,(function(e,r){if(r)return r=We(e,t),Ie.test(r)?_(e).position()[t]+"px":r}))})),_.each({Height:"height",Width:"width"},(function(e,t){_.each({padding:"inner"+e,content:t,"":"outer"+e},(function(r,i){_.fn[i]=function(n,o){var a=arguments.length&&(r||"boolean"!=typeof n),s=r||(!0===n||!0===o?"margin":"border");return H(this,(function(t,r,n){var o;return y(t)?0===i.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===n?_.css(t,r,s):_.style(t,r,n,s)}),t,a?n:void 0,a)}}))})),_.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(e,t){_.fn[t]=function(e){return this.on(t,e)}})),_.fn.extend({bind:function(e,t,r){return this.on(e,null,t,r)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,r,i){return this.on(t,e,r,i)},undelegate:function(e,t,r){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",r)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),_.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(e,t){_.fn[t]=function(e,r){return arguments.length>0?this.on(t,null,e,r):this.trigger(t)}}));var $t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;_.proxy=function(e,t){var r,i,n;if("string"==typeof t&&(r=e[t],t=e,e=r),v(e))return i=s.call(arguments,2),(n=function(){return e.apply(t||this,i.concat(s.call(arguments)))}).guid=e.guid=e.guid||_.guid++,n},_.holdReady=function(e){e?_.readyWait++:_.ready(!0)},_.isArray=Array.isArray,_.parseJSON=JSON.parse,_.nodeName=D,_.isFunction=v,_.isWindow=y,_.camelCase=Y,_.type=S,_.now=Date.now,_.isNumeric=function(e){var t=_.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},_.trim=function(e){return null==e?"":(e+"").replace($t,"")},void 0===(i=function(){return _}.apply(t,[]))||(e.exports=i);var Qt=r.jQuery,Zt=r.$;return _.noConflict=function(e){return r.$===_&&(r.$=Zt),e&&r.jQuery===_&&(r.jQuery=Qt),_},void 0===n&&(r.jQuery=r.$=_),_}))},function(e,t,r){"use strict";function i(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var o,a,s,l;null==window.GitHub&&(window.GitHub={}),window.Render=window.Render||{},s=function(){if(null!=console.log){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];try{var i;return(i=console).log.apply(i,t)}catch(e){return e,console.log(t)}}},l=function(e){var t;return 50,(null!=(t=window.debug).buffer?t.buffer:t.buffer=[]).push({time:Date.now(),args:e}),window.debug.buffer=window.debug.buffer.slice(-50)},window.Render.showDebug=function(){var e,t,r,n,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;for(t=0,r=(n=(window.debug.buffer||[]).slice(-o)).length;t<r;t++)e=n[t],s.apply(void 0,["".concat(new Date(e.time),": ")].concat(i(e.args)));return(window.debug.buffer||[]).length},window.debug=null!=window.debug?window.debug:((o=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(l(t),!window.Render.quiet)return s.apply(void 0,t)}).buffer=[],o),(a=r(2)).keys().forEach(a)},function(e,t,r){var i={"./config.coffee":3,"./doctor.coffee":4,"./failbot.coffee":5,"./jobQueue.coffee":6,"./modeSwitcher.coffee":7,"./slider.coffee":8,"./status.coffee":9};function n(e){var t=o(e);return r(t)}function o(e){if(!r.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=o,e.exports=n,n.id=2},function(e,t,r){"use strict";window.Render.quiet=!0},function(e,t,r){"use strict";(function(e){function t(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}window.Render.Doctor=function(){function r(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.updateHealth=this.updateHealth.bind(this),this.container=e,this.problems=[],this.updateHealth()}var i,n,o;return i=r,(n=[{key:"addProblem",value:function(e){return this.problems.push(e),this.updateHealth()}},{key:"healthy",value:function(){return 0===this.problems.length}},{key:"clearProblems",value:function(){return this.problems=[]}},{key:"updateHealth",value:function(){var t,r,i;if(e(this.container).length)return setTimeout(this.updateHealth,3e3),t=e(".js-viewer-health"),this.problems.length?(i=this.problems.join(", "),r="is-viewer-bad",t.show()):(i="Everything running smoothly!",r="is-viewer-good"),t.removeClass("is-viewer-good is-viewer-bad"),t.addClass(r),t.find(".js-message").html(i)}}])&&t(i.prototype,n),o&&t(i,o),r}()}).call(this,r(0))},function(e,t,r){"use strict";(function(e,t){function r(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var n,o,a,s,l,c,u,h,f,p,d,m,g;o={originalHistoryState:JSON.stringify(window.history.state)},n=[],h=(new Date).getTime(),m=!1,c=function(){m=!0},l=function(){m=!1},e(window).on("pageshow",l),e(window).on("pagehide",c),e(window).on("error",(function(t){var i,a,l,c,f,d,m,g=t.originalEvent;d=g.message,c=g.filename,f=g.lineno,l=g.error,a=(i=e).extend.apply(i,[{},o].concat(r(n),[{message:d,filename:c,lineno:f,url:window.location.href,readyState:document.readyState,referrer:document.referrer,stack:null!=l?l.stack:void 0,historyState:JSON.stringify(window.history.state),timeSinceLoad:Math.round((new Date).getTime()-h),extensionScripts:JSON.stringify(s().sort()),navigations:JSON.stringify(u())},null!=l?l.failbotContext:void 0])),n=[],e(document).trigger("captured:error",a),a.logging=function(){var e;try{return JSON.stringify((null!=(e=window.debug)?e.buffer:void 0)||[])}catch(e){}}(),p(t)&&(m=e("body").data("render-url"),e.ajax({type:"POST",url:"".concat(m,"/_errors"),data:{error:a}}))})),g=0,p=function(e){var t,r,i=e.originalEvent;return r=i.lineno,!(null==(null!=(t=i.error)?t.stack:void 0)||!r||m||g>=10||(g++,0))},s=function(){var t,r,i,n,o;for(n=[],t=0,r=(i=e("script")).length;t<r;t++)o=i[t],/^(?:chrome-extension|file):/.test(o.src)&&n.push(o.src);return n},a=t.event.dispatch,t.event.dispatch=function(e){var t;return"error"===e.type&&e.target===window?a.apply(this,arguments):(n.push({eventType:e.type,eventTarget:e.target}),t=a.apply(this,arguments),n.pop(),t)},f=function(e,t){var r;return(r=u()).push({type:e,url:window.location.href,state:window.history.state,info:t}),d(r)},u=function(){var e;return(e=function(){try{return sessionStorage.getItem("navigations")}catch(e){}}())?JSON.parse(e):[]},d=function(e){try{return sessionStorage.setItem("navigations",JSON.stringify(e))}catch(e){}},f("load"),e(window).on("hashchange",(function(e){return f("hashchange",{oldURL:e.oldURL,newURL:e.newURL})})),e(window).on("popstate",(function(e){return f("popstate",{eventState:e.state})})),e(document).on("pjax:success",(function(e){return f("pjax:success")})),e(document).on("pjax:popstate",(function(e){return f("pjax:popstate",{pjaxDirection:e.direction,pjaxState:e.state})})),"#b00m"===window.location.hash&&b00m()}).call(this,r(0),r(0))},function(e,t,r){"use strict";function i(e){return function(e){if(Array.isArray(e))return e}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}window.Render.JobQueue=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,e),this.run=this.run.bind(this),this.queue=[],this.queueInterval=t.queueInterval||16,this.batchSize=t.batchSize||50}var t,r,n;return t=e,(r=[{key:"run",value:function(e){var t,r,n;if(null!=e)return 0===this.queue.length&&setTimeout(this.run,0),this.queue.push(e);for(r=0,n=this.batchSize;0<=n?r<n:r>n;0<=n?++r:--r){if(!(this.queue.length>0))return;var o=i(this.queue);t=o[0],this.queue=o.slice(1),null!=t&&t()}return setTimeout(this.run,this.queueInterval)}}])&&a(t.prototype,r),n&&a(t,n),e}()},function(e,t,r){"use strict";(function(e){function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}window.Render.ModeSwitcher=function r(i){var n,o=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".js-view-modes",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".js-view-mode-item";t(this,r),this.callback=i,this.identifier=a,this.childIdentifier=s,(n=e(this.identifier)).length>0&&n.children(this.childIdentifier).on("click",(function(t){return o.callback(e(t.target).data("mode")),n.children(o.childIdentifier).removeClass("active"),e(t.target).addClass("active")}))}}).call(this,r(0))},function(e,t,r){"use strict";(function(e){function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}window.Render.Slider=function(){function i(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(this,i),this.bindControls=this.bindControls.bind(this),this.value=this.value.bind(this),this.setDragger=this.setDragger.bind(this),this.callbacks=r,this.dragger=e(n.identifier||".js-dragger"),this.track=this.dragger.parent(),this.container=this.track.parent(),this.percentage=n.percentage||50,this.bindControls(),this.setDragger()}var n,o,a;return n=i,(o=[{key:"bindControls",value:function(){var t=this;return this.dragger.on("mousedown",(function(r){return r.preventDefault(),e("body").css({cursor:"pointer"}),null!=t.callbacks.mouseDown&&t.callbacks.mouseDown(),e(document).on("mousemove.dragger",(function(e){var r,i;if(e.preventDefault(),i=t.track.width()-t.dragger.width(),(r=e.clientX-t.track.offset().left)<0&&(r=0),r>i&&(r=i),t.dragger.css({left:r}),t.percentage=r/i*100,debug("Slider at ".concat(t.percentage,"%")),null!=t.callbacks.slide)return t.callbacks.slide(t.percentage)})),e(document).on("mouseup.dragger",(function(){if(e(document).off(".dragger"),e("body").css({cursor:"auto"}),null!=t.callbacks.mouseUp)return t.callbacks.mouseUp()}))}))}},{key:"value",value:function(){return this.percentage}},{key:"setDragger",value:function(){var e,t;return t=this.track.width()-this.dragger.width(),e=this.percentage/100*t,this.dragger.css({left:e})}},{key:"show",value:function(){return this.container.show(),this.setDragger()}},{key:"hide",value:function(){return this.container.hide()}}])&&r(n.prototype,o),a&&r(n,a),i}()}).call(this,r(0))},function(e,t,r){"use strict";(function(e,t){function r(e){return function(e){if(Array.isArray(e))return e}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a,s,l=[].indexOf;s=window.Render,a=function(e){return/^client:\/\//.exec(e)},s.Status=function(){function i(t){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n(this,i),this.sendInitial=this.sendInitial.bind(this),this.onReady=this.onReady.bind(this),this.onAck=this.onAck.bind(this),this.requireAck=this.requireAck.bind(this),this.submitTiming=this.submitTiming.bind(this),this.submitGiveup=this.submitGiveup.bind(this),this.handleData=this.handleData.bind(this),this.handleCmd=this.handleCmd.bind(this),this.handleMessage=this.handleMessage.bind(this),this.haveParent=this.haveParent.bind(this),this.handleLink=this.handleLink.bind(this),this.navigateTo=this.navigateTo.bind(this),this.navigateRelative=this.navigateRelative.bind(this),this.navigateDirect=this.navigateDirect.bind(this),this.format=t,null==this.format)throw new Error("Format not declared when Status was constructed.");window.location.hash.length&&(this.identity=window.location.hash.substring(1)),this.sentData={have:[],waiting:[]},this.messages=[{status:"constructor",payload:void 0,when:Date.now(),sent:!0}],this.acked=!1,e(window).on("message",this.handleMessage),o.noLinks||e(document).on("click","a",this.handleLink),r=o.initial||"hello",this.sendInitial(r,10,1e3)}var s,c,u;return s=i,(c=[{key:"sendInitial",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;if(!this.acked&&(r-=1)>=0)return setTimeout((function(){return t.sendInitial(e,r,i)}),i),debug("Sending hello. Will try again ".concat(r," more times in 1 second until ack'd")),this.set(e)}},{key:"load",value:function(e,t){var r=this;return null==t.setStatus&&(t.setStatus=!0),null==t.attempts&&(t.attempts=this.clientTimeoutAttempts()),null==t.before&&(t.before=function(e,t){}),null==t.success&&(t.success=function(e,i){if(t.setStatus)return r.set("loaded")}),null==t.error&&(t.error=function(e,i){if(t.setStatus)return r.set("error")}),null==t.timeout&&(t.timeout=3e4),t.setStatus&&this.set("loading"),a(e)?this.loadClient(e,t):this.loadHttp(e,t)}},{key:"set",value:function(e){var t,r,i,n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n=this.alreadySentStatus(e),r={status:e,payload:o,when:Date.now(),sent:!1},null==n||"hello"!==(i=!e)&&"resize"!==i?(n&&"hello"===e||this.messages.push(r),"ready"===e&&this.onReady(),this.requireAck(e)?void 0:(r.sent=!0,this.post({type:"render",body:e,payload:o}))):(t=Math.abs(Date.now()-n.when),debug("Already set status '".concat(e,"' ").concat(t,"ms ago")))}},{key:"alreadySentStatus",value:function(e){return this.messages.filter((function(t){return t.status===e}))[0]}},{key:"get",value:function(){return this.messages[this.messages.length-1].status}},{key:"prepareData",value:function(e,r){var i;if(i=e,r.json&&"string"==typeof e)try{i=JSON.parse(e)}catch(r){debug("Error while trying to parse initial JSON: ".concat(r)),debug("Attempting to parse htmlDecoded JSON"),i=JSON.parse(t.unescape(e))}return i}},{key:"loadClient",value:function(e,t){var i,n,o,s=this;if(!a(e))throw new Error("Not a client URL: ".concat(e));var l=r(this.sentData.have);return n=l[0],o=l.slice(1),this.sentData.have=o,null!=n?(t.before(void 0,t),t.setStatus&&this.set("loaded"),t.success(this.prepareData(n,t))):(t.before(void 0,t),i={timeout:t.timeout,created:Date.now(),success:function(e){return t.success(s.prepareData(e,t))},error:t.error},this.sentData.waiting.push(i),null!=i.timeout?setTimeout((function(){var e;if(-1!==(e=s.sentData.waiting.indexOf(i)))return s.sentData.waiting=s.sentData.waiting.slice(0,e).concat(s.sentData.waiting.slice(e+1)),t.setStatus&&s.set("error"),i.error(new Error("Timeout ".concat(i.timeout,"ms")))}),i.timeout):void 0)}},{key:"loadHttpIe",value:function(t,r){var i,n,o,a,s,l=this;return e.support.cors=!0,s=new XDomainRequest,o=function(){var e;return e=s.responseText,r.setStatus&&l.set("loaded"),r.success(l.prepareData(e,r),s)},a=function(){return n("Request timed out after ".concat(option.timeout,"ms"))},i=function(){return n("Crossdomain request failed.")},n=function(e){return r.attempts-=1,r.attempts>0?(debug("Request didn't work, going to retry up to ".concat(r.attempts," more times")),setTimeout((function(){return l.loadHttpIE(t,r)}),1e3)):(r.setStatus&&l.set("error"),l.submitGiveup(),r.error(new Error(e),s))},s.onload=o,s.ontimeout=a,s.onerror=i,s.timeout=r.timeout||5e3,s.open("get",t),s.send()}},{key:"loadHttp",value:function(t,r){var i=this;return null!=window.XDomainRequest?this.loadHttpIe(t,r):e.ajax({url:t,crossDomain:!0,method:"GET",timeout:r.timeout,beforeSend:r.before,success:function(e,t,n){return e=i.prepareData(e,r),r.setStatus&&i.set("loaded"),r.success(e,n)},error:function(e,n,o){return r.attempts-=1,r.attempts>0?(debug("Couldn't load, going to retry up to ".concat(r.attempts," more times")),setTimeout((function(){return i.loadHttp(t,r)}),1e3)):(r.setStatus&&i.set("error"),i.submitGiveup(),r.error(o,e))}})}},{key:"post",value:function(e){return null==e.identity&&(e.identity=this.identity),this.haveParent()?(debug("Render Status:",e),window.parent.postMessage(JSON.stringify(e),"*")):debug("WARNING: No window.parent: postMessage:",e)}},{key:"onReady",value:function(){var e,t,r,i;for(r={},e=0,t=(i=this.messages).length;e<t;e++)!function(e){r[e.status]=e.when}(i[e]);return this.submitTiming("local",r)}},{key:"onAck",value:function(){var e,t,r,i,n;for(debug("Ack'd, sending saved messages"),this.acked=!0,n=[],e=0,t=(i=this.messages).length;e<t;e++)(r=i[e]).sent?n.push(void 0):(r.sent=!0,n.push(this.post({type:"render",body:r.status,payload:r.payload})));return n}},{key:"requireAck",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!this.acked&&"hello"!==e}},{key:"submitTiming",value:function(t,r){var i;return debug("Got ".concat(t," timing: ").concat(this.format," => ").concat(JSON.stringify(r))),i=e("body").data("render-url"),e.ajax({type:"POST",data:{timing:r},url:"".concat(i,"/stats/timing/").concat(t,"/").concat(this.format,"/"),success:function(e,r,i){return debug("Sent ".concat(t," timing info:"),e)},error:function(e,t,r){return debug("Failed to send remote timing info:",r)}})}},{key:"submitGiveup",value:function(){var t;return t=e("body").data("render-url"),e.ajax({type:"POST",url:"".concat(t,"/stats/").concat(this.format,"/gave_up"),success:function(e,t,r){return debug("Sent give up status info.")},error:function(e,t,r){return debug("Failed to send give up info:",r)}})}},{key:"handleData",value:function(e){var t,i;if(this.sentData.waiting.length){var n=r(this.sentData.waiting);return t=n[0],i=n.slice(1),this.sentData.waiting=i,this.set("loaded"),t.success(e)}return this.sentData.have.push(e)}},{key:"handleCmd",value:function(t,r){switch(t){case"branding":return e(document.body).removeClass("is-embedded",r);case"ack":if(this.requireAck())return this.onAck();break;default:return debug("Invalid command '".concat(t,"':"),r)}}},{key:"handleMessage",value:function(t){var r,i,n,o,a,s,l,c,u,h,f;s=e("body").data("github-hostname"),f=new RegExp(".".concat(s,"$"));var p=t.originalEvent;if(o=p.data,c=p.origin,o&&c&&(f.test(c)||"github.com"===c.toLowerCase())){var d=function(){try{return JSON.parse(o)}catch(e){return t=e,o}}();if(h=d.type,l=d.identity,i=d.body,h&&i){if(null!=l&&l!==this.identity)return debug("Message has identity '".concat(l,"' != '").concat(this.identity,"', which is mine"));switch(h){case"render:timing":var m=i;return u=m.timing,a=m.format,u&&a?a!==this.format?debug("Format mismatch: got '".concat(a,"' expected '").concat(this.format,"'")):this.submitTiming("remote",u):debug("Malformed timing message:",i);case"render:cmd":if(r=i[n=i.cmd],null!=n&&null!=r)return this.handleCmd(n,r);break;case"render:data":return this.handleData(i);default:return debug("Unknown message type: ".concat(h))}}}}},{key:"haveParent",value:function(){return window.parent!==window}},{key:"handleLink",value:function(t){var r,i;if(null!=(i=(r=e(t.target)).attr("href"))?i.length:void 0){if(i.match(/^\#/))return!0;t.preventDefault();try{return this.navigateTo(i)}catch(e){return t=e,debug("Navigation to '".concat(i,"' failed:"),t),r.addClass("failed"),setTimeout((function(){return r.removeClass("failed")}),500)}}}},{key:"navigateTo",value:function(e){return e.match(/^https?:\/\//)||e.match(/^\/\//)?this.navigateDirect(e):this.navigateRelative(e)}},{key:"navigateRelative",value:function(t){var r,i,n,o,a,s,c,u;if(r=e(".js-render-shell"),c=e("body").data("github-hostname"),a=r.data("document-nwo"),n=r.data("document-commit"),s=r.data("document-path"),i=function(){return t.match(/^\//)?"":l.call(s,"/")<0?"/":"/"+s.slice(0,+s.lastIndexOf("/")+1||9e9)},!((null!=c?c.length:void 0)&&(null!=a?a.length:void 0)&&(null!=s?s.length:void 0)&&(null!=n?n.length:void 0)))throw o="Cannot construct relative link, missing:",(null!=c?c.length:void 0)||(o+=" root"),(null!=a?a.length:void 0)||(o+=" nwo"),(null!=s?s.length:void 0)||(o+=" path"),(null!=n?n.length:void 0)||(o+=" commit"),new Error(o);return u="//".concat(c,"/").concat(a,"/blob/").concat(n).concat(i()).concat(t),this.navigateDirect(u)}},{key:"navigateDirect",value:function(e){return this.haveParent()?window.top.location.href=e:window.location.href=e}},{key:"clientTimeoutAttempts",value:function(){return e("body").data("client-timeout-attempts")}}])&&o(s.prototype,c),u&&o(s,u),i}()}).call(this,r(0),r(10))},function(e,t,r){(function(){var r=this,i=r._,n={},o=Array.prototype,a=Object.prototype,s=Function.prototype,l=o.push,c=o.slice,u=o.concat,h=a.toString,f=a.hasOwnProperty,p=o.forEach,d=o.map,m=o.reduce,g=o.reduceRight,v=o.filter,y=o.every,x=o.some,b=o.indexOf,w=o.lastIndexOf,S=Array.isArray,_=Object.keys,M=s.bind,T=function(e){return e instanceof T?e:this instanceof T?void(this._wrapped=e):new T(e)};e.exports&&(t=e.exports=T),t._=T,T.VERSION="1.5.2";var C=T.each=T.forEach=function(e,t,r){if(null!=e)if(p&&e.forEach===p)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,o=e.length;i<o;i++)if(t.call(r,e[i],i,e)===n)return}else{var a=T.keys(e);for(i=0,o=a.length;i<o;i++)if(t.call(r,e[a[i]],a[i],e)===n)return}};T.map=T.collect=function(e,t,r){var i=[];return null==e?i:d&&e.map===d?e.map(t,r):(C(e,(function(e,n,o){i.push(t.call(r,e,n,o))})),i)};var A="Reduce of empty array with no initial value";T.reduce=T.foldl=T.inject=function(e,t,r,i){var n=arguments.length>2;if(null==e&&(e=[]),m&&e.reduce===m)return i&&(t=T.bind(t,i)),n?e.reduce(t,r):e.reduce(t);if(C(e,(function(e,o,a){n?r=t.call(i,r,e,o,a):(r=e,n=!0)})),!n)throw new TypeError(A);return r},T.reduceRight=T.foldr=function(e,t,r,i){var n=arguments.length>2;if(null==e&&(e=[]),g&&e.reduceRight===g)return i&&(t=T.bind(t,i)),n?e.reduceRight(t,r):e.reduceRight(t);var o=e.length;if(o!==+o){var a=T.keys(e);o=a.length}if(C(e,(function(s,l,c){l=a?a[--o]:--o,n?r=t.call(i,r,e[l],l,c):(r=e[l],n=!0)})),!n)throw new TypeError(A);return r},T.find=T.detect=function(e,t,r){var i;return E(e,(function(e,n,o){if(t.call(r,e,n,o))return i=e,!0})),i},T.filter=T.select=function(e,t,r){var i=[];return null==e?i:v&&e.filter===v?e.filter(t,r):(C(e,(function(e,n,o){t.call(r,e,n,o)&&i.push(e)})),i)},T.reject=function(e,t,r){return T.filter(e,(function(e,i,n){return!t.call(r,e,i,n)}),r)},T.every=T.all=function(e,t,r){t||(t=T.identity);var i=!0;return null==e?i:y&&e.every===y?e.every(t,r):(C(e,(function(e,o,a){if(!(i=i&&t.call(r,e,o,a)))return n})),!!i)};var E=T.some=T.any=function(e,t,r){t||(t=T.identity);var i=!1;return null==e?i:x&&e.some===x?e.some(t,r):(C(e,(function(e,o,a){if(i||(i=t.call(r,e,o,a)))return n})),!!i)};T.contains=T.include=function(e,t){return null!=e&&(b&&e.indexOf===b?-1!=e.indexOf(t):E(e,(function(e){return e===t})))},T.invoke=function(e,t){var r=c.call(arguments,2),i=T.isFunction(t);return T.map(e,(function(e){return(i?t:e[t]).apply(e,r)}))},T.pluck=function(e,t){return T.map(e,(function(e){return e[t]}))},T.where=function(e,t,r){return T.isEmpty(t)?r?void 0:[]:T[r?"find":"filter"](e,(function(e){for(var r in t)if(t[r]!==e[r])return!1;return!0}))},T.findWhere=function(e,t){return T.where(e,t,!0)},T.max=function(e,t,r){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&T.isEmpty(e))return-1/0;var i={computed:-1/0,value:-1/0};return C(e,(function(e,n,o){var a=t?t.call(r,e,n,o):e;a>i.computed&&(i={value:e,computed:a})})),i.value},T.min=function(e,t,r){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&T.isEmpty(e))return 1/0;var i={computed:1/0,value:1/0};return C(e,(function(e,n,o){var a=t?t.call(r,e,n,o):e;a<i.computed&&(i={value:e,computed:a})})),i.value},T.shuffle=function(e){var t,r=0,i=[];return C(e,(function(e){t=T.random(r++),i[r-1]=i[t],i[t]=e})),i},T.sample=function(e,t,r){return arguments.length<2||r?e[T.random(e.length-1)]:T.shuffle(e).slice(0,Math.max(0,t))};var D=function(e){return T.isFunction(e)?e:function(t){return t[e]}};T.sortBy=function(e,t,r){var i=D(t);return T.pluck(T.map(e,(function(e,t,n){return{value:e,index:t,criteria:i.call(r,e,t,n)}})).sort((function(e,t){var r=e.criteria,i=t.criteria;if(r!==i){if(r>i||void 0===r)return 1;if(r<i||void 0===i)return-1}return e.index-t.index})),"value")};var L=function(e){return function(t,r,i){var n={},o=null==r?T.identity:D(r);return C(t,(function(r,a){var s=o.call(i,r,a,t);e(n,s,r)})),n}};T.groupBy=L((function(e,t,r){(T.has(e,t)?e[t]:e[t]=[]).push(r)})),T.indexBy=L((function(e,t,r){e[t]=r})),T.countBy=L((function(e,t){T.has(e,t)?e[t]++:e[t]=1})),T.sortedIndex=function(e,t,r,i){for(var n=(r=null==r?T.identity:D(r)).call(i,t),o=0,a=e.length;o<a;){var s=o+a>>>1;r.call(i,e[s])<n?o=s+1:a=s}return o},T.toArray=function(e){return e?T.isArray(e)?c.call(e):e.length===+e.length?T.map(e,T.identity):T.values(e):[]},T.size=function(e){return null==e?0:e.length===+e.length?e.length:T.keys(e).length},T.first=T.head=T.take=function(e,t,r){if(null!=e)return null==t||r?e[0]:c.call(e,0,t)},T.initial=function(e,t,r){return c.call(e,0,e.length-(null==t||r?1:t))},T.last=function(e,t,r){if(null!=e)return null==t||r?e[e.length-1]:c.call(e,Math.max(e.length-t,0))},T.rest=T.tail=T.drop=function(e,t,r){return c.call(e,null==t||r?1:t)},T.compact=function(e){return T.filter(e,T.identity)};var P=function(e,t,r){return t&&T.every(e,T.isArray)?u.apply(r,e):(C(e,(function(e){T.isArray(e)||T.isArguments(e)?t?l.apply(r,e):P(e,t,r):r.push(e)})),r)};T.flatten=function(e,t){return P(e,t,[])},T.without=function(e){return T.difference(e,c.call(arguments,1))},T.uniq=T.unique=function(e,t,r,i){T.isFunction(t)&&(i=r,r=t,t=!1);var n=r?T.map(e,r,i):e,o=[],a=[];return C(n,(function(r,i){(t?i&&a[a.length-1]===r:T.contains(a,r))||(a.push(r),o.push(e[i]))})),o},T.union=function(){return T.uniq(T.flatten(arguments,!0))},T.intersection=function(e){var t=c.call(arguments,1);return T.filter(T.uniq(e),(function(e){return T.every(t,(function(t){return T.indexOf(t,e)>=0}))}))},T.difference=function(e){var t=u.apply(o,c.call(arguments,1));return T.filter(e,(function(e){return!T.contains(t,e)}))},T.zip=function(){for(var e=T.max(T.pluck(arguments,"length").concat(0)),t=new Array(e),r=0;r<e;r++)t[r]=T.pluck(arguments,""+r);return t},T.object=function(e,t){if(null==e)return{};for(var r={},i=0,n=e.length;i<n;i++)t?r[e[i]]=t[i]:r[e[i][0]]=e[i][1];return r},T.indexOf=function(e,t,r){if(null==e)return-1;var i=0,n=e.length;if(r){if("number"!=typeof r)return e[i=T.sortedIndex(e,t)]===t?i:-1;i=r<0?Math.max(0,n+r):r}if(b&&e.indexOf===b)return e.indexOf(t,r);for(;i<n;i++)if(e[i]===t)return i;return-1},T.lastIndexOf=function(e,t,r){if(null==e)return-1;var i=null!=r;if(w&&e.lastIndexOf===w)return i?e.lastIndexOf(t,r):e.lastIndexOf(t);for(var n=i?r:e.length;n--;)if(e[n]===t)return n;return-1},T.range=function(e,t,r){arguments.length<=1&&(t=e||0,e=0),r=arguments[2]||1;for(var i=Math.max(Math.ceil((t-e)/r),0),n=0,o=new Array(i);n<i;)o[n++]=e,e+=r;return o};var R=function(){};T.bind=function(e,t){var r,i;if(M&&e.bind===M)return M.apply(e,c.call(arguments,1));if(!T.isFunction(e))throw new TypeError;return r=c.call(arguments,2),i=function(){if(!(this instanceof i))return e.apply(t,r.concat(c.call(arguments)));R.prototype=e.prototype;var n=new R;R.prototype=null;var o=e.apply(n,r.concat(c.call(arguments)));return Object(o)===o?o:n}},T.partial=function(e){var t=c.call(arguments,1);return function(){return e.apply(this,t.concat(c.call(arguments)))}},T.bindAll=function(e){var t=c.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return C(t,(function(t){e[t]=T.bind(e[t],e)})),e},T.memoize=function(e,t){var r={};return t||(t=T.identity),function(){var i=t.apply(this,arguments);return T.has(r,i)?r[i]:r[i]=e.apply(this,arguments)}},T.delay=function(e,t){var r=c.call(arguments,2);return setTimeout((function(){return e.apply(null,r)}),t)},T.defer=function(e){return T.delay.apply(T,[e,1].concat(c.call(arguments,1)))},T.throttle=function(e,t,r){var i,n,o,a=null,s=0;r||(r={});var l=function(){s=!1===r.leading?0:new Date,a=null,o=e.apply(i,n)};return function(){var c=new Date;s||!1!==r.leading||(s=c);var u=t-(c-s);return i=this,n=arguments,u<=0?(clearTimeout(a),a=null,s=c,o=e.apply(i,n)):a||!1===r.trailing||(a=setTimeout(l,u)),o}},T.debounce=function(e,t,r){var i,n,o,a,s;return function(){o=this,n=arguments,a=new Date;var l=function(){var c=new Date-a;c<t?i=setTimeout(l,t-c):(i=null,r||(s=e.apply(o,n)))},c=r&&!i;return i||(i=setTimeout(l,t)),c&&(s=e.apply(o,n)),s}},T.once=function(e){var t,r=!1;return function(){return r||(r=!0,t=e.apply(this,arguments),e=null),t}},T.wrap=function(e,t){return function(){var r=[e];return l.apply(r,arguments),t.apply(this,r)}},T.compose=function(){var e=arguments;return function(){for(var t=arguments,r=e.length-1;r>=0;r--)t=[e[r].apply(this,t)];return t[0]}},T.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},T.keys=_||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var r in e)T.has(e,r)&&t.push(r);return t},T.values=function(e){for(var t=T.keys(e),r=t.length,i=new Array(r),n=0;n<r;n++)i[n]=e[t[n]];return i},T.pairs=function(e){for(var t=T.keys(e),r=t.length,i=new Array(r),n=0;n<r;n++)i[n]=[t[n],e[t[n]]];return i},T.invert=function(e){for(var t={},r=T.keys(e),i=0,n=r.length;i<n;i++)t[e[r[i]]]=r[i];return t},T.functions=T.methods=function(e){var t=[];for(var r in e)T.isFunction(e[r])&&t.push(r);return t.sort()},T.extend=function(e){return C(c.call(arguments,1),(function(t){if(t)for(var r in t)e[r]=t[r]})),e},T.pick=function(e){var t={},r=u.apply(o,c.call(arguments,1));return C(r,(function(r){r in e&&(t[r]=e[r])})),t},T.omit=function(e){var t={},r=u.apply(o,c.call(arguments,1));for(var i in e)T.contains(r,i)||(t[i]=e[i]);return t},T.defaults=function(e){return C(c.call(arguments,1),(function(t){if(t)for(var r in t)void 0===e[r]&&(e[r]=t[r])})),e},T.clone=function(e){return T.isObject(e)?T.isArray(e)?e.slice():T.extend({},e):e},T.tap=function(e,t){return t(e),e};var F=function(e,t,r,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof T&&(e=e._wrapped),t instanceof T&&(t=t._wrapped);var n=h.call(e);if(n!=h.call(t))return!1;switch(n){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var o=r.length;o--;)if(r[o]==e)return i[o]==t;var a=e.constructor,s=t.constructor;if(a!==s&&!(T.isFunction(a)&&a instanceof a&&T.isFunction(s)&&s instanceof s))return!1;r.push(e),i.push(t);var l=0,c=!0;if("[object Array]"==n){if(c=(l=e.length)==t.length)for(;l--&&(c=F(e[l],t[l],r,i)););}else{for(var u in e)if(T.has(e,u)&&(l++,!(c=T.has(t,u)&&F(e[u],t[u],r,i))))break;if(c){for(u in t)if(T.has(t,u)&&!l--)break;c=!l}}return r.pop(),i.pop(),c};T.isEqual=function(e,t){return F(e,t,[],[])},T.isEmpty=function(e){if(null==e)return!0;if(T.isArray(e)||T.isString(e))return 0===e.length;for(var t in e)if(T.has(e,t))return!1;return!0},T.isElement=function(e){return!(!e||1!==e.nodeType)},T.isArray=S||function(e){return"[object Array]"==h.call(e)},T.isObject=function(e){return e===Object(e)},C(["Arguments","Function","String","Number","Date","RegExp"],(function(e){T["is"+e]=function(t){return h.call(t)=="[object "+e+"]"}})),T.isArguments(arguments)||(T.isArguments=function(e){return!(!e||!T.has(e,"callee"))}),T.isFunction=function(e){return"function"==typeof e},T.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},T.isNaN=function(e){return T.isNumber(e)&&e!=+e},T.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==h.call(e)},T.isNull=function(e){return null===e},T.isUndefined=function(e){return void 0===e},T.has=function(e,t){return f.call(e,t)},T.noConflict=function(){return r._=i,this},T.identity=function(e){return e},T.times=function(e,t,r){for(var i=Array(Math.max(0,e)),n=0;n<e;n++)i[n]=t.call(r,n);return i},T.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var O={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};O.unescape=T.invert(O.escape);var U={escape:new RegExp("["+T.keys(O.escape).join("")+"]","g"),unescape:new RegExp("("+T.keys(O.unescape).join("|")+")","g")};T.each(["escape","unescape"],(function(e){T[e]=function(t){return null==t?"":(""+t).replace(U[e],(function(t){return O[e][t]}))}})),T.result=function(e,t){if(null!=e){var r=e[t];return T.isFunction(r)?r.call(e):r}},T.mixin=function(e){C(T.functions(e),(function(t){var r=T[t]=e[t];T.prototype[t]=function(){var e=[this._wrapped];return l.apply(e,arguments),B.call(this,r.apply(T,e))}}))};var N=0;T.uniqueId=function(e){var t=++N+"";return e?e+t:t},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var V=/(.)^/,k={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},z=/\\|'|\r|\n|\t|\u2028|\u2029/g;T.template=function(e,t,r){var i;r=T.defaults({},r,T.templateSettings);var n=new RegExp([(r.escape||V).source,(r.interpolate||V).source,(r.evaluate||V).source].join("|")+"|$","g"),o=0,a="__p+='";e.replace(n,(function(t,r,i,n,s){return a+=e.slice(o,s).replace(z,(function(e){return"\\"+k[e]})),r&&(a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),i&&(a+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),n&&(a+="';\n"+n+"\n__p+='"),o=s+t.length,t})),a+="';\n",r.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{i=new Function(r.variable||"obj","_",a)}catch(e){throw e.source=a,e}if(t)return i(t,T);var s=function(e){return i.call(this,e,T)};return s.source="function("+(r.variable||"obj")+"){\n"+a+"}",s},T.chain=function(e){return T(e).chain()};var B=function(e){return this._chain?T(e).chain():e};T.mixin(T),C(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=o[e];T.prototype[e]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=e&&"splice"!=e||0!==r.length||delete r[0],B.call(this,r)}})),C(["concat","join","slice"],(function(e){var t=o[e];T.prototype[e]=function(){return B.call(this,t.apply(this._wrapped,arguments))}})),T.extend(T.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},function(e,t){var r,i,n,o,a,s,l,c,u,h,f,p,d,m,g,v,y,x,b,w,S,_,M,T,C,A,E,D=D||{REVISION:"58"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},self.Int32Array=self.Int32Array||Array,self.Float32Array=self.Float32Array||Array,String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},D.extend=function(e,t){if(Object.keys)for(var r=Object.keys(t),i=0,n=r.length;i<n;i++){var o=r[i];Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}else{var a={}.hasOwnProperty;for(var o in t)a.call(t,o)&&(e[o]=t[o])}return e},function(){for(var e=0,t=["ms","moz","webkit","o"],r=0;r<t.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"];void 0===window.requestAnimationFrame&&(window.requestAnimationFrame=function(t){var r=Date.now(),i=Math.max(0,16-(r-e)),n=window.setTimeout((function(){t(r+i)}),i);return e=r+i,n}),window.cancelAnimationFrame=window.cancelAnimationFrame||function(e){window.clearTimeout(e)}}(),D.CullFaceNone=0,D.CullFaceBack=1,D.CullFaceFront=2,D.CullFaceFrontBack=3,D.FrontFaceDirectionCW=0,D.FrontFaceDirectionCCW=1,D.BasicShadowMap=0,D.PCFShadowMap=1,D.PCFSoftShadowMap=2,D.FrontSide=0,D.BackSide=1,D.DoubleSide=2,D.NoShading=0,D.FlatShading=1,D.SmoothShading=2,D.NoColors=0,D.FaceColors=1,D.VertexColors=2,D.NoBlending=0,D.NormalBlending=1,D.AdditiveBlending=2,D.SubtractiveBlending=3,D.MultiplyBlending=4,D.CustomBlending=5,D.AddEquation=100,D.SubtractEquation=101,D.ReverseSubtractEquation=102,D.ZeroFactor=200,D.OneFactor=201,D.SrcColorFactor=202,D.OneMinusSrcColorFactor=203,D.SrcAlphaFactor=204,D.OneMinusSrcAlphaFactor=205,D.DstAlphaFactor=206,D.OneMinusDstAlphaFactor=207,D.DstColorFactor=208,D.OneMinusDstColorFactor=209,D.SrcAlphaSaturateFactor=210,D.MultiplyOperation=0,D.MixOperation=1,D.AddOperation=2,D.UVMapping=function(){},D.CubeReflectionMapping=function(){},D.CubeRefractionMapping=function(){},D.SphericalReflectionMapping=function(){},D.SphericalRefractionMapping=function(){},D.RepeatWrapping=1e3,D.ClampToEdgeWrapping=1001,D.MirroredRepeatWrapping=1002,D.NearestFilter=1003,D.NearestMipMapNearestFilter=1004,D.NearestMipMapLinearFilter=1005,D.LinearFilter=1006,D.LinearMipMapNearestFilter=1007,D.LinearMipMapLinearFilter=1008,D.UnsignedByteType=1009,D.ByteType=1010,D.ShortType=1011,D.UnsignedShortType=1012,D.IntType=1013,D.UnsignedIntType=1014,D.FloatType=1015,D.UnsignedShort4444Type=1016,D.UnsignedShort5551Type=1017,D.UnsignedShort565Type=1018,D.AlphaFormat=1019,D.RGBFormat=1020,D.RGBAFormat=1021,D.LuminanceFormat=1022,D.LuminanceAlphaFormat=1023,D.RGB_S3TC_DXT1_Format=2001,D.RGBA_S3TC_DXT1_Format=2002,D.RGBA_S3TC_DXT3_Format=2003,D.RGBA_S3TC_DXT5_Format=2004,D.Color=function(e){return void 0!==e&&this.set(e),this},D.Color.prototype={constructor:D.Color,r:1,g:1,b:1,set:function(e){return e instanceof D.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(e,t,r){if(0===t)this.r=this.g=this.b=r;else{var i=function(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e},n=r<=.5?r*(1+t):r+t-r*t,o=2*r-n;this.r=i(o,n,e+1/3),this.g=i(o,n,e),this.b=i(o,n,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+),(\d+),(\d+)\)$/i.test(e)){var t=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(e)){t=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}if(/^(\w+)$/i.test(e))return this.setHex(D.ColorKeywords[e]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:(r={h:0,s:0,l:0},function(){var e,t,i=this.r,n=this.g,o=this.b,a=Math.max(i,n,o),s=Math.min(i,n,o),l=(s+a)/2;if(s===a)e=0,t=0;else{var c=a-s;switch(t=l<=.5?c/(a+s):c/(2-a-s),a){case i:e=(n-o)/c+(n<o?6:0);break;case n:e=(o-i)/c+2;break;case o:e=(i-n)/c+4}e/=6}return r.h=e,r.s=t,r.l=l,r}),getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,r){var i=this.getHSL();return i.h+=e,i.s+=t,i.l+=r,this.setHSL(i.h,i.s,i.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},clone:function(){return(new D.Color).setRGB(this.r,this.g,this.b)}},D.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},D.Quaternion=function(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1},D.Quaternion.prototype={constructor:D.Quaternion,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e,t){var r=Math.cos(e.x/2),i=Math.cos(e.y/2),n=Math.cos(e.z/2),o=Math.sin(e.x/2),a=Math.sin(e.y/2),s=Math.sin(e.z/2);return void 0===t||"XYZ"===t?(this.x=o*i*n+r*a*s,this.y=r*a*n-o*i*s,this.z=r*i*s+o*a*n,this.w=r*i*n-o*a*s):"YXZ"===t?(this.x=o*i*n+r*a*s,this.y=r*a*n-o*i*s,this.z=r*i*s-o*a*n,this.w=r*i*n+o*a*s):"ZXY"===t?(this.x=o*i*n-r*a*s,this.y=r*a*n+o*i*s,this.z=r*i*s+o*a*n,this.w=r*i*n-o*a*s):"ZYX"===t?(this.x=o*i*n-r*a*s,this.y=r*a*n+o*i*s,this.z=r*i*s-o*a*n,this.w=r*i*n+o*a*s):"YZX"===t?(this.x=o*i*n+r*a*s,this.y=r*a*n+o*i*s,this.z=r*i*s-o*a*n,this.w=r*i*n-o*a*s):"XZY"===t&&(this.x=o*i*n-r*a*s,this.y=r*a*n-o*i*s,this.z=r*i*s+o*a*n,this.w=r*i*n+o*a*s),this},setFromAxisAngle:function(e,t){var r=t/2,i=Math.sin(r);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(r),this},setFromRotationMatrix:function(e){var t,r=e.elements,i=r[0],n=r[4],o=r[8],a=r[1],s=r[5],l=r[9],c=r[2],u=r[6],h=r[10],f=i+s+h;return f>0?(t=.5/Math.sqrt(f+1),this.w=.25/t,this.x=(u-l)*t,this.y=(o-c)*t,this.z=(a-n)*t):i>s&&i>h?(t=2*Math.sqrt(1+i-s-h),this.w=(u-l)/t,this.x=.25*t,this.y=(n+a)/t,this.z=(o+c)/t):s>h?(t=2*Math.sqrt(1+s-i-h),this.w=(o-c)/t,this.x=(n+a)/t,this.y=.25*t,this.z=(l+u)/t):(t=2*Math.sqrt(1+h-i-s),this.w=(a-n)/t,this.x=(o+c)/t,this.y=(l+u)/t,this.z=.25*t),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=this.length();return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e.x,i=e.y,n=e.z,o=e.w,a=t.x,s=t.y,l=t.z,c=t.w;return this.x=r*c+o*a+i*l-n*s,this.y=i*c+o*s+n*a-r*l,this.z=n*c+o*l+r*s-i*a,this.w=o*c-r*a-i*s-n*l,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var r=this.x,i=this.y,n=this.z,o=this.w,a=o*e.w+r*e.x+i*e.y+n*e.z;if(a<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,a=-a):this.copy(e),a>=1)return this.w=o,this.x=r,this.y=i,this.z=n,this;var s=Math.acos(a),l=Math.sqrt(1-a*a);if(Math.abs(l)<.001)return this.w=.5*(o+this.w),this.x=.5*(r+this.x),this.y=.5*(i+this.y),this.z=.5*(n+this.z),this;var c=Math.sin((1-t)*s)/l,u=Math.sin(t*s)/l;return this.w=o*c+this.w*u,this.x=r*c+this.x*u,this.y=i*c+this.y*u,this.z=n*c+this.z*u,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new D.Quaternion(this.x,this.y,this.z,this.w)}},D.Quaternion.slerp=function(e,t,r,i){return r.copy(e).slerp(t,i)},D.Vector2=function(e,t){this.x=e||0,this.y=t||0},D.Vector2.prototype={constructor:D.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e):this.set(0,0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){return this.x=e[0],this.y=e[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new D.Vector2(this.x,this.y)}},D.Vector3=function(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0},D.Vector3.prototype={constructor:D.Vector3,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*i,this.y=n[1]*t+n[4]*r+n[7]*i,this.z=n[2]*t+n[5]*r+n[8]*i,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i+n[12],this.y=n[1]*t+n[5]*r+n[9]*i+n[13],this.z=n[2]*t+n[6]*r+n[10]*i+n[14],this},applyProjection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements,o=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*o,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*o,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*o,this},applyQuaternion:function(e){var t=this.x,r=this.y,i=this.z,n=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*i-a*r,c=s*r+a*t-n*i,u=s*i+n*r-o*t,h=-n*t-o*r-a*i;return this.x=l*s+h*-n+c*-a-u*-o,this.y=c*s+h*-o+u*-n-l*-a,this.z=u*s+h*-a+l*-o-c*-n,this},transformDirection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i,this.y=n[1]*t+n[5]*r+n[9]*i,this.z=n[2]*t+n[6]*r+n[10]*i,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e):(this.x=0,this.y=0,this.z=0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var r=this.x,i=this.y,n=this.z;return this.x=i*e.z-n*e.y,this.y=n*e.x-r*e.z,this.z=r*e.y-i*e.x,this},crossVectors:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(D.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i},setEulerFromRotationMatrix:function(e,t){function r(e){return Math.min(Math.max(e,-1),1)}var i=e.elements,n=i[0],o=i[4],a=i[8],s=i[1],l=i[5],c=i[9],u=i[2],h=i[6],f=i[10];return void 0===t||"XYZ"===t?(this.y=Math.asin(r(a)),Math.abs(a)<.99999?(this.x=Math.atan2(-c,f),this.z=Math.atan2(-o,n)):(this.x=Math.atan2(h,l),this.z=0)):"YXZ"===t?(this.x=Math.asin(-r(c)),Math.abs(c)<.99999?(this.y=Math.atan2(a,f),this.z=Math.atan2(s,l)):(this.y=Math.atan2(-u,n),this.z=0)):"ZXY"===t?(this.x=Math.asin(r(h)),Math.abs(h)<.99999?(this.y=Math.atan2(-u,f),this.z=Math.atan2(-o,l)):(this.y=0,this.z=Math.atan2(s,n))):"ZYX"===t?(this.y=Math.asin(-r(u)),Math.abs(u)<.99999?(this.x=Math.atan2(h,f),this.z=Math.atan2(s,n)):(this.x=0,this.z=Math.atan2(-o,l))):"YZX"===t?(this.z=Math.asin(r(s)),Math.abs(s)<.99999?(this.x=Math.atan2(-c,l),this.y=Math.atan2(-u,n)):(this.x=0,this.y=Math.atan2(a,f))):"XZY"===t&&(this.z=Math.asin(-r(o)),Math.abs(o)<.99999?(this.x=Math.atan2(h,l),this.y=Math.atan2(a,n)):(this.x=Math.atan2(-c,f),this.y=0)),this},setEulerFromQuaternion:function(e,t){function r(e){return Math.min(Math.max(e,-1),1)}var i=e.x*e.x,n=e.y*e.y,o=e.z*e.z,a=e.w*e.w;return void 0===t||"XYZ"===t?(this.x=Math.atan2(2*(e.x*e.w-e.y*e.z),a-i-n+o),this.y=Math.asin(r(2*(e.x*e.z+e.y*e.w))),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),a+i-n-o)):"YXZ"===t?(this.x=Math.asin(r(2*(e.x*e.w-e.y*e.z))),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),a-i-n+o),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),a-i+n-o)):"ZXY"===t?(this.x=Math.asin(r(2*(e.x*e.w+e.y*e.z))),this.y=Math.atan2(2*(e.y*e.w-e.z*e.x),a-i-n+o),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),a-i+n-o)):"ZYX"===t?(this.x=Math.atan2(2*(e.x*e.w+e.z*e.y),a-i-n+o),this.y=Math.asin(r(2*(e.y*e.w-e.x*e.z))),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),a+i-n-o)):"YZX"===t?(this.x=Math.atan2(2*(e.x*e.w-e.z*e.y),a-i+n-o),this.y=Math.atan2(2*(e.y*e.w-e.x*e.z),a+i-n-o),this.z=Math.asin(r(2*(e.x*e.y+e.z*e.w)))):"XZY"===t&&(this.x=Math.atan2(2*(e.x*e.w+e.y*e.z),a-i+n-o),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),a+i-n-o),this.z=Math.asin(r(2*(e.z*e.w-e.x*e.y)))),this},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),r=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),i=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=r,this.z=i,this},getColumnFromMatrix:function(e,t){var r=4*e,i=t.elements;return this.x=i[r],this.y=i[r+1],this.z=i[r+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new D.Vector3(this.x,this.y,this.z)}},D.extend(D.Vector3.prototype,{applyEuler:(n=new D.Quaternion,function(e,t){var r=n.setFromEuler(e,t);return this.applyQuaternion(r),this}),applyAxisAngle:function(){var e=new D.Quaternion;return function(t,r){var i=e.setFromAxisAngle(t,r);return this.applyQuaternion(i),this}}(),projectOnVector:(i=new D.Vector3,function(e){i.copy(e).normalize();var t=this.dot(i);return this.copy(i).multiplyScalar(t)}),projectOnPlane:function(){var e=new D.Vector3;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new D.Vector3;return function(t){return e.copy(this).projectOnVector(t).multiplyScalar(2),this.subVectors(e,this)}}()}),D.Vector4=function(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1},D.Vector4.prototype={constructor:D.Vector4,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i+o[12]*n,this.y=o[1]*t+o[5]*r+o[9]*i+o[13]*n,this.z=o[2]*t+o[6]*r+o[10]*i+o[14]*n,this.w=o[3]*t+o[7]*r+o[11]*i+o[15]*n,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):(this.x=0,this.y=0,this.z=0,this.w=1),this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,i,n,o=e.elements,a=o[0],s=o[4],l=o[8],c=o[1],u=o[5],h=o[9],f=o[2],p=o[6],d=o[10];if(Math.abs(s-c)<.01&&Math.abs(l-f)<.01&&Math.abs(h-p)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+f)<.1&&Math.abs(h+p)<.1&&Math.abs(a+u+d-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,g=(u+1)/2,v=(d+1)/2,y=(s+c)/4,x=(l+f)/4,b=(h+p)/4;return m>g&&m>v?m<.01?(r=0,i=.707106781,n=.707106781):(i=y/(r=Math.sqrt(m)),n=x/r):g>v?g<.01?(r=.707106781,i=0,n=.707106781):(r=y/(i=Math.sqrt(g)),n=b/i):v<.01?(r=.707106781,i=.707106781,n=0):(r=x/(n=Math.sqrt(v)),i=b/n),this.set(r,i,n,t),this}var w=Math.sqrt((p-h)*(p-h)+(l-f)*(l-f)+(c-s)*(c-s));return Math.abs(w)<.001&&(w=1),this.x=(p-h)/w,this.y=(l-f)/w,this.z=(c-s)/w,this.w=Math.acos((a+u+d-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new D.Vector4(this.x,this.y,this.z,this.w)}},D.Line3=function(e,t){this.start=void 0!==e?e:new D.Vector3,this.end=void 0!==t?t:new D.Vector3},D.Line3.prototype={constructor:D.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){return(e||new D.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new D.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new D.Vector3;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:(o=new D.Vector3,a=new D.Vector3,function(e,t){o.subVectors(e,this.start),a.subVectors(this.end,this.start);var r=a.dot(a),i=a.dot(o)/r;return t&&(i=D.Math.clamp(i,0,1)),i}),closestPointToPoint:function(e,t,r){var i=this.closestPointToPointParameter(e,t),n=r||new D.Vector3;return this.delta(n).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new D.Line3).copy(this)}},D.Box2=function(e,t){this.min=void 0!==e?e:new D.Vector2(1/0,1/0),this.max=void 0!==t?t:new D.Vector2(-1/0,-1/0)},D.Box2.prototype={constructor:D.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var r=1,i=e.length;r<i;r++)(t=e[r]).x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new D.Vector2;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){return(e||new D.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new D.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e){return new D.Vector2((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return(t||new D.Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new D.Vector2;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new D.Box2).copy(this)}},D.Box3=function(e,t){this.min=void 0!==e?e:new D.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new D.Vector3(-1/0,-1/0,-1/0)},D.Box3.prototype={constructor:D.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var r=1,i=e.length;r<i;r++)(t=e[r]).x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y),t.z<this.min.z?this.min.z=t.z:t.z>this.max.z&&(this.max.z=t.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new D.Vector3;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new D.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new D.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e){return new D.Vector3((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){return(t||new D.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new D.Vector3;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new D.Vector3;return function(t){var r=t||new D.Sphere;return r.center=this.center(),r.radius=.5*this.size(e).length(),r}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(s=[new D.Vector3,new D.Vector3,new D.Vector3,new D.Vector3,new D.Vector3,new D.Vector3,new D.Vector3,new D.Vector3],function(e){return s[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),s[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),s[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),s[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),s[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),s[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),s[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),s[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(s),this}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new D.Box3).copy(this)}},D.Matrix3=function(e,t,r,i,n,o,a,s,l){this.elements=new Float32Array(9),this.set(void 0!==e?e:1,t||0,r||0,i||0,void 0!==n?n:1,o||0,a||0,s||0,void 0!==l?l:1)},D.Matrix3.prototype={constructor:D.Matrix3,set:function(e,t,r,i,n,o,a,s,l){var c=this.elements;return c[0]=e,c[3]=t,c[6]=r,c[1]=i,c[4]=n,c[7]=o,c[2]=a,c[5]=s,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var e=new D.Vector3;return function(t){for(var r=0,i=t.length;r<i;r+=3)e.x=t[r],e.y=t[r+1],e.z=t[r+2],e.applyMatrix3(this),t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*o*c-t*a*l-r*n*c+r*a*s+i*n*l-i*o*s},getInverse:function(e,t){var r=e.elements,i=this.elements;i[0]=r[10]*r[5]-r[6]*r[9],i[1]=-r[10]*r[1]+r[2]*r[9],i[2]=r[6]*r[1]-r[2]*r[5],i[3]=-r[10]*r[4]+r[6]*r[8],i[4]=r[10]*r[0]-r[2]*r[8],i[5]=-r[6]*r[0]+r[2]*r[4],i[6]=r[9]*r[4]-r[5]*r[8],i[7]=-r[9]*r[0]+r[1]*r[8],i[8]=r[5]*r[0]-r[1]*r[4];var n=r[0]*i[0]+r[1]*i[3]+r[2]*i[6];if(0===n){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return console.warn(o),this.identity(),this}return this.multiplyScalar(1/n),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},clone:function(){var e=this.elements;return new D.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},D.Matrix4=function(e,t,r,i,n,o,a,s,l,c,u,h,f,p,d,m){var g=this.elements=new Float32Array(16);g[0]=void 0!==e?e:1,g[4]=t||0,g[8]=r||0,g[12]=i||0,g[1]=n||0,g[5]=void 0!==o?o:1,g[9]=a||0,g[13]=s||0,g[2]=l||0,g[6]=c||0,g[10]=void 0!==u?u:1,g[14]=h||0,g[3]=f||0,g[7]=p||0,g[11]=d||0,g[15]=void 0!==m?m:1},D.Matrix4.prototype={constructor:D.Matrix4,set:function(e,t,r,i,n,o,a,s,l,c,u,h,f,p,d,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=i,g[1]=n,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=f,g[7]=p,g[11]=d,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]),this},extractPosition:function(e){return console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractRotation:function(){var e=new D.Vector3;return function(t){var r=this.elements,i=t.elements,n=1/e.set(i[0],i[1],i[2]).length(),o=1/e.set(i[4],i[5],i[6]).length(),a=1/e.set(i[8],i[9],i[10]).length();return r[0]=i[0]*n,r[1]=i[1]*n,r[2]=i[2]*n,r[4]=i[4]*o,r[5]=i[5]*o,r[6]=i[6]*o,r[8]=i[8]*a,r[9]=i[9]*a,r[10]=i[10]*a,this}}(),setRotationFromEuler:function(e,t){return console.warn("DEPRECATED: Matrix4's .setRotationFromEuler() has been deprecated in favor of makeRotationFromEuler.  Please update your code."),this.makeRotationFromEuler(e,t)},makeRotationFromEuler:function(e,t){var r=this.elements,i=e.x,n=e.y,o=e.z,a=Math.cos(i),s=Math.sin(i),l=Math.cos(n),c=Math.sin(n),u=Math.cos(o),h=Math.sin(o);if(void 0===t||"XYZ"===t){var f=a*u,p=a*h,d=s*u,m=s*h;r[0]=l*u,r[4]=-l*h,r[8]=c,r[1]=p+d*c,r[5]=f-m*c,r[9]=-s*l,r[2]=m-f*c,r[6]=d+p*c,r[10]=a*l}else if("YXZ"===t){var g=l*u,v=l*h,y=c*u,x=c*h;r[0]=g+x*s,r[4]=y*s-v,r[8]=a*c,r[1]=a*h,r[5]=a*u,r[9]=-s,r[2]=v*s-y,r[6]=x+g*s,r[10]=a*l}else if("ZXY"===t){g=l*u,v=l*h,y=c*u,x=c*h;r[0]=g-x*s,r[4]=-a*h,r[8]=y+v*s,r[1]=v+y*s,r[5]=a*u,r[9]=x-g*s,r[2]=-a*c,r[6]=s,r[10]=a*l}else if("ZYX"===t){f=a*u,p=a*h,d=s*u,m=s*h;r[0]=l*u,r[4]=d*c-p,r[8]=f*c+m,r[1]=l*h,r[5]=m*c+f,r[9]=p*c-d,r[2]=-c,r[6]=s*l,r[10]=a*l}else if("YZX"===t){var b=a*l,w=a*c,S=s*l,_=s*c;r[0]=l*u,r[4]=_-b*h,r[8]=S*h+w,r[1]=h,r[5]=a*u,r[9]=-s*u,r[2]=-c*u,r[6]=w*h+S,r[10]=b-_*h}else if("XZY"===t){b=a*l,w=a*c,S=s*l,_=s*c;r[0]=l*u,r[4]=-h,r[8]=c*u,r[1]=b*h+_,r[5]=a*u,r[9]=w*h-S,r[2]=S*h-w,r[6]=s*u,r[10]=_*h+b}return r[3]=0,r[7]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z,o=e.w,a=r+r,s=i+i,l=n+n,c=r*a,u=r*s,h=r*l,f=i*s,p=i*l,d=n*l,m=o*a,g=o*s,v=o*l;return t[0]=1-(f+d),t[4]=u-v,t[8]=h+g,t[1]=u+v,t[5]=1-(c+d),t[9]=p-m,t[2]=h-g,t[6]=p+m,t[10]=1-(c+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:(l=new D.Vector3,c=new D.Vector3,u=new D.Vector3,function(e,t,r){var i=this.elements;return u.subVectors(e,t).normalize(),0===u.length()&&(u.z=1),l.crossVectors(r,u).normalize(),0===l.length()&&(u.x+=1e-4,l.crossVectors(r,u).normalize()),c.crossVectors(u,l),i[0]=l.x,i[4]=c.x,i[8]=u.x,i[1]=l.y,i[5]=c.y,i[9]=u.y,i[2]=l.z,i[6]=c.z,i[10]=u.z,this}),multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,n=this.elements,o=r[0],a=r[4],s=r[8],l=r[12],c=r[1],u=r[5],h=r[9],f=r[13],p=r[2],d=r[6],m=r[10],g=r[14],v=r[3],y=r[7],x=r[11],b=r[15],w=i[0],S=i[4],_=i[8],M=i[12],T=i[1],C=i[5],A=i[9],E=i[13],D=i[2],L=i[6],P=i[10],R=i[14],F=i[3],O=i[7],U=i[11],N=i[15];return n[0]=o*w+a*T+s*D+l*F,n[4]=o*S+a*C+s*L+l*O,n[8]=o*_+a*A+s*P+l*U,n[12]=o*M+a*E+s*R+l*N,n[1]=c*w+u*T+h*D+f*F,n[5]=c*S+u*C+h*L+f*O,n[9]=c*_+u*A+h*P+f*U,n[13]=c*M+u*E+h*R+f*N,n[2]=p*w+d*T+m*D+g*F,n[6]=p*S+d*C+m*L+g*O,n[10]=p*_+d*A+m*P+g*U,n[14]=p*M+d*E+m*R+g*N,n[3]=v*w+y*T+x*D+b*F,n[7]=v*S+y*C+x*L+b*O,n[11]=v*_+y*A+x*P+b*U,n[15]=v*M+y*E+x*R+b*N,this},multiplyToArray:function(e,t,r){var i=this.elements;return this.multiplyMatrices(e,t),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){var e=new D.Vector3;return function(t){for(var r=0,i=t.length;r<i;r+=3)e.x=t[r],e.y=t[r+1],e.z=t[r+2],e.applyProjection(this),t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z;return t}}(),rotateAxis:function(e){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],f=e[14];return e[3]*(+n*s*u-i*l*u-n*a*h+r*l*h+i*a*f-r*s*f)+e[7]*(+t*s*f-t*l*h+n*o*h-i*o*f+i*l*c-n*s*c)+e[11]*(+t*l*u-t*a*f-n*o*u+r*o*f+n*a*c-r*l*c)+e[15]*(-i*a*c-t*s*u+t*a*h+i*o*u-r*o*h+r*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e},getPosition:function(){var e=new D.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,i=e.elements,n=i[0],o=i[4],a=i[8],s=i[12],l=i[1],c=i[5],u=i[9],h=i[13],f=i[2],p=i[6],d=i[10],m=i[14],g=i[3],v=i[7],y=i[11],x=i[15];r[0]=u*m*v-h*d*v+h*p*y-c*m*y-u*p*x+c*d*x,r[4]=s*d*v-a*m*v-s*p*y+o*m*y+a*p*x-o*d*x,r[8]=a*h*v-s*u*v+s*c*y-o*h*y-a*c*x+o*u*x,r[12]=s*u*p-a*h*p-s*c*d+o*h*d+a*c*m-o*u*m,r[1]=h*d*g-u*m*g-h*f*y+l*m*y+u*f*x-l*d*x,r[5]=a*m*g-s*d*g+s*f*y-n*m*y-a*f*x+n*d*x,r[9]=s*u*g-a*h*g-s*l*y+n*h*y+a*l*x-n*u*x,r[13]=a*h*f-s*u*f+s*l*d-n*h*d-a*l*m+n*u*m,r[2]=c*m*g-h*p*g+h*f*v-l*m*v-c*f*x+l*p*x,r[6]=s*p*g-o*m*g-s*f*v+n*m*v+o*f*x-n*p*x,r[10]=o*h*g-s*c*g+s*l*v-n*h*v-o*l*x+n*c*x,r[14]=s*c*f-o*h*f-s*l*p+n*h*p+o*l*m-n*c*m,r[3]=u*p*g-c*d*g-u*f*v+l*d*v+c*f*y-l*p*y,r[7]=o*d*g-a*p*g+a*f*v-n*d*v-o*f*y+n*p*y,r[11]=a*c*g-o*u*g-a*l*v+n*u*v+o*l*y-n*c*y,r[15]=o*u*f-a*c*f+a*l*p-n*u*p-o*l*d+n*c*d;var b=i[0]*r[0]+i[1]*r[4]+i[2]*r[8]+i[3]*r[12];if(0==b){var w="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(w);return console.warn(w),this.identity(),this}return this.multiplyScalar(1/b),this},translate:function(e){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(e){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(e){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(e){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z;return t[0]*=r,t[4]*=i,t[8]*=n,t[1]*=r,t[5]*=i,t[9]*=n,t[2]*=r,t[6]*=i,t[10]*=n,t[3]*=r,t[7]*=i,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(r,i)))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=1-r,o=e.x,a=e.y,s=e.z,l=n*o,c=n*a;return this.set(l*o+r,l*a-i*s,l*s+i*a,0,l*a+i*s,c*a+r,c*s-i*o,0,l*s-i*a,c*s+i*o,n*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},compose:function(e,t,r){return console.warn("DEPRECATED: Matrix4's .compose() has been deprecated in favor of makeFromPositionQuaternionScale. Please update your code."),this.makeFromPositionQuaternionScale(e,t,r)},makeFromPositionQuaternionScale:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},makeFromPositionEulerScale:function(e,t,r,i){return this.makeRotationFromEuler(t,r),this.scale(i),this.setPosition(e),this},makeFrustum:function(e,t,r,i,n,o){var a=this.elements,s=2*n/(t-e),l=2*n/(i-r),c=(t+e)/(t-e),u=(i+r)/(i-r),h=-(o+n)/(o-n),f=-2*o*n/(o-n);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(e,t,r,i){var n=r*Math.tan(D.Math.degToRad(.5*e)),o=-n,a=o*t,s=n*t;return this.makeFrustum(a,s,o,n,r,i)},makeOrthographic:function(e,t,r,i,n,o){var a=this.elements,s=t-e,l=r-i,c=o-n,u=(t+e)/s,h=(r+i)/l,f=(o+n)/c;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2/l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2/c,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},clone:function(){var e=this.elements;return new D.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},D.extend(D.Matrix4.prototype,{decompose:function(){var e=new D.Vector3,t=new D.Vector3,r=new D.Vector3,i=new D.Matrix4;return function(n,o,a){var s=this.elements;return e.set(s[0],s[1],s[2]),t.set(s[4],s[5],s[6]),r.set(s[8],s[9],s[10]),n=n instanceof D.Vector3?n:new D.Vector3,o=o instanceof D.Quaternion?o:new D.Quaternion,(a=a instanceof D.Vector3?a:new D.Vector3).x=e.length(),a.y=t.length(),a.z=r.length(),n.x=s[12],n.y=s[13],n.z=s[14],i.copy(this),i.elements[0]/=a.x,i.elements[1]/=a.x,i.elements[2]/=a.x,i.elements[4]/=a.y,i.elements[5]/=a.y,i.elements[6]/=a.y,i.elements[8]/=a.z,i.elements[9]/=a.z,i.elements[10]/=a.z,o.setFromRotationMatrix(i),[n,o,a]}}()}),D.Ray=function(e,t){this.origin=void 0!==e?e:new D.Vector3,this.direction=void 0!==t?t:new D.Vector3},D.Ray.prototype={constructor:D.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new D.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new D.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var r=t||new D.Vector3;r.subVectors(e,this.origin);var i=r.dot(this.direction);return r.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(){var e=new D.Vector3;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceTo(t)}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){return 0!=e.normal.dot(this.direction)||0==e.distanceToPoint(this.origin)},distanceToPlane:function(e){var t=e.normal.dot(this.direction);return 0==t?0==e.distanceToPoint(this.origin)?0:void 0:-(this.origin.dot(e.normal)+e.constant)/t},intersectPlane:function(e,t){var r=this.distanceToPlane(e);if(void 0!==r)return this.at(r,t)},applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new D.Ray).copy(this)}},D.Sphere=function(e,t){this.center=void 0!==e?e:new D.Vector3,this.radius=void 0!==t?t:0},D.Sphere.prototype={constructor:D.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromCenterAndPoints:function(e,t){for(var r=0,i=0,n=t.length;i<n;i++){var o=e.distanceToSquared(t[i]);r=Math.max(r,o)}return this.center=e,this.radius=Math.sqrt(r),this},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var r=this.center.distanceToSquared(e),i=t||new D.Vector3;return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(e){var t=e||new D.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new D.Sphere).copy(this)}},D.Frustum=function(e,t,r,i,n,o){this.planes=[void 0!==e?e:new D.Plane,void 0!==t?t:new D.Plane,void 0!==r?r:new D.Plane,void 0!==i?i:new D.Plane,void 0!==n?n:new D.Plane,void 0!==o?o:new D.Plane]},D.Frustum.prototype={constructor:D.Frustum,set:function(e,t,r,i,n,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(n),a[5].copy(o),this},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,i=r[0],n=r[1],o=r[2],a=r[3],s=r[4],l=r[5],c=r[6],u=r[7],h=r[8],f=r[9],p=r[10],d=r[11],m=r[12],g=r[13],v=r[14],y=r[15];return t[0].setComponents(a-i,u-s,d-h,y-m).normalize(),t[1].setComponents(a+i,u+s,d+h,y+m).normalize(),t[2].setComponents(a+n,u+l,d+f,y+g).normalize(),t[3].setComponents(a-n,u-l,d-f,y-g).normalize(),t[4].setComponents(a-o,u-c,d-p,y-v).normalize(),t[5].setComponents(a+o,u+c,d+p,y+v).normalize(),this},intersectsObject:(h=new D.Vector3,function(e){var t=e.matrixWorld,r=this.planes,i=-e.geometry.boundingSphere.radius*t.getMaxScaleOnAxis();h.getPositionFromMatrix(t);for(var n=0;n<6;n++)if(r[n].distanceToPoint(h)<i)return!1;return!0}),intersectsSphere:function(e){for(var t=this.planes,r=e.center,i=-e.radius,n=0;n<6;n++){if(t[n].distanceToPoint(r)<i)return!1}return!0},containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new D.Frustum).copy(this)}},D.Plane=function(e,t){this.normal=void 0!==e?e:new D.Vector3(1,0,0),this.constant=void 0!==t?t:0},D.Plane.prototype={constructor:D.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new D.Vector3,t=new D.Vector3;return function(r,i,n){var o=e.subVectors(n,i).cross(t.subVectors(r,i)).normalize();return this.setFromNormalAndCoplanarPoint(o,r),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e);return(t||new D.Vector3).copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectLine:function(){var e=new D.Vector3;return function(t,r){var i=r||new D.Vector3,n=t.delta(e),o=this.normal.dot(n);if(0==o)return 0==this.distanceToPoint(t.start)?i.copy(t.start):void 0;var a=-(t.start.dot(this.normal)+this.constant)/o;return a<0||a>1?void 0:i.copy(n).multiplyScalar(a).add(t.start)}}(),coplanarPoint:function(e){return(e||new D.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new D.Vector3,t=new D.Vector3;return function(r,i){i=i||(new D.Matrix3).getNormalMatrix(r);var n=e.copy(this.normal).applyMatrix3(i),o=this.coplanarPoint(t);return o.applyMatrix4(r),this.setFromNormalAndCoplanarPoint(n,o),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new D.Plane).copy(this)}},D.Math={clamp:function(e,t,r){return e<t?t:e>r?r:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:e>0?1:0},degToRad:(p=Math.PI/180,function(e){return e*p}),radToDeg:(f=180/Math.PI,function(e){return e*f})},D.Spline=function(e){this.points=e;var t,r,i,n,o,a,s,l,c,u=[],h={x:0,y:0,z:0};function f(e,t,r,i,n,o,a){var s=.5*(r-e),l=.5*(i-t);return(2*(t-r)+s+l)*a+(-3*(t-r)-2*s-l)*o+s*n+t}this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return t=(this.points.length-1)*e,r=Math.floor(t),i=t-r,u[0]=0===r?r:r-1,u[1]=r,u[2]=r>this.points.length-2?this.points.length-1:r+1,u[3]=r>this.points.length-3?this.points.length-1:r+2,a=this.points[u[0]],s=this.points[u[1]],l=this.points[u[2]],c=this.points[u[3]],o=i*(n=i*i),h.x=f(a.x,s.x,l.x,c.x,i,n,o),h.y=f(a.y,s.y,l.y,c.y,i,n,o),h.z=f(a.z,s.z,l.z,c.z,i,n,o),h},this.getControlPointsArray=function(){var e,t,r=this.points.length,i=[];for(e=0;e<r;e++)t=this.points[e],i[e]=[t.x,t.y,t.z];return i},this.getLength=function(e){var t,r,i,n,o=0,a=0,s=0,l=new D.Vector3,c=new D.Vector3,u=[],h=0;for(u[0]=0,e||(e=100),i=this.points.length*e,l.copy(this.points[0]),t=1;t<i;t++)r=t/i,n=this.getPoint(r),c.copy(n),h+=c.distanceTo(l),l.copy(n),o=(this.points.length-1)*r,(a=Math.floor(o))!=s&&(u[a]=h,s=a);return u[u.length]=h,{chunks:u,total:h}},this.reparametrizeByArcLength=function(e){var t,r,i,n,o,a,s,l,c=[],u=new D.Vector3,h=this.getLength();for(c.push(u.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(a=h.chunks[t]-h.chunks[t-1],s=Math.ceil(e*a/h.total),n=(t-1)/(this.points.length-1),o=t/(this.points.length-1),r=1;r<s-1;r++)i=n+r*(1/s)*(o-n),l=this.getPoint(i),c.push(u.copy(l).clone());c.push(u.copy(this.points[t]).clone())}this.points=c}},D.Triangle=function(e,t,r){this.a=void 0!==e?e:new D.Vector3,this.b=void 0!==t?t:new D.Vector3,this.c=void 0!==r?r:new D.Vector3},D.Triangle.normal=(d=new D.Vector3,function(e,t,r,i){var n=i||new D.Vector3;n.subVectors(r,t),d.subVectors(e,t),n.cross(d);var o=n.lengthSq();return o>0?n.multiplyScalar(1/Math.sqrt(o)):n.set(0,0,0)}),D.Triangle.barycoordFromPoint=function(){var e=new D.Vector3,t=new D.Vector3,r=new D.Vector3;return function(i,n,o,a,s){e.subVectors(a,n),t.subVectors(o,n),r.subVectors(i,n);var l=e.dot(e),c=e.dot(t),u=e.dot(r),h=t.dot(t),f=t.dot(r),p=l*h-c*c,d=s||new D.Vector3;if(0==p)return d.set(-2,-1,-1);var m=1/p,g=(h*u-c*f)*m,v=(l*f-c*u)*m;return d.set(1-g-v,v,g)}}(),D.Triangle.containsPoint=function(){var e=new D.Vector3;return function(t,r,i,n){var o=D.Triangle.barycoordFromPoint(t,r,i,n,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),D.Triangle.prototype={constructor:D.Triangle,set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new D.Vector3,t=new D.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){return(e||new D.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return D.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new D.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return D.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return D.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new D.Triangle).copy(this)}},D.Vertex=function(e){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),e},D.UV=function(e,t){return console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),new D.Vector2(e,t)},D.Clock=function(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},D.Clock.prototype={constructor:D.Clock,start:function(){this.startTime=void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},D.EventDispatcher=function(){},D.EventDispatcher.prototype={constructor:D.EventDispatcher,addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners,i=r[e].indexOf(t);-1!==i&&r[e].splice(i,1)}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=0,i=t.length;r<i;r++)t[r].call(this,e)}}}},function(e){e.Raycaster=function(t,r,i,n){this.ray=new e.Ray(t,r),this.ray.direction.lengthSq()>0&&this.ray.direction.normalize(),this.near=i||0,this.far=n||1/0};var t=new e.Sphere,r=new e.Ray,i=new e.Plane,n=new e.Vector3,o=new e.Vector3,a=new e.Matrix4,s=function(e,t){return e.distance-t.distance},l=function(s,c,u){if(s instanceof e.Particle){if(o.getPositionFromMatrix(s.matrixWorld),(h=c.ray.distanceToPoint(o))>s.scale.x)return u;u.push({distance:h,point:s.position,face:null,object:s})}else if(s instanceof e.LOD){o.getPositionFromMatrix(s.matrixWorld);var h=c.ray.origin.distanceTo(o);l(s.getObjectForDistance(h),c,u)}else if(s instanceof e.Mesh){if(o.getPositionFromMatrix(s.matrixWorld),t.set(o,s.geometry.boundingSphere.radius*s.matrixWorld.getMaxScaleOnAxis()),!c.ray.isIntersectionSphere(t))return u;var f,p,d,m,g=s.geometry,v=g.vertices,y=s.material instanceof e.MeshFaceMaterial,x=!0===y?s.material.materials:null,b=s.material.side,w=c.precision;a.getInverse(s.matrixWorld),r.copy(c.ray).applyMatrix4(a);for(var S=0,_=g.faces.length;S<_;S++){var M=g.faces[S],T=!0===y?x[M.materialIndex]:s.material;if(void 0!==T){i.setFromNormalAndCoplanarPoint(M.normal,v[M.a]);var C=r.distanceToPlane(i);if(!(Math.abs(C)<w||C<0)){if((b=T.side)!==e.DoubleSide){var A=r.direction.dot(i.normal);if(!(b===e.FrontSide?A<0:A>0))continue}if(!(C<c.near||C>c.far)){if(n=r.at(C,n),M instanceof e.Face3){if(f=v[M.a],p=v[M.b],d=v[M.c],!e.Triangle.containsPoint(n,f,p,d))continue}else{if(!(M instanceof e.Face4))throw Error("face type not supported");if(f=v[M.a],p=v[M.b],d=v[M.c],m=v[M.d],!e.Triangle.containsPoint(n,f,p,m)&&!e.Triangle.containsPoint(n,p,d,m))continue}u.push({distance:C,point:c.ray.at(C),face:M,faceIndex:S,object:s})}}}}}},c=function(e,t,r){for(var i=e.getDescendants(),n=0,o=i.length;n<o;n++)l(i[n],t,r)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t),this.ray.direction.length()>0&&this.ray.direction.normalize()},e.Raycaster.prototype.intersectObject=function(e,t){var r=[];return!0===t&&c(e,this,r),l(e,this,r),r.sort(s),r},e.Raycaster.prototype.intersectObjects=function(e,t){for(var r=[],i=0,n=e.length;i<n;i++)l(e[i],this,r),!0===t&&c(e[i],this,r);return r.sort(s),r}}(D),D.Object3D=function(){this.id=D.Object3DIdCount++,this.name="",this.parent=void 0,this.children=[],this.up=new D.Vector3(0,1,0),this.position=new D.Vector3,this.rotation=new D.Vector3,this.eulerOrder=D.Object3D.defaultEulerOrder,this.scale=new D.Vector3(1,1,1),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new D.Matrix4,this.matrixWorld=new D.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.quaternion=new D.Quaternion,this.useQuaternion=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.userData={}},D.Object3D.prototype={constructor:D.Object3D,applyMatrix:(m=new D.Matrix4,function(e){this.matrix.multiplyMatrices(e,this.matrix),this.position.getPositionFromMatrix(this.matrix),this.scale.getScaleFromMatrix(this.matrix),m.extractRotation(this.matrix),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(m):this.rotation.setEulerFromRotationMatrix(m,this.eulerOrder)}),rotateOnAxis:function(){var e=new D.Quaternion,t=new D.Quaternion;return function(r,i){return e.setFromAxisAngle(r,i),!0===this.useQuaternion?this.quaternion.multiply(e):(t.setFromEuler(this.rotation,this.eulerOrder),t.multiply(e),this.rotation.setEulerFromQuaternion(t,this.eulerOrder)),this}}(),translateOnAxis:function(){var e=new D.Vector3;return function(t,r){return e.copy(t),!0===this.useQuaternion?e.applyQuaternion(this.quaternion):e.applyEuler(this.rotation,this.eulerOrder),this.position.add(e.multiplyScalar(r)),this}}(),translate:function(e,t){return console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),this.translateOnAxis(t,e)},translateX:function(){var e=new D.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new D.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new D.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new D.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new D.Matrix4;return function(t){e.lookAt(t,this.position,this.up),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(e):this.rotation.setEulerFromRotationMatrix(e,this.eulerOrder)}}(),add:function(e){if(e!==this){if(e instanceof D.Object3D){void 0!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof D.Scene&&t.__addObject(e)}}else console.warn("THREE.Object3D.add: An object can't be added as a child of itself.")},remove:function(e){var t=this.children.indexOf(e);if(-1!==t){e.parent=void 0,this.children.splice(t,1);for(var r=this;void 0!==r.parent;)r=r.parent;void 0!==r&&r instanceof D.Scene&&r.__removeObject(e)}},traverse:function(e){e(this);for(var t=0,r=this.children.length;t<r;t++)this.children[t].traverse(e)},getObjectById:function(e,t){for(var r=0,i=this.children.length;r<i;r++){var n=this.children[r];if(n.id===e)return n;if(!0===t&&void 0!==(n=n.getObjectById(e,t)))return n}},getObjectByName:function(e,t){for(var r=0,i=this.children.length;r<i;r++){var n=this.children[r];if(n.name===e)return n;if(!0===t&&void 0!==(n=n.getObjectByName(e,t)))return n}},getChildByName:function(e,t){return console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,r=this.children.length;t<r;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){!1===this.useQuaternion?this.matrix.makeFromPositionEulerScale(this.position,this.rotation,this.eulerOrder,this.scale):this.matrix.makeFromPositionQuaternionScale(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==e||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;t<r;t++)this.children[t].updateMatrixWorld(e)},clone:function(e){void 0===e&&(e=new D.Object3D),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.rotation instanceof D.Vector3&&e.rotation.copy(this.rotation),e.eulerOrder=this.eulerOrder,e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.quaternion.copy(this.quaternion),e.useQuaternion=this.useQuaternion,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData));for(var t=0;t<this.children.length;t++){var r=this.children[t];e.add(r.clone())}return e}},D.Object3D.defaultEulerOrder="XYZ",D.Object3DIdCount=0,D.Projector=function(){var e,t,r,i,n,o,a,s,l,c,u,h,f=[],p=0,d=[],m=0,g=[],v=0,y=[],x=0,b=[],w=0,S=[],_=0,M={objects:[],sprites:[],lights:[],elements:[]},T=new D.Vector3,C=new D.Vector4,A=new D.Box3(new D.Vector3(-1,-1,-1),new D.Vector3(1,1,1)),E=new D.Box3,L=new Array(3),P=new Array(4),R=new D.Matrix4,F=new D.Matrix4,O=new D.Matrix4,U=new D.Matrix3,N=new D.Matrix3,V=new D.Vector3,k=new D.Frustum,z=new D.Vector4,B=new D.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),F.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(F)},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),F.multiplyMatrices(t.matrixWorld,t.projectionMatrixInverse),e.applyProjection(F)},this.pickingRay=function(e,t){e.z=-1;var r=new D.Vector3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(r,t),r.sub(e).normalize(),new D.Raycaster(e,r)};function I(){if(t===p){var e=new D.RenderableObject;return f.push(e),p++,t++,e}return f[t++]}function j(){if(i===m){var e=new D.RenderableVertex;return d.push(e),m++,i++,e}return d[i++]}function G(){if(o===v){var e=new D.RenderableFace3;return g.push(e),v++,o++,e}return g[o++]}function H(){if(a===x){var e=new D.RenderableFace4;return y.push(e),x++,a++,e}return y[a++]}function W(){if(l===w){var e=new D.RenderableLine;return b.push(e),w++,l++,e}return b[l++]}function X(){if(u===_){var e=new D.RenderableParticle;return S.push(e),_++,u++,e}return S[u++]}function q(e,t){return t.z-e.z}function Y(e,t){var r=0,i=1,n=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return n>=0&&o>=0&&a>=0&&s>=0||!(n<0&&o<0||a<0&&s<0)&&(n<0?r=Math.max(r,n/(n-o)):o<0&&(i=Math.min(i,n/(n-o))),a<0?r=Math.max(r,a/(a-s)):s<0&&(i=Math.min(i,a/(a-s))),!(i<r)&&(e.lerp(t,r),t.lerp(e,1-i),!0))}this.projectScene=function(f,p,m,g){var v,y,x,b,w,S,_,K,$,Q,Z,J,ee,te,re,ie,ne,oe,ae,se,le,ce,ue,he,fe,pe,de=!1;for(o=0,a=0,l=0,u=0,M.elements.length=0,!0===f.autoUpdate&&f.updateMatrixWorld(),void 0===p.parent&&p.updateMatrixWorld(),R.copy(p.matrixWorldInverse.getInverse(p.matrixWorld)),F.multiplyMatrices(p.projectionMatrix,R),N.getNormalMatrix(R),k.setFromMatrix(F),v=0,y=(M=function(r,i){t=0,M.objects.length=0,M.sprites.length=0,M.lights.length=0;var n=function(t){for(var r=0,i=t.children.length;r<i;r++){var o=t.children[r];!1!==o.visible&&(o instanceof D.Light?M.lights.push(o):o instanceof D.Mesh||o instanceof D.Line?!1!==o.frustumCulled&&!0!==k.intersectsObject(o)||((e=I()).object=o,null!==o.renderDepth?e.z=o.renderDepth:(T.getPositionFromMatrix(o.matrixWorld),T.applyProjection(F),e.z=T.z),M.objects.push(e)):o instanceof D.Sprite||o instanceof D.Particle?((e=I()).object=o,null!==o.renderDepth?e.z=o.renderDepth:(T.getPositionFromMatrix(o.matrixWorld),T.applyProjection(F),e.z=T.z),M.sprites.push(e)):((e=I()).object=o,null!==o.renderDepth?e.z=o.renderDepth:(T.getPositionFromMatrix(o.matrixWorld),T.applyProjection(F),e.z=T.z),M.objects.push(e)),n(o))}};return n(r),!0===i&&M.objects.sort(q),M}(f,m)).objects.length;v<y;v++)if(ee=M.objects[v].object,h=ee.matrixWorld,i=0,ee instanceof D.Mesh){for(re=(te=ee.geometry).vertices,ie=te.faces,ae=te.faceVertexUvs,U.getNormalMatrix(h),pe=!0===(fe=ee.material instanceof D.MeshFaceMaterial)?ee.material:null,x=0,b=re.length;x<b;x++)(r=j()).positionWorld.copy(re[x]).applyMatrix4(h),r.positionScreen.copy(r.positionWorld).applyMatrix4(F),r.positionScreen.x/=r.positionScreen.w,r.positionScreen.y/=r.positionScreen.w,r.positionScreen.z/=r.positionScreen.w,r.visible=!(r.positionScreen.x<-1||r.positionScreen.x>1||r.positionScreen.y<-1||r.positionScreen.y>1||r.positionScreen.z<-1||r.positionScreen.z>1);for(w=0,S=ie.length;w<S;w++){ne=ie[w];var me=!0===fe?pe.materials[ne.materialIndex]:ee.material;if(void 0!==me){var ge=me.side;if(ne instanceof D.Face3){if(le=d[ne.a],ce=d[ne.b],ue=d[ne.c],L[0]=le.positionScreen,L[1]=ce.positionScreen,L[2]=ue.positionScreen,!0!==le.visible&&!0!==ce.visible&&!0!==ue.visible&&!A.isIntersectionBox(E.setFromPoints(L)))continue;if(de=(ue.positionScreen.x-le.positionScreen.x)*(ce.positionScreen.y-le.positionScreen.y)-(ue.positionScreen.y-le.positionScreen.y)*(ce.positionScreen.x-le.positionScreen.x)<0,ge!==D.DoubleSide&&de!==(ge===D.FrontSide))continue;(n=G()).v1.copy(le),n.v2.copy(ce),n.v3.copy(ue)}else if(ne instanceof D.Face4){if(le=d[ne.a],ce=d[ne.b],ue=d[ne.c],he=d[ne.d],P[0]=le.positionScreen,P[1]=ce.positionScreen,P[2]=ue.positionScreen,P[3]=he.positionScreen,!0!==le.visible&&!0!==ce.visible&&!0!==ue.visible&&!0!==he.visible&&!A.isIntersectionBox(E.setFromPoints(P)))continue;if(de=(he.positionScreen.x-le.positionScreen.x)*(ce.positionScreen.y-le.positionScreen.y)-(he.positionScreen.y-le.positionScreen.y)*(ce.positionScreen.x-le.positionScreen.x)<0||(ce.positionScreen.x-ue.positionScreen.x)*(he.positionScreen.y-ue.positionScreen.y)-(ce.positionScreen.y-ue.positionScreen.y)*(he.positionScreen.x-ue.positionScreen.x)<0,ge!==D.DoubleSide&&de!==(ge===D.FrontSide))continue;(n=H()).v1.copy(le),n.v2.copy(ce),n.v3.copy(ue),n.v4.copy(he)}for(n.normalModel.copy(ne.normal),!1!==de||ge!==D.BackSide&&ge!==D.DoubleSide||n.normalModel.negate(),n.normalModel.applyMatrix3(U).normalize(),n.normalModelView.copy(n.normalModel).applyMatrix3(N),n.centroidModel.copy(ne.centroid).applyMatrix4(h),_=0,K=(oe=ne.vertexNormals).length;_<K;_++){var ve=n.vertexNormalsModel[_];ve.copy(oe[_]),!1!==de||ge!==D.BackSide&&ge!==D.DoubleSide||ve.negate(),ve.applyMatrix3(U).normalize(),n.vertexNormalsModelView[_].copy(ve).applyMatrix3(N)}for(n.vertexNormalsLength=oe.length,$=0,Q=ae.length;$<Q;$++)if(void 0!==(se=ae[$][w]))for(Z=0,J=se.length;Z<J;Z++)n.uvs[$][Z]=se[Z];n.color=ne.color,n.material=me,V.copy(n.centroidModel).applyProjection(F),n.z=V.z,M.elements.push(n)}}}else if(ee instanceof D.Line){O.multiplyMatrices(F,h),re=ee.geometry.vertices,(le=j()).positionScreen.copy(re[0]).applyMatrix4(O);var ye=ee.type===D.LinePieces?2:1;for(x=1,b=re.length;x<b;x++)(le=j()).positionScreen.copy(re[x]).applyMatrix4(O),(x+1)%ye>0||(ce=d[i-2],z.copy(le.positionScreen),B.copy(ce.positionScreen),!0===Y(z,B)&&(z.multiplyScalar(1/z.w),B.multiplyScalar(1/B.w),(s=W()).v1.positionScreen.copy(z),s.v2.positionScreen.copy(B),s.z=Math.max(z.z,B.z),s.material=ee.material,ee.material.vertexColors===D.VertexColors&&(s.vertexColors[0].copy(ee.geometry.colors[x]),s.vertexColors[1].copy(ee.geometry.colors[x-1])),M.elements.push(s)))}for(v=0,y=M.sprites.length;v<y;v++)ee=M.sprites[v].object,h=ee.matrixWorld,ee instanceof D.Particle&&(C.set(h.elements[12],h.elements[13],h.elements[14],1),C.applyMatrix4(F),C.z/=C.w,C.z>0&&C.z<1&&((c=X()).object=ee,c.x=C.x/C.w,c.y=C.y/C.w,c.z=C.z,c.rotation=ee.rotation.z,c.scale.x=ee.scale.x*Math.abs(c.x-(C.x+p.projectionMatrix.elements[0])/(C.w+p.projectionMatrix.elements[12])),c.scale.y=ee.scale.y*Math.abs(c.y-(C.y+p.projectionMatrix.elements[5])/(C.w+p.projectionMatrix.elements[13])),c.material=ee.material,M.elements.push(c)));return!0===g&&M.elements.sort(q),M}},D.Face3=function(e,t,r,i,n,o){this.a=e,this.b=t,this.c=r,this.normal=i instanceof D.Vector3?i:new D.Vector3,this.vertexNormals=i instanceof Array?i:[],this.color=n instanceof D.Color?n:new D.Color,this.vertexColors=n instanceof Array?n:[],this.vertexTangents=[],this.materialIndex=void 0!==o?o:0,this.centroid=new D.Vector3},D.Face3.prototype={constructor:D.Face3,clone:function(){var e,t,r=new D.Face3(this.a,this.b,this.c);for(r.normal.copy(this.normal),r.color.copy(this.color),r.centroid.copy(this.centroid),r.materialIndex=this.materialIndex,e=0,t=this.vertexNormals.length;e<t;e++)r.vertexNormals[e]=this.vertexNormals[e].clone();for(e=0,t=this.vertexColors.length;e<t;e++)r.vertexColors[e]=this.vertexColors[e].clone();for(e=0,t=this.vertexTangents.length;e<t;e++)r.vertexTangents[e]=this.vertexTangents[e].clone();return r}},D.Face4=function(e,t,r,i,n,o,a){this.a=e,this.b=t,this.c=r,this.d=i,this.normal=n instanceof D.Vector3?n:new D.Vector3,this.vertexNormals=n instanceof Array?n:[],this.color=o instanceof D.Color?o:new D.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=void 0!==a?a:0,this.centroid=new D.Vector3},D.Face4.prototype={constructor:D.Face4,clone:function(){var e,t,r=new D.Face4(this.a,this.b,this.c,this.d);for(r.normal.copy(this.normal),r.color.copy(this.color),r.centroid.copy(this.centroid),r.materialIndex=this.materialIndex,e=0,t=this.vertexNormals.length;e<t;e++)r.vertexNormals[e]=this.vertexNormals[e].clone();for(e=0,t=this.vertexColors.length;e<t;e++)r.vertexColors[e]=this.vertexColors[e].clone();for(e=0,t=this.vertexTangents.length;e<t;e++)r.vertexTangents[e]=this.vertexTangents[e].clone();return r}},D.Geometry=function(){this.id=D.GeometryIdCount++,this.name="",this.vertices=[],this.colors=[],this.normals=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1},D.Geometry.prototype={constructor:D.Geometry,addEventListener:D.EventDispatcher.prototype.addEventListener,hasEventListener:D.EventDispatcher.prototype.hasEventListener,removeEventListener:D.EventDispatcher.prototype.removeEventListener,dispatchEvent:D.EventDispatcher.prototype.dispatchEvent,applyMatrix:function(e){for(var t=(new D.Matrix3).getNormalMatrix(e),r=0,i=this.vertices.length;r<i;r++){this.vertices[r].applyMatrix4(e)}for(r=0,i=this.faces.length;r<i;r++){var n=this.faces[r];n.normal.applyMatrix3(t).normalize();for(var o=0,a=n.vertexNormals.length;o<a;o++)n.vertexNormals[o].applyMatrix3(t).normalize();n.centroid.applyMatrix4(e)}},computeCentroids:function(){var e,t,r;for(e=0,t=this.faces.length;e<t;e++)(r=this.faces[e]).centroid.set(0,0,0),r instanceof D.Face3?(r.centroid.add(this.vertices[r.a]),r.centroid.add(this.vertices[r.b]),r.centroid.add(this.vertices[r.c]),r.centroid.divideScalar(3)):r instanceof D.Face4&&(r.centroid.add(this.vertices[r.a]),r.centroid.add(this.vertices[r.b]),r.centroid.add(this.vertices[r.c]),r.centroid.add(this.vertices[r.d]),r.centroid.divideScalar(4))},computeFaceNormals:function(){for(var e=new D.Vector3,t=new D.Vector3,r=0,i=this.faces.length;r<i;r++){var n=this.faces[r],o=this.vertices[n.a],a=this.vertices[n.b],s=this.vertices[n.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){var t,r,i,n,o,a;if(void 0===this.__tmpVertices){for(this.__tmpVertices=new Array(this.vertices.length),a=this.__tmpVertices,t=0,r=this.vertices.length;t<r;t++)a[t]=new D.Vector3;for(i=0,n=this.faces.length;i<n;i++)(o=this.faces[i])instanceof D.Face3?o.vertexNormals=[new D.Vector3,new D.Vector3,new D.Vector3]:o instanceof D.Face4&&(o.vertexNormals=[new D.Vector3,new D.Vector3,new D.Vector3,new D.Vector3])}else for(a=this.__tmpVertices,t=0,r=this.vertices.length;t<r;t++)a[t].set(0,0,0);if(e){var s,l,c,u,h=new D.Vector3,f=new D.Vector3,p=new D.Vector3,d=new D.Vector3,m=new D.Vector3;for(i=0,n=this.faces.length;i<n;i++)(o=this.faces[i])instanceof D.Face3?(s=this.vertices[o.a],l=this.vertices[o.b],c=this.vertices[o.c],h.subVectors(c,l),f.subVectors(s,l),h.cross(f),a[o.a].add(h),a[o.b].add(h),a[o.c].add(h)):o instanceof D.Face4&&(s=this.vertices[o.a],l=this.vertices[o.b],c=this.vertices[o.c],u=this.vertices[o.d],p.subVectors(u,l),f.subVectors(s,l),p.cross(f),a[o.a].add(p),a[o.b].add(p),a[o.d].add(p),d.subVectors(u,c),m.subVectors(l,c),d.cross(m),a[o.b].add(d),a[o.c].add(d),a[o.d].add(d))}else for(i=0,n=this.faces.length;i<n;i++)(o=this.faces[i])instanceof D.Face3?(a[o.a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal)):o instanceof D.Face4&&(a[o.a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal),a[o.d].add(o.normal));for(t=0,r=this.vertices.length;t<r;t++)a[t].normalize();for(i=0,n=this.faces.length;i<n;i++)(o=this.faces[i])instanceof D.Face3?(o.vertexNormals[0].copy(a[o.a]),o.vertexNormals[1].copy(a[o.b]),o.vertexNormals[2].copy(a[o.c])):o instanceof D.Face4&&(o.vertexNormals[0].copy(a[o.a]),o.vertexNormals[1].copy(a[o.b]),o.vertexNormals[2].copy(a[o.c]),o.vertexNormals[3].copy(a[o.d]))},computeMorphNormals:function(){var e,t,r,i,n;for(r=0,i=this.faces.length;r<i;r++)for((n=this.faces[r]).__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;e<t;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var o=new D.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(r=0,i=this.faces.length;r<i;r++)n=this.faces[r],l=new D.Vector3,c=n instanceof D.Face3?{a:new D.Vector3,b:new D.Vector3,c:new D.Vector3}:{a:new D.Vector3,b:new D.Vector3,c:new D.Vector3,d:new D.Vector3},a.push(l),s.push(c)}var l,c,u=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),r=0,i=this.faces.length;r<i;r++)n=this.faces[r],l=u.faceNormals[r],c=u.vertexNormals[r],l.copy(n.normal),n instanceof D.Face3?(c.a.copy(n.vertexNormals[0]),c.b.copy(n.vertexNormals[1]),c.c.copy(n.vertexNormals[2])):(c.a.copy(n.vertexNormals[0]),c.b.copy(n.vertexNormals[1]),c.c.copy(n.vertexNormals[2]),c.d.copy(n.vertexNormals[3]))}for(r=0,i=this.faces.length;r<i;r++)(n=this.faces[r]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeTangents:function(){var e,t,r,i,n,o,a,s,l,c,u,h,f,p,d,m,g,v,y,x,b,w,S,_,M,T,C,A=[],E=[],L=new D.Vector3,P=new D.Vector3,R=new D.Vector3,F=new D.Vector3,O=new D.Vector3;for(r=0,i=this.vertices.length;r<i;r++)A[r]=new D.Vector3,E[r]=new D.Vector3;function U(e,t,r,i,n,o,a){l=e.vertices[t],c=e.vertices[r],u=e.vertices[i],h=s[n],f=s[o],p=s[a],d=c.x-l.x,m=u.x-l.x,g=c.y-l.y,v=u.y-l.y,y=c.z-l.z,x=u.z-l.z,b=f.x-h.x,w=p.x-h.x,S=f.y-h.y,_=p.y-h.y,M=1/(b*_-w*S),L.set((_*d-S*m)*M,(_*g-S*v)*M,(_*y-S*x)*M),P.set((b*m-w*d)*M,(b*v-w*g)*M,(b*x-w*y)*M),A[t].add(L),A[r].add(L),A[i].add(L),E[t].add(P),E[r].add(P),E[i].add(P)}for(e=0,t=this.faces.length;e<t;e++)a=this.faces[e],s=this.faceVertexUvs[0][e],a instanceof D.Face3?U(this,a.a,a.b,a.c,0,1,2):a instanceof D.Face4&&(U(this,a.a,a.b,a.d,0,1,3),U(this,a.b,a.c,a.d,1,2,3));var N=["a","b","c","d"];for(e=0,t=this.faces.length;e<t;e++)for(a=this.faces[e],n=0;n<a.vertexNormals.length;n++)O.copy(a.vertexNormals[n]),o=a[N[n]],T=A[o],R.copy(T),R.sub(O.multiplyScalar(O.dot(T))).normalize(),F.crossVectors(a.vertexNormals[n],T),C=F.dot(E[o])<0?-1:1,a.vertexTangents[n]=new D.Vector4(R.x,R.y,R.z,C);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,r=0,i=t.length;r<i;r++)r>0&&(e+=t[r].distanceTo(t[r-1])),this.lineDistances[r]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new D.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new D.Sphere),this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},mergeVertices:function(){var e,t,r,i,n,o,a,s,l,c={},u=[],h=[],f=Math.pow(10,4);for(this.__tmpVertices=void 0,r=0,i=this.vertices.length;r<i;r++)e=this.vertices[r],void 0===c[t=[Math.round(e.x*f),Math.round(e.y*f),Math.round(e.z*f)].join("_")]?(c[t]=r,u.push(this.vertices[r]),h[r]=u.length-1):h[r]=h[c[t]];var p=[];for(r=0,i=this.faces.length;r<i;r++)if((n=this.faces[r])instanceof D.Face3){n.a=h[n.a],n.b=h[n.b],n.c=h[n.c],o=[n.a,n.b,n.c];for(var d=-1,m=0;m<3;m++)if(o[m]==o[(m+1)%3]){d=m,p.push(r);break}}else if(n instanceof D.Face4){n.a=h[n.a],n.b=h[n.b],n.c=h[n.c],n.d=h[n.d],o=[n.a,n.b,n.c,n.d];for(d=-1,m=0;m<4;m++)o[m]==o[(m+1)%4]&&(d>=0&&p.push(r),d=m);if(d>=0){o.splice(d,1);var g=new D.Face3(o[0],o[1],o[2],n.normal,n.color,n.materialIndex);for(a=0,s=this.faceVertexUvs.length;a<s;a++)(l=this.faceVertexUvs[a][r])&&l.splice(d,1);n.vertexNormals&&n.vertexNormals.length>0&&(g.vertexNormals=n.vertexNormals,g.vertexNormals.splice(d,1)),n.vertexColors&&n.vertexColors.length>0&&(g.vertexColors=n.vertexColors,g.vertexColors.splice(d,1)),this.faces[r]=g}}for(r=p.length-1;r>=0;r--)for(this.faces.splice(r,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(r,1);var v=this.vertices.length-u.length;return this.vertices=u,v},clone:function(){for(var e=new D.Geometry,t=this.vertices,r=0,i=t.length;r<i;r++)e.vertices.push(t[r].clone());var n=this.faces;for(r=0,i=n.length;r<i;r++)e.faces.push(n[r].clone());var o=this.faceVertexUvs[0];for(r=0,i=o.length;r<i;r++){for(var a=o[r],s=[],l=0,c=a.length;l<c;l++)s.push(new D.Vector2(a[l].x,a[l].y));e.faceVertexUvs[0].push(s)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},D.GeometryIdCount=0,D.BufferGeometry=function(){this.id=D.GeometryIdCount++,this.attributes={},this.dynamic=!1,this.offsets=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.morphTargets=[]},D.BufferGeometry.prototype={constructor:D.BufferGeometry,addEventListener:D.EventDispatcher.prototype.addEventListener,hasEventListener:D.EventDispatcher.prototype.hasEventListener,removeEventListener:D.EventDispatcher.prototype.removeEventListener,dispatchEvent:D.EventDispatcher.prototype.dispatchEvent,applyMatrix:function(e){var t,r;(this.attributes.position&&(t=this.attributes.position.array),this.attributes.normal&&(r=this.attributes.normal.array),void 0!==t&&(e.multiplyVector3Array(t),this.verticesNeedUpdate=!0),void 0!==r)&&((new D.Matrix3).getNormalMatrix(e).multiplyVector3Array(r),this.normalizeNormals(),this.normalsNeedUpdate=!0)},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new D.Box3);var e=this.attributes.position.array;if(e){var t,r,i,n=this.boundingBox;e.length>=3&&(n.min.x=n.max.x=e[0],n.min.y=n.max.y=e[1],n.min.z=n.max.z=e[2]);for(var o=3,a=e.length;o<a;o+=3)t=e[o],r=e[o+1],i=e[o+2],t<n.min.x?n.min.x=t:t>n.max.x&&(n.max.x=t),r<n.min.y?n.min.y=r:r>n.max.y&&(n.max.y=r),i<n.min.z?n.min.z=i:i>n.max.z&&(n.max.z=i)}void 0!==e&&0!==e.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new D.Sphere);var e=this.attributes.position.array;if(e){for(var t,r,i,n,o=0,a=0,s=e.length;a<s;a+=3)(t=(r=e[a])*r+(i=e[a+1])*i+(n=e[a+2])*n)>o&&(o=t);this.boundingSphere.radius=Math.sqrt(o)}},computeVertexNormals:function(){if(this.attributes.position){var e,t,r,i,n=this.attributes.position.array.length;if(void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(n),numItems:n};else for(e=0,t=this.attributes.normal.array.length;e<t;e++)this.attributes.normal.array[e]=0;var o,a,s,l,c,u,h=this.attributes.position.array,f=this.attributes.normal.array,p=new D.Vector3,d=new D.Vector3,m=new D.Vector3,g=new D.Vector3,v=new D.Vector3;if(this.attributes.index){var y=this.attributes.index.array,x=this.offsets;for(r=0,i=x.length;r<i;++r){var b=x[r].start,w=x[r].count,S=x[r].index;for(e=b,t=b+w;e<t;e+=3)o=S+y[e],a=S+y[e+1],s=S+y[e+2],l=h[3*o],c=h[3*o+1],u=h[3*o+2],p.set(l,c,u),l=h[3*a],c=h[3*a+1],u=h[3*a+2],d.set(l,c,u),l=h[3*s],c=h[3*s+1],u=h[3*s+2],m.set(l,c,u),g.subVectors(m,d),v.subVectors(p,d),g.cross(v),f[3*o]+=g.x,f[3*o+1]+=g.y,f[3*o+2]+=g.z,f[3*a]+=g.x,f[3*a+1]+=g.y,f[3*a+2]+=g.z,f[3*s]+=g.x,f[3*s+1]+=g.y,f[3*s+2]+=g.z}}else for(e=0,t=h.length;e<t;e+=9)l=h[e],c=h[e+1],u=h[e+2],p.set(l,c,u),l=h[e+3],c=h[e+4],u=h[e+5],d.set(l,c,u),l=h[e+6],c=h[e+7],u=h[e+8],m.set(l,c,u),g.subVectors(m,d),v.subVectors(p,d),g.cross(v),f[e]=g.x,f[e+1]=g.y,f[e+2]=g.z,f[e+3]=g.x,f[e+4]=g.y,f[e+5]=g.z,f[e+6]=g.x,f[e+7]=g.y,f[e+8]=g.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e,t,r,i,n=this.attributes.normal.array,o=0,a=n.length;o<a;o+=3)e=n[o],t=n[o+1],r=n[o+2],i=1/Math.sqrt(e*e+t*t+r*r),n[o]*=i,n[o+1]*=i,n[o+2]*=i},computeTangents:function(){if(void 0!==this.attributes.index&&void 0!==this.attributes.position&&void 0!==this.attributes.normal&&void 0!==this.attributes.uv){var e=this.attributes.index.array,t=this.attributes.position.array,r=this.attributes.normal.array,i=this.attributes.uv.array,n=t.length/3;if(void 0===this.attributes.tangent){var o=4*n;this.attributes.tangent={itemSize:4,array:new Float32Array(o),numItems:o}}for(var a,s,l,c,u,h,f,p,d,m,g,v,y,x,b,w,S,_,M,T,C,A,E,L,P,R,F=this.attributes.tangent.array,O=[],U=[],N=0;N<n;N++)O[N]=new D.Vector3,U[N]=new D.Vector3;var V,k,z,B,I,j,G,H,W,X,q=new D.Vector3,Y=new D.Vector3,K=this.offsets;for(z=0,B=K.length;z<B;++z){var $=K[z].start,Q=K[z].count,Z=K[z].index;for(V=$,k=$+Q;V<k;V+=3)I=Z+e[V],j=Z+e[V+1],G=Z+e[V+2],W=j,X=G,a=t[3*(H=I)],s=t[3*H+1],l=t[3*H+2],c=t[3*W],u=t[3*W+1],h=t[3*W+2],f=t[3*X],p=t[3*X+1],d=t[3*X+2],m=i[2*H],g=i[2*H+1],v=i[2*W],y=i[2*W+1],x=i[2*X],b=i[2*X+1],w=c-a,S=f-a,_=u-s,M=p-s,T=h-l,C=d-l,R=1/((A=v-m)*(P=b-g)-(E=x-m)*(L=y-g)),q.set((P*w-L*S)*R,(P*_-L*M)*R,(P*T-L*C)*R),Y.set((A*S-E*w)*R,(A*M-E*_)*R,(A*C-E*T)*R),O[H].add(q),O[W].add(q),O[X].add(q),U[H].add(Y),U[W].add(Y),U[X].add(Y)}var J,ee,te,re=new D.Vector3,ie=new D.Vector3,ne=new D.Vector3,oe=new D.Vector3;for(z=0,B=K.length;z<B;++z){$=K[z].start,Q=K[z].count,Z=K[z].index;for(V=$,k=$+Q;V<k;V+=3)I=Z+e[V],j=Z+e[V+1],G=Z+e[V+2],ae(I),ae(j),ae(G)}this.hasTangents=!0,this.tangentsNeedUpdate=!0}else console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function ae(e){ne.x=r[3*e],ne.y=r[3*e+1],ne.z=r[3*e+2],oe.copy(ne),ee=O[e],re.copy(ee),re.sub(ne.multiplyScalar(ne.dot(ee))).normalize(),ie.crossVectors(oe,ee),te=ie.dot(U[e]),J=te<0?-1:1,F[4*e]=re.x,F[4*e+1]=re.y,F[4*e+2]=re.z,F[4*e+3]=J}},dispose:function(){this.dispatchEvent({type:"dispose"})}},D.Camera=function(){D.Object3D.call(this),this.matrixWorldInverse=new D.Matrix4,this.projectionMatrix=new D.Matrix4,this.projectionMatrixInverse=new D.Matrix4},D.Camera.prototype=Object.create(D.Object3D.prototype),D.Camera.prototype.lookAt=function(){var e=new D.Matrix4;return function(t){e.lookAt(this.position,t,this.up),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(e):this.rotation.setEulerFromRotationMatrix(e,this.eulerOrder)}}(),D.OrthographicCamera=function(e,t,r,i,n,o){D.Camera.call(this),this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=void 0!==n?n:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},D.OrthographicCamera.prototype=Object.create(D.Camera.prototype),D.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},D.PerspectiveCamera=function(e,t,r,i){D.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.updateProjectionMatrix()},D.PerspectiveCamera.prototype=Object.create(D.Camera.prototype),D.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*D.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},D.PerspectiveCamera.prototype.setViewOffset=function(e,t,r,i,n,o){this.fullWidth=e,this.fullHeight=t,this.x=r,this.y=i,this.width=n,this.height=o,this.updateProjectionMatrix()},D.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(D.Math.degToRad(.5*this.fov))*this.near,r=-t,i=e*r,n=e*t,o=Math.abs(n-i),a=Math.abs(t-r);this.projectionMatrix.makeFrustum(i+this.x*o/this.fullWidth,i+(this.x+this.width)*o/this.fullWidth,t-(this.y+this.height)*a/this.fullHeight,t-this.y*a/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},D.Light=function(e){D.Object3D.call(this),this.color=new D.Color(e)},D.Light.prototype=Object.create(D.Object3D.prototype),D.Light.prototype.clone=function(e){return void 0===e&&(e=new D.Light),D.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},D.AmbientLight=function(e){D.Light.call(this,e)},D.AmbientLight.prototype=Object.create(D.Light.prototype),D.AmbientLight.prototype.clone=function(){var e=new D.AmbientLight;return D.Light.prototype.clone.call(this,e),e},D.AreaLight=function(e,t){D.Light.call(this,e),this.normal=new D.Vector3(0,-1,0),this.right=new D.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},D.AreaLight.prototype=Object.create(D.Light.prototype),D.DirectionalLight=function(e,t){D.Light.call(this,e),this.position.set(0,1,0),this.target=new D.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new D.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},D.DirectionalLight.prototype=Object.create(D.Light.prototype),D.DirectionalLight.prototype.clone=function(){var e=new D.DirectionalLight;return D.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},D.HemisphereLight=function(e,t,r){D.Light.call(this,e),this.position.set(0,100,0),this.groundColor=new D.Color(t),this.intensity=void 0!==r?r:1},D.HemisphereLight.prototype=Object.create(D.Light.prototype),D.HemisphereLight.prototype.clone=function(){var e=new D.PointLight;return D.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},D.PointLight=function(e,t,r){D.Light.call(this,e),this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0},D.PointLight.prototype=Object.create(D.Light.prototype),D.PointLight.prototype.clone=function(){var e=new D.PointLight;return D.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e},D.SpotLight=function(e,t,r,i,n){D.Light.call(this,e),this.position.set(0,1,0),this.target=new D.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/3,this.exponent=void 0!==n?n:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},D.SpotLight.prototype=Object.create(D.Light.prototype),D.SpotLight.prototype.clone=function(){var e=new D.SpotLight;return D.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},D.Loader=function(e){this.showStatus=e,this.statusDomElement=e?D.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},D.Loader.prototype={constructor:D.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";e.total?t+=(100*e.loaded/e.total).toFixed(0)+"%":t+=(e.loaded/1e3).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return t.pop(),(t.length<1?".":t.join("/"))+"/"},initMaterials:function(e,t){for(var r=[],i=0;i<e.length;++i)r[i]=D.Loader.prototype.createMaterial(e[i],t);return r},needsTangents:function(e){for(var t=0,r=e.length;t<r;t++){if(e[t]instanceof D.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){var r=this;function i(e){var t=Math.log(e)/Math.LN2;return Math.floor(t)==t}function n(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function o(e,o,a,s,l,c,u){var h=/\.dds$/i.test(a),f=t+"/"+a;if(h){var p=D.ImageUtils.loadCompressedTexture(f);e[o]=p}else{p=document.createElement("canvas");e[o]=new D.Texture(p)}if(e[o].sourceFile=a,s&&(e[o].repeat.set(s[0],s[1]),1!==s[0]&&(e[o].wrapS=D.RepeatWrapping),1!==s[1]&&(e[o].wrapT=D.RepeatWrapping)),l&&e[o].offset.set(l[0],l[1]),c){var d={repeat:D.RepeatWrapping,mirror:D.MirroredRepeatWrapping};void 0!==d[c[0]]&&(e[o].wrapS=d[c[0]]),void 0!==d[c[1]]&&(e[o].wrapT=d[c[1]])}u&&(e[o].anisotropy=u),h||function(e,t){var o=new Image;o.onload=function(){if(i(this.width)&&i(this.height))e.image=this;else{var t=n(this.width),r=n(this.height);e.image.width=t,e.image.height=r,e.image.getContext("2d").drawImage(this,0,0,t,r)}e.needsUpdate=!0},o.crossOrigin=r.crossOrigin,o.src=t}(e[o],f)}function a(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var s="MeshLambertMaterial",l={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var c=e.shading.toLowerCase();"phong"===c?s="MeshPhongMaterial":"basic"===c&&(s="MeshBasicMaterial")}if(void 0!==e.blending&&void 0!==D[e.blending]&&(l.blending=D[e.blending]),(void 0!==e.transparent||e.opacity<1)&&(l.transparent=e.transparent),void 0!==e.depthTest&&(l.depthTest=e.depthTest),void 0!==e.depthWrite&&(l.depthWrite=e.depthWrite),void 0!==e.visible&&(l.visible=e.visible),void 0!==e.flipSided&&(l.side=D.BackSide),void 0!==e.doubleSided&&(l.side=D.DoubleSide),void 0!==e.wireframe&&(l.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?l.vertexColors=D.FaceColors:e.vertexColors&&(l.vertexColors=D.VertexColors)),e.colorDiffuse?l.color=a(e.colorDiffuse):e.DbgColor&&(l.color=e.DbgColor),e.colorSpecular&&(l.specular=a(e.colorSpecular)),e.colorAmbient&&(l.ambient=a(e.colorAmbient)),e.transparency&&(l.opacity=e.transparency),e.specularCoef&&(l.shininess=e.specularCoef),e.mapDiffuse&&t&&o(l,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&o(l,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&o(l,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&o(l,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&o(l,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapBumpScale&&(l.bumpScale=e.mapBumpScale),e.mapNormal){var u=D.ShaderLib.normalmap,h=D.UniformsUtils.clone(u.uniforms);h.tNormal.value=l.normalMap,e.mapNormalFactor&&h.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),l.map&&(h.tDiffuse.value=l.map,h.enableDiffuse.value=!0),l.specularMap&&(h.tSpecular.value=l.specularMap,h.enableSpecular.value=!0),l.lightMap&&(h.tAO.value=l.lightMap,h.enableAO.value=!0),h.uDiffuseColor.value.setHex(l.color),h.uSpecularColor.value.setHex(l.specular),h.uAmbientColor.value.setHex(l.ambient),h.uShininess.value=l.shininess,void 0!==l.opacity&&(h.uOpacity.value=l.opacity);var f={fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:h,lights:!0,fog:!0},p=new D.ShaderMaterial(f);l.transparent&&(p.transparent=!0)}else p=new D[s](l);return void 0!==e.DbgName&&(p.name=e.DbgName),p}},D.ImageLoader=function(){this.crossOrigin=null},D.ImageLoader.prototype={constructor:D.ImageLoader,addEventListener:D.EventDispatcher.prototype.addEventListener,hasEventListener:D.EventDispatcher.prototype.hasEventListener,removeEventListener:D.EventDispatcher.prototype.removeEventListener,dispatchEvent:D.EventDispatcher.prototype.dispatchEvent,load:function(e,t){var r=this;void 0===t&&(t=new Image),t.addEventListener("load",(function(){r.dispatchEvent({type:"load",content:t})}),!1),t.addEventListener("error",(function(){r.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})}),!1),r.crossOrigin&&(t.crossOrigin=r.crossOrigin),t.src=e}},D.JSONLoader=function(e){D.Loader.call(this,e),this.withCredentials=!1},D.JSONLoader.prototype=Object.create(D.Loader.prototype),D.JSONLoader.prototype.load=function(e,t,r){r=r&&"string"==typeof r?r:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,r)},D.JSONLoader.prototype.loadAjaxJSON=function(e,t,r,i,n){var o=new XMLHttpRequest,a=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var s=JSON.parse(o.responseText),l=e.parse(s,i);r(l.geometry,l.materials)}else console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+t+"] ["+o.status+"]");else o.readyState===o.LOADING?n&&(0===a&&(a=o.getResponseHeader("Content-Length")),n({total:a,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&void 0!==n&&(a=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.withCredentials=this.withCredentials,o.send(null)},D.JSONLoader.prototype.parse=function(e,t){var r=new D.Geometry,i=void 0!==e.scale?1/e.scale:1;if(function(t){function i(e,t){return e&1<<t}var n,o,a,s,l,c,u,h,f,p,d,m,g,v,y,x,b,w,S,_,M,T,C,A,E,L,P,R=e.faces,F=e.vertices,O=e.normals,U=e.colors,N=0;for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&N++;for(n=0;n<N;n++)r.faceUvs[n]=[],r.faceVertexUvs[n]=[];s=0,l=F.length;for(;s<l;)(_=new D.Vector3).x=F[s++]*t,_.y=F[s++]*t,_.z=F[s++]*t,r.vertices.push(_);s=0,l=R.length;for(;s<l;){if(d=R[s++],m=i(d,0),g=i(d,1),v=i(d,2),y=i(d,3),x=i(d,4),b=i(d,5),w=i(d,6),S=i(d,7),m?((M=new D.Face4).a=R[s++],M.b=R[s++],M.c=R[s++],M.d=R[s++],c=4):((M=new D.Face3).a=R[s++],M.b=R[s++],M.c=R[s++],c=3),g&&(p=R[s++],M.materialIndex=p),a=r.faces.length,v)for(n=0;n<N;n++)A=e.uvs[n],f=R[s++],L=A[2*f],P=A[2*f+1],r.faceUvs[n][a]=new D.Vector2(L,P);if(y)for(n=0;n<N;n++){for(A=e.uvs[n],E=[],o=0;o<c;o++)f=R[s++],L=A[2*f],P=A[2*f+1],E[o]=new D.Vector2(L,P);r.faceVertexUvs[n][a]=E}if(x&&(h=3*R[s++],(C=new D.Vector3).x=O[h++],C.y=O[h++],C.z=O[h],M.normal=C),b)for(n=0;n<c;n++)h=3*R[s++],(C=new D.Vector3).x=O[h++],C.y=O[h++],C.z=O[h],M.vertexNormals.push(C);if(w&&(u=R[s++],T=new D.Color(U[u]),M.color=T),S)for(n=0;n<c;n++)u=R[s++],T=new D.Color(U[u]),M.vertexColors.push(T);r.faces.push(M)}}(i),function(){var t,i,n,o,a,s;if(e.skinWeights)for(t=0,i=e.skinWeights.length;t<i;t+=2)n=e.skinWeights[t],o=e.skinWeights[t+1],0,0,r.skinWeights.push(new D.Vector4(n,o,0,0));if(e.skinIndices)for(t=0,i=e.skinIndices.length;t<i;t+=2)a=e.skinIndices[t],s=e.skinIndices[t+1],0,0,r.skinIndices.push(new D.Vector4(a,s,0,0));r.bones=e.bones,r.animation=e.animation}(),function(t){var i,n,o,a,s,l,c,u,h,f,p;if(void 0!==e.morphTargets)for(s=0,l=e.morphTargets.length;s<l;s++)for(r.morphTargets[s]={},r.morphTargets[s].name=e.morphTargets[s].name,r.morphTargets[s].vertices=[],o=r.morphTargets[s].vertices,a=e.morphTargets[s].vertices,i=0,n=a.length;i<n;i+=3){var d=new D.Vector3;d.x=a[i]*t,d.y=a[i+1]*t,d.z=a[i+2]*t,o.push(d)}if(void 0!==e.morphColors)for(s=0,l=e.morphColors.length;s<l;s++)for(r.morphColors[s]={},r.morphColors[s].name=e.morphColors[s].name,r.morphColors[s].colors=[],h=r.morphColors[s].colors,f=e.morphColors[s].colors,c=0,u=f.length;c<u;c+=3)(p=new D.Color(16755200)).setRGB(f[c],f[c+1],f[c+2]),h.push(p)}(i),r.computeCentroids(),r.computeFaceNormals(),void 0===e.materials)return{geometry:r};var n=this.initMaterials(e.materials,t);return this.needsTangents(n)&&r.computeTangents(),{geometry:r,materials:n}},D.LoadingMonitor=function(){var e=this,t=0,r=0,i=function(i){t++,e.dispatchEvent({type:"progress",loaded:t,total:r}),t===r&&e.dispatchEvent({type:"load"})};this.add=function(e){r++,e.addEventListener("load",i,!1)}},D.LoadingMonitor.prototype={constructor:D.LoadingMonitor,addEventListener:D.EventDispatcher.prototype.addEventListener,hasEventListener:D.EventDispatcher.prototype.hasEventListener,removeEventListener:D.EventDispatcher.prototype.removeEventListener,dispatchEvent:D.EventDispatcher.prototype.dispatchEvent},D.GeometryLoader=function(){},D.GeometryLoader.prototype={constructor:D.GeometryLoader,addEventListener:D.EventDispatcher.prototype.addEventListener,hasEventListener:D.EventDispatcher.prototype.hasEventListener,removeEventListener:D.EventDispatcher.prototype.removeEventListener,dispatchEvent:D.EventDispatcher.prototype.dispatchEvent,load:function(e){var t=this,r=new XMLHttpRequest;r.addEventListener("load",(function(e){var r=t.parse(JSON.parse(e.target.responseText));t.dispatchEvent({type:"load",content:r})}),!1),r.addEventListener("progress",(function(e){t.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})}),!1),r.addEventListener("error",(function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})}),!1),r.open("GET",e,!0),r.send(null)},parse:function(e){}},D.MaterialLoader=function(){},D.MaterialLoader.prototype={constructor:D.MaterialLoader,addEventListener:D.EventDispatcher.prototype.addEventListener,hasEventListener:D.EventDispatcher.prototype.hasEventListener,removeEventListener:D.EventDispatcher.prototype.removeEventListener,dispatchEvent:D.EventDispatcher.prototype.dispatchEvent,load:function(e){var t=this,r=new XMLHttpRequest;r.addEventListener("load",(function(e){var r=t.parse(JSON.parse(e.target.responseText));t.dispatchEvent({type:"load",content:r})}),!1),r.addEventListener("progress",(function(e){t.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})}),!1),r.addEventListener("error",(function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})}),!1),r.open("GET",e,!0),r.send(null)},parse:function(e){var t;switch(e.type){case"MeshBasicMaterial":t=new D.MeshBasicMaterial({color:e.color,opacity:e.opacity,transparent:e.transparent,wireframe:e.wireframe});break;case"MeshLambertMaterial":t=new D.MeshLambertMaterial({color:e.color,ambient:e.ambient,emissive:e.emissive,opacity:e.opacity,transparent:e.transparent,wireframe:e.wireframe});break;case"MeshPhongMaterial":t=new D.MeshPhongMaterial({color:e.color,ambient:e.ambient,emissive:e.emissive,specular:e.specular,shininess:e.shininess,opacity:e.opacity,transparent:e.transparent,wireframe:e.wireframe});break;case"MeshNormalMaterial":t=new D.MeshNormalMaterial({opacity:e.opacity,transparent:e.transparent,wireframe:e.wireframe});break;case"MeshDepthMaterial":t=new D.MeshDepthMaterial({opacity:e.opacity,transparent:e.transparent,wireframe:e.wireframe})}return t}},D.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlerMap={},this.hierarchyHandlerMap={},this.addGeometryHandler("ascii",D.JSONLoader)},D.SceneLoader.prototype.constructor=D.SceneLoader,D.SceneLoader.prototype.load=function(e,t){var r=this,i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status||0===i.status){var n=JSON.parse(i.responseText);r.parse(n,t,e)}else console.error("THREE.SceneLoader: Couldn't load ["+e+"] ["+i.status+"]")},i.open("GET",e,!0),i.send(null)},D.SceneLoader.prototype.addGeometryHandler=function(e,t){this.geometryHandlerMap[e]={loaderClass:t}},D.SceneLoader.prototype.addHierarchyHandler=function(e,t){this.hierarchyHandlerMap[e]={loaderClass:t}},D.SceneLoader.prototype.parse=function(e,t,r){var i,n,o,a,s,l,c,u,h,f,p,d,m,g,v=this,y=D.Loader.prototype.extractUrlBase(r),x=[],b=e;for(var w in this.geometryHandlerMap){var S=this.geometryHandlerMap[w].loaderClass;this.geometryHandlerMap[w].loaderObject=new S}for(var w in this.hierarchyHandlerMap){S=this.hierarchyHandlerMap[w].loaderClass;this.hierarchyHandlerMap[w].loaderObject=new S}if(f=0,p=0,g={scene:new D.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},b.transform){var _=b.transform.position,M=b.transform.rotation,T=b.transform.scale;_&&g.scene.position.set(_[0],_[1],_[2]),M&&g.scene.rotation.set(M[0],M[1],M[2]),T&&g.scene.scale.set(T[0],T[1],T[2]),(_||M||T)&&(g.scene.updateMatrix(),g.scene.updateMatrixWorld())}function C(e,t){return"relativeToHTML"==t?e:y+"/"+e}function A(){!function e(t,r){var a,s,l,f,p,d;for(var m in r)if(void 0===g.objects[m]){var y=r[m],w=null;if(y.type&&y.type in v.hierarchyHandlerMap){if(void 0===y.loading){var S={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1},_={};for(var M in y)M in S||(_[M]=y[M]);n=g.materials[y.material],y.loading=!0;var T=v.hierarchyHandlerMap[y.type].loaderObject;T.options?T.load(C(y.url,b.urlBaseType),P(m,t,n,y)):T.load(C(y.url,b.urlBaseType),P(m,t,n,y),_)}}else if(void 0!==y.geometry){if(i=g.geometries[y.geometry]){var A=!1;if(n=g.materials[y.material],A=n instanceof D.ShaderMaterial,l=y.position,f=y.rotation,p=y.scale,a=y.matrix,d=y.quaternion,y.material||(n=new D.MeshFaceMaterial(g.face_materials[y.geometry])),n instanceof D.MeshFaceMaterial&&0===n.materials.length&&(n=new D.MeshFaceMaterial(g.face_materials[y.geometry])),n instanceof D.MeshFaceMaterial)for(var E=0;E<n.materials.length;E++)A=A||n.materials[E]instanceof D.ShaderMaterial;A&&i.computeTangents(),y.skin?w=new D.SkinnedMesh(i,n):y.morph?(w=new D.MorphAnimMesh(i,n),void 0!==y.duration&&(w.duration=y.duration),void 0!==y.time&&(w.time=y.time),void 0!==y.mirroredLoop&&(w.mirroredLoop=y.mirroredLoop),n.morphNormals&&i.computeMorphNormals()):w=new D.Mesh(i,n),w.name=m,a?(w.matrixAutoUpdate=!1,w.matrix.set(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])):(w.position.set(l[0],l[1],l[2]),d?(w.quaternion.set(d[0],d[1],d[2],d[3]),w.useQuaternion=!0):w.rotation.set(f[0],f[1],f[2]),w.scale.set(p[0],p[1],p[2])),w.visible=y.visible,w.castShadow=y.castShadow,w.receiveShadow=y.receiveShadow,t.add(w),g.objects[m]=w}}else"DirectionalLight"===y.type||"PointLight"===y.type||"AmbientLight"===y.type?(u=void 0!==y.color?y.color:16777215,h=void 0!==y.intensity?y.intensity:1,"DirectionalLight"===y.type?(l=y.direction,(c=new D.DirectionalLight(u,h)).position.set(l[0],l[1],l[2]),y.target&&(x.push({object:c,targetName:y.target}),c.target=null)):"PointLight"===y.type?(l=y.position,s=y.distance,(c=new D.PointLight(u,h,s)).position.set(l[0],l[1],l[2])):"AmbientLight"===y.type&&(c=new D.AmbientLight(u)),t.add(c),c.name=m,g.lights[m]=c,g.objects[m]=c):"PerspectiveCamera"===y.type||"OrthographicCamera"===y.type?(l=y.position,f=y.rotation,d=y.quaternion,"PerspectiveCamera"===y.type?o=new D.PerspectiveCamera(y.fov,y.aspect,y.near,y.far):"OrthographicCamera"===y.type&&(o=new D.OrthographicCamera(y.left,y.right,y.top,y.bottom,y.near,y.far)),o.name=m,o.position.set(l[0],l[1],l[2]),void 0!==d?(o.quaternion.set(d[0],d[1],d[2],d[3]),o.useQuaternion=!0):void 0!==f&&o.rotation.set(f[0],f[1],f[2]),t.add(o),g.cameras[m]=o,g.objects[m]=o):(l=y.position,f=y.rotation,p=y.scale,d=y.quaternion,(w=new D.Object3D).name=m,w.position.set(l[0],l[1],l[2]),d?(w.quaternion.set(d[0],d[1],d[2],d[3]),w.useQuaternion=!0):w.rotation.set(f[0],f[1],f[2]),w.scale.set(p[0],p[1],p[2]),w.visible=void 0!==y.visible&&y.visible,t.add(w),g.objects[m]=w,g.empties[m]=w);if(w){if(void 0!==y.userData)for(var L in y.userData){var R=y.userData[L];w.userData[L]=R}if(void 0!==y.groups)for(E=0;E<y.groups.length;E++){var F=y.groups[E];void 0===g.groups[F]&&(g.groups[F]=[]),g.groups[F].push(m)}void 0!==y.children&&e(w,y.children)}}}(g.scene,b.objects)}function E(e,t,r,i,n){var o=n.position,a=n.rotation,s=n.quaternion,l=n.scale;e.position.set(o[0],o[1],o[2]),s?(e.quaternion.set(s[0],s[1],s[2],s[3]),e.useQuaternion=!0):e.rotation.set(a[0],a[1],a[2]),e.scale.set(l[0],l[1],l[2]),i&&e.traverse((function(e){e.material=i}));var c=void 0===n.visible||n.visible;e.traverse((function(e){e.visible=c})),r.add(e),e.name=t,g.objects[t]=e,A()}function L(e){return function(t,r){t.name=e,function(e,t,r){g.geometries[r]=e,g.face_materials[r]=t,A()}(t,r,e),f-=1,v.onLoadComplete(),F()}}function P(e,t,r,i){return function(n){E(n.content?n.content:n.dae?n.scene:n,e,t,r,i),f-=1,v.onLoadComplete(),F()}}function R(e){return function(t,r){t.name=e,g.geometries[e]=t,g.face_materials[e]=r}}function F(){var e={totalModels:d,totalTextures:m,loadedModels:d-f,loadedTextures:m-p};v.callbackProgress(e,g),v.onLoadProgress(),0===f&&0===p&&(!function(){for(var e=0;e<x.length;e++){var t=x[e],r=g.objects[t.targetName];r?t.object.target=r:(t.object.target=new D.Object3D,g.scene.add(t.object.target)),t.object.target.userData.targetInverse=t.object}}(),t(g))}var O,U,N,V,k,z,B,I,j,G,H,W=function(e){return function(){!function(e){p-=e,F(),v.onLoadComplete()}(e)}};for(O in b.fogs)"linear"===(U=b.fogs[O]).type?a=new D.Fog(0,U.near,U.far):"exp2"===U.type&&(a=new D.FogExp2(0,U.density)),l=U.color,a.color.setRGB(l[0],l[1],l[2]),g.fogs[O]=a;for(N in b.geometries)(V=b.geometries[N]).type in this.geometryHandlerMap&&(f+=1,v.onLoadStart());for(k in b.objects)(z=b.objects[k]).type&&z.type in this.hierarchyHandlerMap&&(f+=1,v.onLoadStart());for(N in d=f,b.geometries)if("cube"===(V=b.geometries[N]).type)(i=new D.CubeGeometry(V.width,V.height,V.depth,V.widthSegments,V.heightSegments,V.depthSegments)).name=N,g.geometries[N]=i;else if("plane"===V.type)(i=new D.PlaneGeometry(V.width,V.height,V.widthSegments,V.heightSegments)).name=N,g.geometries[N]=i;else if("sphere"===V.type)(i=new D.SphereGeometry(V.radius,V.widthSegments,V.heightSegments)).name=N,g.geometries[N]=i;else if("cylinder"===V.type)(i=new D.CylinderGeometry(V.topRad,V.botRad,V.height,V.radSegs,V.heightSegs)).name=N,g.geometries[N]=i;else if("torus"===V.type)(i=new D.TorusGeometry(V.radius,V.tube,V.segmentsR,V.segmentsT)).name=N,g.geometries[N]=i;else if("icosahedron"===V.type)(i=new D.IcosahedronGeometry(V.radius,V.subdivisions)).name=N,g.geometries[N]=i;else if(V.type in this.geometryHandlerMap){var X={};for(var q in V)"type"!==q&&"url"!==q&&(X[q]=V[q]);this.geometryHandlerMap[V.type].loaderObject.load(C(V.url,b.urlBaseType),L(N),X)}else if("embedded"===V.type){var Y=b.embeds[V.id];if(Y.metadata=b.metadata,Y){var K=this.geometryHandlerMap.ascii.loaderObject.parse(Y,"");R(N)(K.geometry,K.materials)}}for(B in b.textures)if((I=b.textures[B]).url instanceof Array){p+=I.url.length;for(var $=0;$<I.url.length;$++)v.onLoadStart()}else p+=1,v.onLoadStart();for(B in m=p,b.textures){if(void 0!==(I=b.textures[B]).mapping&&void 0!==D[I.mapping]&&(I.mapping=new D[I.mapping]),I.url instanceof Array){for(var Q=I.url.length,Z=[],J=0;J<Q;J++)Z[J]=C(I.url[J],b.urlBaseType);s=(ee=/\.dds$/i.test(Z[0]))?D.ImageUtils.loadCompressedTextureCube(Z,I.mapping,W(Q)):D.ImageUtils.loadTextureCube(Z,I.mapping,W(Q))}else{var ee=/\.dds$/i.test(I.url),te=C(I.url,b.urlBaseType),re=W(1);if(s=ee?D.ImageUtils.loadCompressedTexture(te,I.mapping,re):D.ImageUtils.loadTexture(te,I.mapping,re),void 0!==D[I.minFilter]&&(s.minFilter=D[I.minFilter]),void 0!==D[I.magFilter]&&(s.magFilter=D[I.magFilter]),I.anisotropy&&(s.anisotropy=I.anisotropy),I.repeat&&(s.repeat.set(I.repeat[0],I.repeat[1]),1!==I.repeat[0]&&(s.wrapS=D.RepeatWrapping),1!==I.repeat[1]&&(s.wrapT=D.RepeatWrapping)),I.offset&&s.offset.set(I.offset[0],I.offset[1]),I.wrap){var ie={repeat:D.RepeatWrapping,mirror:D.MirroredRepeatWrapping};void 0!==ie[I.wrap[0]]&&(s.wrapS=ie[I.wrap[0]]),void 0!==ie[I.wrap[1]]&&(s.wrapT=ie[I.wrap[1]])}}g.textures[B]=s}for(j in b.materials){for(H in(G=b.materials[j]).parameters)if("envMap"===H||"map"===H||"lightMap"===H||"bumpMap"===H)G.parameters[H]=g.textures[G.parameters[H]];else if("shading"===H)G.parameters[H]="flat"===G.parameters[H]?D.FlatShading:D.SmoothShading;else if("side"===H)"double"==G.parameters[H]?G.parameters[H]=D.DoubleSide:"back"==G.parameters[H]?G.parameters[H]=D.BackSide:G.parameters[H]=D.FrontSide;else if("blending"===H)G.parameters[H]=G.parameters[H]in D?D[G.parameters[H]]:D.NormalBlending;else if("combine"===H)G.parameters[H]=G.parameters[H]in D?D[G.parameters[H]]:D.MultiplyOperation;else if("vertexColors"===H)"face"==G.parameters[H]?G.parameters[H]=D.FaceColors:G.parameters[H]&&(G.parameters[H]=D.VertexColors);else if("wrapRGB"===H){var ne=G.parameters[H];G.parameters[H]=new D.Vector3(ne[0],ne[1],ne[2])}if(void 0!==G.parameters.opacity&&G.parameters.opacity<1&&(G.parameters.transparent=!0),G.parameters.normalMap){var oe=D.ShaderLib.normalmap,ae=D.UniformsUtils.clone(oe.uniforms),se=G.parameters.color,le=G.parameters.specular,ce=G.parameters.ambient,ue=G.parameters.shininess;ae.tNormal.value=g.textures[G.parameters.normalMap],G.parameters.normalScale&&ae.uNormalScale.value.set(G.parameters.normalScale[0],G.parameters.normalScale[1]),G.parameters.map&&(ae.tDiffuse.value=G.parameters.map,ae.enableDiffuse.value=!0),G.parameters.envMap&&(ae.tCube.value=G.parameters.envMap,ae.enableReflection.value=!0,ae.uReflectivity.value=G.parameters.reflectivity),G.parameters.lightMap&&(ae.tAO.value=G.parameters.lightMap,ae.enableAO.value=!0),G.parameters.specularMap&&(ae.tSpecular.value=g.textures[G.parameters.specularMap],ae.enableSpecular.value=!0),G.parameters.displacementMap&&(ae.tDisplacement.value=g.textures[G.parameters.displacementMap],ae.enableDisplacement.value=!0,ae.uDisplacementBias.value=G.parameters.displacementBias,ae.uDisplacementScale.value=G.parameters.displacementScale),ae.uDiffuseColor.value.setHex(se),ae.uSpecularColor.value.setHex(le),ae.uAmbientColor.value.setHex(ce),ae.uShininess.value=ue,G.parameters.opacity&&(ae.uOpacity.value=G.parameters.opacity);var he={fragmentShader:oe.fragmentShader,vertexShader:oe.vertexShader,uniforms:ae,lights:!0,fog:!0};n=new D.ShaderMaterial(he)}else n=new D[G.type](G.parameters);n.name=j,g.materials[j]=n}for(j in b.materials)if((G=b.materials[j]).parameters.materials){var fe=[];for(J=0;J<G.parameters.materials.length;J++){var pe=G.parameters.materials[J];fe.push(g.materials[pe])}g.materials[j].materials=fe}A(),g.cameras&&b.defaults.camera&&(g.currentCamera=g.cameras[b.defaults.camera]),g.fogs&&b.defaults.fog&&(g.scene.fog=g.fogs[b.defaults.fog]),v.callbackSync(g),F()},D.TextureLoader=function(){this.crossOrigin=null},D.TextureLoader.prototype={constructor:D.TextureLoader,addEventListener:D.EventDispatcher.prototype.addEventListener,hasEventListener:D.EventDispatcher.prototype.hasEventListener,removeEventListener:D.EventDispatcher.prototype.removeEventListener,dispatchEvent:D.EventDispatcher.prototype.dispatchEvent,load:function(e){var t=this,r=new Image;r.addEventListener("load",(function(){var e=new D.Texture(r);e.needsUpdate=!0,t.dispatchEvent({type:"load",content:e})}),!1),r.addEventListener("error",(function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})}),!1),t.crossOrigin&&(r.crossOrigin=t.crossOrigin),r.src=e}},D.Material=function(){this.id=D.MaterialIdCount++,this.name="",this.side=D.FrontSide,this.opacity=1,this.transparent=!1,this.blending=D.NormalBlending,this.blendSrc=D.SrcAlphaFactor,this.blendDst=D.OneMinusSrcAlphaFactor,this.blendEquation=D.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=!1,this.visible=!0,this.needsUpdate=!0},D.Material.prototype={constructor:D.Material,addEventListener:D.EventDispatcher.prototype.addEventListener,hasEventListener:D.EventDispatcher.prototype.hasEventListener,removeEventListener:D.EventDispatcher.prototype.removeEventListener,dispatchEvent:D.EventDispatcher.prototype.dispatchEvent,setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r){if(t in this){var i=this[t];i instanceof D.Color?i.set(r):i instanceof D.Vector3&&r instanceof D.Vector3?i.copy(r):this[t]=r}}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},clone:function(e){return void 0===e&&(e=new D.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},D.MaterialIdCount=0,D.LineBasicMaterial=function(e){D.Material.call(this),this.color=new D.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.setValues(e)},D.LineBasicMaterial.prototype=Object.create(D.Material.prototype),D.LineBasicMaterial.prototype.clone=function(){var e=new D.LineBasicMaterial;return D.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},D.LineDashedMaterial=function(e){D.Material.call(this),this.color=new D.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},D.LineDashedMaterial.prototype=Object.create(D.Material.prototype),D.LineDashedMaterial.prototype.clone=function(){var e=new D.LineDashedMaterial;return D.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},D.MeshBasicMaterial=function(e){D.Material.call(this),this.color=new D.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=D.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=D.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=D.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},D.MeshBasicMaterial.prototype=Object.create(D.Material.prototype),D.MeshBasicMaterial.prototype.clone=function(){var e=new D.MeshBasicMaterial;return D.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},D.MeshLambertMaterial=function(e){D.Material.call(this),this.color=new D.Color(16777215),this.ambient=new D.Color(16777215),this.emissive=new D.Color(0),this.wrapAround=!1,this.wrapRGB=new D.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=D.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=D.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=D.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},D.MeshLambertMaterial.prototype=Object.create(D.Material.prototype),D.MeshLambertMaterial.prototype.clone=function(){var e=new D.MeshLambertMaterial;return D.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},D.MeshPhongMaterial=function(e){D.Material.call(this),this.color=new D.Color(16777215),this.ambient=new D.Color(16777215),this.emissive=new D.Color(0),this.specular=new D.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new D.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new D.Vector2(1,1),this.specularMap=null,this.envMap=null,this.combine=D.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=D.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=D.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},D.MeshPhongMaterial.prototype=Object.create(D.Material.prototype),D.MeshPhongMaterial.prototype.clone=function(){var e=new D.MeshPhongMaterial;return D.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},D.MeshDepthMaterial=function(e){D.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},D.MeshDepthMaterial.prototype=Object.create(D.Material.prototype),D.MeshDepthMaterial.prototype.clone=function(){var e=new D.MeshDepthMaterial;return D.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},D.MeshNormalMaterial=function(e){D.Material.call(this,e),this.shading=D.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},D.MeshNormalMaterial.prototype=Object.create(D.Material.prototype),D.MeshNormalMaterial.prototype.clone=function(){var e=new D.MeshNormalMaterial;return D.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},D.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},D.MeshFaceMaterial.prototype.clone=function(){return new D.MeshFaceMaterial(this.materials.slice(0))},D.ParticleBasicMaterial=function(e){D.Material.call(this),this.color=new D.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(e)},D.ParticleBasicMaterial.prototype=Object.create(D.Material.prototype),D.ParticleBasicMaterial.prototype.clone=function(){var e=new D.ParticleBasicMaterial;return D.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},D.ParticleCanvasMaterial=function(e){D.Material.call(this),this.color=new D.Color(16777215),this.program=function(e,t){},this.setValues(e)},D.ParticleCanvasMaterial.prototype=Object.create(D.Material.prototype),D.ParticleCanvasMaterial.prototype.clone=function(){var e=new D.ParticleCanvasMaterial;return D.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},D.ShaderMaterial=function(e){D.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=D.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=D.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},D.ShaderMaterial.prototype=Object.create(D.Material.prototype),D.ShaderMaterial.prototype.clone=function(){var e=new D.ShaderMaterial;return D.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=D.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},D.SpriteMaterial=function(e){D.Material.call(this),this.color=new D.Color(16777215),this.map=new D.Texture,this.useScreenCoordinates=!0,this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.scaleByViewport=!this.sizeAttenuation,this.alignment=D.SpriteAlignment.center.clone(),this.fog=!1,this.uvOffset=new D.Vector2(0,0),this.uvScale=new D.Vector2(1,1),this.setValues(e),void 0===(e=e||{}).depthTest&&(this.depthTest=!this.useScreenCoordinates),void 0===e.sizeAttenuation&&(this.sizeAttenuation=!this.useScreenCoordinates),void 0===e.scaleByViewport&&(this.scaleByViewport=!this.sizeAttenuation)},D.SpriteMaterial.prototype=Object.create(D.Material.prototype),D.SpriteMaterial.prototype.clone=function(){var e=new D.SpriteMaterial;return D.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.useScreenCoordinates=this.useScreenCoordinates,e.sizeAttenuation=this.sizeAttenuation,e.scaleByViewport=this.scaleByViewport,e.alignment.copy(this.alignment),e.uvOffset.copy(this.uvOffset),e.uvScale.copy(this.uvScale),e.fog=this.fog,e},D.SpriteAlignment={},D.SpriteAlignment.topLeft=new D.Vector2(1,-1),D.SpriteAlignment.topCenter=new D.Vector2(0,-1),D.SpriteAlignment.topRight=new D.Vector2(-1,-1),D.SpriteAlignment.centerLeft=new D.Vector2(1,0),D.SpriteAlignment.center=new D.Vector2(0,0),D.SpriteAlignment.centerRight=new D.Vector2(-1,0),D.SpriteAlignment.bottomLeft=new D.Vector2(1,1),D.SpriteAlignment.bottomCenter=new D.Vector2(0,1),D.SpriteAlignment.bottomRight=new D.Vector2(-1,1),D.Texture=function(e,t,r,i,n,o,a,s,l){this.id=D.TextureIdCount++,this.name="",this.image=e,this.mipmaps=[],this.mapping=void 0!==t?t:new D.UVMapping,this.wrapS=void 0!==r?r:D.ClampToEdgeWrapping,this.wrapT=void 0!==i?i:D.ClampToEdgeWrapping,this.magFilter=void 0!==n?n:D.LinearFilter,this.minFilter=void 0!==o?o:D.LinearMipMapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:D.RGBAFormat,this.type=void 0!==s?s:D.UnsignedByteType,this.offset=new D.Vector2(0,0),this.repeat=new D.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},D.Texture.prototype={constructor:D.Texture,addEventListener:D.EventDispatcher.prototype.addEventListener,hasEventListener:D.EventDispatcher.prototype.hasEventListener,removeEventListener:D.EventDispatcher.prototype.removeEventListener,dispatchEvent:D.EventDispatcher.prototype.dispatchEvent,clone:function(e){return void 0===e&&(e=new D.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},D.TextureIdCount=0,D.CompressedTexture=function(e,t,r,i,n,o,a,s,l,c,u){D.Texture.call(this,null,o,a,s,l,c,i,n,u),this.image={width:t,height:r},this.mipmaps=e,this.generateMipmaps=!1},D.CompressedTexture.prototype=Object.create(D.Texture.prototype),D.CompressedTexture.prototype.clone=function(){var e=new D.CompressedTexture;return D.Texture.prototype.clone.call(this,e),e},D.DataTexture=function(e,t,r,i,n,o,a,s,l,c,u){D.Texture.call(this,null,o,a,s,l,c,i,n,u),this.image={data:e,width:t,height:r}},D.DataTexture.prototype=Object.create(D.Texture.prototype),D.DataTexture.prototype.clone=function(){var e=new D.DataTexture;return D.Texture.prototype.clone.call(this,e),e},D.Particle=function(e){D.Object3D.call(this),this.material=e},D.Particle.prototype=Object.create(D.Object3D.prototype),D.Particle.prototype.clone=function(e){return void 0===e&&(e=new D.Particle(this.material)),D.Object3D.prototype.clone.call(this,e),e},D.ParticleSystem=function(e,t){D.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new D.ParticleBasicMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.geometry&&null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.frustumCulled=!1},D.ParticleSystem.prototype=Object.create(D.Object3D.prototype),D.ParticleSystem.prototype.clone=function(e){return void 0===e&&(e=new D.ParticleSystem(this.geometry,this.material)),e.sortParticles=this.sortParticles,D.Object3D.prototype.clone.call(this,e),e},D.Line=function(e,t,r){D.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new D.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==r?r:D.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},D.LineStrip=0,D.LinePieces=1,D.Line.prototype=Object.create(D.Object3D.prototype),D.Line.prototype.clone=function(e){return void 0===e&&(e=new D.Line(this.geometry,this.material,this.type)),D.Object3D.prototype.clone.call(this,e),e},D.Mesh=function(e,t){D.Object3D.call(this),this.geometry=null,this.material=null,this.setGeometry(e),this.setMaterial(t)},D.Mesh.prototype=Object.create(D.Object3D.prototype),D.Mesh.prototype.setGeometry=function(e){void 0!==e&&(this.geometry=e,null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.updateMorphTargets())},D.Mesh.prototype.setMaterial=function(e){this.material=void 0!==e?e:new D.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0})},D.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},D.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},D.Mesh.prototype.clone=function(e){return void 0===e&&(e=new D.Mesh(this.geometry,this.material)),D.Object3D.prototype.clone.call(this,e),e},D.Bone=function(e){D.Object3D.call(this),this.skin=e,this.skinMatrix=new D.Matrix4},D.Bone.prototype=Object.create(D.Object3D.prototype),D.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var r,i=this.children.length;for(r=0;r<i;r++)this.children[r].update(this.skinMatrix,t)},D.SkinnedMesh=function(e,t,r){var i,n,o,a,s,l;if(D.Mesh.call(this,e,t),this.useVertexTexture=void 0===r||r,this.identityMatrix=new D.Matrix4,this.bones=[],this.boneMatrices=[],this.geometry&&void 0!==this.geometry.bones){for(i=0;i<this.geometry.bones.length;i++)a=(o=this.geometry.bones[i]).pos,s=o.rotq,l=o.scl,(n=this.addBone()).name=o.name,n.position.set(a[0],a[1],a[2]),n.quaternion.set(s[0],s[1],s[2],s[3]),n.useQuaternion=!0,void 0!==l?n.scale.set(l[0],l[1],l[2]):n.scale.set(1,1,1);for(i=0;i<this.bones.length;i++)o=this.geometry.bones[i],n=this.bones[i],-1===o.parent?this.add(n):this.bones[o.parent].add(n);var c,u=this.bones.length;if(this.useVertexTexture)c=u>256?64:u>64?32:u>16?16:8,this.boneTextureWidth=c,this.boneTextureHeight=c,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new D.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,D.RGBAFormat,D.FloatType),this.boneTexture.minFilter=D.NearestFilter,this.boneTexture.magFilter=D.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1;else this.boneMatrices=new Float32Array(16*u);this.pose()}},D.SkinnedMesh.prototype=Object.create(D.Mesh.prototype),D.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new D.Bone(this)),this.bones.push(e),e},D.SkinnedMesh.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;t<r;t++){var i=this.children[t];i instanceof D.Bone?i.update(this.identityMatrix,!1):i.updateMatrixWorld(!0)}if(null==this.boneInverses){this.boneInverses=[];for(var n=0,o=this.bones.length;n<o;n++){var a=new D.Matrix4;a.getInverse(this.bones[n].skinMatrix),this.boneInverses.push(a)}}for(n=0,o=this.bones.length;n<o;n++)D.SkinnedMesh.offsetMatrix.multiplyMatrices(this.bones[n].skinMatrix,this.boneInverses[n]),D.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,16*n);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)},D.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],r=1/t.lengthManhattan();r!==1/0?t.multiplyScalar(r):t.set(1)}},D.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new D.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),D.Mesh.prototype.clone.call(this,e),e},D.SkinnedMesh.offsetMatrix=new D.Matrix4,D.MorphAnimMesh=function(e,t){D.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},D.MorphAnimMesh.prototype=Object.create(D.Mesh.prototype),D.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},D.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},D.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},D.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,r=e.animations,i=/([a-z]+)(\d+)/,n=0,o=e.morphTargets.length;n<o;n++){var a=e.morphTargets[n].name.match(i);if(a&&a.length>1){var s=a[1];a[2];r[s]||(r[s]={start:1/0,end:-1/0});var l=r[s];n<l.start&&(l.start=n),n>l.end&&(l.end=n),t||(t=s)}}e.firstAnimation=t},D.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,r){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:r}},D.MorphAnimMesh.prototype.playAnimation=function(e,t){var r=this.geometry.animations[e];r?(this.setFrameRange(r.start,r.end),this.duration=(r.end-r.start)/t*1e3,this.time=0):console.warn("animation["+e+"] undefined")},D.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var r=this.startKeyframe+D.Math.clamp(Math.floor(this.time/t),0,this.length-1);r!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[r]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=r);var i=this.time%t/t;this.directionBackwards&&(i=1-i),this.morphTargetInfluences[this.currentKeyframe]=i,this.morphTargetInfluences[this.lastKeyframe]=1-i},D.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new D.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,D.Mesh.prototype.clone.call(this,e),e},D.Ribbon=function(e,t){D.Object3D.call(this),this.geometry=e,this.material=t},D.Ribbon.prototype=Object.create(D.Object3D.prototype),D.Ribbon.prototype.clone=function(e){return void 0===e&&(e=new D.Ribbon(this.geometry,this.material)),D.Object3D.prototype.clone.call(this,e),e},D.LOD=function(){D.Object3D.call(this),this.objects=[]},D.LOD.prototype=Object.create(D.Object3D.prototype),D.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=0;r<this.objects.length&&!(t<this.objects[r].distance);r++);this.objects.splice(r,0,{distance:t,object:e}),this.add(e)},D.LOD.prototype.getObjectForDistance=function(e){for(var t=1,r=this.objects.length;t<r&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},D.LOD.prototype.update=function(){var e=new D.Vector3,t=new D.Vector3;return function(r){if(this.objects.length>1){e.getPositionFromMatrix(r.matrixWorld),t.getPositionFromMatrix(this.matrixWorld);var i=e.distanceTo(t);this.objects[0].object.visible=!0;for(var n=1,o=this.objects.length;n<o&&i>=this.objects[n].distance;n++)this.objects[n-1].object.visible=!1,this.objects[n].object.visible=!0;for(;n<o;n++)this.objects[n].object.visible=!1}}}(),D.LOD.prototype.clone=function(){},D.Sprite=function(e){D.Object3D.call(this),this.material=void 0!==e?e:new D.SpriteMaterial,this.rotation3d=this.rotation,this.rotation=0},D.Sprite.prototype=Object.create(D.Object3D.prototype),D.Sprite.prototype.updateMatrix=function(){this.rotation3d.set(0,0,this.rotation),this.quaternion.setFromEuler(this.rotation3d,this.eulerOrder),this.matrix.makeFromPositionQuaternionScale(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},D.Sprite.prototype.clone=function(e){return void 0===e&&(e=new D.Sprite(this.material)),D.Object3D.prototype.clone.call(this,e),e},D.Scene=function(){D.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},D.Scene.prototype=Object.create(D.Object3D.prototype),D.Scene.prototype.__addObject=function(e){if(e instanceof D.Light)-1===this.__lights.indexOf(e)&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target);else if(!(e instanceof D.Camera||e instanceof D.Bone)&&-1===this.__objects.indexOf(e)){this.__objects.push(e),this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}for(var r=0;r<e.children.length;r++)this.__addObject(e.children[r])},D.Scene.prototype.__removeObject=function(e){if(e instanceof D.Light)-1!==(t=this.__lights.indexOf(e))&&this.__lights.splice(t,1);else if(!(e instanceof D.Camera)){var t;if(-1!==(t=this.__objects.indexOf(e))){this.__objects.splice(t,1),this.__objectsRemoved.push(e);var r=this.__objectsAdded.indexOf(e);-1!==r&&this.__objectsAdded.splice(r,1)}}for(var i=0;i<e.children.length;i++)this.__removeObject(e.children[i])},D.Fog=function(e,t,r){this.name="",this.color=new D.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3},D.Fog.prototype.clone=function(){return new D.Fog(this.color.getHex(),this.near,this.far)},D.FogExp2=function(e,t){this.name="",this.color=new D.Color(e),this.density=void 0!==t?t:25e-5},D.FogExp2.prototype.clone=function(){return new D.FogExp2(this.color.getHex(),this.density)},D.CanvasRenderer=function(e){console.log("THREE.CanvasRenderer",D.REVISION);var t=D.Math.smoothstep;e=e||{};var r,i,n,o,a,s,l,c,u,h,f,p,d,m,g,v,y,x,b,w,S,_,M,T,C,A,E,L,P,R,F,O,U,N,V,k,z,B,I,j=this,G=new D.Projector,H=void 0!==e.canvas?e.canvas:document.createElement("canvas"),W=H.getContext("2d"),X=new D.Color(0),q=0,Y=1,K=0,$=null,Q=null,Z=null,J=null,ee=null,te=null,re=0,ie=new D.RenderableVertex,ne=new D.RenderableVertex,oe=new D.Color,ae=new D.Color,se=new D.Color,le=new D.Color,ce=new D.Color,ue=new D.Color,he=new D.Color,fe=new D.Color,pe={},de={},me=new D.Box2,ge=new D.Box2,ve=new D.Box2,ye=new D.Color,xe=new D.Color,be=new D.Color,we=new D.Vector3,Se=16;function _e(e){Y!==e&&(W.globalAlpha=e,Y=e)}function Me(e){K!==e&&(e===D.NormalBlending?W.globalCompositeOperation="source-over":e===D.AdditiveBlending?W.globalCompositeOperation="lighter":e===D.SubtractiveBlending&&(W.globalCompositeOperation="darker"),K=e)}function Te(e){Z!==e&&(W.lineWidth=e,Z=e)}function Ce(e){J!==e&&(W.lineCap=e,J=e)}function Ae(e){ee!==e&&(W.lineJoin=e,ee=e)}function Ee(e){$!==e&&(W.strokeStyle=e,$=e)}function De(e){Q!==e&&(W.fillStyle=e,Q=e)}function Le(e,t){te===e&&re===t||(W.setLineDash([e,t]),te=e,re=t)}(N=document.createElement("canvas")).width=N.height=2,(V=N.getContext("2d")).fillStyle="rgba(0,0,0,1)",V.fillRect(0,0,2,2),k=V.getImageData(0,0,2,2),z=k.data,(B=document.createElement("canvas")).width=B.height=Se,(I=B.getContext("2d")).translate(-Se/2,-Se/2),I.scale(Se,Se),Se--,void 0===W.setLineDash&&(void 0!==W.mozDash?W.setLineDash=function(e){W.mozDash=null!==e[0]?e:null}:W.setLineDash=function(){}),this.domElement=H,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t,r){o=e*this.devicePixelRatio,a=t*this.devicePixelRatio,s=Math.floor(o/2),l=Math.floor(a/2),H.width=o,H.height=a,1!==this.devicePixelRatio&&!1!==r&&(H.style.width=e+"px",H.style.height=t+"px"),me.set(new D.Vector2(-s,-l),new D.Vector2(s,l)),ge.set(new D.Vector2(-s,-l),new D.Vector2(s,l)),Y=1,K=0,$=null,Q=null,Z=null,J=null,ee=null},this.setClearColor=function(e,t){X.set(e),q=void 0!==t?t:1,ge.set(new D.Vector2(-s,-l),new D.Vector2(s,l))},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){W.setTransform(1,0,0,-1,s,l),!1===ge.empty()&&(ge.intersect(me),ge.expandByScalar(2),q<1&&W.clearRect(0|ge.min.x,0|ge.min.y,ge.max.x-ge.min.x|0,ge.max.y-ge.min.y|0),q>0&&(Me(D.NormalBlending),_e(1),De("rgba("+Math.floor(255*X.r)+","+Math.floor(255*X.g)+","+Math.floor(255*X.b)+","+q+")"),W.fillRect(0|ge.min.x,0|ge.min.y,ge.max.x-ge.min.x|0,ge.max.y-ge.min.y|0)),ge.makeEmpty())},this.render=function(e,o){if(o instanceof D.Camera!=!1){!0===this.autoClear&&this.clear(),W.setTransform(1,0,0,-1,s,l),j.info.render.vertices=0,j.info.render.faces=0,r=G.projectScene(e,o,this.sortObjects,this.sortElements),i=r.elements,n=r.lights,function(){ye.setRGB(0,0,0),xe.setRGB(0,0,0),be.setRGB(0,0,0);for(var e=0,t=n.length;e<t;e++){var r=n[e],i=r.color;r instanceof D.AmbientLight?ye.add(i):r instanceof D.DirectionalLight?xe.add(i):r instanceof D.PointLight&&be.add(i)}}();for(var a=0,H=i.length;a<H;a++){var X=i[a],q=X.material;if(void 0!==q&&!1!==q.visible){if(ve.makeEmpty(),X instanceof D.RenderableParticle)(c=X).x*=s,c.y*=l,K(c,X,q);else if(X instanceof D.RenderableLine)c=X.v1,u=X.v2,c.positionScreen.x*=s,c.positionScreen.y*=l,u.positionScreen.x*=s,u.positionScreen.y*=l,ve.setFromPoints([c.positionScreen,u.positionScreen]),!0===me.isIntersectionBox(ve)&&$(c,u,X,q);else if(X instanceof D.RenderableFace3){if(c=X.v1,u=X.v2,h=X.v3,c.positionScreen.z<-1||c.positionScreen.z>1)continue;if(u.positionScreen.z<-1||u.positionScreen.z>1)continue;if(h.positionScreen.z<-1||h.positionScreen.z>1)continue;c.positionScreen.x*=s,c.positionScreen.y*=l,u.positionScreen.x*=s,u.positionScreen.y*=l,h.positionScreen.x*=s,h.positionScreen.y*=l,!0===q.overdraw&&(Fe(c.positionScreen,u.positionScreen),Fe(u.positionScreen,h.positionScreen),Fe(h.positionScreen,c.positionScreen)),ve.setFromPoints([c.positionScreen,u.positionScreen,h.positionScreen]),!0===me.isIntersectionBox(ve)&&Q(c,u,h,0,1,2,X,q)}else if(X instanceof D.RenderableFace4){if(c=X.v1,u=X.v2,h=X.v3,f=X.v4,c.positionScreen.z<-1||c.positionScreen.z>1)continue;if(u.positionScreen.z<-1||u.positionScreen.z>1)continue;if(h.positionScreen.z<-1||h.positionScreen.z>1)continue;if(f.positionScreen.z<-1||f.positionScreen.z>1)continue;c.positionScreen.x*=s,c.positionScreen.y*=l,u.positionScreen.x*=s,u.positionScreen.y*=l,h.positionScreen.x*=s,h.positionScreen.y*=l,f.positionScreen.x*=s,f.positionScreen.y*=l,ie.positionScreen.copy(u.positionScreen),ne.positionScreen.copy(f.positionScreen),!0===q.overdraw&&(Fe(c.positionScreen,u.positionScreen),Fe(u.positionScreen,f.positionScreen),Fe(f.positionScreen,c.positionScreen),Fe(h.positionScreen,ie.positionScreen),Fe(h.positionScreen,ne.positionScreen)),ve.setFromPoints([c.positionScreen,u.positionScreen,h.positionScreen,f.positionScreen]),!0===me.isIntersectionBox(ve)&&Z(c,u,h,f,ie,ne,X,q)}ge.union(ve)}}W.setTransform(1,0,0,1,0,0)}else console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");function Y(e,t,r){for(var i=0,o=n.length;i<o;i++){var a=n[i];if(fe.copy(a.color),a instanceof D.DirectionalLight){var s=we.getPositionFromMatrix(a.matrixWorld).normalize();if((l=t.dot(s))<=0)continue;l*=a.intensity,r.add(fe.multiplyScalar(l))}else if(a instanceof D.PointLight){var l;s=we.getPositionFromMatrix(a.matrixWorld);if((l=t.dot(we.subVectors(s,e).normalize()))<=0)continue;if(0==(l*=0==a.distance?1:1-Math.min(e.distanceTo(s)/a.distance,1)))continue;l*=a.intensity,r.add(fe.multiplyScalar(l))}}}function K(e,t,r){var i,n,o,a,c,u,h;if(_e(r.opacity),Me(r.blending),r instanceof D.ParticleBasicMaterial)if(null===r.map){if(o=t.object.scale.x,a=t.object.scale.y,o*=t.scale.x*s,a*=t.scale.y*l,ve.min.set(e.x-o,e.y-a),ve.max.set(e.x+o,e.y+a),!1===me.isIntersectionBox(ve))return void ve.makeEmpty();De(r.color.getStyle()),W.save(),W.translate(e.x,e.y),W.rotate(-t.rotation),W.scale(o,a),W.fillRect(-1,-1,2,2),W.restore()}else{if(u=(c=r.map.image).width>>1,h=c.height>>1,i=(o=t.scale.x*s)*u,n=(a=t.scale.y*l)*h,ve.min.set(e.x-i,e.y-n),ve.max.set(e.x+i,e.y+n),!1===me.isIntersectionBox(ve))return void ve.makeEmpty();W.save(),W.translate(e.x,e.y),W.rotate(-t.rotation),W.scale(o,-a),W.translate(-u,-h),W.drawImage(c,0,0),W.restore()}else if(r instanceof D.ParticleCanvasMaterial){if(i=t.scale.x*s,n=t.scale.y*l,ve.min.set(e.x-i,e.y-n),ve.max.set(e.x+i,e.y+n),!1===me.isIntersectionBox(ve))return void ve.makeEmpty();Ee(r.color.getStyle()),De(r.color.getStyle()),W.save(),W.translate(e.x,e.y),W.rotate(-t.rotation),W.scale(i,n),r.program(W),W.restore()}}function $(e,t,r,i){if(_e(i.opacity),Me(i.blending),W.beginPath(),W.moveTo(e.positionScreen.x,e.positionScreen.y),W.lineTo(t.positionScreen.x,t.positionScreen.y),i instanceof D.LineBasicMaterial){if(Te(i.linewidth),Ce(i.linecap),Ae(i.linejoin),i.vertexColors!==D.VertexColors)Ee(i.color.getStyle());else{var n=r.vertexColors[0].getStyle(),o=r.vertexColors[1].getStyle();if(n===o)Ee(n);else{try{var a=W.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);a.addColorStop(0,n),a.addColorStop(1,o)}catch(e){a=n}Ee(a)}}W.stroke(),ve.expandByScalar(2*i.linewidth)}else i instanceof D.LineDashedMaterial&&(Te(i.linewidth),Ce(i.linecap),Ae(i.linejoin),Ee(i.color.getStyle()),Le(i.dashSize,i.gapSize),W.stroke(),ve.expandByScalar(2*i.linewidth),Le(null,null))}function Q(e,r,i,n,a,s,l,c){if(j.info.render.vertices+=3,j.info.render.faces++,_e(c.opacity),Me(c.blending),p=e.positionScreen.x,d=e.positionScreen.y,m=r.positionScreen.x,g=r.positionScreen.y,v=i.positionScreen.x,y=i.positionScreen.y,J(p,d,m,g,v,y),(c instanceof D.MeshLambertMaterial||c instanceof D.MeshPhongMaterial)&&null===c.map)ue.copy(c.color),he.copy(c.emissive),c.vertexColors===D.FaceColors&&ue.multiply(l.color),!1===c.wireframe&&c.shading==D.SmoothShading&&3==l.vertexNormalsLength?(ae.copy(ye),se.copy(ye),le.copy(ye),Y(l.v1.positionWorld,l.vertexNormalsModel[0],ae),Y(l.v2.positionWorld,l.vertexNormalsModel[1],se),Y(l.v3.positionWorld,l.vertexNormalsModel[2],le),ae.multiply(ue).add(he),se.multiply(ue).add(he),le.multiply(ue).add(he),ce.addColors(se,le).multiplyScalar(.5),A=Re(ae,se,le,ce),Pe(p,d,m,g,v,y,0,0,1,0,0,1,A)):(oe.copy(ye),Y(l.centroidModel,l.normalModel,oe),oe.multiply(ue).add(he),!0===c.wireframe?te(oe,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):re(oe));else if(c instanceof D.MeshBasicMaterial||c instanceof D.MeshLambertMaterial||c instanceof D.MeshPhongMaterial)null!==c.map?c.map.mapping instanceof D.UVMapping&&(E=l.uvs[0],Se(p,d,m,g,v,y,E[n].x,E[n].y,E[a].x,E[a].y,E[s].x,E[s].y,c.map)):null!==c.envMap?c.envMap.mapping instanceof D.SphericalReflectionMapping&&(we.copy(l.vertexNormalsModelView[n]),L=.5*we.x+.5,P=.5*we.y+.5,we.copy(l.vertexNormalsModelView[a]),R=.5*we.x+.5,F=.5*we.y+.5,we.copy(l.vertexNormalsModelView[s]),O=.5*we.x+.5,U=.5*we.y+.5,Se(p,d,m,g,v,y,L,P,R,F,O,U,c.envMap)):(oe.copy(c.color),c.vertexColors===D.FaceColors&&oe.multiply(l.color),!0===c.wireframe?te(oe,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):re(oe));else if(c instanceof D.MeshDepthMaterial)T=o.near,C=o.far,ae.r=ae.g=ae.b=1-t(e.positionScreen.z*e.positionScreen.w,T,C),se.r=se.g=se.b=1-t(r.positionScreen.z*r.positionScreen.w,T,C),le.r=le.g=le.b=1-t(i.positionScreen.z*i.positionScreen.w,T,C),ce.addColors(se,le).multiplyScalar(.5),A=Re(ae,se,le,ce),Pe(p,d,m,g,v,y,0,0,1,0,0,1,A);else if(c instanceof D.MeshNormalMaterial){var u;c.shading==D.FlatShading?(u=l.normalModelView,oe.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),!0===c.wireframe?te(oe,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):re(oe)):c.shading==D.SmoothShading&&(u=l.vertexNormalsModelView[n],ae.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),u=l.vertexNormalsModelView[a],se.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),u=l.vertexNormalsModelView[s],le.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),ce.addColors(se,le).multiplyScalar(.5),A=Re(ae,se,le,ce),Pe(p,d,m,g,v,y,0,0,1,0,0,1,A))}}function Z(e,r,i,n,a,s,l,c){if(j.info.render.vertices+=4,j.info.render.faces++,_e(c.opacity),Me(c.blending),void 0!==c.map&&null!==c.map||void 0!==c.envMap&&null!==c.envMap)return Q(e,r,n,0,1,3,l,c),void Q(a,i,s,1,2,3,l,c);if(p=e.positionScreen.x,d=e.positionScreen.y,m=r.positionScreen.x,g=r.positionScreen.y,v=i.positionScreen.x,y=i.positionScreen.y,x=n.positionScreen.x,b=n.positionScreen.y,w=a.positionScreen.x,S=a.positionScreen.y,_=s.positionScreen.x,M=s.positionScreen.y,c instanceof D.MeshLambertMaterial||c instanceof D.MeshPhongMaterial)ue.copy(c.color),he.copy(c.emissive),c.vertexColors===D.FaceColors&&ue.multiply(l.color),!1===c.wireframe&&c.shading==D.SmoothShading&&4==l.vertexNormalsLength?(ae.copy(ye),se.copy(ye),le.copy(ye),ce.copy(ye),Y(l.v1.positionWorld,l.vertexNormalsModel[0],ae),Y(l.v2.positionWorld,l.vertexNormalsModel[1],se),Y(l.v4.positionWorld,l.vertexNormalsModel[3],le),Y(l.v3.positionWorld,l.vertexNormalsModel[2],ce),ae.multiply(ue).add(he),se.multiply(ue).add(he),le.multiply(ue).add(he),ce.multiply(ue).add(he),A=Re(ae,se,le,ce),J(p,d,m,g,x,b),Pe(p,d,m,g,x,b,0,0,1,0,0,1,A),J(w,S,v,y,_,M),Pe(w,S,v,y,_,M,1,0,1,1,0,1,A)):(oe.copy(ye),Y(l.centroidModel,l.normalModel,oe),oe.multiply(ue).add(he),ee(p,d,m,g,v,y,x,b),!0===c.wireframe?te(oe,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):re(oe));else if(c instanceof D.MeshBasicMaterial)oe.copy(c.color),c.vertexColors===D.FaceColors&&oe.multiply(l.color),ee(p,d,m,g,v,y,x,b),!0===c.wireframe?te(oe,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):re(oe);else if(c instanceof D.MeshNormalMaterial){var u;c.shading==D.FlatShading?(u=l.normalModelView,oe.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),ee(p,d,m,g,v,y,x,b),!0===c.wireframe?te(oe,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):re(oe)):c.shading==D.SmoothShading&&(u=l.vertexNormalsModelView[0],ae.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),u=l.vertexNormalsModelView[1],se.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),u=l.vertexNormalsModelView[3],le.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),u=l.vertexNormalsModelView[2],ce.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),A=Re(ae,se,le,ce),J(p,d,m,g,x,b),Pe(p,d,m,g,x,b,0,0,1,0,0,1,A),J(w,S,v,y,_,M),Pe(w,S,v,y,_,M,1,0,1,1,0,1,A))}else c instanceof D.MeshDepthMaterial&&(T=o.near,C=o.far,ae.r=ae.g=ae.b=1-t(e.positionScreen.z*e.positionScreen.w,T,C),se.r=se.g=se.b=1-t(r.positionScreen.z*r.positionScreen.w,T,C),le.r=le.g=le.b=1-t(n.positionScreen.z*n.positionScreen.w,T,C),ce.r=ce.g=ce.b=1-t(i.positionScreen.z*i.positionScreen.w,T,C),A=Re(ae,se,le,ce),J(p,d,m,g,x,b),Pe(p,d,m,g,x,b,0,0,1,0,0,1,A),J(w,S,v,y,_,M),Pe(w,S,v,y,_,M,1,0,1,1,0,1,A))}function J(e,t,r,i,n,o){W.beginPath(),W.moveTo(e,t),W.lineTo(r,i),W.lineTo(n,o),W.closePath()}function ee(e,t,r,i,n,o,a,s){W.beginPath(),W.moveTo(e,t),W.lineTo(r,i),W.lineTo(n,o),W.lineTo(a,s),W.closePath()}function te(e,t,r,i){Te(t),Ce(r),Ae(i),Ee(e.getStyle()),W.stroke(),ve.expandByScalar(2*t)}function re(e){De(e.getStyle()),W.fill()}function Se(e,t,r,i,n,o,a,s,l,c,u,h,f){if(!(f instanceof D.DataTexture||void 0===f.image||0==f.image.width)){if(!0===f.needsUpdate){var p=f.wrapS==D.RepeatWrapping,d=f.wrapT==D.RepeatWrapping;pe[f.id]=W.createPattern(f.image,!0===p&&!0===d?"repeat":!0===p&&!1===d?"repeat-x":!1===p&&!0===d?"repeat-y":"no-repeat"),f.needsUpdate=!1}void 0===pe[f.id]?De("rgba(0,0,0,1)"):De(pe[f.id]);var m,g,v,y,x,b,w,S,_=f.offset.x/f.repeat.x,M=f.offset.y/f.repeat.y,T=f.image.width*f.repeat.x,C=f.image.height*f.repeat.y;if(l=(l+_)*T,c=(1-c+M)*C,u=(u+_)*T,h=(1-h+M)*C,r-=e,i-=t,n-=e,o-=t,0===(w=(l-=a=(a+_)*T)*(h-=s=(1-s+M)*C)-(u-=a)*(c-=s))){if(void 0===de[f.id]){var A=document.createElement("canvas");A.width=f.image.width,A.height=f.image.height;var E=A.getContext("2d");E.drawImage(f.image,0,0),de[f.id]=E.getImageData(0,0,f.image.width,f.image.height).data}var L=de[f.id],P=4*(Math.floor(a)+Math.floor(s)*f.image.width);return oe.setRGB(L[P]/255,L[P+1]/255,L[P+2]/255),void re(oe)}x=e-(m=(h*r-c*n)*(S=1/w))*a-(v=(l*n-u*r)*S)*s,b=t-(g=(h*i-c*o)*S)*a-(y=(l*o-u*i)*S)*s,W.save(),W.transform(m,g,v,y,x,b),W.fill(),W.restore()}}function Pe(e,t,r,i,n,o,a,s,l,c,u,h,f){var p,d,m,g,v,y,x,b=f.width-1,w=f.height-1;l*=b,c*=w,u*=b,h*=w,v=e-(p=((h-=s*=w)*(r-=e)-(c-=s)*(n-=e))*(x=1/((l-=a*=b)*h-(u-=a)*c)))*a-(m=(l*n-u*r)*x)*s,y=t-(d=(h*(i-=t)-c*(o-=t))*x)*a-(g=(l*o-u*i)*x)*s,W.save(),W.transform(p,d,m,g,v,y),W.clip(),W.drawImage(f,0,0),W.restore()}function Re(e,t,r,i){return z[0]=255*e.r|0,z[1]=255*e.g|0,z[2]=255*e.b|0,z[4]=255*t.r|0,z[5]=255*t.g|0,z[6]=255*t.b|0,z[8]=255*r.r|0,z[9]=255*r.g|0,z[10]=255*r.b|0,z[12]=255*i.r|0,z[13]=255*i.g|0,z[14]=255*i.b|0,V.putImageData(k,0,0),I.drawImage(N,0,0),B}function Fe(e,t){var r,i=t.x-e.x,n=t.y-e.y,o=i*i+n*n;0!==o&&(i*=r=1/Math.sqrt(o),n*=r,t.x+=i,t.y+=n,e.x-=i,e.y-=n)}}},D.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = gl_FragColor * texelColor;","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -vViewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix \t+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","vec3 shadowZ = vec3( shadowCoord.z );","shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));","shadowKernel[0] *= vec3(0.25);","shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));","shadowKernel[1] *= vec3(0.25);","shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));","shadowKernel[2] *= vec3(0.25);","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},D.UniformsUtils={merge:function(e){var t,r,i,n={};for(t=0;t<e.length;t++)for(r in i=this.clone(e[t]))n[r]=i[r];return n},clone:function(e){var t,r,i,n={};for(t in e)for(r in n[t]={},e[t])(i=e[t][r])instanceof D.Color||i instanceof D.Vector2||i instanceof D.Vector3||i instanceof D.Vector4||i instanceof D.Matrix4||i instanceof D.Texture?n[t][r]=i.clone():n[t][r]=i instanceof Array?i.slice():i;return n}},D.UniformsLib={common:{diffuse:{type:"c",value:new D.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new D.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new D.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new D.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new D.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new D.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},D.ShaderLib={basic:{uniforms:D.UniformsUtils.merge([D.UniformsLib.common,D.UniformsLib.fog,D.UniformsLib.shadowmap]),vertexShader:[D.ShaderChunk.map_pars_vertex,D.ShaderChunk.lightmap_pars_vertex,D.ShaderChunk.envmap_pars_vertex,D.ShaderChunk.color_pars_vertex,D.ShaderChunk.morphtarget_pars_vertex,D.ShaderChunk.skinning_pars_vertex,D.ShaderChunk.shadowmap_pars_vertex,"void main() {",D.ShaderChunk.map_vertex,D.ShaderChunk.lightmap_vertex,D.ShaderChunk.color_vertex,D.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",D.ShaderChunk.morphnormal_vertex,D.ShaderChunk.skinnormal_vertex,D.ShaderChunk.defaultnormal_vertex,"#endif",D.ShaderChunk.morphtarget_vertex,D.ShaderChunk.skinning_vertex,D.ShaderChunk.default_vertex,D.ShaderChunk.worldpos_vertex,D.ShaderChunk.envmap_vertex,D.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",D.ShaderChunk.color_pars_fragment,D.ShaderChunk.map_pars_fragment,D.ShaderChunk.lightmap_pars_fragment,D.ShaderChunk.envmap_pars_fragment,D.ShaderChunk.fog_pars_fragment,D.ShaderChunk.shadowmap_pars_fragment,D.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",D.ShaderChunk.map_fragment,D.ShaderChunk.alphatest_fragment,D.ShaderChunk.specularmap_fragment,D.ShaderChunk.lightmap_fragment,D.ShaderChunk.color_fragment,D.ShaderChunk.envmap_fragment,D.ShaderChunk.shadowmap_fragment,D.ShaderChunk.linear_to_gamma_fragment,D.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:D.UniformsUtils.merge([D.UniformsLib.common,D.UniformsLib.fog,D.UniformsLib.lights,D.UniformsLib.shadowmap,{ambient:{type:"c",value:new D.Color(16777215)},emissive:{type:"c",value:new D.Color(0)},wrapRGB:{type:"v3",value:new D.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",D.ShaderChunk.map_pars_vertex,D.ShaderChunk.lightmap_pars_vertex,D.ShaderChunk.envmap_pars_vertex,D.ShaderChunk.lights_lambert_pars_vertex,D.ShaderChunk.color_pars_vertex,D.ShaderChunk.morphtarget_pars_vertex,D.ShaderChunk.skinning_pars_vertex,D.ShaderChunk.shadowmap_pars_vertex,"void main() {",D.ShaderChunk.map_vertex,D.ShaderChunk.lightmap_vertex,D.ShaderChunk.color_vertex,D.ShaderChunk.morphnormal_vertex,D.ShaderChunk.skinbase_vertex,D.ShaderChunk.skinnormal_vertex,D.ShaderChunk.defaultnormal_vertex,D.ShaderChunk.morphtarget_vertex,D.ShaderChunk.skinning_vertex,D.ShaderChunk.default_vertex,D.ShaderChunk.worldpos_vertex,D.ShaderChunk.envmap_vertex,D.ShaderChunk.lights_lambert_vertex,D.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",D.ShaderChunk.color_pars_fragment,D.ShaderChunk.map_pars_fragment,D.ShaderChunk.lightmap_pars_fragment,D.ShaderChunk.envmap_pars_fragment,D.ShaderChunk.fog_pars_fragment,D.ShaderChunk.shadowmap_pars_fragment,D.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",D.ShaderChunk.map_fragment,D.ShaderChunk.alphatest_fragment,D.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",D.ShaderChunk.lightmap_fragment,D.ShaderChunk.color_fragment,D.ShaderChunk.envmap_fragment,D.ShaderChunk.shadowmap_fragment,D.ShaderChunk.linear_to_gamma_fragment,D.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:D.UniformsUtils.merge([D.UniformsLib.common,D.UniformsLib.bump,D.UniformsLib.normalmap,D.UniformsLib.fog,D.UniformsLib.lights,D.UniformsLib.shadowmap,{ambient:{type:"c",value:new D.Color(16777215)},emissive:{type:"c",value:new D.Color(0)},specular:{type:"c",value:new D.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new D.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",D.ShaderChunk.map_pars_vertex,D.ShaderChunk.lightmap_pars_vertex,D.ShaderChunk.envmap_pars_vertex,D.ShaderChunk.lights_phong_pars_vertex,D.ShaderChunk.color_pars_vertex,D.ShaderChunk.morphtarget_pars_vertex,D.ShaderChunk.skinning_pars_vertex,D.ShaderChunk.shadowmap_pars_vertex,"void main() {",D.ShaderChunk.map_vertex,D.ShaderChunk.lightmap_vertex,D.ShaderChunk.color_vertex,D.ShaderChunk.morphnormal_vertex,D.ShaderChunk.skinbase_vertex,D.ShaderChunk.skinnormal_vertex,D.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",D.ShaderChunk.morphtarget_vertex,D.ShaderChunk.skinning_vertex,D.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",D.ShaderChunk.worldpos_vertex,D.ShaderChunk.envmap_vertex,D.ShaderChunk.lights_phong_vertex,D.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",D.ShaderChunk.color_pars_fragment,D.ShaderChunk.map_pars_fragment,D.ShaderChunk.lightmap_pars_fragment,D.ShaderChunk.envmap_pars_fragment,D.ShaderChunk.fog_pars_fragment,D.ShaderChunk.lights_phong_pars_fragment,D.ShaderChunk.shadowmap_pars_fragment,D.ShaderChunk.bumpmap_pars_fragment,D.ShaderChunk.normalmap_pars_fragment,D.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",D.ShaderChunk.map_fragment,D.ShaderChunk.alphatest_fragment,D.ShaderChunk.specularmap_fragment,D.ShaderChunk.lights_phong_fragment,D.ShaderChunk.lightmap_fragment,D.ShaderChunk.color_fragment,D.ShaderChunk.envmap_fragment,D.ShaderChunk.shadowmap_fragment,D.ShaderChunk.linear_to_gamma_fragment,D.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:D.UniformsUtils.merge([D.UniformsLib.particle,D.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",D.ShaderChunk.color_pars_vertex,D.ShaderChunk.shadowmap_pars_vertex,"void main() {",D.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",D.ShaderChunk.worldpos_vertex,D.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",D.ShaderChunk.color_pars_fragment,D.ShaderChunk.map_particle_pars_fragment,D.ShaderChunk.fog_pars_fragment,D.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",D.ShaderChunk.map_particle_fragment,D.ShaderChunk.alphatest_fragment,D.ShaderChunk.color_fragment,D.ShaderChunk.shadowmap_fragment,D.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:D.UniformsUtils.merge([D.UniformsLib.common,D.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",D.ShaderChunk.color_pars_vertex,"void main() {",D.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",D.ShaderChunk.color_pars_fragment,D.ShaderChunk.fog_pars_fragment,"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",D.ShaderChunk.color_fragment,D.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",D.ShaderChunk.morphtarget_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );",D.ShaderChunk.morphtarget_vertex,D.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:D.UniformsUtils.merge([D.UniformsLib.fog,D.UniformsLib.lights,D.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new D.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new D.Color(16777215)},uSpecularColor:{type:"c",value:new D.Color(1118481)},uAmbientColor:{type:"c",value:new D.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new D.Vector2(0,0)},uRepeat:{type:"v2",value:new D.Vector2(1,1)},wrapRGB:{type:"v3",value:new D.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",D.ShaderChunk.shadowmap_pars_fragment,D.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",D.ShaderChunk.shadowmap_fragment,D.ShaderChunk.linear_to_gamma_fragment,D.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",D.ShaderChunk.skinning_pars_vertex,D.ShaderChunk.shadowmap_pars_vertex,"void main() {",D.ShaderChunk.skinbase_vertex,D.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[D.ShaderChunk.morphtarget_pars_vertex,D.ShaderChunk.skinning_pars_vertex,"void main() {",D.ShaderChunk.skinbase_vertex,D.ShaderChunk.morphtarget_vertex,D.ShaderChunk.skinning_vertex,D.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")}},D.WebGLRenderer=function(e){console.log("THREE.WebGLRenderer",D.REVISION);var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElement("canvas"),r=void 0!==e.precision?e.precision:"highp",i=void 0===e.alpha||e.alpha,n=void 0===e.premultipliedAlpha||e.premultipliedAlpha,o=void 0!==e.antialias&&e.antialias,a=void 0===e.stencil||e.stencil,s=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,l=new D.Color(0),c=0;void 0!==e.clearColor&&(console.warn("DEPRECATED: clearColor in WebGLRenderer constructor parameters is being removed. Use .setClearColor() instead."),l.setHex(e.clearColor)),void 0!==e.clearAlpha&&(console.warn("DEPRECATED: clearAlpha in WebGLRenderer constructor parameters is being removed. Use .setClearColor() instead."),c=e.clearAlpha),this.domElement=t,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyBasedShading=!1,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=D.PCFShadowMap,this.shadowMapCullFace=D.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var u,h,f,p,d,m=this,g=[],v=0,y=null,x=null,b=-1,w=null,S=null,_=0,M=0,T=-1,C=-1,A=-1,E=-1,L=-1,P=-1,R=-1,F=-1,O=null,U=null,N=null,V=null,k=0,z=0,B=0,I=0,j=0,G=0,H={},W=new D.Frustum,X=new D.Matrix4,q=new D.Matrix4,Y=new D.Vector3,K=new D.Vector3,$=!0,Q={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}};!function(){try{if(!(u=t.getContext("experimental-webgl",{alpha:i,premultipliedAlpha:n,antialias:o,stencil:a,preserveDrawingBuffer:s})))throw"Error creating WebGL context."}catch(e){console.error(e)}h=u.getExtension("OES_texture_float"),f=u.getExtension("OES_standard_derivatives"),p=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("MOZ_EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),d=u.getExtension("WEBGL_compressed_texture_s3tc")||u.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||u.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),h||console.log("THREE.WebGLRenderer: Float textures not supported.");f||console.log("THREE.WebGLRenderer: Standard derivatives not supported.");p||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported.");d||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported.");void 0===u.getShaderPrecisionFormat&&(u.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}(),u.clearColor(0,0,0,1),u.clearDepth(1),u.clearStencil(0),u.enable(u.DEPTH_TEST),u.depthFunc(u.LEQUAL),u.frontFace(u.CCW),u.cullFace(u.BACK),u.enable(u.CULL_FACE),u.enable(u.BLEND),u.blendEquation(u.FUNC_ADD),u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA),u.clearColor(l.r,l.g,l.b,c),this.context=u;var Z=u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS),J=u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS),ee=(u.getParameter(u.MAX_TEXTURE_SIZE),u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE)),te=p?u.getParameter(p.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,re=J>0,ie=re&&h,ne=(d&&u.getParameter(u.COMPRESSED_TEXTURE_FORMATS),u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT)),oe=u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT),ae=(u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT),u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT)),se=u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT),le=(u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT),u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT),u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT),u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT),u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT),u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT),u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT),ne.precision>0&&ae.precision>0),ce=oe.precision>0&&se.precision>0;function ue(e){var t,r;if(e.__webglVertexBuffer=u.createBuffer(),e.__webglNormalBuffer=u.createBuffer(),e.__webglTangentBuffer=u.createBuffer(),e.__webglColorBuffer=u.createBuffer(),e.__webglUVBuffer=u.createBuffer(),e.__webglUV2Buffer=u.createBuffer(),e.__webglSkinIndicesBuffer=u.createBuffer(),e.__webglSkinWeightsBuffer=u.createBuffer(),e.__webglFaceBuffer=u.createBuffer(),e.__webglLineBuffer=u.createBuffer(),e.numMorphTargets)for(e.__webglMorphTargetsBuffers=[],t=0,r=e.numMorphTargets;t<r;t++)e.__webglMorphTargetsBuffers.push(u.createBuffer());if(e.numMorphNormals)for(e.__webglMorphNormalsBuffers=[],t=0,r=e.numMorphNormals;t<r;t++)e.__webglMorphNormalsBuffers.push(u.createBuffer());m.info.memory.geometries++}"highp"!==r||le||(ce?(r="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(r="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==r||ce||(r="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return u},this.supportsVertexTextures=function(){return re},this.supportsFloatTextures=function(){return h},this.supportsStandardDerivatives=function(){return f},this.supportsCompressedTextureS3TC=function(){return d},this.getMaxAnisotropy=function(){return te},this.getPrecision=function(){return r},this.setSize=function(e,r,i){t.width=e*this.devicePixelRatio,t.height=r*this.devicePixelRatio,1!==this.devicePixelRatio&&!1!==i&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,t.width,t.height)},this.setViewport=function(e,r,i,n){k=void 0!==e?e:0,z=void 0!==r?r:0,B=void 0!==i?i:t.width,I=void 0!==n?n:t.height,u.viewport(k,z,B,I)},this.setScissor=function(e,t,r,i){u.scissor(e,t,r,i)},this.enableScissorTest=function(e){e?u.enable(u.SCISSOR_TEST):u.disable(u.SCISSOR_TEST)},this.setClearColor=function(e,t){l.set(e),c=void 0!==t?t:1,u.clearColor(l.r,l.g,l.b,c)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return l},this.getClearAlpha=function(){return c},this.clear=function(e,t,r){var i=0;(void 0===e||e)&&(i|=u.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=u.DEPTH_BUFFER_BIT),(void 0===r||r)&&(i|=u.STENCIL_BUFFER_BIT),u.clear(i)},this.clearTarget=function(e,t,r,i){this.setRenderTarget(e),this.clear(t,r,i)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){y=null,A=-1,R=-1,F=-1,w=-1,b=-1,$=!0,T=-1,C=-1,this.shadowMapPlugin.update(e,t)};var he=function(e){var t=e.target;t.removeEventListener("dispose",he),me(t),m.info.memory.geometries--},fe=function(e){var t=e.target;t.removeEventListener("dispose",fe),ge(t),m.info.memory.textures--},pe=function(e){var t=e.target;t.removeEventListener("dispose",pe),ve(t),m.info.memory.textures--},de=function(e){var t=e.target;t.removeEventListener("dispose",de),ye(t)},me=function(e){if(e.__webglInit=void 0,void 0!==e.__webglVertexBuffer&&u.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&u.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&u.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&u.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&u.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&u.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&u.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&u.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&u.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&u.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&u.deleteBuffer(e.__webglLineDistanceBuffer),void 0!==e.geometryGroups)for(var t in e.geometryGroups){var r=e.geometryGroups[t];if(void 0!==r.numMorphTargets)for(var i=0,n=r.numMorphTargets;i<n;i++)u.deleteBuffer(r.__webglMorphTargetsBuffers[i]);if(void 0!==r.numMorphNormals)for(i=0,n=r.numMorphNormals;i<n;i++)u.deleteBuffer(r.__webglMorphNormalsBuffers[i]);xe(r)}xe(e)},ge=function(e){if(e.image&&e.image.__webglTextureCube)u.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,u.deleteTexture(e.__webglTexture)}},ve=function(e){if(e&&e.__webglTexture)if(u.deleteTexture(e.__webglTexture),e instanceof D.WebGLRenderTargetCube)for(var t=0;t<6;t++)u.deleteFramebuffer(e.__webglFramebuffer[t]),u.deleteRenderbuffer(e.__webglRenderbuffer[t]);else u.deleteFramebuffer(e.__webglFramebuffer),u.deleteRenderbuffer(e.__webglRenderbuffer)},ye=function(e){var t=e.program;if(void 0!==t){var r,i,n;e.program=void 0;var o=!1;for(r=0,i=g.length;r<i;r++)if((n=g[r]).program===t){n.usedTimes--,0===n.usedTimes&&(o=!0);break}if(!0===o){var a=[];for(r=0,i=g.length;r<i;r++)(n=g[r]).program!==t&&a.push(n);g=a,u.deleteProgram(t),m.info.memory.programs--}}};function xe(e){if(e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)u.deleteBuffer(e.__webglCustomAttributesList[t].buffer)}function be(e,t){var r=e.vertices.length,i=t.material;if(i.attributes)for(var n in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),i.attributes){var o=i.attributes[n];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(r*a),o.buffer=u.createBuffer(),o.buffer.belongsToAttribute=n,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}function we(e,t){var r,i,n=t.geometry,o=e.faces3,a=e.faces4,s=3*o.length+4*a.length,l=1*o.length+2*a.length,c=3*o.length+4*a.length,h=Se(t,e),f=Te(h),p=_e(h),d=Me(h);if(e.__vertexArray=new Float32Array(3*s),p&&(e.__normalArray=new Float32Array(3*s)),n.hasTangents&&(e.__tangentArray=new Float32Array(4*s)),d&&(e.__colorArray=new Float32Array(3*s)),f&&((n.faceUvs.length>0||n.faceVertexUvs.length>0)&&(e.__uvArray=new Float32Array(2*s)),(n.faceUvs.length>1||n.faceVertexUvs.length>1)&&(e.__uv2Array=new Float32Array(2*s))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*s),e.__skinWeightArray=new Float32Array(4*s)),e.__faceArray=new Uint16Array(3*l),e.__lineArray=new Uint16Array(2*c),e.numMorphTargets)for(e.__morphTargetsArrays=[],r=0,i=e.numMorphTargets;r<i;r++)e.__morphTargetsArrays.push(new Float32Array(3*s));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],r=0,i=e.numMorphNormals;r<i;r++)e.__morphNormalsArrays.push(new Float32Array(3*s));if(e.__webglFaceCount=3*l,e.__webglLineCount=2*c,h.attributes)for(var m in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),h.attributes){var g=h.attributes[m],v={};for(var y in g)v[y]=g[y];if(!v.__webglInitialized||v.createUniqueBuffers){v.__webglInitialized=!0;var x=1;"v2"===v.type?x=2:"v3"===v.type?x=3:"v4"===v.type?x=4:"c"===v.type&&(x=3),v.size=x,v.array=new Float32Array(s*x),v.buffer=u.createBuffer(),v.buffer.belongsToAttribute=m,g.needsUpdate=!0,v.__original=g}e.__webglCustomAttributesList.push(v)}e.__inittedArrays=!0}function Se(e,t){return e.material instanceof D.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function _e(e){return!(e instanceof D.MeshBasicMaterial&&!e.envMap||e instanceof D.MeshDepthMaterial)&&(function(e){return e&&void 0!==e.shading&&e.shading===D.SmoothShading}(e)?D.SmoothShading:D.FlatShading)}function Me(e){return!!e.vertexColors&&e.vertexColors}function Te(e){return!!(e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof D.ShaderMaterial)}function Ce(e,t,r,i,n){if(e.__inittedArrays){var o,a,s,l,c,h,f,p,d,m,g,v,y,x,b,w,S,_,M,T,C,A,E,L,P,R,F,O,U,N,V,k,z,B,I,j,G,H,W,X,q,Y,K,$,Q,Z,J,ee=_e(n),te=Me(n),re=Te(n),ie=ee===D.SmoothShading,ne=0,oe=0,ae=0,se=0,le=0,ce=0,ue=0,he=0,fe=0,pe=0,de=0,me=0,ge=e.__vertexArray,ve=e.__uvArray,ye=e.__uv2Array,xe=e.__normalArray,be=e.__tangentArray,we=e.__colorArray,Se=e.__skinIndexArray,Ce=e.__skinWeightArray,Ae=e.__morphTargetsArrays,Ee=e.__morphNormalsArrays,De=e.__webglCustomAttributesList,Le=e.__faceArray,Pe=e.__lineArray,Re=t.geometry,Fe=Re.verticesNeedUpdate,Oe=Re.elementsNeedUpdate,Ue=Re.uvsNeedUpdate,Ne=Re.normalsNeedUpdate,Ve=Re.tangentsNeedUpdate,ke=Re.colorsNeedUpdate,ze=Re.morphTargetsNeedUpdate,Be=Re.vertices,Ie=e.faces3,je=e.faces4,Ge=Re.faces,He=Re.faceVertexUvs[0],We=Re.faceVertexUvs[1],Xe=(Re.colors,Re.skinIndices),qe=Re.skinWeights,Ye=Re.morphTargets,Ke=Re.morphNormals;if(Fe){for(o=0,a=Ie.length;o<a;o++)g=Be[(s=Ge[Ie[o]]).a],v=Be[s.b],y=Be[s.c],ge[oe]=g.x,ge[oe+1]=g.y,ge[oe+2]=g.z,ge[oe+3]=v.x,ge[oe+4]=v.y,ge[oe+5]=v.z,ge[oe+6]=y.x,ge[oe+7]=y.y,ge[oe+8]=y.z,oe+=9;for(o=0,a=je.length;o<a;o++)g=Be[(s=Ge[je[o]]).a],v=Be[s.b],y=Be[s.c],x=Be[s.d],ge[oe]=g.x,ge[oe+1]=g.y,ge[oe+2]=g.z,ge[oe+3]=v.x,ge[oe+4]=v.y,ge[oe+5]=v.z,ge[oe+6]=y.x,ge[oe+7]=y.y,ge[oe+8]=y.z,ge[oe+9]=x.x,ge[oe+10]=x.y,ge[oe+11]=x.z,oe+=12;u.bindBuffer(u.ARRAY_BUFFER,e.__webglVertexBuffer),u.bufferData(u.ARRAY_BUFFER,ge,r)}if(ze)for(X=0,q=Ye.length;X<q;X++){for(de=0,o=0,a=Ie.length;o<a;o++)s=Ge[$=Ie[o]],g=Ye[X].vertices[s.a],v=Ye[X].vertices[s.b],y=Ye[X].vertices[s.c],(Y=Ae[X])[de]=g.x,Y[de+1]=g.y,Y[de+2]=g.z,Y[de+3]=v.x,Y[de+4]=v.y,Y[de+5]=v.z,Y[de+6]=y.x,Y[de+7]=y.y,Y[de+8]=y.z,n.morphNormals&&(ie?(M=(Q=Ke[X].vertexNormals[$]).a,T=Q.b,C=Q.c):(T=M=Ke[X].faceNormals[$],C=M),(K=Ee[X])[de]=M.x,K[de+1]=M.y,K[de+2]=M.z,K[de+3]=T.x,K[de+4]=T.y,K[de+5]=T.z,K[de+6]=C.x,K[de+7]=C.y,K[de+8]=C.z),de+=9;for(o=0,a=je.length;o<a;o++)s=Ge[$=je[o]],g=Ye[X].vertices[s.a],v=Ye[X].vertices[s.b],y=Ye[X].vertices[s.c],x=Ye[X].vertices[s.d],(Y=Ae[X])[de]=g.x,Y[de+1]=g.y,Y[de+2]=g.z,Y[de+3]=v.x,Y[de+4]=v.y,Y[de+5]=v.z,Y[de+6]=y.x,Y[de+7]=y.y,Y[de+8]=y.z,Y[de+9]=x.x,Y[de+10]=x.y,Y[de+11]=x.z,n.morphNormals&&(ie?(M=(Q=Ke[X].vertexNormals[$]).a,T=Q.b,C=Q.c,A=Q.d):(T=M=Ke[X].faceNormals[$],C=M,A=M),(K=Ee[X])[de]=M.x,K[de+1]=M.y,K[de+2]=M.z,K[de+3]=T.x,K[de+4]=T.y,K[de+5]=T.z,K[de+6]=C.x,K[de+7]=C.y,K[de+8]=C.z,K[de+9]=A.x,K[de+10]=A.y,K[de+11]=A.z),de+=12;u.bindBuffer(u.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[X]),u.bufferData(u.ARRAY_BUFFER,Ae[X],r),n.morphNormals&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[X]),u.bufferData(u.ARRAY_BUFFER,Ee[X],r))}if(qe.length){for(o=0,a=Ie.length;o<a;o++)F=qe[(s=Ge[Ie[o]]).a],O=qe[s.b],U=qe[s.c],Ce[pe]=F.x,Ce[pe+1]=F.y,Ce[pe+2]=F.z,Ce[pe+3]=F.w,Ce[pe+4]=O.x,Ce[pe+5]=O.y,Ce[pe+6]=O.z,Ce[pe+7]=O.w,Ce[pe+8]=U.x,Ce[pe+9]=U.y,Ce[pe+10]=U.z,Ce[pe+11]=U.w,V=Xe[s.a],k=Xe[s.b],z=Xe[s.c],Se[pe]=V.x,Se[pe+1]=V.y,Se[pe+2]=V.z,Se[pe+3]=V.w,Se[pe+4]=k.x,Se[pe+5]=k.y,Se[pe+6]=k.z,Se[pe+7]=k.w,Se[pe+8]=z.x,Se[pe+9]=z.y,Se[pe+10]=z.z,Se[pe+11]=z.w,pe+=12;for(o=0,a=je.length;o<a;o++)F=qe[(s=Ge[je[o]]).a],O=qe[s.b],U=qe[s.c],N=qe[s.d],Ce[pe]=F.x,Ce[pe+1]=F.y,Ce[pe+2]=F.z,Ce[pe+3]=F.w,Ce[pe+4]=O.x,Ce[pe+5]=O.y,Ce[pe+6]=O.z,Ce[pe+7]=O.w,Ce[pe+8]=U.x,Ce[pe+9]=U.y,Ce[pe+10]=U.z,Ce[pe+11]=U.w,Ce[pe+12]=N.x,Ce[pe+13]=N.y,Ce[pe+14]=N.z,Ce[pe+15]=N.w,V=Xe[s.a],k=Xe[s.b],z=Xe[s.c],B=Xe[s.d],Se[pe]=V.x,Se[pe+1]=V.y,Se[pe+2]=V.z,Se[pe+3]=V.w,Se[pe+4]=k.x,Se[pe+5]=k.y,Se[pe+6]=k.z,Se[pe+7]=k.w,Se[pe+8]=z.x,Se[pe+9]=z.y,Se[pe+10]=z.z,Se[pe+11]=z.w,Se[pe+12]=B.x,Se[pe+13]=B.y,Se[pe+14]=B.z,Se[pe+15]=B.w,pe+=16;pe>0&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),u.bufferData(u.ARRAY_BUFFER,Se,r),u.bindBuffer(u.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),u.bufferData(u.ARRAY_BUFFER,Ce,r))}if(ke&&te){for(o=0,a=Ie.length;o<a;o++)h=(s=Ge[Ie[o]]).vertexColors,f=s.color,3===h.length&&te===D.VertexColors?(E=h[0],L=h[1],P=h[2]):(E=f,L=f,P=f),we[fe]=E.r,we[fe+1]=E.g,we[fe+2]=E.b,we[fe+3]=L.r,we[fe+4]=L.g,we[fe+5]=L.b,we[fe+6]=P.r,we[fe+7]=P.g,we[fe+8]=P.b,fe+=9;for(o=0,a=je.length;o<a;o++)h=(s=Ge[je[o]]).vertexColors,f=s.color,4===h.length&&te===D.VertexColors?(E=h[0],L=h[1],P=h[2],R=h[3]):(E=f,L=f,P=f,R=f),we[fe]=E.r,we[fe+1]=E.g,we[fe+2]=E.b,we[fe+3]=L.r,we[fe+4]=L.g,we[fe+5]=L.b,we[fe+6]=P.r,we[fe+7]=P.g,we[fe+8]=P.b,we[fe+9]=R.r,we[fe+10]=R.g,we[fe+11]=R.b,fe+=12;fe>0&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglColorBuffer),u.bufferData(u.ARRAY_BUFFER,we,r))}if(Ve&&Re.hasTangents){for(o=0,a=Ie.length;o<a;o++)b=(p=(s=Ge[Ie[o]]).vertexTangents)[0],w=p[1],S=p[2],be[ue]=b.x,be[ue+1]=b.y,be[ue+2]=b.z,be[ue+3]=b.w,be[ue+4]=w.x,be[ue+5]=w.y,be[ue+6]=w.z,be[ue+7]=w.w,be[ue+8]=S.x,be[ue+9]=S.y,be[ue+10]=S.z,be[ue+11]=S.w,ue+=12;for(o=0,a=je.length;o<a;o++)b=(p=(s=Ge[je[o]]).vertexTangents)[0],w=p[1],S=p[2],_=p[3],be[ue]=b.x,be[ue+1]=b.y,be[ue+2]=b.z,be[ue+3]=b.w,be[ue+4]=w.x,be[ue+5]=w.y,be[ue+6]=w.z,be[ue+7]=w.w,be[ue+8]=S.x,be[ue+9]=S.y,be[ue+10]=S.z,be[ue+11]=S.w,be[ue+12]=_.x,be[ue+13]=_.y,be[ue+14]=_.z,be[ue+15]=_.w,ue+=16;u.bindBuffer(u.ARRAY_BUFFER,e.__webglTangentBuffer),u.bufferData(u.ARRAY_BUFFER,be,r)}if(Ne&&ee){for(o=0,a=Ie.length;o<a;o++)if(l=(s=Ge[Ie[o]]).vertexNormals,c=s.normal,3===l.length&&ie)for(I=0;I<3;I++)G=l[I],xe[ce]=G.x,xe[ce+1]=G.y,xe[ce+2]=G.z,ce+=3;else for(I=0;I<3;I++)xe[ce]=c.x,xe[ce+1]=c.y,xe[ce+2]=c.z,ce+=3;for(o=0,a=je.length;o<a;o++)if(l=(s=Ge[je[o]]).vertexNormals,c=s.normal,4===l.length&&ie)for(I=0;I<4;I++)G=l[I],xe[ce]=G.x,xe[ce+1]=G.y,xe[ce+2]=G.z,ce+=3;else for(I=0;I<4;I++)xe[ce]=c.x,xe[ce+1]=c.y,xe[ce+2]=c.z,ce+=3;u.bindBuffer(u.ARRAY_BUFFER,e.__webglNormalBuffer),u.bufferData(u.ARRAY_BUFFER,xe,r)}if(Ue&&He&&re){for(o=0,a=Ie.length;o<a;o++)if(void 0!==(d=He[Ie[o]]))for(I=0;I<3;I++)H=d[I],ve[ae]=H.x,ve[ae+1]=H.y,ae+=2;for(o=0,a=je.length;o<a;o++)if(void 0!==(d=He[je[o]]))for(I=0;I<4;I++)H=d[I],ve[ae]=H.x,ve[ae+1]=H.y,ae+=2;ae>0&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglUVBuffer),u.bufferData(u.ARRAY_BUFFER,ve,r))}if(Ue&&We&&re){for(o=0,a=Ie.length;o<a;o++)if(void 0!==(m=We[Ie[o]]))for(I=0;I<3;I++)W=m[I],ye[se]=W.x,ye[se+1]=W.y,se+=2;for(o=0,a=je.length;o<a;o++)if(void 0!==(m=We[je[o]]))for(I=0;I<4;I++)W=m[I],ye[se]=W.x,ye[se+1]=W.y,se+=2;se>0&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglUV2Buffer),u.bufferData(u.ARRAY_BUFFER,ye,r))}if(Oe){for(o=0,a=Ie.length;o<a;o++)Le[le]=ne,Le[le+1]=ne+1,Le[le+2]=ne+2,le+=3,Pe[he]=ne,Pe[he+1]=ne+1,Pe[he+2]=ne,Pe[he+3]=ne+2,Pe[he+4]=ne+1,Pe[he+5]=ne+2,he+=6,ne+=3;for(o=0,a=je.length;o<a;o++)Le[le]=ne,Le[le+1]=ne+1,Le[le+2]=ne+3,Le[le+3]=ne+1,Le[le+4]=ne+2,Le[le+5]=ne+3,le+=6,Pe[he]=ne,Pe[he+1]=ne+1,Pe[he+2]=ne,Pe[he+3]=ne+3,Pe[he+4]=ne+1,Pe[he+5]=ne+2,Pe[he+6]=ne+2,Pe[he+7]=ne+3,he+=8,ne+=4;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,Le,r),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,Pe,r)}if(De)for(I=0,j=De.length;I<j;I++)if((J=De[I]).__original.needsUpdate){if(me=0,0,1===J.size){if(void 0===J.boundTo||"vertices"===J.boundTo){for(o=0,a=Ie.length;o<a;o++)s=Ge[Ie[o]],J.array[me]=J.value[s.a],J.array[me+1]=J.value[s.b],J.array[me+2]=J.value[s.c],me+=3;for(o=0,a=je.length;o<a;o++)s=Ge[je[o]],J.array[me]=J.value[s.a],J.array[me+1]=J.value[s.b],J.array[me+2]=J.value[s.c],J.array[me+3]=J.value[s.d],me+=4}else if("faces"===J.boundTo){for(o=0,a=Ie.length;o<a;o++)Z=J.value[Ie[o]],J.array[me]=Z,J.array[me+1]=Z,J.array[me+2]=Z,me+=3;for(o=0,a=je.length;o<a;o++)Z=J.value[je[o]],J.array[me]=Z,J.array[me+1]=Z,J.array[me+2]=Z,J.array[me+3]=Z,me+=4}}else if(2===J.size){if(void 0===J.boundTo||"vertices"===J.boundTo){for(o=0,a=Ie.length;o<a;o++)s=Ge[Ie[o]],g=J.value[s.a],v=J.value[s.b],y=J.value[s.c],J.array[me]=g.x,J.array[me+1]=g.y,J.array[me+2]=v.x,J.array[me+3]=v.y,J.array[me+4]=y.x,J.array[me+5]=y.y,me+=6;for(o=0,a=je.length;o<a;o++)s=Ge[je[o]],g=J.value[s.a],v=J.value[s.b],y=J.value[s.c],x=J.value[s.d],J.array[me]=g.x,J.array[me+1]=g.y,J.array[me+2]=v.x,J.array[me+3]=v.y,J.array[me+4]=y.x,J.array[me+5]=y.y,J.array[me+6]=x.x,J.array[me+7]=x.y,me+=8}else if("faces"===J.boundTo){for(o=0,a=Ie.length;o<a;o++)g=Z=J.value[Ie[o]],v=Z,y=Z,J.array[me]=g.x,J.array[me+1]=g.y,J.array[me+2]=v.x,J.array[me+3]=v.y,J.array[me+4]=y.x,J.array[me+5]=y.y,me+=6;for(o=0,a=je.length;o<a;o++)g=Z=J.value[je[o]],v=Z,y=Z,x=Z,J.array[me]=g.x,J.array[me+1]=g.y,J.array[me+2]=v.x,J.array[me+3]=v.y,J.array[me+4]=y.x,J.array[me+5]=y.y,J.array[me+6]=x.x,J.array[me+7]=x.y,me+=8}}else if(3===J.size){var $e;if($e="c"===J.type?["r","g","b"]:["x","y","z"],void 0===J.boundTo||"vertices"===J.boundTo){for(o=0,a=Ie.length;o<a;o++)s=Ge[Ie[o]],g=J.value[s.a],v=J.value[s.b],y=J.value[s.c],J.array[me]=g[$e[0]],J.array[me+1]=g[$e[1]],J.array[me+2]=g[$e[2]],J.array[me+3]=v[$e[0]],J.array[me+4]=v[$e[1]],J.array[me+5]=v[$e[2]],J.array[me+6]=y[$e[0]],J.array[me+7]=y[$e[1]],J.array[me+8]=y[$e[2]],me+=9;for(o=0,a=je.length;o<a;o++)s=Ge[je[o]],g=J.value[s.a],v=J.value[s.b],y=J.value[s.c],x=J.value[s.d],J.array[me]=g[$e[0]],J.array[me+1]=g[$e[1]],J.array[me+2]=g[$e[2]],J.array[me+3]=v[$e[0]],J.array[me+4]=v[$e[1]],J.array[me+5]=v[$e[2]],J.array[me+6]=y[$e[0]],J.array[me+7]=y[$e[1]],J.array[me+8]=y[$e[2]],J.array[me+9]=x[$e[0]],J.array[me+10]=x[$e[1]],J.array[me+11]=x[$e[2]],me+=12}else if("faces"===J.boundTo){for(o=0,a=Ie.length;o<a;o++)g=Z=J.value[Ie[o]],v=Z,y=Z,J.array[me]=g[$e[0]],J.array[me+1]=g[$e[1]],J.array[me+2]=g[$e[2]],J.array[me+3]=v[$e[0]],J.array[me+4]=v[$e[1]],J.array[me+5]=v[$e[2]],J.array[me+6]=y[$e[0]],J.array[me+7]=y[$e[1]],J.array[me+8]=y[$e[2]],me+=9;for(o=0,a=je.length;o<a;o++)g=Z=J.value[je[o]],v=Z,y=Z,x=Z,J.array[me]=g[$e[0]],J.array[me+1]=g[$e[1]],J.array[me+2]=g[$e[2]],J.array[me+3]=v[$e[0]],J.array[me+4]=v[$e[1]],J.array[me+5]=v[$e[2]],J.array[me+6]=y[$e[0]],J.array[me+7]=y[$e[1]],J.array[me+8]=y[$e[2]],J.array[me+9]=x[$e[0]],J.array[me+10]=x[$e[1]],J.array[me+11]=x[$e[2]],me+=12}else if("faceVertices"===J.boundTo){for(o=0,a=Ie.length;o<a;o++)g=(Z=J.value[Ie[o]])[0],v=Z[1],y=Z[2],J.array[me]=g[$e[0]],J.array[me+1]=g[$e[1]],J.array[me+2]=g[$e[2]],J.array[me+3]=v[$e[0]],J.array[me+4]=v[$e[1]],J.array[me+5]=v[$e[2]],J.array[me+6]=y[$e[0]],J.array[me+7]=y[$e[1]],J.array[me+8]=y[$e[2]],me+=9;for(o=0,a=je.length;o<a;o++)g=(Z=J.value[je[o]])[0],v=Z[1],y=Z[2],x=Z[3],J.array[me]=g[$e[0]],J.array[me+1]=g[$e[1]],J.array[me+2]=g[$e[2]],J.array[me+3]=v[$e[0]],J.array[me+4]=v[$e[1]],J.array[me+5]=v[$e[2]],J.array[me+6]=y[$e[0]],J.array[me+7]=y[$e[1]],J.array[me+8]=y[$e[2]],J.array[me+9]=x[$e[0]],J.array[me+10]=x[$e[1]],J.array[me+11]=x[$e[2]],me+=12}}else if(4===J.size)if(void 0===J.boundTo||"vertices"===J.boundTo){for(o=0,a=Ie.length;o<a;o++)s=Ge[Ie[o]],g=J.value[s.a],v=J.value[s.b],y=J.value[s.c],J.array[me]=g.x,J.array[me+1]=g.y,J.array[me+2]=g.z,J.array[me+3]=g.w,J.array[me+4]=v.x,J.array[me+5]=v.y,J.array[me+6]=v.z,J.array[me+7]=v.w,J.array[me+8]=y.x,J.array[me+9]=y.y,J.array[me+10]=y.z,J.array[me+11]=y.w,me+=12;for(o=0,a=je.length;o<a;o++)s=Ge[je[o]],g=J.value[s.a],v=J.value[s.b],y=J.value[s.c],x=J.value[s.d],J.array[me]=g.x,J.array[me+1]=g.y,J.array[me+2]=g.z,J.array[me+3]=g.w,J.array[me+4]=v.x,J.array[me+5]=v.y,J.array[me+6]=v.z,J.array[me+7]=v.w,J.array[me+8]=y.x,J.array[me+9]=y.y,J.array[me+10]=y.z,J.array[me+11]=y.w,J.array[me+12]=x.x,J.array[me+13]=x.y,J.array[me+14]=x.z,J.array[me+15]=x.w,me+=16}else if("faces"===J.boundTo){for(o=0,a=Ie.length;o<a;o++)g=Z=J.value[Ie[o]],v=Z,y=Z,J.array[me]=g.x,J.array[me+1]=g.y,J.array[me+2]=g.z,J.array[me+3]=g.w,J.array[me+4]=v.x,J.array[me+5]=v.y,J.array[me+6]=v.z,J.array[me+7]=v.w,J.array[me+8]=y.x,J.array[me+9]=y.y,J.array[me+10]=y.z,J.array[me+11]=y.w,me+=12;for(o=0,a=je.length;o<a;o++)g=Z=J.value[je[o]],v=Z,y=Z,x=Z,J.array[me]=g.x,J.array[me+1]=g.y,J.array[me+2]=g.z,J.array[me+3]=g.w,J.array[me+4]=v.x,J.array[me+5]=v.y,J.array[me+6]=v.z,J.array[me+7]=v.w,J.array[me+8]=y.x,J.array[me+9]=y.y,J.array[me+10]=y.z,J.array[me+11]=y.w,J.array[me+12]=x.x,J.array[me+13]=x.y,J.array[me+14]=x.z,J.array[me+15]=x.w,me+=16}else if("faceVertices"===J.boundTo){for(o=0,a=Ie.length;o<a;o++)g=(Z=J.value[Ie[o]])[0],v=Z[1],y=Z[2],J.array[me]=g.x,J.array[me+1]=g.y,J.array[me+2]=g.z,J.array[me+3]=g.w,J.array[me+4]=v.x,J.array[me+5]=v.y,J.array[me+6]=v.z,J.array[me+7]=v.w,J.array[me+8]=y.x,J.array[me+9]=y.y,J.array[me+10]=y.z,J.array[me+11]=y.w,me+=12;for(o=0,a=je.length;o<a;o++)g=(Z=J.value[je[o]])[0],v=Z[1],y=Z[2],x=Z[3],J.array[me]=g.x,J.array[me+1]=g.y,J.array[me+2]=g.z,J.array[me+3]=g.w,J.array[me+4]=v.x,J.array[me+5]=v.y,J.array[me+6]=v.z,J.array[me+7]=v.w,J.array[me+8]=y.x,J.array[me+9]=y.y,J.array[me+10]=y.z,J.array[me+11]=y.w,J.array[me+12]=x.x,J.array[me+13]=x.y,J.array[me+14]=x.z,J.array[me+15]=x.w,me+=16}u.bindBuffer(u.ARRAY_BUFFER,J.buffer),u.bufferData(u.ARRAY_BUFFER,J.array,r)}i&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function Ae(e){H[e]||(u.enableVertexAttribArray(e),H[e]=!0)}function Ee(){for(var e in H)H[e]&&(u.disableVertexAttribArray(e),H[e]=!1)}function De(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function Le(e,t){return t[0]-e[0]}function Pe(e,t,r){if(e.length)for(var i=0,n=e.length;i<n;i++)y=null,S=null,A=-1,R=-1,F=-1,T=-1,C=-1,w=-1,b=-1,$=!0,e[i].render(t,r,j,G),y=null,S=null,A=-1,R=-1,F=-1,T=-1,C=-1,w=-1,b=-1,$=!0}function Re(e,t,r,i,n,o,a,s){var l,c,u,h,f,p,d;t?(f=e.length-1,p=-1,d=-1):(f=0,p=e.length,d=1);for(var g=f;g!==p;g+=d)if((l=e[g]).render){if(c=l.object,u=l.buffer,s)h=s;else{if(!(h=l[r]))continue;a&&m.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst),m.setDepthTest(h.depthTest),m.setDepthWrite(h.depthWrite),Qe(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}m.setMaterialFaces(h),u instanceof D.BufferGeometry?m.renderBufferDirect(i,n,o,h,u,c):m.renderBuffer(i,n,o,h,u,c)}}function Fe(e,t,r,i,n,o,a){for(var s,l,c,u=0,h=e.length;u<h;u++)if((l=(s=e[u]).object).visible){if(a)c=a;else{if(!(c=s[t]))continue;o&&m.setBlending(c.blending,c.blendEquation,c.blendSrc,c.blendDst),m.setDepthTest(c.depthTest),m.setDepthWrite(c.depthWrite),Qe(c.polygonOffset,c.polygonOffsetFactor,c.polygonOffsetUnits)}m.renderImmediateObject(r,i,n,c,l)}}function Oe(e){var t=e.object.material;t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)}function Ue(e){var t,r,i,n=e.object,o=e.buffer;(i=n.material)instanceof D.MeshFaceMaterial?(r=o.materialIndex,(t=i.materials[r]).transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)):(t=i)&&(t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null))}function Ne(e,t){var r,i,n,o;if(void 0===e.__webglInit)if(e.__webglInit=!0,e._modelViewMatrix=new D.Matrix4,e._normalMatrix=new D.Matrix3,void 0!==e.geometry&&void 0===e.geometry.__webglInit&&(e.geometry.__webglInit=!0,e.geometry.addEventListener("dispose",he)),void 0===(i=e.geometry));else if(i instanceof D.BufferGeometry)!function(e){var t,r,i;for(t in e.attributes)i="index"===t?u.ELEMENT_ARRAY_BUFFER:u.ARRAY_BUFFER,(r=e.attributes[t]).buffer=u.createBuffer(),u.bindBuffer(i,r.buffer),u.bufferData(i,r.array,u.STATIC_DRAW)}(i);else if(e instanceof D.Mesh)for(r in n=e.material,void 0===i.geometryGroups&&function(e,t){var r,i,n,o,a,s,l={},c=e.morphTargets.length,u=e.morphNormals.length,h=t instanceof D.MeshFaceMaterial;for(e.geometryGroups={},r=0,i=e.faces.length;r<i;r++)n=e.faces[r],void 0===l[o=h?n.materialIndex:0]&&(l[o]={hash:o,counter:0}),s=l[o].hash+"_"+l[o].counter,void 0===e.geometryGroups[s]&&(e.geometryGroups[s]={faces3:[],faces4:[],materialIndex:o,vertices:0,numMorphTargets:c,numMorphNormals:u}),a=n instanceof D.Face3?3:4,e.geometryGroups[s].vertices+a>65535&&(l[o].counter+=1,s=l[o].hash+"_"+l[o].counter,void 0===e.geometryGroups[s]&&(e.geometryGroups[s]={faces3:[],faces4:[],materialIndex:o,vertices:0,numMorphTargets:c,numMorphNormals:u})),n instanceof D.Face3?e.geometryGroups[s].faces3.push(r):e.geometryGroups[s].faces4.push(r),e.geometryGroups[s].vertices+=a;for(var f in e.geometryGroupsList=[],e.geometryGroups)e.geometryGroups[f].id=_++,e.geometryGroupsList.push(e.geometryGroups[f])}(i,n),i.geometryGroups)(o=i.geometryGroups[r]).__webglVertexBuffer||(ue(o),we(o,e),i.verticesNeedUpdate=!0,i.morphTargetsNeedUpdate=!0,i.elementsNeedUpdate=!0,i.uvsNeedUpdate=!0,i.normalsNeedUpdate=!0,i.tangentsNeedUpdate=!0,i.colorsNeedUpdate=!0);else e instanceof D.Ribbon?i.__webglVertexBuffer||(!function(e){e.__webglVertexBuffer=u.createBuffer(),e.__webglColorBuffer=u.createBuffer(),e.__webglNormalBuffer=u.createBuffer(),m.info.memory.geometries++}(i),function(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__normalArray=new Float32Array(3*r),e.__webglVertexCount=r,be(e,t)}(i,e),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0,i.normalsNeedUpdate=!0):e instanceof D.Line?i.__webglVertexBuffer||(!function(e){e.__webglVertexBuffer=u.createBuffer(),e.__webglColorBuffer=u.createBuffer(),e.__webglLineDistanceBuffer=u.createBuffer(),m.info.memory.geometries++}(i),function(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__lineDistanceArray=new Float32Array(1*r),e.__webglLineCount=r,be(e,t)}(i,e),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0,i.lineDistancesNeedUpdate=!0):e instanceof D.ParticleSystem&&(i.__webglVertexBuffer||(!function(e){e.__webglVertexBuffer=u.createBuffer(),e.__webglColorBuffer=u.createBuffer(),m.info.memory.geometries++}(i),function(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__sortArray=[],e.__webglParticleCount=r,be(e,t)}(i,e),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0));if(void 0===e.__webglActive){if(e instanceof D.Mesh){if((i=e.geometry)instanceof D.BufferGeometry)Ve(t.__webglObjects,i,e);else if(i instanceof D.Geometry)for(r in i.geometryGroups)o=i.geometryGroups[r],Ve(t.__webglObjects,o,e)}else e instanceof D.Ribbon||e instanceof D.Line||e instanceof D.ParticleSystem?(i=e.geometry,Ve(t.__webglObjects,i,e)):e instanceof D.ImmediateRenderObject||e.immediateRenderCallback?function(e,t){e.push({object:t,opaque:null,transparent:null})}(t.__webglObjectsImmediate,e):e instanceof D.Sprite?t.__webglSprites.push(e):e instanceof D.LensFlare&&t.__webglFlares.push(e);e.__webglActive=!0}}function Ve(e,t,r){e.push({buffer:t,object:r,opaque:null,transparent:null})}function ke(e){var t,r,i,n=e.geometry;if(n instanceof D.BufferGeometry)!function(e,t,r){var i,n,o=e.attributes;for(i in o)(n=o[i]).needsUpdate&&("index"===i?(u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,n.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,n.array,t)):(u.bindBuffer(u.ARRAY_BUFFER,n.buffer),u.bufferData(u.ARRAY_BUFFER,n.array,t)),n.needsUpdate=!1),r&&!n.dynamic&&delete n.array}(n,u.DYNAMIC_DRAW,!n.dynamic);else if(e instanceof D.Mesh){for(var o=0,a=n.geometryGroupsList.length;o<a;o++)i=Se(e,t=n.geometryGroupsList[o]),n.buffersNeedUpdate&&we(t,e),r=i.attributes&&ze(i),(n.verticesNeedUpdate||n.morphTargetsNeedUpdate||n.elementsNeedUpdate||n.uvsNeedUpdate||n.normalsNeedUpdate||n.colorsNeedUpdate||n.tangentsNeedUpdate||r)&&Ce(t,e,u.DYNAMIC_DRAW,!n.dynamic,i);n.verticesNeedUpdate=!1,n.morphTargetsNeedUpdate=!1,n.elementsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.tangentsNeedUpdate=!1,n.buffersNeedUpdate=!1,i.attributes&&Be(i)}else e instanceof D.Ribbon?(r=(i=Se(e,n)).attributes&&ze(i),(n.verticesNeedUpdate||n.colorsNeedUpdate||n.normalsNeedUpdate||r)&&function(e,t){var r,i,n,o,a,s,l,c,h,f,p,d,m,g=e.vertices,v=e.colors,y=e.normals,x=g.length,b=v.length,w=y.length,S=e.__vertexArray,_=e.__colorArray,M=e.__normalArray,T=e.verticesNeedUpdate,C=e.colorsNeedUpdate,A=e.normalsNeedUpdate,E=e.__webglCustomAttributesList;if(T){for(r=0;r<x;r++)o=g[r],S[a=3*r]=o.x,S[a+1]=o.y,S[a+2]=o.z;u.bindBuffer(u.ARRAY_BUFFER,e.__webglVertexBuffer),u.bufferData(u.ARRAY_BUFFER,S,t)}if(C){for(i=0;i<b;i++)s=v[i],_[a=3*i]=s.r,_[a+1]=s.g,_[a+2]=s.b;u.bindBuffer(u.ARRAY_BUFFER,e.__webglColorBuffer),u.bufferData(u.ARRAY_BUFFER,_,t)}if(A){for(n=0;n<w;n++)l=y[n],M[a=3*n]=l.x,M[a+1]=l.y,M[a+2]=l.z;u.bindBuffer(u.ARRAY_BUFFER,e.__webglNormalBuffer),u.bufferData(u.ARRAY_BUFFER,M,t)}if(E)for(c=0,h=E.length;c<h;c++)if((d=E[c]).needsUpdate&&(void 0===d.boundTo||"vertices"===d.boundTo)){if(a=0,p=d.value.length,1===d.size)for(f=0;f<p;f++)d.array[f]=d.value[f];else if(2===d.size)for(f=0;f<p;f++)m=d.value[f],d.array[a]=m.x,d.array[a+1]=m.y,a+=2;else if(3===d.size)if("c"===d.type)for(f=0;f<p;f++)m=d.value[f],d.array[a]=m.r,d.array[a+1]=m.g,d.array[a+2]=m.b,a+=3;else for(f=0;f<p;f++)m=d.value[f],d.array[a]=m.x,d.array[a+1]=m.y,d.array[a+2]=m.z,a+=3;else if(4===d.size)for(f=0;f<p;f++)m=d.value[f],d.array[a]=m.x,d.array[a+1]=m.y,d.array[a+2]=m.z,d.array[a+3]=m.w,a+=4;u.bindBuffer(u.ARRAY_BUFFER,d.buffer),u.bufferData(u.ARRAY_BUFFER,d.array,t)}}(n,u.DYNAMIC_DRAW),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1,n.normalsNeedUpdate=!1,i.attributes&&Be(i)):e instanceof D.Line?(r=(i=Se(e,n)).attributes&&ze(i),(n.verticesNeedUpdate||n.colorsNeedUpdate||n.lineDistancesNeedUpdate||r)&&function(e,t){var r,i,n,o,a,s,l,c,h,f,p,d,m=e.vertices,g=e.colors,v=e.lineDistances,y=m.length,x=g.length,b=v.length,w=e.__vertexArray,S=e.__colorArray,_=e.__lineDistanceArray,M=e.verticesNeedUpdate,T=e.colorsNeedUpdate,C=e.lineDistancesNeedUpdate,A=e.__webglCustomAttributesList;if(M){for(r=0;r<y;r++)o=m[r],w[a=3*r]=o.x,w[a+1]=o.y,w[a+2]=o.z;u.bindBuffer(u.ARRAY_BUFFER,e.__webglVertexBuffer),u.bufferData(u.ARRAY_BUFFER,w,t)}if(T){for(i=0;i<x;i++)s=g[i],S[a=3*i]=s.r,S[a+1]=s.g,S[a+2]=s.b;u.bindBuffer(u.ARRAY_BUFFER,e.__webglColorBuffer),u.bufferData(u.ARRAY_BUFFER,S,t)}if(C){for(n=0;n<b;n++)_[n]=v[n];u.bindBuffer(u.ARRAY_BUFFER,e.__webglLineDistanceBuffer),u.bufferData(u.ARRAY_BUFFER,_,t)}if(A)for(l=0,c=A.length;l<c;l++)if((d=A[l]).needsUpdate&&(void 0===d.boundTo||"vertices"===d.boundTo)){if(a=0,f=d.value.length,1===d.size)for(h=0;h<f;h++)d.array[h]=d.value[h];else if(2===d.size)for(h=0;h<f;h++)p=d.value[h],d.array[a]=p.x,d.array[a+1]=p.y,a+=2;else if(3===d.size)if("c"===d.type)for(h=0;h<f;h++)p=d.value[h],d.array[a]=p.r,d.array[a+1]=p.g,d.array[a+2]=p.b,a+=3;else for(h=0;h<f;h++)p=d.value[h],d.array[a]=p.x,d.array[a+1]=p.y,d.array[a+2]=p.z,a+=3;else if(4===d.size)for(h=0;h<f;h++)p=d.value[h],d.array[a]=p.x,d.array[a+1]=p.y,d.array[a+2]=p.z,d.array[a+3]=p.w,a+=4;u.bindBuffer(u.ARRAY_BUFFER,d.buffer),u.bufferData(u.ARRAY_BUFFER,d.array,t)}}(n,u.DYNAMIC_DRAW),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1,n.lineDistancesNeedUpdate=!1,i.attributes&&Be(i)):e instanceof D.ParticleSystem&&(r=(i=Se(e,n)).attributes&&ze(i),(n.verticesNeedUpdate||n.colorsNeedUpdate||e.sortParticles||r)&&function(e,t,r){var i,n,o,a,s,l,c,h,f,p,d,m,g=e.vertices,v=g.length,y=e.colors,x=y.length,b=e.__vertexArray,w=e.__colorArray,S=e.__sortArray,_=e.verticesNeedUpdate,M=(e.elementsNeedUpdate,e.colorsNeedUpdate),T=e.__webglCustomAttributesList;if(r.sortParticles){for(q.copy(X),q.multiply(r.matrixWorld),i=0;i<v;i++)o=g[i],Y.copy(o),Y.applyProjection(q),S[i]=[Y.z,i];for(S.sort(Le),i=0;i<v;i++)o=g[S[i][1]],b[a=3*i]=o.x,b[a+1]=o.y,b[a+2]=o.z;for(n=0;n<x;n++)a=3*n,l=y[S[n][1]],w[a]=l.r,w[a+1]=l.g,w[a+2]=l.b;if(T)for(c=0,h=T.length;c<h;c++)if(void 0===(m=T[c]).boundTo||"vertices"===m.boundTo)if(a=0,p=m.value.length,1===m.size)for(f=0;f<p;f++)s=S[f][1],m.array[f]=m.value[s];else if(2===m.size)for(f=0;f<p;f++)s=S[f][1],d=m.value[s],m.array[a]=d.x,m.array[a+1]=d.y,a+=2;else if(3===m.size)if("c"===m.type)for(f=0;f<p;f++)s=S[f][1],d=m.value[s],m.array[a]=d.r,m.array[a+1]=d.g,m.array[a+2]=d.b,a+=3;else for(f=0;f<p;f++)s=S[f][1],d=m.value[s],m.array[a]=d.x,m.array[a+1]=d.y,m.array[a+2]=d.z,a+=3;else if(4===m.size)for(f=0;f<p;f++)s=S[f][1],d=m.value[s],m.array[a]=d.x,m.array[a+1]=d.y,m.array[a+2]=d.z,m.array[a+3]=d.w,a+=4}else{if(_)for(i=0;i<v;i++)o=g[i],b[a=3*i]=o.x,b[a+1]=o.y,b[a+2]=o.z;if(M)for(n=0;n<x;n++)l=y[n],w[a=3*n]=l.r,w[a+1]=l.g,w[a+2]=l.b;if(T)for(c=0,h=T.length;c<h;c++)if((m=T[c]).needsUpdate&&(void 0===m.boundTo||"vertices"===m.boundTo))if(p=m.value.length,a=0,1===m.size)for(f=0;f<p;f++)m.array[f]=m.value[f];else if(2===m.size)for(f=0;f<p;f++)d=m.value[f],m.array[a]=d.x,m.array[a+1]=d.y,a+=2;else if(3===m.size)if("c"===m.type)for(f=0;f<p;f++)d=m.value[f],m.array[a]=d.r,m.array[a+1]=d.g,m.array[a+2]=d.b,a+=3;else for(f=0;f<p;f++)d=m.value[f],m.array[a]=d.x,m.array[a+1]=d.y,m.array[a+2]=d.z,a+=3;else if(4===m.size)for(f=0;f<p;f++)d=m.value[f],m.array[a]=d.x,m.array[a+1]=d.y,m.array[a+2]=d.z,m.array[a+3]=d.w,a+=4}if((_||r.sortParticles)&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglVertexBuffer),u.bufferData(u.ARRAY_BUFFER,b,t)),(M||r.sortParticles)&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglColorBuffer),u.bufferData(u.ARRAY_BUFFER,w,t)),T)for(c=0,h=T.length;c<h;c++)((m=T[c]).needsUpdate||r.sortParticles)&&(u.bindBuffer(u.ARRAY_BUFFER,m.buffer),u.bufferData(u.ARRAY_BUFFER,m.array,t))}(n,u.DYNAMIC_DRAW,e),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1,i.attributes&&Be(i))}function ze(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function Be(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function Ie(e,t){e instanceof D.Mesh||e instanceof D.ParticleSystem||e instanceof D.Ribbon||e instanceof D.Line?je(t.__webglObjects,e):e instanceof D.Sprite?Ge(t.__webglSprites,e):e instanceof D.LensFlare?Ge(t.__webglFlares,e):(e instanceof D.ImmediateRenderObject||e.immediateRenderCallback)&&je(t.__webglObjectsImmediate,e),delete e.__webglActive}function je(e,t){for(var r=e.length-1;r>=0;r--)e[r].object===t&&e.splice(r,1)}function Ge(e,t){for(var r=e.length-1;r>=0;r--)e[r]===t&&e.splice(r,1)}function He(e,r,i,n,o){M=0,n.needsUpdate&&(n.program&&ye(n),m.initMaterial(n,r,i,o),n.needsUpdate=!1),n.morphTargets&&(o.__webglMorphTargetInfluences||(o.__webglMorphTargetInfluences=new Float32Array(m.maxMorphTargets)));var a=!1,s=n.program,l=s.uniforms,c=n.uniforms;if(s!==y&&(u.useProgram(s),y=s,a=!0),n.id!==b&&(b=n.id,a=!0),(a||e!==S)&&(u.uniformMatrix4fv(l.projectionMatrix,!1,e.projectionMatrix.elements),e!==S&&(S=e)),n.skinning)if(ie&&o.useVertexTexture){if(null!==l.boneTexture){var h=Xe();u.uniform1i(l.boneTexture,h),m.setTexture(o.boneTexture,h)}}else null!==l.boneGlobalMatrices&&u.uniformMatrix4fv(l.boneGlobalMatrices,!1,o.boneMatrices);return a&&(i&&n.fog&&function(e,t){e.fogColor.value=t.color,t instanceof D.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof D.FogExp2&&(e.fogDensity.value=t.density)}(c,i),(n instanceof D.MeshPhongMaterial||n instanceof D.MeshLambertMaterial||n.lights)&&($&&(!function(e,t){var r,i,n,o,a,s,l,c,u,h=0,f=0,p=0,d=Q,g=d.directional.colors,v=d.directional.positions,y=d.point.colors,x=d.point.positions,b=d.point.distances,w=d.spot.colors,S=d.spot.positions,_=d.spot.distances,M=d.spot.directions,T=d.spot.anglesCos,C=d.spot.exponents,A=d.hemi.skyColors,E=d.hemi.groundColors,L=d.hemi.positions,P=0,R=0,F=0,O=0,U=0,N=0,V=0,k=0,z=0,B=0,I=0,j=0;for(r=0,i=t.length;r<i;r++)if(!(n=t[r]).onlyShadow)if(o=n.color,l=n.intensity,u=n.distance,n instanceof D.AmbientLight){if(!n.visible)continue;m.gammaInput?(h+=o.r*o.r,f+=o.g*o.g,p+=o.b*o.b):(h+=o.r,f+=o.g,p+=o.b)}else if(n instanceof D.DirectionalLight){if(U+=1,!n.visible)continue;if(K.getPositionFromMatrix(n.matrixWorld),Y.getPositionFromMatrix(n.target.matrixWorld),K.sub(Y),K.normalize(),0===K.x&&0===K.y&&0===K.z)continue;v[z=3*P]=K.x,v[z+1]=K.y,v[z+2]=K.z,m.gammaInput?Ye(g,z,o,l*l):Ke(g,z,o,l),P+=1}else if(n instanceof D.PointLight){if(N+=1,!n.visible)continue;B=3*R,m.gammaInput?Ye(y,B,o,l*l):Ke(y,B,o,l),Y.getPositionFromMatrix(n.matrixWorld),x[B]=Y.x,x[B+1]=Y.y,x[B+2]=Y.z,b[R]=u,R+=1}else if(n instanceof D.SpotLight){if(V+=1,!n.visible)continue;I=3*F,m.gammaInput?Ye(w,I,o,l*l):Ke(w,I,o,l),Y.getPositionFromMatrix(n.matrixWorld),S[I]=Y.x,S[I+1]=Y.y,S[I+2]=Y.z,_[F]=u,K.copy(Y),Y.getPositionFromMatrix(n.target.matrixWorld),K.sub(Y),K.normalize(),M[I]=K.x,M[I+1]=K.y,M[I+2]=K.z,T[F]=Math.cos(n.angle),C[F]=n.exponent,F+=1}else if(n instanceof D.HemisphereLight){if(k+=1,!n.visible)continue;if(K.getPositionFromMatrix(n.matrixWorld),K.normalize(),0===K.x&&0===K.y&&0===K.z)continue;L[j=3*O]=K.x,L[j+1]=K.y,L[j+2]=K.z,a=n.color,s=n.groundColor,m.gammaInput?(Ye(A,j,a,c=l*l),Ye(E,j,s,c)):(Ke(A,j,a,l),Ke(E,j,s,l)),O+=1}for(r=3*P,i=Math.max(g.length,3*U);r<i;r++)g[r]=0;for(r=3*R,i=Math.max(y.length,3*N);r<i;r++)y[r]=0;for(r=3*F,i=Math.max(w.length,3*V);r<i;r++)w[r]=0;for(r=3*O,i=Math.max(A.length,3*k);r<i;r++)A[r]=0;for(r=3*O,i=Math.max(E.length,3*k);r<i;r++)E[r]=0;d.directional.length=P,d.point.length=R,d.spot.length=F,d.hemi.length=O,d.ambient[0]=h,d.ambient[1]=f,d.ambient[2]=p}(0,r),$=!1),function(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}(c,Q)),(n instanceof D.MeshBasicMaterial||n instanceof D.MeshLambertMaterial||n instanceof D.MeshPhongMaterial)&&function(e,t){e.opacity.value=t.opacity,m.gammaInput?e.diffuse.value.copyGammaToLinear(t.color):e.diffuse.value=t.color;e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale);t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var r;t.map?r=t.map:t.specularMap?r=t.specularMap:t.normalMap?r=t.normalMap:t.bumpMap&&(r=t.bumpMap);if(void 0!==r){var i=r.offset,n=r.repeat;e.offsetRepeat.value.set(i.x,i.y,n.x,n.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof D.WebGLRenderTargetCube?1:-1,m.gammaInput,e.reflectivity.value=t.reflectivity;e.refractionRatio.value=t.refractionRatio,e.combine.value=t.combine,e.useRefract.value=t.envMap&&t.envMap.mapping instanceof D.CubeRefractionMapping}(c,n),n instanceof D.LineBasicMaterial?We(c,n):n instanceof D.LineDashedMaterial?(We(c,n),function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(c,n)):n instanceof D.ParticleBasicMaterial?function(e,r){e.psColor.value=r.color,e.opacity.value=r.opacity,e.size.value=r.size,e.scale.value=t.height/2,e.map.value=r.map}(c,n):n instanceof D.MeshPhongMaterial?function(e,t){e.shininess.value=t.shininess,m.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive),e.specular.value.copyGammaToLinear(t.specular)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.specular.value=t.specular);t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(c,n):n instanceof D.MeshLambertMaterial?function(e,t){m.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive);t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(c,n):n instanceof D.MeshDepthMaterial?(c.mNear.value=e.near,c.mFar.value=e.far,c.opacity.value=n.opacity):n instanceof D.MeshNormalMaterial&&(c.opacity.value=n.opacity),o.receiveShadow&&!n._shadowPass&&function(e,t){if(e.shadowMatrix)for(var r=0,i=0,n=t.length;i<n;i++){var o=t[i];o.castShadow&&((o instanceof D.SpotLight||o instanceof D.DirectionalLight&&!o.shadowCascade)&&(e.shadowMap.value[r]=o.shadowMap,e.shadowMapSize.value[r]=o.shadowMapSize,e.shadowMatrix.value[r]=o.shadowMatrix,e.shadowDarkness.value[r]=o.shadowDarkness,e.shadowBias.value[r]=o.shadowBias,r++))}}(c,r),function(e,t){var r,i,n,o,a,s,l,c,h,f,p;for(h=0,f=t.length;h<f;h++)if(o=e.uniforms[t[h][1]])if(r=t[h][0],n=r.type,i=r.value,"i"===n)u.uniform1i(o,i);else if("f"===n)u.uniform1f(o,i);else if("v2"===n)u.uniform2f(o,i.x,i.y);else if("v3"===n)u.uniform3f(o,i.x,i.y,i.z);else if("v4"===n)u.uniform4f(o,i.x,i.y,i.z,i.w);else if("c"===n)u.uniform3f(o,i.r,i.g,i.b);else if("iv1"===n)u.uniform1iv(o,i);else if("iv"===n)u.uniform3iv(o,i);else if("fv1"===n)u.uniform1fv(o,i);else if("fv"===n)u.uniform3fv(o,i);else if("v2v"===n){for(void 0===r._array&&(r._array=new Float32Array(2*i.length)),l=0,c=i.length;l<c;l++)p=2*l,r._array[p]=i[l].x,r._array[p+1]=i[l].y;u.uniform2fv(o,r._array)}else if("v3v"===n){for(void 0===r._array&&(r._array=new Float32Array(3*i.length)),l=0,c=i.length;l<c;l++)p=3*l,r._array[p]=i[l].x,r._array[p+1]=i[l].y,r._array[p+2]=i[l].z;u.uniform3fv(o,r._array)}else if("v4v"===n){for(void 0===r._array&&(r._array=new Float32Array(4*i.length)),l=0,c=i.length;l<c;l++)p=4*l,r._array[p]=i[l].x,r._array[p+1]=i[l].y,r._array[p+2]=i[l].z,r._array[p+3]=i[l].w;u.uniform4fv(o,r._array)}else if("m4"===n)void 0===r._array&&(r._array=new Float32Array(16)),i.flattenToArray(r._array),u.uniformMatrix4fv(o,!1,r._array);else if("m4v"===n){for(void 0===r._array&&(r._array=new Float32Array(16*i.length)),l=0,c=i.length;l<c;l++)i[l].flattenToArrayOffset(r._array,16*l);u.uniformMatrix4fv(o,!1,r._array)}else if("t"===n){if(a=i,s=Xe(),u.uniform1i(o,s),!a)continue;a.image instanceof Array&&6===a.image.length?rt(a,s):a instanceof D.WebGLRenderTargetCube?it(a,s):m.setTexture(a,s)}else if("tv"===n){for(void 0===r._array&&(r._array=[]),l=0,c=r.value.length;l<c;l++)r._array[l]=Xe();for(u.uniform1iv(o,r._array),l=0,c=r.value.length;l<c;l++)a=r.value[l],s=r._array[l],a&&m.setTexture(a,s)}}(s,n.uniformsList),(n instanceof D.ShaderMaterial||n instanceof D.MeshPhongMaterial||n.envMap)&&null!==l.cameraPosition&&(Y.getPositionFromMatrix(e.matrixWorld),u.uniform3f(l.cameraPosition,Y.x,Y.y,Y.z)),(n instanceof D.MeshPhongMaterial||n instanceof D.MeshLambertMaterial||n instanceof D.ShaderMaterial||n.skinning)&&null!==l.viewMatrix&&u.uniformMatrix4fv(l.viewMatrix,!1,e.matrixWorldInverse.elements)),function(e,t){u.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&u.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}(l,o),null!==l.modelMatrix&&u.uniformMatrix4fv(l.modelMatrix,!1,o.matrixWorld.elements),s}function We(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function Xe(){var e=M;return e>=Z&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Z),M+=1,e}function qe(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function Ye(e,t,r,i){e[t]=r.r*r.r*i,e[t+1]=r.g*r.g*i,e[t+2]=r.b*r.b*i}function Ke(e,t,r,i){e[t]=r.r*i,e[t+1]=r.g*i,e[t+2]=r.b*i}function $e(e){e!==V&&(u.lineWidth(e),V=e)}function Qe(e,t,r){O!==e&&(e?u.enable(u.POLYGON_OFFSET_FILL):u.disable(u.POLYGON_OFFSET_FILL),O=e),!e||U===t&&N===r||(u.polygonOffset(t,r),U=t,N=r)}function Ze(e,t){var r;return"fragment"===e?r=u.createShader(u.FRAGMENT_SHADER):"vertex"===e&&(r=u.createShader(u.VERTEX_SHADER)),u.shaderSource(r,t),u.compileShader(r),u.getShaderParameter(r,u.COMPILE_STATUS)?r:(console.error(u.getShaderInfoLog(r)),console.error(function(e){for(var t=e.split("\n"),r=0,i=t.length;r<i;r++)t[r]=r+1+": "+t[r];return t.join("\n")}(t)),null)}function Je(e){return 0==(e&e-1)}function et(e,t,r){r?(u.texParameteri(e,u.TEXTURE_WRAP_S,st(t.wrapS)),u.texParameteri(e,u.TEXTURE_WRAP_T,st(t.wrapT)),u.texParameteri(e,u.TEXTURE_MAG_FILTER,st(t.magFilter)),u.texParameteri(e,u.TEXTURE_MIN_FILTER,st(t.minFilter))):(u.texParameteri(e,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(e,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(e,u.TEXTURE_MAG_FILTER,at(t.magFilter)),u.texParameteri(e,u.TEXTURE_MIN_FILTER,at(t.minFilter))),p&&t.type!==D.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(u.texParameterf(e,p.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,te)),t.__oldAnisotropy=t.anisotropy)}function tt(e,t){if(e.width<=t&&e.height<=t)return e;var r=Math.max(e.width,e.height),i=Math.floor(e.width*t/r),n=Math.floor(e.height*t/r),o=document.createElement("canvas");return o.width=i,o.height=n,o.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,i,n),o}function rt(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.image.__webglTextureCube=u.createTexture(),m.info.memory.textures++),u.activeTexture(u.TEXTURE0+t),u.bindTexture(u.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var r=e instanceof D.CompressedTexture,i=[],n=0;n<6;n++)m.autoScaleCubemaps&&!r?i[n]=tt(e.image[n],ee):i[n]=e.image[n];var o=i[0],a=Je(o.width)&&Je(o.height),s=st(e.format),l=st(e.type);et(u.TEXTURE_CUBE_MAP,e,a);for(n=0;n<6;n++)if(r)for(var c,h=i[n].mipmaps,f=0,p=h.length;f<p;f++)c=h[f],u.compressedTexImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+n,f,s,c.width,c.height,0,c.data);else u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,s,s,l,i[n]);e.generateMipmaps&&a&&u.generateMipmap(u.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else u.activeTexture(u.TEXTURE0+t),u.bindTexture(u.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function it(e,t){u.activeTexture(u.TEXTURE0+t),u.bindTexture(u.TEXTURE_CUBE_MAP,e.__webglTexture)}function nt(e,t,r){u.bindFramebuffer(u.FRAMEBUFFER,e),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,r,t.__webglTexture,0)}function ot(e,t){u.bindRenderbuffer(u.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_COMPONENT16,t.width,t.height),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_STENCIL,t.width,t.height),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,e)):u.renderbufferStorage(u.RENDERBUFFER,u.RGBA4,t.width,t.height)}function at(e){return e===D.NearestFilter||e===D.NearestMipMapNearestFilter||e===D.NearestMipMapLinearFilter?u.NEAREST:u.LINEAR}function st(e){if(e===D.RepeatWrapping)return u.REPEAT;if(e===D.ClampToEdgeWrapping)return u.CLAMP_TO_EDGE;if(e===D.MirroredRepeatWrapping)return u.MIRRORED_REPEAT;if(e===D.NearestFilter)return u.NEAREST;if(e===D.NearestMipMapNearestFilter)return u.NEAREST_MIPMAP_NEAREST;if(e===D.NearestMipMapLinearFilter)return u.NEAREST_MIPMAP_LINEAR;if(e===D.LinearFilter)return u.LINEAR;if(e===D.LinearMipMapNearestFilter)return u.LINEAR_MIPMAP_NEAREST;if(e===D.LinearMipMapLinearFilter)return u.LINEAR_MIPMAP_LINEAR;if(e===D.UnsignedByteType)return u.UNSIGNED_BYTE;if(e===D.UnsignedShort4444Type)return u.UNSIGNED_SHORT_4_4_4_4;if(e===D.UnsignedShort5551Type)return u.UNSIGNED_SHORT_5_5_5_1;if(e===D.UnsignedShort565Type)return u.UNSIGNED_SHORT_5_6_5;if(e===D.ByteType)return u.BYTE;if(e===D.ShortType)return u.SHORT;if(e===D.UnsignedShortType)return u.UNSIGNED_SHORT;if(e===D.IntType)return u.INT;if(e===D.UnsignedIntType)return u.UNSIGNED_INT;if(e===D.FloatType)return u.FLOAT;if(e===D.AlphaFormat)return u.ALPHA;if(e===D.RGBFormat)return u.RGB;if(e===D.RGBAFormat)return u.RGBA;if(e===D.LuminanceFormat)return u.LUMINANCE;if(e===D.LuminanceAlphaFormat)return u.LUMINANCE_ALPHA;if(e===D.AddEquation)return u.FUNC_ADD;if(e===D.SubtractEquation)return u.FUNC_SUBTRACT;if(e===D.ReverseSubtractEquation)return u.FUNC_REVERSE_SUBTRACT;if(e===D.ZeroFactor)return u.ZERO;if(e===D.OneFactor)return u.ONE;if(e===D.SrcColorFactor)return u.SRC_COLOR;if(e===D.OneMinusSrcColorFactor)return u.ONE_MINUS_SRC_COLOR;if(e===D.SrcAlphaFactor)return u.SRC_ALPHA;if(e===D.OneMinusSrcAlphaFactor)return u.ONE_MINUS_SRC_ALPHA;if(e===D.DstAlphaFactor)return u.DST_ALPHA;if(e===D.OneMinusDstAlphaFactor)return u.ONE_MINUS_DST_ALPHA;if(e===D.DstColorFactor)return u.DST_COLOR;if(e===D.OneMinusDstColorFactor)return u.ONE_MINUS_DST_COLOR;if(e===D.SrcAlphaSaturateFactor)return u.SRC_ALPHA_SATURATE;if(void 0!==d){if(e===D.RGB_S3TC_DXT1_Format)return d.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===D.RGBA_S3TC_DXT1_Format)return d.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===D.RGBA_S3TC_DXT3_Format)return d.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===D.RGBA_S3TC_DXT5_Format)return d.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}this.renderBufferImmediate=function(e,t,r){if(e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=u.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=u.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=u.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=u.createBuffer()),e.hasPositions&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglVertexBuffer),u.bufferData(u.ARRAY_BUFFER,e.positionArray,u.DYNAMIC_DRAW),u.enableVertexAttribArray(t.attributes.position),u.vertexAttribPointer(t.attributes.position,3,u.FLOAT,!1,0,0)),e.hasNormals){if(u.bindBuffer(u.ARRAY_BUFFER,e.__webglNormalBuffer),r.shading===D.FlatShading){var i,n,o,a,s,l,c,h,f,p,d,m=3*e.count;for(d=0;d<m;d+=9)a=(p=e.normalArray)[d],l=p[d+1],h=p[d+2],s=p[d+3],c=p[d+4],f=p[d+5],i=(a+s+p[d+6])/3,n=(l+c+p[d+7])/3,o=(h+f+p[d+8])/3,p[d]=i,p[d+1]=n,p[d+2]=o,p[d+3]=i,p[d+4]=n,p[d+5]=o,p[d+6]=i,p[d+7]=n,p[d+8]=o}u.bufferData(u.ARRAY_BUFFER,e.normalArray,u.DYNAMIC_DRAW),u.enableVertexAttribArray(t.attributes.normal),u.vertexAttribPointer(t.attributes.normal,3,u.FLOAT,!1,0,0)}e.hasUvs&&r.map&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglUvBuffer),u.bufferData(u.ARRAY_BUFFER,e.uvArray,u.DYNAMIC_DRAW),u.enableVertexAttribArray(t.attributes.uv),u.vertexAttribPointer(t.attributes.uv,2,u.FLOAT,!1,0,0)),e.hasColors&&r.vertexColors!==D.NoColors&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglColorBuffer),u.bufferData(u.ARRAY_BUFFER,e.colorArray,u.DYNAMIC_DRAW),u.enableVertexAttribArray(t.attributes.color),u.vertexAttribPointer(t.attributes.color,3,u.FLOAT,!1,0,0)),u.drawArrays(u.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,i,n,o){if(!1!==i.visible){var a,s,l,c,h,f,p;s=(a=He(e,t,r,i,o)).attributes,l=n.attributes;var d=!1,g=i.wireframe?1:0,v=16777215*n.id+2*a.id+g;if(v!==w&&(w=v,d=!0),d&&Ee(),o instanceof D.Mesh){var y=l.index;if(y){var x=n.offsets;x.length>1&&(d=!0);for(var b=0,S=x.length;b<S;b++){var _=x[b].index;if(d){for(h in l)"index"!==h&&(f=s[h],p=(c=l[h]).itemSize,f>=0&&(u.bindBuffer(u.ARRAY_BUFFER,c.buffer),Ae(f),u.vertexAttribPointer(f,p,u.FLOAT,!1,0,_*p*4)));u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,y.buffer)}u.drawElements(u.TRIANGLES,x[b].count,u.UNSIGNED_SHORT,2*x[b].start),m.info.render.calls++,m.info.render.vertices+=x[b].count,m.info.render.faces+=x[b].count/3}}else{if(d)for(h in l)"index"!==h&&(f=s[h],p=(c=l[h]).itemSize,f>=0&&(u.bindBuffer(u.ARRAY_BUFFER,c.buffer),Ae(f),u.vertexAttribPointer(f,p,u.FLOAT,!1,0,0)));var M=n.attributes.position;u.drawArrays(u.TRIANGLES,0,M.numItems/3),m.info.render.calls++,m.info.render.vertices+=M.numItems/3,m.info.render.faces+=M.numItems/3/3}}else if(o instanceof D.ParticleSystem){if(d){for(h in l)f=s[h],p=(c=l[h]).itemSize,f>=0&&(u.bindBuffer(u.ARRAY_BUFFER,c.buffer),Ae(f),u.vertexAttribPointer(f,p,u.FLOAT,!1,0,0));M=l.position;u.drawArrays(u.POINTS,0,M.numItems/3),m.info.render.calls++,m.info.render.points+=M.numItems/3}}else if(o instanceof D.Line&&d){for(h in l)f=s[h],p=(c=l[h]).itemSize,f>=0&&(u.bindBuffer(u.ARRAY_BUFFER,c.buffer),Ae(f),u.vertexAttribPointer(f,p,u.FLOAT,!1,0,0));$e(i.linewidth);M=l.position;u.drawArrays(u.LINE_STRIP,0,M.numItems/3),m.info.render.calls++,m.info.render.points+=M.numItems}}},this.renderBuffer=function(e,t,r,i,n,o){if(!1!==i.visible){var a,s,l,c,h,f;s=(a=He(e,t,r,i,o)).attributes;var p=!1,d=i.wireframe?1:0,g=16777215*n.id+2*a.id+d;if(g!==w&&(w=g,p=!0),p&&Ee(),!i.morphTargets&&s.position>=0?p&&(u.bindBuffer(u.ARRAY_BUFFER,n.__webglVertexBuffer),Ae(s.position),u.vertexAttribPointer(s.position,3,u.FLOAT,!1,0,0)):o.morphTargetBase&&function(e,t,r){var i=e.program.attributes;-1!==r.morphTargetBase&&i.position>=0?(u.bindBuffer(u.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[r.morphTargetBase]),Ae(i.position),u.vertexAttribPointer(i.position,3,u.FLOAT,!1,0,0)):i.position>=0&&(u.bindBuffer(u.ARRAY_BUFFER,t.__webglVertexBuffer),Ae(i.position),u.vertexAttribPointer(i.position,3,u.FLOAT,!1,0,0));if(r.morphTargetForcedOrder.length)for(var n=0,o=r.morphTargetForcedOrder,a=r.morphTargetInfluences;n<e.numSupportedMorphTargets&&n<o.length;)i["morphTarget"+n]>=0&&(u.bindBuffer(u.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[o[n]]),Ae(i["morphTarget"+n]),u.vertexAttribPointer(i["morphTarget"+n],3,u.FLOAT,!1,0,0)),i["morphNormal"+n]>=0&&e.morphNormals&&(u.bindBuffer(u.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[o[n]]),Ae(i["morphNormal"+n]),u.vertexAttribPointer(i["morphNormal"+n],3,u.FLOAT,!1,0,0)),r.__webglMorphTargetInfluences[n]=a[o[n]],n++;else{var s,l,c=[],h=(a=r.morphTargetInfluences).length;for(l=0;l<h;l++)(s=a[l])>0&&c.push([s,l]);c.length>e.numSupportedMorphTargets?(c.sort(Le),c.length=e.numSupportedMorphTargets):c.length>e.numSupportedMorphNormals?c.sort(Le):0===c.length&&c.push([0,0]);var f;for(n=0;n<e.numSupportedMorphTargets;)c[n]?(f=c[n][1],i["morphTarget"+n]>=0&&(u.bindBuffer(u.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[f]),Ae(i["morphTarget"+n]),u.vertexAttribPointer(i["morphTarget"+n],3,u.FLOAT,!1,0,0)),i["morphNormal"+n]>=0&&e.morphNormals&&(u.bindBuffer(u.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[f]),Ae(i["morphNormal"+n]),u.vertexAttribPointer(i["morphNormal"+n],3,u.FLOAT,!1,0,0)),r.__webglMorphTargetInfluences[n]=a[f]):r.__webglMorphTargetInfluences[n]=0,n++}null!==e.program.uniforms.morphTargetInfluences&&u.uniform1fv(e.program.uniforms.morphTargetInfluences,r.__webglMorphTargetInfluences)}(i,n,o),p){if(n.__webglCustomAttributesList)for(h=0,f=n.__webglCustomAttributesList.length;h<f;h++)s[(c=n.__webglCustomAttributesList[h]).buffer.belongsToAttribute]>=0&&(u.bindBuffer(u.ARRAY_BUFFER,c.buffer),Ae(s[c.buffer.belongsToAttribute]),u.vertexAttribPointer(s[c.buffer.belongsToAttribute],c.size,u.FLOAT,!1,0,0));s.color>=0&&(u.bindBuffer(u.ARRAY_BUFFER,n.__webglColorBuffer),Ae(s.color),u.vertexAttribPointer(s.color,3,u.FLOAT,!1,0,0)),s.normal>=0&&(u.bindBuffer(u.ARRAY_BUFFER,n.__webglNormalBuffer),Ae(s.normal),u.vertexAttribPointer(s.normal,3,u.FLOAT,!1,0,0)),s.tangent>=0&&(u.bindBuffer(u.ARRAY_BUFFER,n.__webglTangentBuffer),Ae(s.tangent),u.vertexAttribPointer(s.tangent,4,u.FLOAT,!1,0,0)),s.uv>=0&&(u.bindBuffer(u.ARRAY_BUFFER,n.__webglUVBuffer),Ae(s.uv),u.vertexAttribPointer(s.uv,2,u.FLOAT,!1,0,0)),s.uv2>=0&&(u.bindBuffer(u.ARRAY_BUFFER,n.__webglUV2Buffer),Ae(s.uv2),u.vertexAttribPointer(s.uv2,2,u.FLOAT,!1,0,0)),i.skinning&&s.skinIndex>=0&&s.skinWeight>=0&&(u.bindBuffer(u.ARRAY_BUFFER,n.__webglSkinIndicesBuffer),Ae(s.skinIndex),u.vertexAttribPointer(s.skinIndex,4,u.FLOAT,!1,0,0),u.bindBuffer(u.ARRAY_BUFFER,n.__webglSkinWeightsBuffer),Ae(s.skinWeight),u.vertexAttribPointer(s.skinWeight,4,u.FLOAT,!1,0,0)),s.lineDistance>=0&&(u.bindBuffer(u.ARRAY_BUFFER,n.__webglLineDistanceBuffer),Ae(s.lineDistance),u.vertexAttribPointer(s.lineDistance,1,u.FLOAT,!1,0,0))}o instanceof D.Mesh?(i.wireframe?($e(i.wireframeLinewidth),p&&u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,n.__webglLineBuffer),u.drawElements(u.LINES,n.__webglLineCount,u.UNSIGNED_SHORT,0)):(p&&u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,n.__webglFaceBuffer),u.drawElements(u.TRIANGLES,n.__webglFaceCount,u.UNSIGNED_SHORT,0)),m.info.render.calls++,m.info.render.vertices+=n.__webglFaceCount,m.info.render.faces+=n.__webglFaceCount/3):o instanceof D.Line?(l=o.type===D.LineStrip?u.LINE_STRIP:u.LINES,$e(i.linewidth),u.drawArrays(l,0,n.__webglLineCount),m.info.render.calls++):o instanceof D.ParticleSystem?(u.drawArrays(u.POINTS,0,n.__webglParticleCount),m.info.render.calls++,m.info.render.points+=n.__webglParticleCount):o instanceof D.Ribbon&&(u.drawArrays(u.TRIANGLE_STRIP,0,n.__webglVertexCount),m.info.render.calls++)}},this.render=function(e,t,r,i){if(t instanceof D.Camera!=!1){var n,o,a,s,l,c=e.__lights,h=e.fog;for(b=-1,$=!0,!0===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),X.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),W.setFromMatrix(X),this.autoUpdateObjects&&this.initWebGLObjects(e),Pe(this.renderPluginsPre,e,t),m.info.render.calls=0,m.info.render.vertices=0,m.info.render.faces=0,m.info.render.points=0,this.setRenderTarget(r),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),n=0,o=(l=e.__webglObjects).length;n<o;n++)s=(a=l[n]).object,a.id=n,a.render=!1,s.visible&&((s instanceof D.Mesh||s instanceof D.ParticleSystem)&&s.frustumCulled&&!W.intersectsObject(s)||(qe(s,t),Ue(a),a.render=!0,!0===this.sortObjects&&(null!==s.renderDepth?a.z=s.renderDepth:(Y.getPositionFromMatrix(s.matrixWorld),Y.applyProjection(X),a.z=Y.z))));for(this.sortObjects&&l.sort(De),n=0,o=(l=e.__webglObjectsImmediate).length;n<o;n++)(s=(a=l[n]).object).visible&&(qe(s,t),Oe(a));if(e.overrideMaterial){var f=e.overrideMaterial;this.setBlending(f.blending,f.blendEquation,f.blendSrc,f.blendDst),this.setDepthTest(f.depthTest),this.setDepthWrite(f.depthWrite),Qe(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits),Re(e.__webglObjects,!1,"",t,c,h,!0,f),Fe(e.__webglObjectsImmediate,"",t,c,h,!1,f)}else{f=null;this.setBlending(D.NoBlending),Re(e.__webglObjects,!0,"opaque",t,c,h,!1,f),Fe(e.__webglObjectsImmediate,"opaque",t,c,h,!1,f),Re(e.__webglObjects,!1,"transparent",t,c,h,!0,f),Fe(e.__webglObjectsImmediate,"transparent",t,c,h,!0,f)}Pe(this.renderPluginsPost,e,t),r&&r.generateMipmaps&&r.minFilter!==D.NearestFilter&&r.minFilter!==D.LinearFilter&&function(e){e instanceof D.WebGLRenderTargetCube?(u.bindTexture(u.TEXTURE_CUBE_MAP,e.__webglTexture),u.generateMipmap(u.TEXTURE_CUBE_MAP),u.bindTexture(u.TEXTURE_CUBE_MAP,null)):(u.bindTexture(u.TEXTURE_2D,e.__webglTexture),u.generateMipmap(u.TEXTURE_2D),u.bindTexture(u.TEXTURE_2D,null))}(r),this.setDepthTest(!0),this.setDepthWrite(!0)}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.renderImmediateObject=function(e,t,r,i,n){var o=He(e,t,r,i,n);w=-1,m.setMaterialFaces(i),n.immediateRenderCallback?n.immediateRenderCallback(o,u,W):n.render((function(e){m.renderBufferImmediate(e,o,i)}))},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);e.__objectsAdded.length;)Ne(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);for(;e.__objectsRemoved.length;)Ie(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,r=e.__webglObjects.length;t<r;t++){var i=e.__webglObjects[t].object;void 0===i.__webglInit&&(void 0!==i.__webglActive&&Ie(i,e),Ne(i,e)),ke(i)}},this.initMaterial=function(e,t,i,n){var o,a,s,l,c,h,f;e.addEventListener("dispose",de),e instanceof D.MeshDepthMaterial?f="depth":e instanceof D.MeshNormalMaterial?f="normal":e instanceof D.MeshBasicMaterial?f="basic":e instanceof D.MeshLambertMaterial?f="lambert":e instanceof D.MeshPhongMaterial?f="phong":e instanceof D.LineBasicMaterial?f="basic":e instanceof D.LineDashedMaterial?f="dashed":e instanceof D.ParticleBasicMaterial&&(f="particle_basic"),f&&function(e,t){e.uniforms=D.UniformsUtils.clone(t.uniforms),e.vertexShader=t.vertexShader,e.fragmentShader=t.fragmentShader}(e,D.ShaderLib[f]),l=function(e){var t,r,i,n,o,a,s;for(n=o=a=s=0,t=0,r=e.length;t<r;t++)(i=e[t]).onlyShadow||(i instanceof D.DirectionalLight&&n++,i instanceof D.PointLight&&o++,i instanceof D.SpotLight&&a++,i instanceof D.HemisphereLight&&s++);return{directional:n,point:o,spot:a,hemi:s}}(t),h=function(e){var t,r,i,n=0;for(t=0,r=e.length;t<r;t++)(i=e[t]).castShadow&&(i instanceof D.SpotLight&&n++,i instanceof D.DirectionalLight&&!i.shadowCascade&&n++);return n}(t),c=function(e){if(ie&&e&&e.useVertexTexture)return 1024;var t=u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS),r=Math.floor((t-20)/4);return void 0!==e&&e instanceof D.SkinnedMesh&&(r=Math.min(e.bones.length,r))<e.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)"),r}(n),s={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:i,useFog:e.fog,fogExp:i instanceof D.FogExp2,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:c,useVertexTexture:ie&&n&&n.useVertexTexture,boneTextureWidth:n&&n.boneTextureWidth,boneTextureHeight:n&&n.boneTextureHeight,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:l.directional,maxPointLights:l.point,maxSpotLights:l.spot,maxHemiLights:l.hemi,maxShadows:h,shadowMapEnabled:this.shadowMapEnabled&&n.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:e.side===D.DoubleSide,flipSided:e.side===D.BackSide},e.program=function(e,t,i,n,o,a,s){var l,c,h,f,p,d=[];e?d.push(e):(d.push(t),d.push(i));for(h in a)d.push(h),d.push(a[h]);for(l in s)d.push(l),d.push(s[l]);for(p=d.join(),l=0,c=g.length;l<c;l++){var y=g[l];if(y.code===p)return y.usedTimes++,y.program}var x="SHADOWMAP_TYPE_BASIC";s.shadowMapType===D.PCFShadowMap?x="SHADOWMAP_TYPE_PCF":s.shadowMapType===D.PCFSoftShadowMap&&(x="SHADOWMAP_TYPE_PCF_SOFT");var b=function(e){var t,r,i=[];for(var n in e)!1!==(t=e[n])&&(r="#define "+n+" "+t,i.push(r));return i.join("\n")}(a);f=u.createProgram();var w,S,_,M,T=["precision "+r+" float;",b,re?"#define VERTEX_TEXTURES":"",m.gammaInput?"#define GAMMA_INPUT":"",m.gammaOutput?"#define GAMMA_OUTPUT":"",m.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+s.maxDirLights,"#define MAX_POINT_LIGHTS "+s.maxPointLights,"#define MAX_SPOT_LIGHTS "+s.maxSpotLights,"#define MAX_HEMI_LIGHTS "+s.maxHemiLights,"#define MAX_SHADOWS "+s.maxShadows,"#define MAX_BONES "+s.maxBones,s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.lightMap?"#define USE_LIGHTMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.vertexColors?"#define USE_COLOR":"",s.skinning?"#define USE_SKINNING":"",s.useVertexTexture?"#define BONE_TEXTURE":"",s.boneTextureWidth?"#define N_BONE_PIXEL_X "+s.boneTextureWidth.toFixed(1):"",s.boneTextureHeight?"#define N_BONE_PIXEL_Y "+s.boneTextureHeight.toFixed(1):"",s.morphTargets?"#define USE_MORPHTARGETS":"",s.morphNormals?"#define USE_MORPHNORMALS":"",s.perPixel?"#define PHONG_PER_PIXEL":"",s.wrapAround?"#define WRAP_AROUND":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+x:"",s.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",s.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",s.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),C=["precision "+r+" float;",s.bumpMap||s.normalMap?"#extension GL_OES_standard_derivatives : enable":"",b,"#define MAX_DIR_LIGHTS "+s.maxDirLights,"#define MAX_POINT_LIGHTS "+s.maxPointLights,"#define MAX_SPOT_LIGHTS "+s.maxSpotLights,"#define MAX_HEMI_LIGHTS "+s.maxHemiLights,"#define MAX_SHADOWS "+s.maxShadows,s.alphaTest?"#define ALPHATEST "+s.alphaTest:"",m.gammaInput?"#define GAMMA_INPUT":"",m.gammaOutput?"#define GAMMA_OUTPUT":"",m.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.lightMap?"#define USE_LIGHTMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.vertexColors?"#define USE_COLOR":"",s.metal?"#define METAL":"",s.perPixel?"#define PHONG_PER_PIXEL":"",s.wrapAround?"#define WRAP_AROUND":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+x:"",s.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",s.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"),A=Ze("vertex",T+i),E=Ze("fragment",C+t);u.attachShader(f,A),u.attachShader(f,E),u.linkProgram(f),u.getProgramParameter(f,u.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+u.getProgramParameter(f,u.VALIDATE_STATUS)+", gl error ["+u.getError()+"]");u.deleteShader(E),u.deleteShader(A),f.uniforms={},f.attributes={},w=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"],s.useVertexTexture?w.push("boneTexture"):w.push("boneGlobalMatrices");for(S in n)w.push(S);for(function(e,t){var r,i,n;for(r=0,i=t.length;r<i;r++)n=t[r],e.uniforms[n]=u.getUniformLocation(e,n)}(f,w),w=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"],M=0;M<s.maxMorphTargets;M++)w.push("morphTarget"+M);for(M=0;M<s.maxMorphNormals;M++)w.push("morphNormal"+M);for(_ in o)w.push(_);return function(e,t){var r,i,n;for(r=0,i=t.length;r<i;r++)n=t[r],e.attributes[n]=u.getAttribLocation(e,n)}(f,w),f.id=v++,g.push({program:f,code:p,usedTimes:1}),m.info.memory.programs=g.length,f}(f,e.fragmentShader,e.vertexShader,e.uniforms,e.attributes,e.defines,s);var p=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var d="morphTarget";for(a=0;a<this.maxMorphTargets;a++)p[d+a]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;d="morphNormal";for(a=0;a<this.maxMorphNormals;a++)p[d+a]>=0&&e.numSupportedMorphNormals++}for(o in e.uniformsList=[],e.uniforms)e.uniformsList.push([e.uniforms[o],o])},this.setFaceCulling=function(e,t){e===D.CullFaceNone?u.disable(u.CULL_FACE):(t===D.FrontFaceDirectionCW?u.frontFace(u.CW):u.frontFace(u.CCW),e===D.CullFaceBack?u.cullFace(u.BACK):e===D.CullFaceFront?u.cullFace(u.FRONT):u.cullFace(u.FRONT_AND_BACK),u.enable(u.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===D.DoubleSide,r=e.side===D.BackSide;T!==t&&(t?u.disable(u.CULL_FACE):u.enable(u.CULL_FACE),T=t),C!==r&&(r?u.frontFace(u.CW):u.frontFace(u.CCW),C=r)},this.setDepthTest=function(e){R!==e&&(e?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),R=e)},this.setDepthWrite=function(e){F!==e&&(u.depthMask(e),F=e)},this.setBlending=function(e,t,r,i){e!==A&&(e===D.NoBlending?u.disable(u.BLEND):e===D.AdditiveBlending?(u.enable(u.BLEND),u.blendEquation(u.FUNC_ADD),u.blendFunc(u.SRC_ALPHA,u.ONE)):e===D.SubtractiveBlending?(u.enable(u.BLEND),u.blendEquation(u.FUNC_ADD),u.blendFunc(u.ZERO,u.ONE_MINUS_SRC_COLOR)):e===D.MultiplyBlending?(u.enable(u.BLEND),u.blendEquation(u.FUNC_ADD),u.blendFunc(u.ZERO,u.SRC_COLOR)):e===D.CustomBlending?u.enable(u.BLEND):(u.enable(u.BLEND),u.blendEquationSeparate(u.FUNC_ADD,u.FUNC_ADD),u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA)),A=e),e===D.CustomBlending?(t!==E&&(u.blendEquation(st(t)),E=t),r===L&&i===P||(u.blendFunc(st(r),st(i)),L=r,P=i)):(E=null,L=null,P=null)},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",fe),e.__webglTexture=u.createTexture(),m.info.memory.textures++),u.activeTexture(u.TEXTURE0+t),u.bindTexture(u.TEXTURE_2D,e.__webglTexture),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,e.flipY),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),u.pixelStorei(u.UNPACK_ALIGNMENT,e.unpackAlignment);var r=e.image,i=Je(r.width)&&Je(r.height),n=st(e.format),o=st(e.type);et(u.TEXTURE_2D,e,i);var a,s=e.mipmaps;if(e instanceof D.DataTexture)if(s.length>0&&i){for(var l=0,c=s.length;l<c;l++)a=s[l],u.texImage2D(u.TEXTURE_2D,l,n,a.width,a.height,0,n,o,a.data);e.generateMipmaps=!1}else u.texImage2D(u.TEXTURE_2D,0,n,r.width,r.height,0,n,o,r.data);else if(e instanceof D.CompressedTexture)for(l=0,c=s.length;l<c;l++)a=s[l],u.compressedTexImage2D(u.TEXTURE_2D,l,n,a.width,a.height,0,a.data);else if(s.length>0&&i){for(l=0,c=s.length;l<c;l++)a=s[l],u.texImage2D(u.TEXTURE_2D,l,n,n,o,a);e.generateMipmaps=!1}else u.texImage2D(u.TEXTURE_2D,0,n,n,o,e.image);e.generateMipmaps&&i&&u.generateMipmap(u.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else u.activeTexture(u.TEXTURE0+t),u.bindTexture(u.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t,r,i,n,o,a=e instanceof D.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",pe),e.__webglTexture=u.createTexture(),m.info.memory.textures++;var s=Je(e.width)&&Je(e.height),l=st(e.format),c=st(e.type);if(a){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],u.bindTexture(u.TEXTURE_CUBE_MAP,e.__webglTexture),et(u.TEXTURE_CUBE_MAP,e,s);for(var h=0;h<6;h++)e.__webglFramebuffer[h]=u.createFramebuffer(),e.__webglRenderbuffer[h]=u.createRenderbuffer(),u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,l,e.width,e.height,0,l,c,null),nt(e.__webglFramebuffer[h],e,u.TEXTURE_CUBE_MAP_POSITIVE_X+h),ot(e.__webglRenderbuffer[h],e);s&&u.generateMipmap(u.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=u.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=u.createRenderbuffer(),u.bindTexture(u.TEXTURE_2D,e.__webglTexture),et(u.TEXTURE_2D,e,s),u.texImage2D(u.TEXTURE_2D,0,l,e.width,e.height,0,l,c,null),nt(e.__webglFramebuffer,e,u.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,e.__webglRenderbuffer):ot(e.__webglRenderbuffer,e),s&&u.generateMipmap(u.TEXTURE_2D);a?u.bindTexture(u.TEXTURE_CUBE_MAP,null):u.bindTexture(u.TEXTURE_2D,null),u.bindRenderbuffer(u.RENDERBUFFER,null),u.bindFramebuffer(u.FRAMEBUFFER,null)}e?(t=a?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,r=e.width,i=e.height,n=0,o=0):(t=null,r=B,i=I,n=k,o=z),t!==x&&(u.bindFramebuffer(u.FRAMEBUFFER,t),u.viewport(n,o,r,i),x=t),j=r,G=i},this.shadowMapPlugin=new D.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new D.SpritePlugin),this.addPostPlugin(new D.LensFlarePlugin)},D.WebGLRenderTarget=function(e,t,r){this.width=e,this.height=t,r=r||{},this.wrapS=void 0!==r.wrapS?r.wrapS:D.ClampToEdgeWrapping,this.wrapT=void 0!==r.wrapT?r.wrapT:D.ClampToEdgeWrapping,this.magFilter=void 0!==r.magFilter?r.magFilter:D.LinearFilter,this.minFilter=void 0!==r.minFilter?r.minFilter:D.LinearMipMapLinearFilter,this.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,this.offset=new D.Vector2(0,0),this.repeat=new D.Vector2(1,1),this.format=void 0!==r.format?r.format:D.RGBAFormat,this.type=void 0!==r.type?r.type:D.UnsignedByteType,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=null},D.WebGLRenderTarget.prototype={constructor:D.WebGLRenderTarget,addEventListener:D.EventDispatcher.prototype.addEventListener,hasEventListener:D.EventDispatcher.prototype.hasEventListener,removeEventListener:D.EventDispatcher.prototype.removeEventListener,dispatchEvent:D.EventDispatcher.prototype.dispatchEvent,clone:function(){var e=new D.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},D.WebGLRenderTargetCube=function(e,t,r){D.WebGLRenderTarget.call(this,e,t,r),this.activeCubeFace=0},D.WebGLRenderTargetCube.prototype=Object.create(D.WebGLRenderTarget.prototype),D.RenderableVertex=function(){this.positionWorld=new D.Vector3,this.positionScreen=new D.Vector4,this.visible=!0},D.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},D.RenderableFace3=function(){this.v1=new D.RenderableVertex,this.v2=new D.RenderableVertex,this.v3=new D.RenderableVertex,this.centroidModel=new D.Vector3,this.normalModel=new D.Vector3,this.normalModelView=new D.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new D.Vector3,new D.Vector3,new D.Vector3],this.vertexNormalsModelView=[new D.Vector3,new D.Vector3,new D.Vector3],this.color=null,this.material=null,this.uvs=[[]],this.z=null},D.RenderableFace4=function(){this.v1=new D.RenderableVertex,this.v2=new D.RenderableVertex,this.v3=new D.RenderableVertex,this.v4=new D.RenderableVertex,this.centroidModel=new D.Vector3,this.normalModel=new D.Vector3,this.normalModelView=new D.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new D.Vector3,new D.Vector3,new D.Vector3,new D.Vector3],this.vertexNormalsModelView=[new D.Vector3,new D.Vector3,new D.Vector3,new D.Vector3],this.color=null,this.material=null,this.uvs=[[]],this.z=null},D.RenderableObject=function(){this.object=null,this.z=null},D.RenderableParticle=function(){this.object=null,this.x=null,this.y=null,this.z=null,this.rotation=null,this.scale=new D.Vector2,this.material=null},D.RenderableLine=function(){this.z=null,this.v1=new D.RenderableVertex,this.v2=new D.RenderableVertex,this.vertexColors=[new D.Color,new D.Color],this.material=null},D.GeometryUtils={merge:function(e,t,r){var i,n,o=e.vertices.length,a=(e.faceVertexUvs[0].length,t instanceof D.Mesh?t.geometry:t),s=e.vertices,l=a.vertices,c=e.faces,u=a.faces,h=e.faceVertexUvs[0],f=a.faceVertexUvs[0];void 0===r&&(r=0),t instanceof D.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,n=(new D.Matrix3).getNormalMatrix(i));for(var p=0,d=l.length;p<d;p++){var m=l[p].clone();i&&m.applyMatrix4(i),s.push(m)}for(p=0,d=u.length;p<d;p++){var g,v,y,x=u[p],b=x.vertexNormals,w=x.vertexColors;x instanceof D.Face3?g=new D.Face3(x.a+o,x.b+o,x.c+o):x instanceof D.Face4&&(g=new D.Face4(x.a+o,x.b+o,x.c+o,x.d+o)),g.normal.copy(x.normal),n&&g.normal.applyMatrix3(n).normalize();for(var S=0,_=b.length;S<_;S++)v=b[S].clone(),n&&v.applyMatrix3(n).normalize(),g.vertexNormals.push(v);g.color.copy(x.color);for(S=0,_=w.length;S<_;S++)y=w[S],g.vertexColors.push(y.clone());g.materialIndex=x.materialIndex+r,g.centroid.copy(x.centroid),i&&g.centroid.applyMatrix4(i),c.push(g)}for(p=0,d=f.length;p<d;p++){var M=f[p],T=[];for(S=0,_=M.length;S<_;S++)T.push(new D.Vector2(M[S].x,M[S].y));h.push(T)}},removeMaterials:function(e,t){for(var r={},i=0,n=t.length;i<n;i++)r[t[i]]=!0;var o,a=[];for(i=0,n=e.faces.length;i<n;i++)(o=e.faces[i]).materialIndex in r||a.push(o);e.faces=a},randomPointInTriangle:function(e,t,r){var i,n,o,a=new D.Vector3,s=D.GeometryUtils.__v1;return(i=D.GeometryUtils.random())+(n=D.GeometryUtils.random())>1&&(i=1-i,n=1-n),o=1-i-n,a.copy(e),a.multiplyScalar(i),s.copy(t),s.multiplyScalar(n),a.add(s),s.copy(r),s.multiplyScalar(o),a.add(s),a},randomPointInFace:function(e,t,r){var i,n,o,a,s,l;return e instanceof D.Face3?(i=t.vertices[e.a],n=t.vertices[e.b],o=t.vertices[e.c],D.GeometryUtils.randomPointInTriangle(i,n,o)):e instanceof D.Face4?(i=t.vertices[e.a],n=t.vertices[e.b],o=t.vertices[e.c],a=t.vertices[e.d],r?e._area1&&e._area2?(s=e._area1,l=e._area2):(s=D.GeometryUtils.triangleArea(i,n,a),l=D.GeometryUtils.triangleArea(n,o,a),e._area1=s,e._area2=l):(s=D.GeometryUtils.triangleArea(i,n,a),l=D.GeometryUtils.triangleArea(n,o,a)),D.GeometryUtils.random()*(s+l)<s?D.GeometryUtils.randomPointInTriangle(i,n,a):D.GeometryUtils.randomPointInTriangle(n,o,a)):void 0},randomPointsInGeometry:function(e,t){var r,i,n,o,a,s,l=e.faces,c=e.vertices,u=l.length,h=0,f=[];for(i=0;i<u;i++)(r=l[i])instanceof D.Face3?(n=c[r.a],o=c[r.b],a=c[r.c],r._area=D.GeometryUtils.triangleArea(n,o,a)):r instanceof D.Face4&&(n=c[r.a],o=c[r.b],a=c[r.c],s=c[r.d],r._area1=D.GeometryUtils.triangleArea(n,o,s),r._area2=D.GeometryUtils.triangleArea(o,a,s),r._area=r._area1+r._area2),h+=r._area,f[i]=h;var p,d,m,g=[],v={};for(i=0;i<t;i++)p=D.GeometryUtils.random()*h,m=p,d=function e(t,r){if(r<t)return t;var i=t+Math.floor((r-t)/2);return f[i]>m?e(t,i-1):f[i]<m?e(i+1,r):i}(0,f.length-1),g[i]=D.GeometryUtils.randomPointInFace(l[d],e,!0),v[d]?v[d]+=1:v[d]=1;return g},triangleArea:function(e,t,r){var i=D.GeometryUtils.__v1,n=D.GeometryUtils.__v2;return i.subVectors(t,e),n.subVectors(r,e),i.cross(n),.5*i.length()},center:function(e){e.computeBoundingBox();var t=e.boundingBox,r=new D.Vector3;return r.addVectors(t.min,t.max),r.multiplyScalar(-.5),e.applyMatrix((new D.Matrix4).makeTranslation(r.x,r.y,r.z)),e.computeBoundingBox(),r},normalizeUVs:function(e){for(var t=e.faceVertexUvs[0],r=0,i=t.length;r<i;r++)for(var n=t[r],o=0,a=n.length;o<a;o++)1!==n[o].x&&(n[o].x=n[o].x-Math.floor(n[o].x)),1!==n[o].y&&(n[o].y=n[o].y-Math.floor(n[o].y))},triangulateQuads:function(e){var t,r,i,n,o=[],a=[],s=[];for(t=0,r=e.faceUvs.length;t<r;t++)a[t]=[];for(t=0,r=e.faceVertexUvs.length;t<r;t++)s[t]=[];for(t=0,r=e.faces.length;t<r;t++){var l=e.faces[t];if(l instanceof D.Face4){var c=l.a,u=l.b,h=l.c,f=l.d,p=new D.Face3,d=new D.Face3;for(p.color.copy(l.color),d.color.copy(l.color),p.materialIndex=l.materialIndex,d.materialIndex=l.materialIndex,p.a=c,p.b=u,p.c=f,d.a=u,d.b=h,d.c=f,4===l.vertexColors.length&&(p.vertexColors[0]=l.vertexColors[0].clone(),p.vertexColors[1]=l.vertexColors[1].clone(),p.vertexColors[2]=l.vertexColors[3].clone(),d.vertexColors[0]=l.vertexColors[1].clone(),d.vertexColors[1]=l.vertexColors[2].clone(),d.vertexColors[2]=l.vertexColors[3].clone()),o.push(p,d),i=0,n=e.faceVertexUvs.length;i<n;i++)if(e.faceVertexUvs[i].length){var m=e.faceVertexUvs[i][t],g=m[0],v=m[1],y=m[2],x=m[3],b=[g.clone(),v.clone(),x.clone()],w=[v.clone(),y.clone(),x.clone()];s[i].push(b,w)}for(i=0,n=e.faceUvs.length;i<n;i++)if(e.faceUvs[i].length){var S=e.faceUvs[i][t];a[i].push(S,S)}}else{for(o.push(l),i=0,n=e.faceUvs.length;i<n;i++)a[i].push(e.faceUvs[i][t]);for(i=0,n=e.faceVertexUvs.length;i<n;i++)s[i].push(e.faceVertexUvs[i][t])}}e.faces=o,e.faceUvs=a,e.faceVertexUvs=s,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()},setMaterialIndex:function(e,t,r,i){for(var n=e.faces,o=r||0,a=i||n.length-1,s=o;s<=a;s++)n[s].materialIndex=t}},D.GeometryUtils.random=D.Math.random16,D.GeometryUtils.__v1=new D.Vector3,D.GeometryUtils.__v2=new D.Vector3,D.ImageUtils={crossOrigin:"anonymous",loadTexture:function(e,t,r,i){var n=new Image,o=new D.Texture(n,t),a=new D.ImageLoader;return a.addEventListener("load",(function(e){o.image=e.content,o.needsUpdate=!0,r&&r(o)})),a.addEventListener("error",(function(e){i&&i(e.message)})),a.crossOrigin=this.crossOrigin,a.load(e,n),o.sourceFile=e,o},loadCompressedTexture:function(e,t,r,i){var n=new D.CompressedTexture;n.mapping=t;var o=new XMLHttpRequest;return o.onload=function(){var e=o.response,t=D.ImageUtils.parseDDS(e,!0);n.format=t.format,n.mipmaps=t.mipmaps,n.image.width=t.width,n.image.height=t.height,n.generateMipmaps=!1,n.needsUpdate=!0,r&&r(n)},o.onerror=i,o.open("GET",e,!0),o.responseType="arraybuffer",o.send(null),n},loadTextureCube:function(e,t,r,i){var n=[];n.loadCount=0;var o=new D.Texture;o.image=n,void 0!==t&&(o.mapping=t),o.flipY=!1;for(var a=0,s=e.length;a<s;++a){var l=new Image;n[a]=l,l.onload=function(){n.loadCount+=1,6===n.loadCount&&(o.needsUpdate=!0,r&&r(o))},l.onerror=i,l.crossOrigin=this.crossOrigin,l.src=e[a]}return o},loadCompressedTextureCube:function(e,t,r,i){var n=[];n.loadCount=0;var o=new D.CompressedTexture;o.image=n,void 0!==t&&(o.mapping=t),o.flipY=!1,o.generateMipmaps=!1;var a=function(e,t){return function(){var i=e.response,a=D.ImageUtils.parseDDS(i,!0);t.format=a.format,t.mipmaps=a.mipmaps,t.width=a.width,t.height=a.height,n.loadCount+=1,6===n.loadCount&&(o.format=a.format,o.needsUpdate=!0,r&&r(o))}};if(e instanceof Array)for(var s=0,l=e.length;s<l;++s){var c={};n[s]=c,(h=new XMLHttpRequest).onload=a(h,c),h.onerror=i;var u=e[s];h.open("GET",u,!0),h.responseType="arraybuffer",h.send(null)}else{var h;u=e;(h=new XMLHttpRequest).onload=function(){var e=h.response,t=D.ImageUtils.parseDDS(e,!0);if(t.isCubemap){for(var i=t.mipmaps.length/t.mipmapCount,a=0;a<i;a++){n[a]={mipmaps:[]};for(var s=0;s<t.mipmapCount;s++)n[a].mipmaps.push(t.mipmaps[a*t.mipmapCount+s]),n[a].format=t.format,n[a].width=t.width,n[a].height=t.height}o.format=t.format,o.needsUpdate=!0,r&&r(o)}},h.onerror=i,h.open("GET",u,!0),h.responseType="arraybuffer",h.send(null)}return o},parseDDS:function(e,t){var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var n,o=i("DXT1"),a=i("DXT3"),s=i("DXT5"),l=new Int32Array(e,0,31);if(542327876!==l[0])return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),r;if(4&!l[20])return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),r;var c,u=l[21];switch(u){case o:n=8,r.format=D.RGB_S3TC_DXT1_Format;break;case a:n=16,r.format=D.RGBA_S3TC_DXT3_Format;break;case s:n=16,r.format=D.RGBA_S3TC_DXT5_Format;break;default:return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",(c=u,String.fromCharCode(255&c,c>>8&255,c>>16&255,c>>24&255))),r}r.mipmapCount=1,131072&l[2]&&!1!==t&&(r.mipmapCount=Math.max(1,l[7])),r.isCubemap=!!(512&l[28]),r.width=l[4],r.height=l[3];for(var h=l[1]+4,f=r.width,p=r.height,d=r.isCubemap?6:1,m=0;m<d;m++){for(var g=0;g<r.mipmapCount;g++){var v=Math.max(4,f)/4*Math.max(4,p)/4*n,y={data:new Uint8Array(e,h,v),width:f,height:p};r.mipmaps.push(y),h+=v,f=Math.max(.5*f,1),p=Math.max(.5*p,1)}f=r.width,p=r.height}return r},getNormalMap:function(e,t){var r=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},i=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t|=1;var n=e.width,o=e.height,a=document.createElement("canvas");a.width=n,a.height=o;var s=a.getContext("2d");s.drawImage(e,0,0);for(var l,c,u=s.getImageData(0,0,n,o).data,h=s.createImageData(n,o),f=h.data,p=0;p<n;p++)for(var d=0;d<o;d++){var m=d-1<0?0:d-1,g=d+1>o-1?o-1:d+1,v=p-1<0?0:p-1,y=p+1>n-1?n-1:p+1,x=[],b=[0,0,u[4*(d*n+p)]/255*t];x.push([-1,0,u[4*(d*n+v)]/255*t]),x.push([-1,-1,u[4*(m*n+v)]/255*t]),x.push([0,-1,u[4*(m*n+p)]/255*t]),x.push([1,-1,u[4*(m*n+y)]/255*t]),x.push([1,0,u[4*(d*n+y)]/255*t]),x.push([1,1,u[4*(g*n+y)]/255*t]),x.push([0,1,u[4*(g*n+p)]/255*t]),x.push([-1,1,u[4*(g*n+v)]/255*t]);for(var w=[],S=x.length,_=0;_<S;_++){var M=x[_],T=x[(_+1)%S];M=r(M,b),T=r(T,b),w.push(i((c=T,[(l=M)[1]*c[2]-l[2]*c[1],l[2]*c[0]-l[0]*c[2],l[0]*c[1]-l[1]*c[0]])))}var C=[0,0,0];for(_=0;_<w.length;_++)C[0]+=w[_][0],C[1]+=w[_][1],C[2]+=w[_][2];C[0]/=w.length,C[1]/=w.length,C[2]/=w.length;var A=4*(d*n+p);f[A]=(C[0]+1)/2*255|0,f[A+1]=(C[1]+1)/2*255|0,f[A+2]=255*C[2]|0,f[A+3]=255}return s.putImageData(h,0,0),a},generateDataTexture:function(e,t,r){for(var i=e*t,n=new Uint8Array(3*i),o=Math.floor(255*r.r),a=Math.floor(255*r.g),s=Math.floor(255*r.b),l=0;l<i;l++)n[3*l]=o,n[3*l+1]=a,n[3*l+2]=s;var c=new D.DataTexture(n,e,t,D.RGBFormat);return c.needsUpdate=!0,c}},D.SceneUtils={createMultiMaterialObject:function(e,t){for(var r=new D.Object3D,i=0,n=t.length;i<n;i++)r.add(new D.Mesh(e,t[i]));return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld),t.remove(e),r.add(e)},attach:function(e,t,r){var i=new D.Matrix4;i.getInverse(r.matrixWorld),e.applyMatrix(i),t.remove(e),r.add(e)}},D.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e;this.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t,r=this.getFace(),i=this.size/r.resolution,n=0,o=String(e).split(""),a=o.length,s=[];for(t=0;t<a;t++){var l=new D.Path,c=this.extractGlyphPoints(o[t],r,i,n,l);n+=c.offset,s.push(c.path)}return{paths:s,offset:n/2}},extractGlyphPoints:function(e,t,r,i,n){var o,a,s,l,c,u,h,f,p,d,m,g,v,y,x,b,w,S,_=[],M=t.glyphs[e]||t.glyphs["?"];if(M){if(M.o)for(c=(l=M._cachedOutline||(M._cachedOutline=M.o.split(" "))).length,u=r,h=r,o=0;o<c;)switch(l[o++]){case"m":f=l[o++]*u+i,p=l[o++]*h,n.moveTo(f,p);break;case"l":f=l[o++]*u+i,p=l[o++]*h,n.lineTo(f,p);break;case"q":if(d=l[o++]*u+i,m=l[o++]*h,y=l[o++]*u+i,x=l[o++]*h,n.quadraticCurveTo(y,x,d,m),S=_[_.length-1])for(g=S.x,v=S.y,a=1,s=this.divisions;a<=s;a++){var T=a/s;D.Shape.Utils.b2(T,g,y,d),D.Shape.Utils.b2(T,v,x,m)}break;case"b":if(d=l[o++]*u+i,m=l[o++]*h,y=l[o++]*u+i,x=l[o++]*-h,b=l[o++]*u+i,w=l[o++]*-h,n.bezierCurveTo(d,m,y,x,b,w),S=_[_.length-1])for(g=S.x,v=S.y,a=1,s=this.divisions;a<=s;a++)T=a/s,D.Shape.Utils.b3(T,g,y,b,d),D.Shape.Utils.b3(T,v,x,w,m)}return{offset:M.ha*r,path:n}}}},D.FontUtils.generateShapes=function(e,t){var r=void 0!==(t=t||{}).size?t.size:100,i=void 0!==t.curveSegments?t.curveSegments:4,n=void 0!==t.font?t.font:"helvetiker",o=void 0!==t.weight?t.weight:"normal",a=void 0!==t.style?t.style:"normal";D.FontUtils.size=r,D.FontUtils.divisions=i,D.FontUtils.face=n,D.FontUtils.weight=o,D.FontUtils.style=a;for(var s=D.FontUtils.drawText(e).paths,l=[],c=0,u=s.length;c<u;c++)Array.prototype.push.apply(l,s[c].toShapes());return l},g=D.FontUtils,v=function(e){for(var t=e.length,r=0,i=t-1,n=0;n<t;i=n++)r+=e[i].x*e[n].y-e[n].x*e[i].y;return.5*r},y=function(e,t,r,i,n,o){var a,s,l,c,u,h,f,p,d,m,g,v,y,x,b;if(s=e[o[t]].x,l=e[o[t]].y,c=e[o[r]].x,u=e[o[r]].y,h=e[o[i]].x,1e-10>(c-s)*((f=e[o[i]].y)-l)-(u-l)*(h-s))return!1;for(m=h-c,g=f-u,v=s-h,y=l-f,x=c-s,b=u-l,a=0;a<n;a++)if(a!==t&&a!==r&&a!==i&&(p=e[o[a]].x,m*((d=e[o[a]].y)-u)-g*(p-c)>=0&&v*(d-f)-y*(p-h)>=0&&x*(d-l)-b*(p-s)>=0))return!1;return!0},g.Triangulate=function(e,t){var r=e.length;if(r<3)return null;var i,n,o,a=[],s=[],l=[];if(v(e)>0)for(n=0;n<r;n++)s[n]=n;else for(n=0;n<r;n++)s[n]=r-1-n;var c=r,u=2*c;for(n=c-1;c>2;){if(u--<=0)return console.log("Warning, unable to triangulate polygon!"),t?l:a;if(c<=(i=n)&&(i=0),c<=(n=i+1)&&(n=0),c<=(o=n+1)&&(o=0),y(e,i,n,o,c,s)){var h,f,p,d,m;for(h=s[i],f=s[n],p=s[o],a.push([e[h],e[f],e[p]]),l.push([s[i],s[n],s[o]]),d=n,m=n+1;m<c;d++,m++)s[d]=s[m];u=2*--c}}return t?l:a},g.Triangulate.area=v,self._typeface_js={faces:D.FontUtils.faces,loadFace:D.FontUtils.loadFace},D.typeface_js=self._typeface_js,D.Curve=function(){},D.Curve.prototype.getPoint=function(e){return console.log("Warning, getPoint() not implemented!"),null},D.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},D.Curve.prototype.getPoints=function(e){e||(e=5);var t,r=[];for(t=0;t<=e;t++)r.push(this.getPoint(t/e));return r},D.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,r=[];for(t=0;t<=e;t++)r.push(this.getPointAt(t/e));return r},D.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},D.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,i=[],n=this.getPoint(0),o=0;for(i.push(0),r=1;r<=e;r++)o+=(t=this.getPoint(r/e)).distanceTo(n),i.push(o),n=t;return this.cacheArcLengths=i,i},D.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},D.Curve.prototype.getUtoTmapping=function(e,t){var r,i=this.getLengths(),n=0,o=i.length;r=t||e*i[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=i[n=Math.floor(s+(l-s)/2)]-r)<0)s=n+1;else{if(!(a>0)){l=n;break}l=n-1}if(i[n=l]==r)return n/(o-1);var c=i[n];return(n+(r-c)/(i[n+1]-c))/(o-1)},D.Curve.prototype.getTangent=function(e){var t=e-1e-4,r=e+1e-4;t<0&&(t=0),r>1&&(r=1);var i=this.getPoint(t);return this.getPoint(r).clone().sub(i).normalize()},D.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},D.LineCurve=function(e,t){this.v1=e,this.v2=t},D.LineCurve.prototype=Object.create(D.Curve.prototype),D.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},D.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},D.LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},D.QuadraticBezierCurve=function(e,t,r){this.v0=e,this.v1=t,this.v2=r},D.QuadraticBezierCurve.prototype=Object.create(D.Curve.prototype),D.QuadraticBezierCurve.prototype.getPoint=function(e){var t,r;return t=D.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),r=D.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new D.Vector2(t,r)},D.QuadraticBezierCurve.prototype.getTangent=function(e){var t,r;t=D.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),r=D.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);var i=new D.Vector2(t,r);return i.normalize(),i},D.CubicBezierCurve=function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},D.CubicBezierCurve.prototype=Object.create(D.Curve.prototype),D.CubicBezierCurve.prototype.getPoint=function(e){var t,r;return t=D.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=D.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new D.Vector2(t,r)},D.CubicBezierCurve.prototype.getTangent=function(e){var t,r;t=D.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=D.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var i=new D.Vector2(t,r);return i.normalize(),i},D.SplineCurve=function(e){this.points=null==e?[]:e},D.SplineCurve.prototype=Object.create(D.Curve.prototype),D.SplineCurve.prototype.getPoint=function(e){var t,r,i,n=new D.Vector2,o=[],a=this.points;return i=(t=(a.length-1)*e)-(r=Math.floor(t)),o[0]=0==r?r:r-1,o[1]=r,o[2]=r>a.length-2?a.length-1:r+1,o[3]=r>a.length-3?a.length-1:r+2,n.x=D.Curve.Utils.interpolate(a[o[0]].x,a[o[1]].x,a[o[2]].x,a[o[3]].x,i),n.y=D.Curve.Utils.interpolate(a[o[0]].y,a[o[1]].y,a[o[2]].y,a[o[3]].y,i),n},D.EllipseCurve=function(e,t,r,i,n,o,a){this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=o,this.aClockwise=a},D.EllipseCurve.prototype=Object.create(D.Curve.prototype),D.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;this.aClockwise||(e=1-e);var r=this.aStartAngle+e*t,i=this.aX+this.xRadius*Math.cos(r),n=this.aY+this.yRadius*Math.sin(r);return new D.Vector2(i,n)},D.ArcCurve=function(e,t,r,i,n,o){D.EllipseCurve.call(this,e,t,r,r,i,n,o)},D.ArcCurve.prototype=Object.create(D.EllipseCurve.prototype),D.Curve.Utils={tangentQuadraticBezier:function(e,t,r,i){return 2*(1-e)*(r-t)+2*e*(i-r)},tangentCubicBezier:function(e,t,r,i,n){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*i*(1-e)-3*e*e*i+3*e*e*n},tangentSpline:function(e,t,r,i,n){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,r,i,n){var o=.5*(r-e),a=.5*(i-t),s=n*n;return(2*t-2*r+o+a)*(n*s)+(-3*t+3*r-2*o-a)*s+o*n+t}},D.Curve.create=function(e,t){return e.prototype=Object.create(D.Curve.prototype),e.prototype.getPoint=t,e},D.LineCurve3=D.Curve.create((function(e,t){this.v1=e,this.v2=t}),(function(e){var t=new D.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t})),D.QuadraticBezierCurve3=D.Curve.create((function(e,t,r){this.v0=e,this.v1=t,this.v2=r}),(function(e){var t,r,i;return t=D.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),r=D.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),i=D.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new D.Vector3(t,r,i)})),D.CubicBezierCurve3=D.Curve.create((function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i}),(function(e){var t,r,i;return t=D.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=D.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),i=D.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new D.Vector3(t,r,i)})),D.SplineCurve3=D.Curve.create((function(e){this.points=null==e?[]:e}),(function(e){var t,r,i,n=new D.Vector3,o=[],a=this.points;i=(t=(a.length-1)*e)-(r=Math.floor(t)),o[0]=0==r?r:r-1,o[1]=r,o[2]=r>a.length-2?a.length-1:r+1,o[3]=r>a.length-3?a.length-1:r+2;var s=a[o[0]],l=a[o[1]],c=a[o[2]],u=a[o[3]];return n.x=D.Curve.Utils.interpolate(s.x,l.x,c.x,u.x,i),n.y=D.Curve.Utils.interpolate(s.y,l.y,c.y,u.y,i),n.z=D.Curve.Utils.interpolate(s.z,l.z,c.z,u.z,i),n})),D.ClosedSplineCurve3=D.Curve.create((function(e){this.points=null==e?[]:e}),(function(e){var t,r,i,n=new D.Vector3,o=[],a=this.points;return i=(t=(a.length-0)*e)-(r=Math.floor(t)),r+=r>0?0:(Math.floor(Math.abs(r)/a.length)+1)*a.length,o[0]=(r-1)%a.length,o[1]=r%a.length,o[2]=(r+1)%a.length,o[3]=(r+2)%a.length,n.x=D.Curve.Utils.interpolate(a[o[0]].x,a[o[1]].x,a[o[2]].x,a[o[3]].x,i),n.y=D.Curve.Utils.interpolate(a[o[0]].y,a[o[1]].y,a[o[2]].y,a[o[3]].y,i),n.z=D.Curve.Utils.interpolate(a[o[0]].z,a[o[1]].z,a[o[2]].z,a[o[3]].z,i),n})),D.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},D.CurvePath.prototype=Object.create(D.Curve.prototype),D.CurvePath.prototype.add=function(e){this.curves.push(e)},D.CurvePath.prototype.checkConnection=function(){},D.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new D.LineCurve(t,e))},D.CurvePath.prototype.getPoint=function(e){for(var t,r=e*this.getLength(),i=this.getCurveLengths(),n=0;n<i.length;){if(i[n]>=r){var o=1-(i[n]-r)/(t=this.curves[n]).getLength();return t.getPointAt(o)}n++}return null},D.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},D.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],r=0,i=this.curves.length;for(e=0;e<i;e++)r+=this.curves[e].getLength(),t.push(r);return this.cacheLengths=t,t},D.CurvePath.prototype.getBoundingBox=function(){var e,t,r,i,n,o,a,s,l,c,u=this.getPoints();e=t=Number.NEGATIVE_INFINITY,i=n=Number.POSITIVE_INFINITY;var h=u[0]instanceof D.Vector3;for(c=h?new D.Vector3:new D.Vector2,s=0,l=u.length;s<l;s++)(a=u[s]).x>e?e=a.x:a.x<i&&(i=a.x),a.y>t?t=a.y:a.y<n&&(n=a.y),h&&(a.z>r?r=a.z:a.z<o&&(o=a.z)),c.add(a);var f={minX:i,minY:n,maxX:e,maxY:t,centroid:c.divideScalar(l)};return h&&(f.maxZ=r,f.minZ=o),f},D.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},D.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},D.CurvePath.prototype.createGeometry=function(e){for(var t=new D.Geometry,r=0;r<e.length;r++)t.vertices.push(new D.Vector3(e[r].x,e[r].y,e[r].z||0));return t},D.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},D.CurvePath.prototype.getTransformedPoints=function(e,t){var r,i,n=this.getPoints(e);for(t||(t=this.bends),r=0,i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},D.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var r,i,n=this.getSpacedPoints(e);for(t||(t=this.bends),r=0,i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},D.CurvePath.prototype.getWrapPoints=function(e,t){var r,i,n,o,a,s,l=this.getBoundingBox();for(r=0,i=e.length;r<i;r++){o=(n=e[r]).x,a=n.y,s=o/l.maxX,s=t.getUtoTmapping(s,o);var c=t.getPoint(s),u=t.getNormalVector(s).multiplyScalar(a);n.x=c.x+u.x,n.y=c.y+u.y}return e},D.Gyroscope=function(){D.Object3D.call(this)},D.Gyroscope.prototype=Object.create(D.Object3D.prototype),D.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.makeFromPositionQuaternionScale(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;t<r;t++)this.children[t].updateMatrixWorld(e)},D.Gyroscope.prototype.translationWorld=new D.Vector3,D.Gyroscope.prototype.translationObject=new D.Vector3,D.Gyroscope.prototype.rotationWorld=new D.Quaternion,D.Gyroscope.prototype.rotationObject=new D.Quaternion,D.Gyroscope.prototype.scaleWorld=new D.Vector3,D.Gyroscope.prototype.scaleObject=new D.Vector3,D.Path=function(e){D.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},D.Path.prototype=Object.create(D.CurvePath.prototype),D.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},D.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},D.Path.prototype.moveTo=function(e,t){var r=Array.prototype.slice.call(arguments);this.actions.push({action:D.PathActions.MOVE_TO,args:r})},D.Path.prototype.lineTo=function(e,t){var r=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,n=i[i.length-2],o=i[i.length-1],a=new D.LineCurve(new D.Vector2(n,o),new D.Vector2(e,t));this.curves.push(a),this.actions.push({action:D.PathActions.LINE_TO,args:r})},D.Path.prototype.quadraticCurveTo=function(e,t,r,i){var n=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,a=o[o.length-2],s=o[o.length-1],l=new D.QuadraticBezierCurve(new D.Vector2(a,s),new D.Vector2(e,t),new D.Vector2(r,i));this.curves.push(l),this.actions.push({action:D.PathActions.QUADRATIC_CURVE_TO,args:n})},D.Path.prototype.bezierCurveTo=function(e,t,r,i,n,o){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,l=s[s.length-2],c=s[s.length-1],u=new D.CubicBezierCurve(new D.Vector2(l,c),new D.Vector2(e,t),new D.Vector2(r,i),new D.Vector2(n,o));this.curves.push(u),this.actions.push({action:D.PathActions.BEZIER_CURVE_TO,args:a})},D.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,i=r[r.length-2],n=r[r.length-1],o=[new D.Vector2(i,n)];Array.prototype.push.apply(o,e);var a=new D.SplineCurve(o);this.curves.push(a),this.actions.push({action:D.PathActions.CSPLINE_THRU,args:t})},D.Path.prototype.arc=function(e,t,r,i,n,o){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],l=a[a.length-1];this.absarc(e+s,t+l,r,i,n,o)},D.Path.prototype.absarc=function(e,t,r,i,n,o){this.absellipse(e,t,r,r,i,n,o)},D.Path.prototype.ellipse=function(e,t,r,i,n,o,a){var s=this.actions[this.actions.length-1].args,l=s[s.length-2],c=s[s.length-1];this.absellipse(e+l,t+c,r,i,n,o,a)},D.Path.prototype.absellipse=function(e,t,r,i,n,o,a){var s=Array.prototype.slice.call(arguments),l=new D.EllipseCurve(e,t,r,i,n,o,a);this.curves.push(l);var c=l.getPoint(a?1:0);s.push(c.x),s.push(c.y),this.actions.push({action:D.PathActions.ELLIPSE,args:s})},D.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var r=[],i=0;i<e;i++)r.push(this.getPoint(i/e));return r},D.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var r,i,n,o,a,s,l,c,u,h,f,p,d,m,g,v,y,x,b=[];for(r=0,i=this.actions.length;r<i;r++)switch(o=(n=this.actions[r]).action,a=n.args,o){case D.PathActions.MOVE_TO:case D.PathActions.LINE_TO:b.push(new D.Vector2(a[0],a[1]));break;case D.PathActions.QUADRATIC_CURVE_TO:for(s=a[2],l=a[3],h=a[0],f=a[1],b.length>0?(p=(m=b[b.length-1]).x,d=m.y):(p=(m=this.actions[r-1].args)[m.length-2],d=m[m.length-1]),g=1;g<=e;g++)v=g/e,y=D.Shape.Utils.b2(v,p,h,s),x=D.Shape.Utils.b2(v,d,f,l),b.push(new D.Vector2(y,x));break;case D.PathActions.BEZIER_CURVE_TO:for(s=a[4],l=a[5],h=a[0],f=a[1],c=a[2],u=a[3],b.length>0?(p=(m=b[b.length-1]).x,d=m.y):(p=(m=this.actions[r-1].args)[m.length-2],d=m[m.length-1]),g=1;g<=e;g++)v=g/e,y=D.Shape.Utils.b3(v,p,h,c,s),x=D.Shape.Utils.b3(v,d,f,u,l),b.push(new D.Vector2(y,x));break;case D.PathActions.CSPLINE_THRU:m=this.actions[r-1].args;var w=[new D.Vector2(m[m.length-2],m[m.length-1])],S=e*a[0].length;w=w.concat(a[0]);var _=new D.SplineCurve(w);for(g=1;g<=S;g++)b.push(_.getPointAt(g/S));break;case D.PathActions.ARC:var M=a[0],T=a[1],C=a[2],A=a[3],E=a[4],L=!!a[5],P=E-A,R=2*e;for(g=1;g<=R;g++)v=g/R,L||(v=1-v),F=A+v*P,y=M+C*Math.cos(F),x=T+C*Math.sin(F),b.push(new D.Vector2(y,x));break;case D.PathActions.ELLIPSE:M=a[0],T=a[1];var F,O=a[2],U=a[3];A=a[4],E=a[5],L=!!a[6],P=E-A,R=2*e;for(g=1;g<=R;g++)v=g/R,L||(v=1-v),F=A+v*P,y=M+O*Math.cos(F),x=T+U*Math.sin(F),b.push(new D.Vector2(y,x))}var N=b[b.length-1];return Math.abs(N.x-b[0].x)<1e-10&&Math.abs(N.y-b[0].y)<1e-10&&b.splice(b.length-1,1),t&&b.push(b[0]),b},D.Path.prototype.toShapes=function(){var e,t,r,i,n,o=[],a=new D.Path;for(e=0,t=this.actions.length;e<t;e++)n=(r=this.actions[e]).args,(i=r.action)==D.PathActions.MOVE_TO&&0!=a.actions.length&&(o.push(a),a=new D.Path),a[i].apply(a,n);if(0!=a.actions.length&&o.push(a),0==o.length)return[];var s,l,c=[],u=!D.Shape.Utils.isClockWise(o[0].getPoints());if(1==o.length)return s=o[0],(l=new D.Shape).actions=s.actions,l.curves=s.curves,c.push(l),c;if(u)for(l=new D.Shape,e=0,t=o.length;e<t;e++)s=o[e],D.Shape.Utils.isClockWise(s.getPoints())?(l.actions=s.actions,l.curves=s.curves,c.push(l),l=new D.Shape):l.holes.push(s);else{for(e=0,t=o.length;e<t;e++)s=o[e],D.Shape.Utils.isClockWise(s.getPoints())?(l&&c.push(l),(l=new D.Shape).actions=s.actions,l.curves=s.curves):l.holes.push(s);c.push(l)}return c},D.Shape=function(){D.Path.apply(this,arguments),this.holes=[]},D.Shape.prototype=Object.create(D.Path.prototype),D.Shape.prototype.extrude=function(e){return new D.ExtrudeGeometry(this,e)},D.Shape.prototype.makeGeometry=function(e){return new D.ShapeGeometry(this,e)},D.Shape.prototype.getPointsHoles=function(e){var t,r=this.holes.length,i=[];for(t=0;t<r;t++)i[t]=this.holes[t].getTransformedPoints(e,this.bends);return i},D.Shape.prototype.getSpacedPointsHoles=function(e){var t,r=this.holes.length,i=[];for(t=0;t<r;t++)i[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return i},D.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},D.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},D.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},D.Shape.Utils={removeHoles:function(e,t){var r,i,n,o,a,s,l,c,u,h,f,p,d,m,g,v,y=e.concat(),x=y.concat(),b=[];for(a=0;a<t.length;a++){for(l=t[a],Array.prototype.push.apply(x,l),c=Number.POSITIVE_INFINITY,s=0;s<l.length;s++){f=l[s];var w=[];for(h=0;h<y.length;h++)p=y[h],u=f.distanceToSquared(p),w.push(u),u<c&&(c=u,n=s,o=h)}r=o-1>=0?o-1:y.length-1,i=n-1>=0?n-1:l.length-1;var S=[l[n],y[o],y[r]],_=D.FontUtils.Triangulate.area(S),M=[l[n],l[i],y[o]],T=D.FontUtils.Triangulate.area(M),C=o,A=n;n+=-1,(o+=1)<0&&(o+=y.length),o%=y.length,n<0&&(n+=l.length),n%=l.length,r=o-1>=0?o-1:y.length-1,i=n-1>=0?n-1:l.length-1,S=[l[n],y[o],y[r]];var E=D.FontUtils.Triangulate.area(S);M=[l[n],l[i],y[o]],_+T>E+D.FontUtils.Triangulate.area(M)&&(n=A,(o=C)<0&&(o+=y.length),o%=y.length,n<0&&(n+=l.length),n%=l.length,r=o-1>=0?o-1:y.length-1,i=n-1>=0?n-1:l.length-1),d=y.slice(0,o),m=y.slice(o),g=l.slice(n),v=l.slice(0,n);var L=[l[n],y[o],y[r]],P=[l[n],l[i],y[o]];b.push(L),b.push(P),y=d.concat(g).concat(v).concat(m)}return{shape:y,isolatedPts:b,allpoints:x}},triangulateShape:function(e,t){var r,i,n,o,a,s,l=D.Shape.Utils.removeHoles(e,t),c=l.shape,u=l.allpoints,h=l.isolatedPts,f=D.FontUtils.Triangulate(c,!1),p={};for(r=0,i=u.length;r<i;r++)void 0!==p[a=u[r].x+":"+u[r].y]&&console.log("Duplicate point",a),p[a]=r;for(r=0,i=f.length;r<i;r++)for(o=f[r],n=0;n<3;n++)void 0!==(s=p[a=o[n].x+":"+o[n].y])&&(o[n]=s);for(r=0,i=h.length;r<i;r++)for(o=h[r],n=0;n<3;n++)void 0!==(s=p[a=o[n].x+":"+o[n].y])&&(o[n]=s);return f.concat(h)},isClockWise:function(e){return D.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var r=1-e;return r*r*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,r,i){return this.b2p0(e,t)+this.b2p1(e,r)+this.b2p2(e,i)},b3p0:function(e,t){var r=1-e;return r*r*r*t},b3p1:function(e,t){var r=1-e;return 3*r*r*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,r,i,n){return this.b3p0(e,t)+this.b3p1(e,r)+this.b3p2(e,i)+this.b3p3(e,n)}},D.AnimationHandler=(x=[],b={},w={update:function(e){for(var t=0;t<x.length;t++)x[t].update(e)},addToUpdate:function(e){-1===x.indexOf(e)&&x.push(e)},removeFromUpdate:function(e){var t=x.indexOf(e);-1!==t&&x.splice(t,1)},add:function(e){void 0!==b[e.name]&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),b[e.name]=e,_(e)},get:function(e){if("string"==typeof e)return b[e]?b[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null)},parse:function(e){var t=[];if(e instanceof D.SkinnedMesh)for(var r=0;r<e.bones.length;r++)t.push(e.bones[r]);else S(e,t);return t}},S=function(e,t){t.push(e);for(var r=0;r<e.children.length;r++)S(e.children[r],t)},_=function(e){if(!0!==e.initialized){for(var t=0;t<e.hierarchy.length;t++){for(var r=0;r<e.hierarchy[t].keys.length;r++)if(e.hierarchy[t].keys[r].time<0&&(e.hierarchy[t].keys[r].time=0),void 0!==e.hierarchy[t].keys[r].rot&&!(e.hierarchy[t].keys[r].rot instanceof D.Quaternion)){var i=e.hierarchy[t].keys[r].rot;e.hierarchy[t].keys[r].rot=new D.Quaternion(i[0],i[1],i[2],i[3])}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){var n={};for(r=0;r<e.hierarchy[t].keys.length;r++)for(var o=0;o<e.hierarchy[t].keys[r].morphTargets.length;o++)n[s=e.hierarchy[t].keys[r].morphTargets[o]]=-1;for(e.hierarchy[t].usedMorphTargets=n,r=0;r<e.hierarchy[t].keys.length;r++){var a={};for(var s in n){for(o=0;o<e.hierarchy[t].keys[r].morphTargets.length;o++)if(e.hierarchy[t].keys[r].morphTargets[o]===s){a[s]=e.hierarchy[t].keys[r].morphTargetsInfluences[o];break}o===e.hierarchy[t].keys[r].morphTargets.length&&(a[s]=0)}e.hierarchy[t].keys[r].morphTargetsInfluences=a}}for(r=1;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].time===e.hierarchy[t].keys[r-1].time&&(e.hierarchy[t].keys.splice(r,1),r--);for(r=0;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].index=r}var l=parseInt(e.length*e.fps,10);for(e.JIT={},e.JIT.hierarchy=[],t=0;t<e.hierarchy.length;t++)e.JIT.hierarchy.push(new Array(l));e.initialized=!0}},w.LINEAR=0,w.CATMULLROM=1,w.CATMULLROM_FORWARD=2,w),D.Animation=function(e,t,r){this.root=e,this.data=D.AnimationHandler.get(t),this.hierarchy=D.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.interpolationType=void 0!==r?r:D.AnimationHandler.LINEAR,this.points=[],this.target=new D.Vector3},D.Animation.prototype.play=function(e,t){if(!1===this.isPlaying){this.isPlaying=!0,this.loop=void 0===e||e,this.currentTime=void 0!==t?t:0;var r,i,n=this.hierarchy.length;for(r=0;r<n;r++){i=this.hierarchy[r],this.interpolationType!==D.AnimationHandler.CATMULLROM_FORWARD&&(i.useQuaternion=!0),i.matrixAutoUpdate=!0,void 0===i.animationCache&&(i.animationCache={},i.animationCache.prevKey={pos:0,rot:0,scl:0},i.animationCache.nextKey={pos:0,rot:0,scl:0},i.animationCache.originalMatrix=i instanceof D.Bone?i.skinMatrix:i.matrix);var o=i.animationCache.prevKey,a=i.animationCache.nextKey;o.pos=this.data.hierarchy[r].keys[0],o.rot=this.data.hierarchy[r].keys[0],o.scl=this.data.hierarchy[r].keys[0],a.pos=this.getNextKeyWith("pos",r,1),a.rot=this.getNextKeyWith("rot",r,1),a.scl=this.getNextKeyWith("scl",r,1)}this.update(0)}this.isPaused=!1,D.AnimationHandler.addToUpdate(this)},D.Animation.prototype.pause=function(){!0===this.isPaused?D.AnimationHandler.addToUpdate(this):D.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},D.Animation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,D.AnimationHandler.removeFromUpdate(this)},D.Animation.prototype.update=function(e){if(!1!==this.isPlaying){var t,r,i,n,o,a,s,l,c,u,h,f,p,d,m=["pos","rot","scl"];this.data.JIT.hierarchy;this.currentTime+=e*this.timeScale,h=this.currentTime,u=this.currentTime=this.currentTime%this.data.length,parseInt(Math.min(u*this.data.fps,this.data.length*this.data.fps),10);for(var g=0,v=this.hierarchy.length;g<v;g++){c=(l=this.hierarchy[g]).animationCache;for(var y=0;y<3;y++){if(t=m[y],a=c.prevKey[t],(s=c.nextKey[t]).time<=h){if(u<h){if(!this.loop)return void this.stop();for(a=this.data.hierarchy[g].keys[0],s=this.getNextKeyWith(t,g,1);s.time<u;)a=s,s=this.getNextKeyWith(t,g,s.index+1)}else do{a=s,s=this.getNextKeyWith(t,g,s.index+1)}while(s.time<u);c.prevKey[t]=a,c.nextKey[t]=s}l.matrixAutoUpdate=!0,l.matrixWorldNeedsUpdate=!0,r=(u-a.time)/(s.time-a.time),n=a[t],o=s[t],(r<0||r>1)&&(console.log("THREE.Animation.update: Warning! Scale out of bounds:"+r+" on bone "+g),r=r<0?0:1),"pos"===t?(i=l.position,this.interpolationType===D.AnimationHandler.LINEAR?(i.x=n[0]+(o[0]-n[0])*r,i.y=n[1]+(o[1]-n[1])*r,i.z=n[2]+(o[2]-n[2])*r):this.interpolationType!==D.AnimationHandler.CATMULLROM&&this.interpolationType!==D.AnimationHandler.CATMULLROM_FORWARD||(this.points[0]=this.getPrevKeyWith("pos",g,a.index-1).pos,this.points[1]=n,this.points[2]=o,this.points[3]=this.getNextKeyWith("pos",g,s.index+1).pos,r=.33*r+.33,f=this.interpolateCatmullRom(this.points,r),i.x=f[0],i.y=f[1],i.z=f[2],this.interpolationType===D.AnimationHandler.CATMULLROM_FORWARD&&(p=this.interpolateCatmullRom(this.points,1.01*r),this.target.set(p[0],p[1],p[2]),this.target.sub(i),this.target.y=0,this.target.normalize(),d=Math.atan2(this.target.x,this.target.z),l.rotation.set(0,d,0)))):"rot"===t?D.Quaternion.slerp(n,o,l.quaternion,r):"scl"===t&&((i=l.scale).x=n[0]+(o[0]-n[0])*r,i.y=n[1]+(o[1]-n[1])*r,i.z=n[2]+(o[2]-n[2])*r)}}}},D.Animation.prototype.interpolateCatmullRom=function(e,t){var r,i,n,o,a,s,l,c,u,h=[],f=[];return n=(r=(e.length-1)*t)-(i=Math.floor(r)),h[0]=0===i?i:i-1,h[1]=i,h[2]=i>e.length-2?i:i+1,h[3]=i>e.length-3?i:i+2,s=e[h[0]],l=e[h[1]],c=e[h[2]],u=e[h[3]],a=n*(o=n*n),f[0]=this.interpolate(s[0],l[0],c[0],u[0],n,o,a),f[1]=this.interpolate(s[1],l[1],c[1],u[1],n,o,a),f[2]=this.interpolate(s[2],l[2],c[2],u[2],n,o,a),f},D.Animation.prototype.interpolate=function(e,t,r,i,n,o,a){var s=.5*(r-e),l=.5*(i-t);return(2*(t-r)+s+l)*a+(-3*(t-r)-2*s-l)*o+s*n+t},D.Animation.prototype.getNextKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(this.interpolationType===D.AnimationHandler.CATMULLROM||this.interpolationType===D.AnimationHandler.CATMULLROM_FORWARD?r=r<i.length-1?r:i.length-1:r%=i.length;r<i.length;r++)if(void 0!==i[r][e])return i[r];return this.data.hierarchy[t].keys[0]},D.Animation.prototype.getPrevKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(r=this.interpolationType===D.AnimationHandler.CATMULLROM||this.interpolationType===D.AnimationHandler.CATMULLROM_FORWARD?r>0?r:0:r>=0?r:r+i.length;r>=0;r--)if(void 0!==i[r][e])return i[r];return this.data.hierarchy[t].keys[i.length-1]},D.KeyFrameAnimation=function(e,t,r){this.root=e,this.data=D.AnimationHandler.get(t),this.hierarchy=D.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.JITCompile=void 0===r||r;for(var i=0,n=this.hierarchy.length;i<n;i++){var o=this.data.hierarchy[i].keys,a=this.data.hierarchy[i].sids,s=this.hierarchy[i];if(o.length&&a){for(var l=0;l<a.length;l++){var c=a[l],u=this.getNextKeyWith(c,i,0);u&&u.apply(c)}s.matrixAutoUpdate=!1,this.data.hierarchy[i].node.updateMatrix(),s.matrixWorldNeedsUpdate=!0}}},D.KeyFrameAnimation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0===e||e,this.currentTime=void 0!==t?t:0,this.startTimeMs=t,this.startTime=1e7,this.endTime=-this.startTime;var r,i,n,o=this.hierarchy.length;for(r=0;r<o;r++){i=this.hierarchy[r],n=this.data.hierarchy[r],i.useQuaternion=!0,void 0===n.animationCache&&(n.animationCache={},n.animationCache.prevKey=null,n.animationCache.nextKey=null,n.animationCache.originalMatrix=i instanceof D.Bone?i.skinMatrix:i.matrix);var a=this.data.hierarchy[r].keys;a.length&&(n.animationCache.prevKey=a[0],n.animationCache.nextKey=a[1],this.startTime=Math.min(a[0].time,this.startTime),this.endTime=Math.max(a[a.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,D.AnimationHandler.addToUpdate(this)},D.KeyFrameAnimation.prototype.pause=function(){this.isPaused?D.AnimationHandler.addToUpdate(this):D.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},D.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,D.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],r=this.data.hierarchy[e];if(void 0!==r.animationCache){var i=r.animationCache.originalMatrix;t instanceof D.Bone?(i.copy(t.skinMatrix),t.skinMatrix=i):(i.copy(t.matrix),t.matrix=i),delete r.animationCache}}},D.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying){var t,r,i,n,o,a,s,l,c=this.data.JIT.hierarchy;if(this.currentTime+=e*this.timeScale,s=this.currentTime,(a=this.currentTime=this.currentTime%this.data.length)<this.startTimeMs&&(a=this.currentTime=this.startTimeMs+a),o=parseInt(Math.min(a*this.data.fps,this.data.length*this.data.fps),10),!(l=a<s)||this.loop){if(!(a<this.startTime)){for(f=0,p=this.hierarchy.length;f<p;f++){i=this.hierarchy[f];d=(n=this.data.hierarchy[f]).keys;var u=n.animationCache;if(this.JITCompile&&void 0!==c[f][o])i instanceof D.Bone?(i.skinMatrix=c[f][o],i.matrixWorldNeedsUpdate=!1):(i.matrix=c[f][o],i.matrixWorldNeedsUpdate=!0);else if(d.length){if(this.JITCompile&&u&&(i instanceof D.Bone?i.skinMatrix=u.originalMatrix:i.matrix=u.originalMatrix),t=u.prevKey,r=u.nextKey,t&&r){if(r.time<=s){if(l&&this.loop)for(t=d[0],r=d[1];r.time<a;)r=d[(t=r).index+1];else if(!l)for(var h=d.length-1;r.time<a&&r.index!==h;)r=d[(t=r).index+1];u.prevKey=t,u.nextKey=r}r.time>=a?t.interpolate(r,a):t.interpolate(r,r.time)}this.data.hierarchy[f].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===c[0][o]){this.hierarchy[0].updateMatrixWorld(!0);for(f=0;f<this.hierarchy.length;f++)this.hierarchy[f]instanceof D.Bone?c[f][o]=this.hierarchy[f].skinMatrix.clone():c[f][o]=this.hierarchy[f].matrix.clone()}}}else{for(var f=0,p=this.hierarchy.length;f<p;f++){var d=this.data.hierarchy[f].keys,m=this.data.hierarchy[f].sids,g=d.length-1,v=this.hierarchy[f];if(d.length){for(var y=0;y<m.length;y++){var x=m[y],b=this.getPrevKeyWith(x,f,g);b&&b.apply(x)}this.data.hierarchy[f].node.updateMatrix(),v.matrixWorldNeedsUpdate=!0}}this.stop()}}},D.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(r%=i.length;r<i.length;r++)if(i[r].hasTarget(e))return i[r];return i[0]},D.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(r=r>=0?r:r+i.length;r>=0;r--)if(i[r].hasTarget(e))return i[r];return i[i.length-1]},D.CubeCamera=function(e,t,r){D.Object3D.call(this);var i=new D.PerspectiveCamera(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new D.Vector3(1,0,0)),this.add(i);var n=new D.PerspectiveCamera(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new D.Vector3(-1,0,0)),this.add(n);var o=new D.PerspectiveCamera(90,1,e,t);o.up.set(0,0,1),o.lookAt(new D.Vector3(0,1,0)),this.add(o);var a=new D.PerspectiveCamera(90,1,e,t);a.up.set(0,0,-1),a.lookAt(new D.Vector3(0,-1,0)),this.add(a);var s=new D.PerspectiveCamera(90,1,e,t);s.up.set(0,-1,0),s.lookAt(new D.Vector3(0,0,1)),this.add(s);var l=new D.PerspectiveCamera(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new D.Vector3(0,0,-1)),this.add(l),this.renderTarget=new D.WebGLRenderTargetCube(r,r,{format:D.RGBFormat,magFilter:D.LinearFilter,minFilter:D.LinearFilter}),this.updateCubeMap=function(e,t){var r=this.renderTarget,c=r.generateMipmaps;r.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,i,r),r.activeCubeFace=1,e.render(t,n,r),r.activeCubeFace=2,e.render(t,o,r),r.activeCubeFace=3,e.render(t,a,r),r.activeCubeFace=4,e.render(t,s,r),r.generateMipmaps=c,r.activeCubeFace=5,e.render(t,l,r)}},D.CubeCamera.prototype=Object.create(D.Object3D.prototype),D.CombinedCamera=function(e,t,r,i,n,o,a){D.Camera.call(this),this.fov=r,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new D.OrthographicCamera(e/-2,e/2,t/2,t/-2,o,a),this.cameraP=new D.PerspectiveCamera(r,e/t,i,n),this.zoom=1,this.toPerspective()},D.CombinedCamera.prototype=Object.create(D.Camera.prototype),D.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},D.CombinedCamera.prototype.toOrthographic=function(){var e=this.fov,t=this.cameraP.aspect,r=(this.cameraP.near+this.cameraP.far)/2,i=Math.tan(e/2)*r,n=2*i*t/2;i/=this.zoom,n/=this.zoom,this.cameraO.left=-n,this.cameraO.right=n,this.cameraO.top=i,this.cameraO.bottom=-i,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},D.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},D.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},D.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},D.CombinedCamera.prototype.setLens=function(e,t){void 0===t&&(t=24);var r=2*D.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(r),r},D.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},D.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},D.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},D.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},D.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},D.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},D.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},D.CircleGeometry=function(e,t,r,i){D.Geometry.call(this),e=e||50,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,t=void 0!==t?Math.max(3,t):8;var n,o=[],a=new D.Vector3,s=new D.Vector2(.5,.5);for(this.vertices.push(a),o.push(s),n=0;n<=t;n++){var l=new D.Vector3,c=r+n/t*i;l.x=e*Math.cos(c),l.y=e*Math.sin(c),this.vertices.push(l),o.push(new D.Vector2((l.x/e+1)/2,(l.y/e+1)/2))}var u=new D.Vector3(0,0,1);for(n=1;n<=t;n++){var h=n,f=n+1;this.faces.push(new D.Face3(h,f,0,[u,u,u])),this.faceVertexUvs[0].push([o[n],o[n+1],s])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new D.Sphere(new D.Vector3,e)},D.CircleGeometry.prototype=Object.create(D.Geometry.prototype),D.CubeGeometry=function(e,t,r,i,n,o){D.Geometry.call(this);var a=this;this.width=e,this.height=t,this.depth=r,this.widthSegments=i||1,this.heightSegments=n||1,this.depthSegments=o||1;var s=this.width/2,l=this.height/2,c=this.depth/2;function u(e,t,r,i,n,o,s,l){var c,u,h,f=a.widthSegments,p=a.heightSegments,d=n/2,m=o/2,g=a.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?c="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(c="y",p=a.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(c="x",f=a.depthSegments);var v=f+1,y=p+1,x=n/f,b=o/p,w=new D.Vector3;for(w[c]=s>0?1:-1,h=0;h<y;h++)for(u=0;u<v;u++){var S=new D.Vector3;S[e]=(u*x-d)*r,S[t]=(h*b-m)*i,S[c]=s,a.vertices.push(S)}for(h=0;h<p;h++)for(u=0;u<f;u++){var _=u+v*h,M=u+v*(h+1),T=u+1+v*(h+1),C=u+1+v*h,A=new D.Face4(_+g,M+g,T+g,C+g);A.normal.copy(w),A.vertexNormals.push(w.clone(),w.clone(),w.clone(),w.clone()),A.materialIndex=l,a.faces.push(A),a.faceVertexUvs[0].push([new D.Vector2(u/f,1-h/p),new D.Vector2(u/f,1-(h+1)/p),new D.Vector2((u+1)/f,1-(h+1)/p),new D.Vector2((u+1)/f,1-h/p)])}}u("z","y",-1,-1,this.depth,this.height,s,0),u("z","y",1,-1,this.depth,this.height,-s,1),u("x","z",1,1,this.width,this.depth,l,2),u("x","z",1,-1,this.width,this.depth,-l,3),u("x","y",1,-1,this.width,this.height,c,4),u("x","y",-1,-1,this.width,this.height,-c,5),this.computeCentroids(),this.mergeVertices()},D.CubeGeometry.prototype=Object.create(D.Geometry.prototype),D.CylinderGeometry=function(e,t,r,i,n,o){D.Geometry.call(this),this.radiusTop=e=void 0!==e?e:20,this.radiusBottom=t=void 0!==t?t:20,this.height=r=void 0!==r?r:100,this.radiusSegments=i=i||8,this.heightSegments=n=n||1,this.openEnded=o=void 0!==o&&o;var a,s,l=r/2,c=[],u=[];for(s=0;s<=n;s++){var h=[],f=[],p=s/n,d=p*(t-e)+e;for(a=0;a<=i;a++){var m=a/i,g=new D.Vector3;g.x=d*Math.sin(m*Math.PI*2),g.y=-p*r+l,g.z=d*Math.cos(m*Math.PI*2),this.vertices.push(g),h.push(this.vertices.length-1),f.push(new D.Vector2(m,1-p))}c.push(h),u.push(f)}var v,y,x=(t-e)/r;for(a=0;a<i;a++)for(0!==e?(v=this.vertices[c[0][a]].clone(),y=this.vertices[c[0][a+1]].clone()):(v=this.vertices[c[1][a]].clone(),y=this.vertices[c[1][a+1]].clone()),v.setY(Math.sqrt(v.x*v.x+v.z*v.z)*x).normalize(),y.setY(Math.sqrt(y.x*y.x+y.z*y.z)*x).normalize(),s=0;s<n;s++){var b=c[s][a],w=c[s+1][a],S=c[s+1][a+1],_=c[s][a+1],M=v.clone(),T=v.clone(),C=y.clone(),A=y.clone(),E=u[s][a].clone(),L=u[s+1][a].clone(),P=u[s+1][a+1].clone(),R=u[s][a+1].clone();this.faces.push(new D.Face4(b,w,S,_,[M,T,C,A])),this.faceVertexUvs[0].push([E,L,P,R])}if(!1===o&&e>0)for(this.vertices.push(new D.Vector3(0,l,0)),a=0;a<i;a++){b=c[0][a],w=c[0][a+1],S=this.vertices.length-1,M=new D.Vector3(0,1,0),T=new D.Vector3(0,1,0),C=new D.Vector3(0,1,0),E=u[0][a].clone(),L=u[0][a+1].clone(),P=new D.Vector2(L.u,0);this.faces.push(new D.Face3(b,w,S,[M,T,C])),this.faceVertexUvs[0].push([E,L,P])}if(!1===o&&t>0)for(this.vertices.push(new D.Vector3(0,-l,0)),a=0;a<i;a++){b=c[s][a+1],w=c[s][a],S=this.vertices.length-1,M=new D.Vector3(0,-1,0),T=new D.Vector3(0,-1,0),C=new D.Vector3(0,-1,0),E=u[s][a+1].clone(),L=u[s][a].clone(),P=new D.Vector2(L.u,1);this.faces.push(new D.Face3(b,w,S,[M,T,C])),this.faceVertexUvs[0].push([E,L,P])}this.computeCentroids(),this.computeFaceNormals()},D.CylinderGeometry.prototype=Object.create(D.Geometry.prototype),D.ExtrudeGeometry=function(e,t){void 0!==e?(D.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()):e=[]},D.ExtrudeGeometry.prototype=Object.create(D.Geometry.prototype),D.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var r=e.length,i=0;i<r;i++){var n=e[i];this.addShape(n,t)}},D.ExtrudeGeometry.prototype.addShape=function(e,t){var r,i,n,o,a,s,l,c,u=void 0!==t.amount?t.amount:100,h=void 0!==t.bevelThickness?t.bevelThickness:6,f=void 0!==t.bevelSize?t.bevelSize:h-2,p=void 0!==t.bevelSegments?t.bevelSegments:3,d=void 0===t.bevelEnabled||t.bevelEnabled,m=void 0!==t.curveSegments?t.curveSegments:12,g=void 0!==t.steps?t.steps:1,v=t.extrudePath,y=!1,x=t.material,b=t.extrudeMaterial,w=void 0!==t.UVGenerator?t.UVGenerator:D.ExtrudeGeometry.WorldUVGenerator;this.shapebb;v&&(r=v.getSpacedPoints(g),y=!0,d=!1,i=void 0!==t.frames?t.frames:new D.TubeGeometry.FrenetFrames(v,g,!1),n=new D.Vector3,o=new D.Vector3,a=new D.Vector3),d||(p=0,h=0,f=0);var S=this,_=this.vertices.length,M=e.extractPoints(m),T=M.shape,C=M.holes,A=!D.Shape.Utils.isClockWise(T);if(A){for(T=T.reverse(),l=0,c=C.length;l<c;l++)s=C[l],D.Shape.Utils.isClockWise(s)&&(C[l]=s.reverse());A=!1}var E=D.Shape.Utils.triangulateShape(T,C),L=T;for(l=0,c=C.length;l<c;l++)s=C[l],T=T.concat(s);function P(e,t,r){return t||console.log("die"),t.clone().multiplyScalar(r).add(e)}var R,F,O,U,N,V,k=T.length,z=E.length;L.length,Math.PI;function B(e,t,r){return function(e,t,r){var i,n,o,a,s,l=D.ExtrudeGeometry.__v1,c=D.ExtrudeGeometry.__v2,u=D.ExtrudeGeometry.__v3,h=D.ExtrudeGeometry.__v4,f=D.ExtrudeGeometry.__v5,p=D.ExtrudeGeometry.__v6;if(l.set(e.x-t.x,e.y-t.y),c.set(e.x-r.x,e.y-r.y),i=l.normalize(),n=c.normalize(),u.set(-i.y,i.x),h.set(n.y,-n.x),f.copy(e).add(u),p.copy(e).add(h),f.equals(p))return h.clone();f.copy(t).add(u),p.copy(r).add(h),o=i.dot(h),a=p.sub(f).dot(h),0===o&&(console.log("Either infinite or no solutions!"),0===a?console.log("Its finite solutions."):console.log("Too bad, no solutions."));if((s=a/o)<0)return function(e,t,r){var i=Math.atan2(t.y-e.y,t.x-e.x),n=Math.atan2(r.y-e.y,r.x-e.x);i>n&&(n+=2*Math.PI);var o=(i+n)/2,a=-Math.cos(o),s=-Math.sin(o);return new D.Vector2(a,s)}(e,t,r);return i.multiplyScalar(s).add(f).sub(e).clone()}(e,t,r)}for(var I=[],j=0,G=L.length,H=G-1,W=j+1;j<G;j++,H++,W++){H===G&&(H=0),W===G&&(W=0);L[j],L[H],L[W];I[j]=B(L[j],L[H],L[W])}var X,q,Y=[],K=I.concat();for(l=0,c=C.length;l<c;l++){for(s=C[l],X=[],j=0,H=(G=s.length)-1,W=j+1;j<G;j++,H++,W++)H===G&&(H=0),W===G&&(W=0),X[j]=B(s[j],s[H],s[W]);Y.push(X),K=K.concat(X)}for(R=0;R<p;R++){for(U=h*(1-(O=R/p)),F=f*Math.sin(O*Math.PI/2),j=0,G=L.length;j<G;j++)Q((N=P(L[j],I[j],F)).x,N.y,-U);for(l=0,c=C.length;l<c;l++)for(s=C[l],X=Y[l],j=0,G=s.length;j<G;j++)Q((N=P(s[j],X[j],F)).x,N.y,-U)}for(F=f,j=0;j<k;j++)N=d?P(T[j],K[j],F):T[j],y?(o.copy(i.normals[0]).multiplyScalar(N.x),n.copy(i.binormals[0]).multiplyScalar(N.y),a.copy(r[0]).add(o).add(n),Q(a.x,a.y,a.z)):Q(N.x,N.y,0);for(q=1;q<=g;q++)for(j=0;j<k;j++)N=d?P(T[j],K[j],F):T[j],y?(o.copy(i.normals[q]).multiplyScalar(N.x),n.copy(i.binormals[q]).multiplyScalar(N.y),a.copy(r[q]).add(o).add(n),Q(a.x,a.y,a.z)):Q(N.x,N.y,u/g*q);for(R=p-1;R>=0;R--){for(U=h*(1-(O=R/p)),F=f*Math.sin(O*Math.PI/2),j=0,G=L.length;j<G;j++)Q((N=P(L[j],I[j],F)).x,N.y,u+U);for(l=0,c=C.length;l<c;l++)for(s=C[l],X=Y[l],j=0,G=s.length;j<G;j++)N=P(s[j],X[j],F),y?Q(N.x,N.y+r[g-1].y,r[g-1].x+U):Q(N.x,N.y,u+U)}function $(e,t){var r,i;for(j=e.length;--j>=0;){r=j,(i=j-1)<0&&(i=e.length-1);var n=0,o=g+2*p;for(n=0;n<o;n++){var a=k*n,s=k*(n+1);J(t+r+a,t+i+a,t+i+s,t+r+s,e,n,o,r,i)}}}function Q(e,t,r){S.vertices.push(new D.Vector3(e,t,r))}function Z(r,i,n,o){r+=_,i+=_,n+=_,S.faces.push(new D.Face3(r,i,n,null,null,x));var a=o?w.generateBottomUV(S,e,t,r,i,n):w.generateTopUV(S,e,t,r,i,n);S.faceVertexUvs[0].push(a)}function J(r,i,n,o,a,s,l,c,u){r+=_,i+=_,n+=_,o+=_,S.faces.push(new D.Face4(r,i,n,o,null,null,b));var h=w.generateSideWallUV(S,e,a,t,r,i,n,o,s,l,c,u);S.faceVertexUvs[0].push(h)}!function(){if(d){var e=0,t=k*e;for(j=0;j<z;j++)Z((V=E[j])[2]+t,V[1]+t,V[0]+t,!0);for(t=k*(e=g+2*p),j=0;j<z;j++)Z((V=E[j])[0]+t,V[1]+t,V[2]+t,!1)}else{for(j=0;j<z;j++)Z((V=E[j])[2],V[1],V[0],!0);for(j=0;j<z;j++)Z((V=E[j])[0]+k*g,V[1]+k*g,V[2]+k*g,!1)}}(),function(){var e=0;for($(L,e),e+=L.length,l=0,c=C.length;l<c;l++)$(s=C[l],e),e+=s.length}()},D.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,i,n,o){var a=e.vertices[i].x,s=e.vertices[i].y,l=e.vertices[n].x,c=e.vertices[n].y,u=e.vertices[o].x,h=e.vertices[o].y;return[new D.Vector2(a,s),new D.Vector2(l,c),new D.Vector2(u,h)]},generateBottomUV:function(e,t,r,i,n,o){return this.generateTopUV(e,t,r,i,n,o)},generateSideWallUV:function(e,t,r,i,n,o,a,s,l,c,u,h){var f=e.vertices[n].x,p=e.vertices[n].y,d=e.vertices[n].z,m=e.vertices[o].x,g=e.vertices[o].y,v=e.vertices[o].z,y=e.vertices[a].x,x=e.vertices[a].y,b=e.vertices[a].z,w=e.vertices[s].x,S=e.vertices[s].y,_=e.vertices[s].z;return Math.abs(p-g)<.01?[new D.Vector2(f,1-d),new D.Vector2(m,1-v),new D.Vector2(y,1-b),new D.Vector2(w,1-_)]:[new D.Vector2(p,1-d),new D.Vector2(g,1-v),new D.Vector2(x,1-b),new D.Vector2(S,1-_)]}},D.ExtrudeGeometry.__v1=new D.Vector2,D.ExtrudeGeometry.__v2=new D.Vector2,D.ExtrudeGeometry.__v3=new D.Vector2,D.ExtrudeGeometry.__v4=new D.Vector2,D.ExtrudeGeometry.__v5=new D.Vector2,D.ExtrudeGeometry.__v6=new D.Vector2,D.ShapeGeometry=function(e,t){D.Geometry.call(this),e instanceof Array==!1&&(e=[e]),this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()},D.ShapeGeometry.prototype=Object.create(D.Geometry.prototype),D.ShapeGeometry.prototype.addShapeList=function(e,t){for(var r=0,i=e.length;r<i;r++)this.addShape(e[r],t);return this},D.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var r,i,n,o=void 0!==t.curveSegments?t.curveSegments:12,a=t.material,s=void 0===t.UVGenerator?D.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,l=(this.shapebb,this.vertices.length),c=e.extractPoints(o),u=c.shape,h=c.holes,f=!D.Shape.Utils.isClockWise(u);if(f){for(u=u.reverse(),r=0,i=h.length;r<i;r++)n=h[r],D.Shape.Utils.isClockWise(n)&&(h[r]=n.reverse());f=!1}var p=D.Shape.Utils.triangulateShape(u,h),d=u;for(r=0,i=h.length;r<i;r++)n=h[r],u=u.concat(n);var m,g,v=u.length,y=p.length;d.length;for(r=0;r<v;r++)m=u[r],this.vertices.push(new D.Vector3(m.x,m.y,0));for(r=0;r<y;r++){var x=(g=p[r])[0]+l,b=g[1]+l,w=g[2]+l;this.faces.push(new D.Face3(x,b,w,null,null,a)),this.faceVertexUvs[0].push(s.generateBottomUV(this,e,t,x,b,w))}},D.LatheGeometry=function(e,t,r,i){D.Geometry.call(this),t=t||12,r=r||0,i=i||2*Math.PI;for(var n=1/(e.length-1),o=1/t,a=0,s=t;a<=s;a++)for(var l=r+a*o*i,c=Math.cos(l),u=Math.sin(l),h=0,f=e.length;h<f;h++){var p=e[h],d=new D.Vector3;d.x=c*p.x-u*p.y,d.y=u*p.x+c*p.y,d.z=p.z,this.vertices.push(d)}var m=e.length;for(a=0,s=t;a<s;a++)for(h=0,f=e.length-1;h<f;h++){var g=h+m*a,v=g,y=g+m,x=(c=g+1+m,g+1);this.faces.push(new D.Face4(v,y,c,x));var b=a*o,w=h*n,S=b+o,_=w+n;this.faceVertexUvs[0].push([new D.Vector2(b,w),new D.Vector2(S,w),new D.Vector2(S,_),new D.Vector2(b,_)])}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},D.LatheGeometry.prototype=Object.create(D.Geometry.prototype),D.PlaneGeometry=function(e,t,r,i){var n,o;D.Geometry.call(this),this.width=e,this.height=t,this.widthSegments=r||1,this.heightSegments=i||1;var a=e/2,s=t/2,l=this.widthSegments,c=this.heightSegments,u=l+1,h=c+1,f=this.width/l,p=this.height/c,d=new D.Vector3(0,0,1);for(o=0;o<h;o++)for(n=0;n<u;n++){var m=n*f-a,g=o*p-s;this.vertices.push(new D.Vector3(m,-g,0))}for(o=0;o<c;o++)for(n=0;n<l;n++){var v=n+u*o,y=n+u*(o+1),x=n+1+u*(o+1),b=n+1+u*o,w=new D.Face4(v,y,x,b);w.normal.copy(d),w.vertexNormals.push(d.clone(),d.clone(),d.clone(),d.clone()),this.faces.push(w),this.faceVertexUvs[0].push([new D.Vector2(n/l,1-o/c),new D.Vector2(n/l,1-(o+1)/c),new D.Vector2((n+1)/l,1-(o+1)/c),new D.Vector2((n+1)/l,1-o/c)])}this.computeCentroids()},D.PlaneGeometry.prototype=Object.create(D.Geometry.prototype),D.RingGeometry=function(e,t,r,i,n,o){D.Geometry.call(this),e=e||0,t=t||50,n=void 0!==n?n:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var a,s,l=[],c=e,u=(t-e)/(i=void 0!==i?Math.max(3,i):8);for(a=0;a<=i;a++){for(s=0;s<=r;s++){var h=new D.Vector3,f=n+s/r*o;h.x=c*Math.cos(f),h.y=c*Math.sin(f),this.vertices.push(h),l.push(new D.Vector2((h.x/c+1)/2,-(h.y/c+1)/2+1))}c+=u}var p=new D.Vector3(0,0,1);for(a=0;a<i;a++){var d=a*r;for(s=0;s<=r;s++){var m=(f=s+d)+a,g=f+r+a,v=f+r+1+a;this.faces.push(new D.Face3(m,g,v,[p,p,p])),this.faceVertexUvs[0].push([l[m],l[g],l[v]]),m=f+a,g=f+r+1+a,v=f+1+a,this.faces.push(new D.Face3(m,g,v,[p,p,p])),this.faceVertexUvs[0].push([l[m],l[g],l[v]])}}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new D.Sphere(new D.Vector3,c)},D.RingGeometry.prototype=Object.create(D.Geometry.prototype),D.SphereGeometry=function(e,t,r,i,n,o,a){D.Geometry.call(this),this.radius=e=e||50,this.widthSegments=t=Math.max(3,Math.floor(t)||8),this.heightSegments=r=Math.max(2,Math.floor(r)||6),this.phiStart=i=void 0!==i?i:0,this.phiLength=n=void 0!==n?n:2*Math.PI,this.thetaStart=o=void 0!==o?o:0,this.thetaLength=a=void 0!==a?a:Math.PI;var s,l,c=[],u=[];for(l=0;l<=r;l++){var h=[],f=[];for(s=0;s<=t;s++){var p=s/t,d=l/r,m=new D.Vector3;m.x=-e*Math.cos(i+p*n)*Math.sin(o+d*a),m.y=e*Math.cos(o+d*a),m.z=e*Math.sin(i+p*n)*Math.sin(o+d*a),this.vertices.push(m),h.push(this.vertices.length-1),f.push(new D.Vector2(p,1-d))}c.push(h),u.push(f)}for(l=0;l<this.heightSegments;l++)for(s=0;s<this.widthSegments;s++){var g=c[l][s+1],v=c[l][s],y=c[l+1][s],x=c[l+1][s+1],b=this.vertices[g].clone().normalize(),w=this.vertices[v].clone().normalize(),S=this.vertices[y].clone().normalize(),_=this.vertices[x].clone().normalize(),M=u[l][s+1].clone(),T=u[l][s].clone(),C=u[l+1][s].clone(),A=u[l+1][s+1].clone();Math.abs(this.vertices[g].y)===this.radius?(this.faces.push(new D.Face3(g,y,x,[b,S,_])),this.faceVertexUvs[0].push([M,C,A])):Math.abs(this.vertices[y].y)===this.radius?(this.faces.push(new D.Face3(g,v,y,[b,w,S])),this.faceVertexUvs[0].push([M,T,C])):(this.faces.push(new D.Face4(g,v,y,x,[b,w,S,_])),this.faceVertexUvs[0].push([M,T,C,A]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new D.Sphere(new D.Vector3,e)},D.SphereGeometry.prototype=Object.create(D.Geometry.prototype),D.TextGeometry=function(e,t){t=t||{};var r=D.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),D.ExtrudeGeometry.call(this,r,t)},D.TextGeometry.prototype=Object.create(D.ExtrudeGeometry.prototype),D.TorusGeometry=function(e,t,r,i,n){D.Geometry.call(this);this.radius=e||100,this.tube=t||40,this.radialSegments=r||8,this.tubularSegments=i||6,this.arc=n||2*Math.PI;for(var o=new D.Vector3,a=[],s=[],l=0;l<=this.radialSegments;l++)for(var c=0;c<=this.tubularSegments;c++){var u=c/this.tubularSegments*this.arc,h=l/this.radialSegments*Math.PI*2;o.x=this.radius*Math.cos(u),o.y=this.radius*Math.sin(u);var f=new D.Vector3;f.x=(this.radius+this.tube*Math.cos(h))*Math.cos(u),f.y=(this.radius+this.tube*Math.cos(h))*Math.sin(u),f.z=this.tube*Math.sin(h),this.vertices.push(f),a.push(new D.Vector2(c/this.tubularSegments,l/this.radialSegments)),s.push(f.clone().sub(o).normalize())}for(l=1;l<=this.radialSegments;l++)for(c=1;c<=this.tubularSegments;c++){var p=(this.tubularSegments+1)*l+c-1,d=(this.tubularSegments+1)*(l-1)+c-1,m=(this.tubularSegments+1)*(l-1)+c,g=(this.tubularSegments+1)*l+c,v=new D.Face4(p,d,m,g,[s[p],s[d],s[m],s[g]]);v.normal.add(s[p]),v.normal.add(s[d]),v.normal.add(s[m]),v.normal.add(s[g]),v.normal.normalize(),this.faces.push(v),this.faceVertexUvs[0].push([a[p].clone(),a[d].clone(),a[m].clone(),a[g].clone()])}this.computeCentroids()},D.TorusGeometry.prototype=Object.create(D.Geometry.prototype),D.TorusKnotGeometry=function(e,t,r,i,n,o,a){D.Geometry.call(this);var s=this;this.radius=e||100,this.tube=t||40,this.radialSegments=r||64,this.tubularSegments=i||8,this.p=n||2,this.q=o||3,this.heightScale=a||1,this.grid=new Array(this.radialSegments);for(var l=new D.Vector3,c=new D.Vector3,u=new D.Vector3,h=0;h<this.radialSegments;++h){this.grid[h]=new Array(this.tubularSegments);for(var f=0;f<this.tubularSegments;++f){var p,d,m=h/this.radialSegments*2*this.p*Math.PI,g=f/this.tubularSegments*2*Math.PI,v=P(m,g,this.q,this.p,this.radius,this.heightScale),y=P(m+.01,g,this.q,this.p,this.radius,this.heightScale);l.subVectors(y,v),c.addVectors(y,v),u.crossVectors(l,c),c.crossVectors(u,l),u.normalize(),c.normalize(),p=-this.tube*Math.cos(g),d=this.tube*Math.sin(g),v.x+=p*c.x+d*u.x,v.y+=p*c.y+d*u.y,v.z+=p*c.z+d*u.z,this.grid[h][f]=L(v.x,v.y,v.z)}}for(h=0;h<this.radialSegments;++h)for(f=0;f<this.tubularSegments;++f){var x=(h+1)%this.radialSegments,b=(f+1)%this.tubularSegments,w=this.grid[h][f],S=this.grid[x][f],_=this.grid[x][b],M=this.grid[h][b],T=new D.Vector2(h/this.radialSegments,f/this.tubularSegments),C=new D.Vector2((h+1)/this.radialSegments,f/this.tubularSegments),A=new D.Vector2((h+1)/this.radialSegments,(f+1)/this.tubularSegments),E=new D.Vector2(h/this.radialSegments,(f+1)/this.tubularSegments);this.faces.push(new D.Face4(w,S,_,M)),this.faceVertexUvs[0].push([T,C,A,E])}function L(e,t,r){return s.vertices.push(new D.Vector3(e,t,r))-1}function P(e,t,r,i,n,o){var a=Math.cos(e),s=(Math.cos(t),Math.sin(e)),l=r/i*e,c=Math.cos(l),u=n*(2+c)*.5*a,h=n*(2+c)*s*.5,f=o*n*Math.sin(l)*.5;return new D.Vector3(u,h,f)}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},D.TorusKnotGeometry.prototype=Object.create(D.Geometry.prototype),D.TubeGeometry=function(e,t,r,i,n,o){D.Geometry.call(this),this.path=e,this.segments=t||64,this.radius=r||1,this.radiusSegments=i||8,this.closed=n||!1,o&&(this.debug=new D.Object3D),this.grid=[];var a,s,l,c,u,h,f,p,d,m,g,v,y,x,b,w,S,_,M,T,C=this,A=this.segments+1,E=new D.Vector3,L=new D.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),P=L.tangents,R=L.normals,F=L.binormals;function O(e,t,r){return C.vertices.push(new D.Vector3(e,t,r))-1}for(this.tangents=P,this.normals=R,this.binormals=F,d=0;d<A;d++)for(this.grid[d]=[],c=d/(A-1),p=e.getPointAt(c),a=P[d],s=R[d],l=F[d],this.debug&&(this.debug.add(new D.ArrowHelper(a,p,r,255)),this.debug.add(new D.ArrowHelper(s,p,r,16711680)),this.debug.add(new D.ArrowHelper(l,p,r,65280))),m=0;m<this.radiusSegments;m++)u=m/this.radiusSegments*2*Math.PI,h=-this.radius*Math.cos(u),f=this.radius*Math.sin(u),E.copy(p),E.x+=h*s.x+f*l.x,E.y+=h*s.y+f*l.y,E.z+=h*s.z+f*l.z,this.grid[d][m]=O(E.x,E.y,E.z);for(d=0;d<this.segments;d++)for(m=0;m<this.radiusSegments;m++)g=this.closed?(d+1)%this.segments:d+1,v=(m+1)%this.radiusSegments,y=this.grid[d][m],x=this.grid[g][m],b=this.grid[g][v],w=this.grid[d][v],S=new D.Vector2(d/this.segments,m/this.radiusSegments),_=new D.Vector2((d+1)/this.segments,m/this.radiusSegments),M=new D.Vector2((d+1)/this.segments,(m+1)/this.radiusSegments),T=new D.Vector2(d/this.segments,(m+1)/this.radiusSegments),this.faces.push(new D.Face4(y,x,b,w)),this.faceVertexUvs[0].push([S,_,M,T]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},D.TubeGeometry.prototype=Object.create(D.Geometry.prototype),D.TubeGeometry.FrenetFrames=function(e,t,r){new D.Vector3;var i,n,o,a,s,l,c,u=new D.Vector3,h=(new D.Vector3,[]),f=[],p=[],d=new D.Vector3,m=new D.Matrix4,g=t+1;for(this.tangents=h,this.normals=f,this.binormals=p,l=0;l<g;l++)c=l/(g-1),h[l]=e.getTangentAt(c),h[l].normalize();for(function(){f[0]=new D.Vector3,p[0]=new D.Vector3,n=Number.MAX_VALUE,o=Math.abs(h[0].x),a=Math.abs(h[0].y),s=Math.abs(h[0].z),o<=n&&(n=o,u.set(1,0,0));a<=n&&(n=a,u.set(0,1,0));s<=n&&u.set(0,0,1);d.crossVectors(h[0],u).normalize(),f[0].crossVectors(h[0],d),p[0].crossVectors(h[0],f[0])}(),l=1;l<g;l++)f[l]=f[l-1].clone(),p[l]=p[l-1].clone(),d.crossVectors(h[l-1],h[l]),d.length()>1e-4&&(d.normalize(),i=Math.acos(h[l-1].dot(h[l])),f[l].applyMatrix4(m.makeRotationAxis(d,i))),p[l].crossVectors(h[l],f[l]);if(r)for(i=Math.acos(f[0].dot(f[g-1])),i/=g-1,h[0].dot(d.crossVectors(f[0],f[g-1]))>0&&(i=-i),l=1;l<g;l++)f[l].applyMatrix4(m.makeRotationAxis(h[l],i*l)),p[l].crossVectors(h[l],f[l])},D.PolyhedronGeometry=function(e,t,r,i){D.Geometry.call(this),r=r||1,i=i||0;for(var n=this,o=0,a=e.length;o<a;o++)y(new D.Vector3(e[o][0],e[o][1],e[o][2]));var s=this.vertices,l=[];for(o=0,a=t.length;o<a;o++){var c=s[t[o][0]],u=s[t[o][1]],h=s[t[o][2]];l[o]=new D.Face3(c.index,u.index,h.index,[c.clone(),u.clone(),h.clone()])}for(o=0,a=l.length;o<a;o++)b(l[o],i);for(o=0,a=this.faceVertexUvs[0].length;o<a;o++){var f=this.faceVertexUvs[0][o],p=f[0].x,d=f[1].x,m=f[2].x,g=Math.max(p,Math.max(d,m)),v=Math.min(p,Math.min(d,m));g>.9&&v<.1&&(p<.2&&(f[0].x+=1),d<.2&&(f[1].x+=1),m<.2&&(f[2].x+=1))}this.mergeVertices();for(o=0,a=this.vertices.length;o<a;o++)this.vertices[o].multiplyScalar(r);function y(e){var t=e.normalize().clone();t.index=n.vertices.push(t)-1;var r=w(e)/2/Math.PI+.5,i=function(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(e)/Math.PI+.5;return t.uv=new D.Vector2(r,1-i),t}function x(e,t,r){var i=new D.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()]);i.centroid.add(e).add(t).add(r).divideScalar(3),i.normal.copy(i.centroid).normalize(),n.faces.push(i);var o=w(i.centroid);n.faceVertexUvs[0].push([S(e.uv,e,o),S(t.uv,t,o),S(r.uv,r,o)])}function b(e,t){for(var r=Math.pow(2,t),i=(Math.pow(4,t),y(n.vertices[e.a])),o=y(n.vertices[e.b]),a=y(n.vertices[e.c]),s=[],l=0;l<=r;l++){s[l]=[];for(var c=y(i.clone().lerp(a,l/r)),u=y(o.clone().lerp(a,l/r)),h=r-l,f=0;f<=h;f++)s[l][f]=0==f&&l==r?c:y(c.clone().lerp(u,f/h))}for(l=0;l<r;l++)for(f=0;f<2*(r-l)-1;f++){var p=Math.floor(f/2);f%2==0?x(s[l][p+1],s[l+1][p],s[l][p]):x(s[l][p+1],s[l+1][p+1],s[l+1][p])}}function w(e){return Math.atan2(e.z,-e.x)}function S(e,t,r){return r<0&&1===e.x&&(e=new D.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new D.Vector2(r/2/Math.PI+.5,e.y)),e.clone()}this.computeCentroids(),this.boundingSphere=new D.Sphere(new D.Vector3,r)},D.PolyhedronGeometry.prototype=Object.create(D.Geometry.prototype),D.IcosahedronGeometry=function(e,t){this.radius=e,this.detail=t;var r=(1+Math.sqrt(5))/2,i=[[-1,r,0],[1,r,0],[-1,-r,0],[1,-r,0],[0,-1,r],[0,1,r],[0,-1,-r],[0,1,-r],[r,0,-1],[r,0,1],[-r,0,-1],[-r,0,1]];D.PolyhedronGeometry.call(this,i,[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],e,t)},D.IcosahedronGeometry.prototype=Object.create(D.Geometry.prototype),D.OctahedronGeometry=function(e,t){D.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],e,t)},D.OctahedronGeometry.prototype=Object.create(D.Geometry.prototype),D.TetrahedronGeometry=function(e,t){D.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],e,t)},D.TetrahedronGeometry.prototype=Object.create(D.Geometry.prototype),D.ParametricGeometry=function(e,t,r,i){D.Geometry.call(this);var n,o,a,s,l=this.vertices,c=this.faces,u=this.faceVertexUvs[0];i=void 0!==i&&i;var h,f,p,d,m,g,v,y,x=t+1;for(n=0;n<=r;n++)for(s=n/r,o=0;o<=t;o++)a=e(o/t,s),l.push(a);for(n=0;n<r;n++)for(o=0;o<t;o++)h=n*x+o,f=n*x+o+1,p=(n+1)*x+o,d=(n+1)*x+o+1,m=new D.Vector2(o/t,n/r),g=new D.Vector2((o+1)/t,n/r),v=new D.Vector2(o/t,(n+1)/r),y=new D.Vector2((o+1)/t,(n+1)/r),i?(c.push(new D.Face3(h,f,p)),c.push(new D.Face3(f,d,p)),u.push([m,g,v]),u.push([g,y,v])):(c.push(new D.Face4(h,f,d,p)),u.push([m,g,y,v]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},D.ParametricGeometry.prototype=Object.create(D.Geometry.prototype),D.ConvexGeometry=function(e){D.Geometry.call(this);for(var t=[[0,1,2],[0,2,1]],r=3;r<e.length;r++)i(r);function i(r){var i=e[r].clone(),a=i.length();i.x+=a*o(),i.y+=a*o(),i.z+=a*o();for(var s,l,c=[],u=0;u<t.length;){var h=t[u];if(n(h,i)){for(var f=0;f<3;f++){for(var p=[h[f],h[(f+1)%3]],d=!0,m=0;m<c.length;m++)if(s=c[m],l=p,s[0]===l[1]&&s[1]===l[0]){c[m]=c[c.length-1],c.pop(),d=!1;break}d&&c.push(p)}t[u]=t[t.length-1],t.pop()}else u++}for(m=0;m<c.length;m++)t.push([c[m][0],c[m][1],r])}function n(t,r){var i=e[t[0]],n=function(e,t,r){var i=new D.Vector3,n=new D.Vector3;return i.subVectors(r,t),n.subVectors(e,t),i.cross(n),i.normalize(),i}(i,e[t[1]],e[t[2]]),o=n.dot(i);return n.dot(r)>=o}function o(){return 2*(Math.random()-.5)*1e-6}function a(e){var t=e.length();return new D.Vector2(e.x/t,e.y/t)}var s=0,l=new Array(e.length);for(r=0;r<t.length;r++)for(var c=t[r],u=0;u<3;u++)void 0===l[c[u]]&&(l[c[u]]=s++,this.vertices.push(e[c[u]])),c[u]=l[c[u]];for(r=0;r<t.length;r++)this.faces.push(new D.Face3(t[r][0],t[r][1],t[r][2]));for(r=0;r<this.faces.length;r++){c=this.faces[r];this.faceVertexUvs[0].push([a(this.vertices[c.a]),a(this.vertices[c.b]),a(this.vertices[c.c])])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},D.ConvexGeometry.prototype=Object.create(D.Geometry.prototype),D.AxisHelper=function(e){e=e||1;var t=new D.Geometry;t.vertices.push(new D.Vector3,new D.Vector3(e,0,0),new D.Vector3,new D.Vector3(0,e,0),new D.Vector3,new D.Vector3(0,0,e)),t.colors.push(new D.Color(16711680),new D.Color(16755200),new D.Color(65280),new D.Color(11206400),new D.Color(255),new D.Color(43775));var r=new D.LineBasicMaterial({vertexColors:D.VertexColors});D.Line.call(this,t,r,D.LinePieces)},D.AxisHelper.prototype=Object.create(D.Line.prototype),D.ArrowHelper=function(e,t,r,i){D.Object3D.call(this),void 0===i&&(i=16776960),void 0===r&&(r=1),this.position=t,this.useQuaternion=!0;var n=new D.Geometry;n.vertices.push(new D.Vector3(0,0,0)),n.vertices.push(new D.Vector3(0,1,0)),this.line=new D.Line(n,new D.LineBasicMaterial({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line);var o=new D.CylinderGeometry(0,.05,.25,5,1);o.applyMatrix((new D.Matrix4).makeTranslation(0,.875,0)),this.cone=new D.Mesh(o,new D.MeshBasicMaterial({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r)},D.ArrowHelper.prototype=Object.create(D.Object3D.prototype),D.ArrowHelper.prototype.setDirection=(T=new D.Vector3,function(e){e.y>.999?this.quaternion.set(0,0,0,1):e.y<-.999?this.quaternion.set(1,0,0,0):(T.set(e.z,0,-e.x).normalize(),M=Math.acos(e.y),this.quaternion.setFromAxisAngle(T,M))}),D.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)},D.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},D.BoxHelper=function(e){e=e||1;var t=new D.Geometry,r=[new D.Vector3(e,e,e),new D.Vector3(-e,e,e),new D.Vector3(-e,-e,e),new D.Vector3(e,-e,e),new D.Vector3(e,e,-e),new D.Vector3(-e,e,-e),new D.Vector3(-e,-e,-e),new D.Vector3(e,-e,-e)];t.vertices.push(r[0],r[1],r[1],r[2],r[2],r[3],r[3],r[0],r[4],r[5],r[5],r[6],r[6],r[7],r[7],r[4],r[0],r[4],r[1],r[5],r[2],r[6],r[3],r[7]),this.vertices=r,D.Line.call(this,t,new D.LineBasicMaterial,D.LinePieces)},D.BoxHelper.prototype=Object.create(D.Line.prototype),D.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var r=t.boundingBox.min,i=t.boundingBox.max,n=this.vertices;n[0].set(i.x,i.y,i.z),n[1].set(r.x,i.y,i.z),n[2].set(r.x,r.y,i.z),n[3].set(i.x,r.y,i.z),n[4].set(i.x,i.y,r.z),n[5].set(r.x,i.y,r.z),n[6].set(r.x,r.y,r.z),n[7].set(i.x,r.y,r.z),this.geometry.computeBoundingSphere(),this.geometry.verticesNeedUpdate=!0,this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},D.CameraHelper=function(e){D.Line.call(this);var t=new D.Geometry,r=new D.LineBasicMaterial({color:16777215,vertexColors:D.FaceColors}),i={};function n(e,t,r){o(e,r),o(t,r)}function o(e,r){t.vertices.push(new D.Vector3),t.colors.push(new D.Color(r)),void 0===i[e]&&(i[e]=[]),i[e].push(t.vertices.length-1)}n("n1","n2",16755200),n("n2","n4",16755200),n("n4","n3",16755200),n("n3","n1",16755200),n("f1","f2",16755200),n("f2","f4",16755200),n("f4","f3",16755200),n("f3","f1",16755200),n("n1","f1",16755200),n("n2","f2",16755200),n("n3","f3",16755200),n("n4","f4",16755200),n("p","n1",16711680),n("p","n2",16711680),n("p","n3",16711680),n("p","n4",16711680),n("u1","u2",43775),n("u2","u3",43775),n("u3","u1",43775),n("c","t",16777215),n("p","c",3355443),n("cn1","cn2",3355443),n("cn3","cn4",3355443),n("cf1","cf2",3355443),n("cf3","cf4",3355443),D.Line.call(this,t,r,D.LinePieces),this.camera=e,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=i,this.update()},D.CameraHelper.prototype=Object.create(D.Line.prototype),D.CameraHelper.prototype.update=(C=new D.Vector3,A=new D.Camera,E=new D.Projector,function(){var e=this;function t(t,r,i,n){C.set(r,i,n),E.unprojectVector(C,A);var o=e.pointMap[t];if(void 0!==o)for(var a=0,s=o.length;a<s;a++)e.geometry.vertices[o[a]].copy(C)}A.projectionMatrix.copy(this.camera.projectionMatrix),t("c",0,0,-1),t("t",0,0,1),t("n1",-1,-1,-1),t("n2",1,-1,-1),t("n3",-1,1,-1),t("n4",1,1,-1),t("f1",-1,-1,1),t("f2",1,-1,1),t("f3",-1,1,1),t("f4",1,1,1),t("u1",.7,1.1,-1),t("u2",-.7,1.1,-1),t("u3",0,2,-1),t("cf1",-1,0,1),t("cf2",1,0,1),t("cf3",0,-1,1),t("cf4",0,1,1),t("cn1",-1,0,-1),t("cn2",1,0,-1),t("cn3",0,-1,-1),t("cn4",0,1,-1),this.geometry.verticesNeedUpdate=!0}),D.DirectionalLightHelper=function(e,t){D.Object3D.call(this),this.matrixAutoUpdate=!1,this.light=e;var r=new D.SphereGeometry(t,4,2),i=new D.MeshBasicMaterial({fog:!1,wireframe:!0});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere=new D.Mesh(r,i),this.lightSphere.matrixWorld=this.light.matrixWorld,this.lightSphere.matrixAutoUpdate=!1,this.add(this.lightSphere),(r=new D.Geometry).vertices.push(this.light.position),r.vertices.push(this.light.target.position),r.computeLineDistances(),(i=new D.LineDashedMaterial({dashSize:4,gapSize:4,opacity:.75,transparent:!0,fog:!1})).color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new D.Line(r,i),this.add(this.targetLine)},D.DirectionalLightHelper.prototype=Object.create(D.Object3D.prototype),D.DirectionalLightHelper.prototype.update=function(){this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.computeLineDistances(),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},D.GridHelper=function(e,t){for(var r=new D.Geometry,i=new D.LineBasicMaterial({vertexColors:D.VertexColors}),n=new D.Color(4473924),o=new D.Color(8947848),a=-e;a<=e;a+=t){r.vertices.push(new D.Vector3(-e,0,a)),r.vertices.push(new D.Vector3(e,0,a)),r.vertices.push(new D.Vector3(a,0,-e)),r.vertices.push(new D.Vector3(a,0,e));var s=0===a?n:o;r.colors.push(s,s,s,s)}D.Line.call(this,r,i,D.LinePieces)},D.GridHelper.prototype=Object.create(D.Line.prototype),D.HemisphereLightHelper=function(e,t,r,i){D.Object3D.call(this),this.light=e;var n=new D.SphereGeometry(t,4,2);n.applyMatrix((new D.Matrix4).makeRotationX(-Math.PI/2));for(var o=0;o<8;o++)n.faces[o].materialIndex=o<4?0:1;var a=new D.MeshBasicMaterial({fog:!1,wireframe:!0});a.color.copy(e.color).multiplyScalar(e.intensity);var s=new D.MeshBasicMaterial({fog:!1,wireframe:!0});s.color.copy(e.groundColor).multiplyScalar(e.intensity),this.lightSphere=new D.Mesh(n,new D.MeshFaceMaterial([a,s])),this.lightSphere.position=e.position,this.lightSphere.lookAt(new D.Vector3),this.add(this.lightSphere)},D.HemisphereLightHelper.prototype=Object.create(D.Object3D.prototype),D.HemisphereLightHelper.prototype.update=function(){this.lightSphere.lookAt(new D.Vector3),this.lightSphere.material.materials[0].color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere.material.materials[1].color.copy(this.light.groundColor).multiplyScalar(this.light.intensity)},D.PointLightHelper=function(e,t){D.Object3D.call(this),this.matrixAutoUpdate=!1,this.light=e;var r=new D.SphereGeometry(t,4,2),i=new D.MeshBasicMaterial({fog:!1,wireframe:!0});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere=new D.Mesh(r,i),this.lightSphere.matrixWorld=this.light.matrixWorld,this.lightSphere.matrixAutoUpdate=!1,this.add(this.lightSphere)},D.PointLightHelper.prototype=Object.create(D.Object3D.prototype),D.PointLightHelper.prototype.update=function(){this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},D.SpotLightHelper=function(e,t){D.Object3D.call(this),this.matrixAutoUpdate=!1,this.light=e;var r=new D.SphereGeometry(t,4,2),i=new D.MeshBasicMaterial({fog:!1,wireframe:!0});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere=new D.Mesh(r,i),this.lightSphere.matrixWorld=this.light.matrixWorld,this.lightSphere.matrixAutoUpdate=!1,this.add(this.lightSphere),(r=new D.CylinderGeometry(1e-4,1,1,8,1,!0)).applyMatrix((new D.Matrix4).makeTranslation(0,-.5,0)),r.applyMatrix((new D.Matrix4).makeRotationX(-Math.PI/2)),(i=new D.MeshBasicMaterial({fog:!1,wireframe:!0,opacity:.3,transparent:!0})).color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightCone=new D.Mesh(r,i),this.lightCone.position=this.light.position;var n=e.distance?e.distance:1e4,o=n*Math.tan(e.angle);this.lightCone.scale.set(o,o,n),this.lightCone.lookAt(this.light.target.position),this.add(this.lightCone)},D.SpotLightHelper.prototype=Object.create(D.Object3D.prototype),D.SpotLightHelper.prototype.update=function(){var e=this.light.distance?this.light.distance:1e4,t=e*Math.tan(this.light.angle);this.lightCone.scale.set(t,t,e),this.lightCone.lookAt(this.light.target.position),this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightCone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},D.ImmediateRenderObject=function(){D.Object3D.call(this),this.render=function(e){}},D.ImmediateRenderObject.prototype=Object.create(D.Object3D.prototype),D.LensFlare=function(e,t,r,i,n){D.Object3D.call(this),this.lensFlares=[],this.positionScreen=new D.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,r,i,n)},D.LensFlare.prototype=Object.create(D.Object3D.prototype),D.LensFlare.prototype.add=function(e,t,r,i,n,o){void 0===t&&(t=-1),void 0===r&&(r=0),void 0===o&&(o=1),void 0===n&&(n=new D.Color(16777215)),void 0===i&&(i=D.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:n,blending:i})},D.LensFlare.prototype.updateLensFlares=function(){var e,t,r=this.lensFlares.length,i=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(e=0;e<r;e++)(t=this.lensFlares[e]).x=this.positionScreen.x+i*t.distance,t.y=this.positionScreen.y+n*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},D.MorphBlendMesh=function(e,t){D.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length,i=r-1,n=r/1;this.createAnimation("__default",0,i,n),this.setAnimationWeight("__default",1)},D.MorphBlendMesh.prototype=Object.create(D.Mesh.prototype),D.MorphBlendMesh.prototype.createAnimation=function(e,t,r,i){var n={startFrame:t,endFrame:r,length:r-t+1,fps:i,duration:(r-t)/i,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=n,this.animationsList.push(n)},D.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,r=/([a-z]+)(\d+)/,i={},n=this.geometry,o=0,a=n.morphTargets.length;o<a;o++){var s=n.morphTargets[o].name.match(r);if(s&&s.length>1){var l=s[1];s[2];i[l]||(i[l]={start:1/0,end:-1/0}),o<(c=i[l]).start&&(c.start=o),o>c.end&&(c.end=o),t||(t=l)}}for(var l in i){var c=i[l];this.createAnimation(l,c.start,c.end,e)}this.firstAnimation=t},D.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},D.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},D.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},D.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},D.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},D.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];r&&(r.time=t)},D.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,r=this.animationsMap[e];return r&&(t=r.time),t},D.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,r=this.animationsMap[e];return r&&(t=r.duration),t},D.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},D.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},D.MorphBlendMesh.prototype.update=function(e){for(var t=0,r=this.animationsList.length;t<r;t++){var i=this.animationsList[t];if(i.active){var n=i.duration/i.length;i.time+=i.direction*e,i.mirroredLoop?(i.time>i.duration||i.time<0)&&(i.direction*=-1,i.time>i.duration&&(i.time=i.duration,i.directionBackwards=!0),i.time<0&&(i.time=0,i.directionBackwards=!1)):(i.time=i.time%i.duration,i.time<0&&(i.time+=i.duration));var o=i.startFrame+D.Math.clamp(Math.floor(i.time/n),0,i.length-1),a=i.weight;o!==i.currentFrame&&(this.morphTargetInfluences[i.lastFrame]=0,this.morphTargetInfluences[i.currentFrame]=1*a,this.morphTargetInfluences[o]=0,i.lastFrame=i.currentFrame,i.currentFrame=o);var s=i.time%n/n;i.directionBackwards&&(s=1-s),this.morphTargetInfluences[i.currentFrame]=s*a,this.morphTargetInfluences[i.lastFrame]=(1-s)*a}}},D.LensFlarePlugin=function(){var e,t,r,i={};function n(t,r){var i=e.createProgram(),n=e.createShader(e.FRAGMENT_SHADER),o=e.createShader(e.VERTEX_SHADER),a="precision "+r+" float;\n";return e.shaderSource(n,a+t.fragmentShader),e.shaderSource(o,a+t.vertexShader),e.compileShader(n),e.compileShader(o),e.attachShader(i,n),e.attachShader(i,o),e.linkProgram(i),i}this.init=function(o){e=o.context,t=o,r=o.getPrecision(),i.vertices=new Float32Array(16),i.faces=new Uint16Array(6);var a=0;i.vertices[a++]=-1,i.vertices[a++]=-1,i.vertices[a++]=0,i.vertices[a++]=0,i.vertices[a++]=1,i.vertices[a++]=-1,i.vertices[a++]=1,i.vertices[a++]=0,i.vertices[a++]=1,i.vertices[a++]=1,i.vertices[a++]=1,i.vertices[a++]=1,i.vertices[a++]=-1,i.vertices[a++]=1,i.vertices[a++]=0,i.vertices[a++]=1,a=0,i.faces[a++]=0,i.faces[a++]=1,i.faces[a++]=2,i.faces[a++]=0,i.faces[a++]=2,i.faces[a++]=3,i.vertexBuffer=e.createBuffer(),i.elementBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,i.vertices,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.elementBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i.faces,e.STATIC_DRAW),i.tempTexture=e.createTexture(),i.occlusionTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,i.tempTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGB,16,16,0,e.RGB,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.bindTexture(e.TEXTURE_2D,i.occlusionTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,16,16,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(i.hasVertexTexture=!1,i.program=n(D.ShaderFlares.lensFlare,r)):(i.hasVertexTexture=!0,i.program=n(D.ShaderFlares.lensFlareVertexTexture,r)),i.attributes={},i.uniforms={},i.attributes.vertex=e.getAttribLocation(i.program,"position"),i.attributes.uv=e.getAttribLocation(i.program,"uv"),i.uniforms.renderType=e.getUniformLocation(i.program,"renderType"),i.uniforms.map=e.getUniformLocation(i.program,"map"),i.uniforms.occlusionMap=e.getUniformLocation(i.program,"occlusionMap"),i.uniforms.opacity=e.getUniformLocation(i.program,"opacity"),i.uniforms.color=e.getUniformLocation(i.program,"color"),i.uniforms.scale=e.getUniformLocation(i.program,"scale"),i.uniforms.rotation=e.getUniformLocation(i.program,"rotation"),i.uniforms.screenPosition=e.getUniformLocation(i.program,"screenPosition")},this.render=function(r,n,o,a){var s=r.__webglFlares,l=s.length;if(l){var c,u,h,f,p,d=new D.Vector3,m=a/o,g=.5*o,v=.5*a,y=16/a,x=new D.Vector2(y*m,y),b=new D.Vector3(1,1,0),w=new D.Vector2(1,1),S=i.uniforms,_=i.attributes;for(e.useProgram(i.program),e.enableVertexAttribArray(i.attributes.vertex),e.enableVertexAttribArray(i.attributes.uv),e.uniform1i(S.occlusionMap,0),e.uniform1i(S.map,1),e.bindBuffer(e.ARRAY_BUFFER,i.vertexBuffer),e.vertexAttribPointer(_.vertex,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(_.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.elementBuffer),e.disable(e.CULL_FACE),e.depthMask(!1),c=0;c<l;c++)if(y=16/a,x.set(y*m,y),f=s[c],d.set(f.matrixWorld.elements[12],f.matrixWorld.elements[13],f.matrixWorld.elements[14]),d.applyMatrix4(n.matrixWorldInverse),d.applyProjection(n.projectionMatrix),b.copy(d),w.x=b.x*g+g,w.y=b.y*v+v,i.hasVertexTexture||w.x>0&&w.x<o&&w.y>0&&w.y<a)for(e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,i.tempTexture),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGB,w.x-8,w.y-8,16,16,0),e.uniform1i(S.renderType,0),e.uniform2f(S.scale,x.x,x.y),e.uniform3f(S.screenPosition,b.x,b.y,b.z),e.disable(e.BLEND),e.enable(e.DEPTH_TEST),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i.occlusionTexture),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,w.x-8,w.y-8,16,16,0),e.uniform1i(S.renderType,1),e.disable(e.DEPTH_TEST),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,i.tempTexture),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),f.positionScreen.copy(b),f.customUpdateCallback?f.customUpdateCallback(f):f.updateLensFlares(),e.uniform1i(S.renderType,2),e.enable(e.BLEND),u=0,h=f.lensFlares.length;u<h;u++)(p=f.lensFlares[u]).opacity>.001&&p.scale>.001&&(b.x=p.x,b.y=p.y,b.z=p.z,y=p.size*p.scale/a,x.x=y*m,x.y=y,e.uniform3f(S.screenPosition,b.x,b.y,b.z),e.uniform2f(S.scale,x.x,x.y),e.uniform1f(S.rotation,p.rotation),e.uniform1f(S.opacity,p.opacity),e.uniform3f(S.color,p.color.r,p.color.g,p.color.b),t.setBlending(p.blending,p.blendEquation,p.blendSrc,p.blendDst),t.setTexture(p.texture,1),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0));e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.depthMask(!0)}}},D.ShadowMapPlugin=function(){var e,t,r,i,n,o,a=new D.Frustum,s=new D.Matrix4,l=new D.Vector3,c=new D.Vector3,u=new D.Vector3;function h(e,t){var r=new D.DirectionalLight;r.isVirtual=!0,r.onlyShadow=!0,r.castShadow=!0,r.shadowCameraNear=e.shadowCameraNear,r.shadowCameraFar=e.shadowCameraFar,r.shadowCameraLeft=e.shadowCameraLeft,r.shadowCameraRight=e.shadowCameraRight,r.shadowCameraBottom=e.shadowCameraBottom,r.shadowCameraTop=e.shadowCameraTop,r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t],r.shadowMapWidth=e.shadowCascadeWidth[t],r.shadowMapHeight=e.shadowCascadeHeight[t],r.pointsWorld=[],r.pointsFrustum=[];for(var i=r.pointsWorld,n=r.pointsFrustum,o=0;o<8;o++)i[o]=new D.Vector3,n[o]=new D.Vector3;var a=e.shadowCascadeNearZ[t],s=e.shadowCascadeFarZ[t];return n[0].set(-1,-1,a),n[1].set(1,-1,a),n[2].set(-1,1,a),n[3].set(1,1,a),n[4].set(-1,-1,s),n[5].set(1,-1,s),n[6].set(-1,1,s),n[7].set(1,1,s),r}function f(e,t){var r=e.shadowCascadeArray[t];r.position.copy(e.position),r.target.position.copy(e.target.position),r.lookAt(r.target),r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t];var i=e.shadowCascadeNearZ[t],n=e.shadowCascadeFarZ[t],o=r.pointsFrustum;o[0].z=i,o[1].z=i,o[2].z=i,o[3].z=i,o[4].z=n,o[5].z=n,o[6].z=n,o[7].z=n}function p(e,t){var r=t.shadowCamera,i=t.pointsFrustum,n=t.pointsWorld;l.set(1/0,1/0,1/0),c.set(-1/0,-1/0,-1/0);for(var o=0;o<8;o++){var a=n[o];a.copy(i[o]),D.ShadowMapPlugin.__projector.unprojectVector(a,e),a.applyMatrix4(r.matrixWorldInverse),a.x<l.x&&(l.x=a.x),a.x>c.x&&(c.x=a.x),a.y<l.y&&(l.y=a.y),a.y>c.y&&(c.y=a.y),a.z<l.z&&(l.z=a.z),a.z>c.z&&(c.z=a.z)}r.left=l.x,r.right=c.x,r.top=c.y,r.bottom=l.y,r.updateProjectionMatrix()}function d(e){return e.material instanceof D.MeshFaceMaterial?e.material.materials[0]:e.material}this.init=function(a){e=a.context,t=a;var s=D.ShaderLib.depthRGBA,l=D.UniformsUtils.clone(s.uniforms);r=new D.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l}),i=new D.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,morphTargets:!0}),n=new D.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,skinning:!0}),o=new D.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,morphTargets:!0,skinning:!0}),r._shadowPass=!0,i._shadowPass=!0,n._shadowPass=!0,o._shadowPass=!0},this.render=function(e,r){t.shadowMapEnabled&&t.shadowMapAutoUpdate&&this.update(e,r)},this.update=function(l,c){var m,g,v,y,x,b,w,S,_,M,T,C,A,E,L=[],P=0;for(e.clearColor(1,1,1,1),e.disable(e.BLEND),e.enable(e.CULL_FACE),e.frontFace(e.CCW),t.shadowMapCullFace===D.CullFaceFront?e.cullFace(e.FRONT):e.cullFace(e.BACK),t.setDepthTest(!0),m=0,g=l.__lights.length;m<g;m++)if((A=l.__lights[m]).castShadow)if(A instanceof D.DirectionalLight&&A.shadowCascade)for(x=0;x<A.shadowCascadeCount;x++){var R;if(A.shadowCascadeArray[x])R=A.shadowCascadeArray[x];else{(R=h(A,x)).originalCamera=c;var F=new D.Gyroscope;F.position=A.shadowCascadeOffset,F.add(R),F.add(R.target),c.add(F),A.shadowCascadeArray[x]=R,console.log("Created virtualLight",R)}f(A,x),L[P]=R,P++}else L[P]=A,P++;for(m=0,g=L.length;m<g;m++){if(!(A=L[m]).shadowMap){var O=D.LinearFilter;t.shadowMapType===D.PCFSoftShadowMap&&(O=D.NearestFilter);var U={minFilter:O,magFilter:O,format:D.RGBAFormat};A.shadowMap=new D.WebGLRenderTarget(A.shadowMapWidth,A.shadowMapHeight,U),A.shadowMapSize=new D.Vector2(A.shadowMapWidth,A.shadowMapHeight),A.shadowMatrix=new D.Matrix4}if(!A.shadowCamera){if(A instanceof D.SpotLight)A.shadowCamera=new D.PerspectiveCamera(A.shadowCameraFov,A.shadowMapWidth/A.shadowMapHeight,A.shadowCameraNear,A.shadowCameraFar);else{if(!(A instanceof D.DirectionalLight)){console.error("Unsupported light type for shadow");continue}A.shadowCamera=new D.OrthographicCamera(A.shadowCameraLeft,A.shadowCameraRight,A.shadowCameraTop,A.shadowCameraBottom,A.shadowCameraNear,A.shadowCameraFar)}l.add(A.shadowCamera),!0===l.autoUpdate&&l.updateMatrixWorld()}for(A.shadowCameraVisible&&!A.cameraHelper&&(A.cameraHelper=new D.CameraHelper(A.shadowCamera),A.shadowCamera.add(A.cameraHelper)),A.isVirtual&&R.originalCamera==c&&p(c,A),b=A.shadowMap,w=A.shadowMatrix,(S=A.shadowCamera).position.getPositionFromMatrix(A.matrixWorld),u.getPositionFromMatrix(A.target.matrixWorld),S.lookAt(u),S.updateMatrixWorld(),S.matrixWorldInverse.getInverse(S.matrixWorld),A.cameraHelper&&(A.cameraHelper.visible=A.shadowCameraVisible),A.shadowCameraVisible&&A.cameraHelper.update(),w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(S.projectionMatrix),w.multiply(S.matrixWorldInverse),s.multiplyMatrices(S.projectionMatrix,S.matrixWorldInverse),a.setFromMatrix(s),t.setRenderTarget(b),t.clear(),v=0,y=(E=l.__webglObjects).length;v<y;v++)C=(T=E[v]).object,T.render=!1,C.visible&&C.castShadow&&((C instanceof D.Mesh||C instanceof D.ParticleSystem)&&C.frustumCulled&&!a.intersectsObject(C)||(C._modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,C.matrixWorld),T.render=!0));var N,V,k;for(v=0,y=E.length;v<y;v++)(T=E[v]).render&&(C=T.object,_=T.buffer,N=d(C),V=C.geometry.morphTargets.length>0&&N.morphTargets,k=C instanceof D.SkinnedMesh&&N.skinning,M=C.customDepthMaterial?C.customDepthMaterial:k?V?o:n:V?i:r,_ instanceof D.BufferGeometry?t.renderBufferDirect(S,l.__lights,null,M,_,C):t.renderBuffer(S,l.__lights,null,M,_,C));for(v=0,y=(E=l.__webglObjectsImmediate).length;v<y;v++)(C=(T=E[v]).object).visible&&C.castShadow&&(C._modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,C.matrixWorld),t.renderImmediateObject(S,l.__lights,null,r,C))}var z=t.getClearColor(),B=t.getClearAlpha();e.clearColor(z.r,z.g,z.b,B),e.enable(e.BLEND),t.shadowMapCullFace===D.CullFaceFront&&e.cullFace(e.BACK)}},D.ShadowMapPlugin.__projector=new D.Projector,D.SpritePlugin=function(){var e,t,r,i={};function n(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}this.init=function(n){e=n.context,t=n,r=n.getPrecision(),i.vertices=new Float32Array(16),i.faces=new Uint16Array(6);var o,a,s,l,c,u,h=0;i.vertices[h++]=-1,i.vertices[h++]=-1,i.vertices[h++]=0,i.vertices[h++]=0,i.vertices[h++]=1,i.vertices[h++]=-1,i.vertices[h++]=1,i.vertices[h++]=0,i.vertices[h++]=1,i.vertices[h++]=1,i.vertices[h++]=1,i.vertices[h++]=1,i.vertices[h++]=-1,i.vertices[h++]=1,i.vertices[h++]=0,i.vertices[h++]=1,h=0,i.faces[h++]=0,i.faces[h++]=1,i.faces[h++]=2,i.faces[h++]=0,i.faces[h++]=2,i.faces[h++]=3,i.vertexBuffer=e.createBuffer(),i.elementBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,i.vertices,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.elementBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i.faces,e.STATIC_DRAW),i.program=(o=D.ShaderSprite.sprite,a=r,s=e.createProgram(),l=e.createShader(e.FRAGMENT_SHADER),c=e.createShader(e.VERTEX_SHADER),u="precision "+a+" float;\n",e.shaderSource(l,u+o.fragmentShader),e.shaderSource(c,u+o.vertexShader),e.compileShader(l),e.compileShader(c),e.attachShader(s,l),e.attachShader(s,c),e.linkProgram(s),s),i.attributes={},i.uniforms={},i.attributes.position=e.getAttribLocation(i.program,"position"),i.attributes.uv=e.getAttribLocation(i.program,"uv"),i.uniforms.uvOffset=e.getUniformLocation(i.program,"uvOffset"),i.uniforms.uvScale=e.getUniformLocation(i.program,"uvScale"),i.uniforms.rotation=e.getUniformLocation(i.program,"rotation"),i.uniforms.scale=e.getUniformLocation(i.program,"scale"),i.uniforms.alignment=e.getUniformLocation(i.program,"alignment"),i.uniforms.color=e.getUniformLocation(i.program,"color"),i.uniforms.map=e.getUniformLocation(i.program,"map"),i.uniforms.opacity=e.getUniformLocation(i.program,"opacity"),i.uniforms.useScreenCoordinates=e.getUniformLocation(i.program,"useScreenCoordinates"),i.uniforms.sizeAttenuation=e.getUniformLocation(i.program,"sizeAttenuation"),i.uniforms.screenPosition=e.getUniformLocation(i.program,"screenPosition"),i.uniforms.modelViewMatrix=e.getUniformLocation(i.program,"modelViewMatrix"),i.uniforms.projectionMatrix=e.getUniformLocation(i.program,"projectionMatrix"),i.uniforms.fogType=e.getUniformLocation(i.program,"fogType"),i.uniforms.fogDensity=e.getUniformLocation(i.program,"fogDensity"),i.uniforms.fogNear=e.getUniformLocation(i.program,"fogNear"),i.uniforms.fogFar=e.getUniformLocation(i.program,"fogFar"),i.uniforms.fogColor=e.getUniformLocation(i.program,"fogColor"),i.uniforms.alphaTest=e.getUniformLocation(i.program,"alphaTest")},this.render=function(r,o,a,s){var l=r.__webglSprites,c=l.length;if(c){var u=i.attributes,h=i.uniforms,f=s/a,p=.5*a,d=.5*s;e.useProgram(i.program),e.enableVertexAttribArray(u.position),e.enableVertexAttribArray(u.uv),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.bindBuffer(e.ARRAY_BUFFER,i.vertexBuffer),e.vertexAttribPointer(u.position,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(u.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.elementBuffer),e.uniformMatrix4fv(h.projectionMatrix,!1,o.projectionMatrix.elements),e.activeTexture(e.TEXTURE0),e.uniform1i(h.map,0);var m=0,g=0,v=r.fog;v?(e.uniform3f(h.fogColor,v.color.r,v.color.g,v.color.b),v instanceof D.Fog?(e.uniform1f(h.fogNear,v.near),e.uniform1f(h.fogFar,v.far),e.uniform1i(h.fogType,1),m=1,g=1):v instanceof D.FogExp2&&(e.uniform1f(h.fogDensity,v.density),e.uniform1i(h.fogType,2),m=2,g=2)):(e.uniform1i(h.fogType,0),m=0,g=0);var y,x,b,w,S,_=[];for(y=0;y<c;y++)b=(x=l[y]).material,x.visible&&0!==b.opacity&&(b.useScreenCoordinates?x.z=-x.position.z:(x._modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,x.matrixWorld),x.z=-x._modelViewMatrix.elements[14]));for(l.sort(n),y=0;y<c;y++)b=(x=l[y]).material,x.visible&&0!==b.opacity&&b.map&&b.map.image&&b.map.image.width&&(e.uniform1f(h.alphaTest,b.alphaTest),!0===b.useScreenCoordinates?(e.uniform1i(h.useScreenCoordinates,1),e.uniform3f(h.screenPosition,(x.position.x*t.devicePixelRatio-p)/p,(d-x.position.y*t.devicePixelRatio)/d,Math.max(0,Math.min(1,x.position.z))),_[0]=t.devicePixelRatio,_[1]=t.devicePixelRatio):(e.uniform1i(h.useScreenCoordinates,0),e.uniform1i(h.sizeAttenuation,b.sizeAttenuation?1:0),e.uniformMatrix4fv(h.modelViewMatrix,!1,x._modelViewMatrix.elements),_[0]=1,_[1]=1),m!==(S=r.fog&&b.fog?g:0)&&(e.uniform1i(h.fogType,S),m=S),w=1/(b.scaleByViewport?s:1),_[0]*=w*f*x.scale.x,_[1]*=w*x.scale.y,e.uniform2f(h.uvScale,b.uvScale.x,b.uvScale.y),e.uniform2f(h.uvOffset,b.uvOffset.x,b.uvOffset.y),e.uniform2f(h.alignment,b.alignment.x,b.alignment.y),e.uniform1f(h.opacity,b.opacity),e.uniform3f(h.color,b.color.r,b.color.g,b.color.b),e.uniform1f(h.rotation,x.rotation),e.uniform2fv(h.scale,_),t.setBlending(b.blending,b.blendEquation,b.blendSrc,b.blendDst),t.setDepthTest(b.depthTest),t.setDepthWrite(b.depthWrite),t.setTexture(b.map,0),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0));e.enable(e.CULL_FACE)}}},D.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var e,t,r,i,n,o,a=new D.Frustum,s=new D.Matrix4;function l(e){return e.material instanceof D.MeshFaceMaterial?e.material.materials[0]:e.material}this.init=function(a){e=a.context,t=a;var s=D.ShaderLib.depthRGBA,l=D.UniformsUtils.clone(s.uniforms);r=new D.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l}),i=new D.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,morphTargets:!0}),n=new D.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,skinning:!0}),o=new D.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,morphTargets:!0,skinning:!0}),r._shadowPass=!0,i._shadowPass=!0,n._shadowPass=!0,o._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(c,u){var h,f,p,d,m,g,v,y,x,b;for(e.clearColor(1,1,1,1),e.disable(e.BLEND),t.setDepthTest(!0),!0===c.autoUpdate&&c.updateMatrixWorld(),u.matrixWorldInverse.getInverse(u.matrixWorld),s.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse),a.setFromMatrix(s),t.setRenderTarget(this.renderTarget),t.clear(),h=0,f=(v=c.__webglObjects).length;h<f;h++)g=(m=v[h]).object,m.render=!1,g.visible&&((g instanceof D.Mesh||g instanceof D.ParticleSystem)&&g.frustumCulled&&!a.intersectsObject(g)||(g._modelViewMatrix.multiplyMatrices(u.matrixWorldInverse,g.matrixWorld),m.render=!0));for(h=0,f=v.length;h<f;h++)if((m=v[h]).render){if(g=m.object,p=m.buffer,g instanceof D.ParticleSystem&&!g.customDepthMaterial)continue;(y=l(g))&&t.setMaterialFaces(g.material),x=g.geometry.morphTargets.length>0&&y.morphTargets,b=g instanceof D.SkinnedMesh&&y.skinning,d=g.customDepthMaterial?g.customDepthMaterial:b?x?o:n:x?i:r,p instanceof D.BufferGeometry?t.renderBufferDirect(u,c.__lights,null,d,p,g):t.renderBuffer(u,c.__lights,null,d,p,g)}for(h=0,f=(v=c.__webglObjectsImmediate).length;h<f;h++)(g=(m=v[h]).object).visible&&(g._modelViewMatrix.multiplyMatrices(u.matrixWorldInverse,g.matrixWorld),t.renderImmediateObject(u,c.__lights,null,r,g));var w=t.getClearColor(),S=t.getClearAlpha();e.clearColor(w.r,w.g,w.b,S),e.enable(e.BLEND)}},D.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility = (       visibility.r / 9.0 ) *","( 1.0 - visibility.g / 9.0 ) *","(       visibility.b / 9.0 ) *","( 1.0 - visibility.a / 9.0 );","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},D.ShaderSprite={sprite:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")}},e.exports=D},function(e,t,r){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=u(e);if(t){var n=u(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return l(this,r)}}function l(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?c(e):t}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h,f;h=window.GitHub.DDD,f=h.AttractMode=function(){var e=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(u,e);var t,r,i,l=s(u);function u(){var e;return n(this,u),(e=l.apply(this,arguments)).tick=e.tick.bind(c(e)),e}return t=u,(r=[{key:"onActivate",value:function(){return this.requested=Date.now(),this.spinRate=.01}},{key:"tick",value:function(e){if(function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")}(this,f),this.requested+this.delay<=Date.now())return this.controls.orbitRight(this.controls.orbitIncrement/2*this.spinRate),this.spinRate<1?this.spinRate*=1.03:void 0}}])&&o(t.prototype,r),i&&o(t,i),u}(h.ControlMode);return e.prototype.delay=3e3,e}.call(void 0)},function(e,t,r){"use strict";(function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=c(e);if(t){var n=c(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return s(this,r)}}function s(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u,h,f=function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")};u=window.GitHub.DDD,h=u.MouseMode=function(r){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(d,r);var s,c,u,p=a(d);function d(){var e;return i(this,d),(e=p.apply(this,arguments)).init=e.init.bind(l(e)),e.hold=e.hold.bind(l(e)),e.release=e.release.bind(l(e)),e.keyChange=e.keyChange.bind(l(e)),e.mouseDown=e.mouseDown.bind(l(e)),e.onScroll=e.onScroll.bind(l(e)),e.bindHandlers=e.bindHandlers.bind(l(e)),e.mouseMove=e.mouseMove.bind(l(e)),e.mouseUp=e.mouseUp.bind(l(e)),e.mouseTranslate=e.mouseTranslate.bind(l(e)),e.mouseOrbit=e.mouseOrbit.bind(l(e)),e}return s=d,(c=[{key:"init",value:function(){return f(this,h),this.translating=!1,this.shift=!1,this.drag={sensitivity:.4,start:new e.Vector2,end:new e.Vector2},this.onScroll=this.onScroll.bind(this),this.mouseDown=this.mouseDown.bind(this),this.keyChange=this.keyChange.bind(this),this.mouseMove=this.mouseMove.bind(this),this.mouseUp=this.mouseUp.bind(this),this.controls.$().on("mousewheel DOMMouseScroll",this.onScroll),this.controls.$().on("mousedown",this.mouseDown),this.controls.$().on("contextmenu",(function(e){return e.preventDefault()})),t(window).on("keydown keyup",this.keyChange)}},{key:"hold",value:function(){return f(this,h),"function"==typeof this.onUse?this.onUse():void 0}},{key:"release",value:function(){return f(this,h),"function"==typeof this.onRelease?this.onRelease():void 0}},{key:"keyChange",value:function(e){if(f(this,h),16===e.keyCode&&("keydown"===e.type&&(this.shift=this.translating=!0),"keyup"===e.type))return this.shift=this.translating=!1}},{key:"mouseDown",value:function(e){if(f(this,h),this.active||"function"==typeof this.onUse&&this.onUse(),e.preventDefault(),this.bindHandlers(!0),this.drag.start.set(e.clientX,e.clientY),3===e.which)return this.translating=!0}},{key:"onScroll",value:function(e){var t;if(f(this,h),this.active||"function"==typeof this.onUse&&this.onUse(),e.stopPropagation(),e.preventDefault(),((t=e.originalEvent).wheelDelta||-40*t.detail)>0?this.controls.changeZoom(.1):this.controls.changeZoom(-.1),this.active)return"function"==typeof this.onRelease?this.onRelease():void 0}},{key:"bindHandlers",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return f(this,h),e=!0===t?"on":"off",this.controls.$()[e]("mousemove",this.mouseMove),this.controls.$()[e]("mouseup",this.mouseUp)}},{key:"mouseMove",value:function(e){return f(this,h),this.translating?this.mouseTranslate(e):this.mouseOrbit(e)}},{key:"mouseUp",value:function(e){if(f(this,h),this.active&&"function"==typeof this.onRelease&&this.onRelease(),this.bindHandlers(!1),this.translating&&!this.shift)return this.translating=!1}},{key:"mouseTranslate",value:function(e){var t;return f(this,h),t=this.drag.end.set(e.clientX,e.clientY).clone().sub(this.drag.start).multiplyScalar(this.drag.sensitivity),this.drag.start.copy(this.drag.end),this.controls.translateUp(t.y),this.controls.translateRight(t.x)}},{key:"mouseOrbit",value:function(e){var t;return f(this,h),t=this.drag.end.set(e.clientX,e.clientY).clone().sub(this.drag.start).multiplyScalar(this.drag.sensitivity),this.drag.start.copy(this.drag.end),this.controls.orbitUp(this.controls.orbitIncrement*t.y),this.controls.orbitRight(this.controls.orbitIncrement*-t.x)}}])&&n(s.prototype,c),u&&n(s,u),d}(u.ControlMode)}).call(this,r(11),r(0))},function(e,t,r){"use strict";(function(e){var t;r(15),r(1),r(16),t=window.GitHub.DDD,e((function(){return t.DefaultColor=parseInt(e(".render-shell").data("color"))||4293572,debug("Color is: ".concat(t.DefaultColor)),new t.Viewer("#solid-viewer",(function(e,r){var i;try{return null!=r.$().data("file1")?(r.load(r.$().data("file1"),{name:"file1",center:!1,color:t.DefaultColor}),r.load(r.$().data("file2"),{name:"file2",center:!1,color:t.DefaultColor})):r.load(r.$().data("file"),{autoscale:!0,scaleTo:100,color:t.DefaultColor})}catch(e){throw i=e,this.status.set("error"),i}}))}))}).call(this,r(0))},function(e,t,r){},function(e,t,r){"use strict";var i,n,o,a,s,l,c,u,h;for(null==(i=window.GitHub).DDD&&(i.DDD={}),c=r(17),o=0,s=(h=["./util.coffee","./viewer.coffee","./controls.coffee"]).length;o<s;o++)c(n=h[o]);for(a=0,l=(u=c.keys()).length;a<l;a++)n=u[a],-1!==h.indexOf&&c(n)},function(e,t,r){var i={"./binary_reader.js":18,"./control_modes/attract.coffee":12,"./control_modes/mouse.coffee":13,"./controls.coffee":19,"./diff.coffee":22,"./genericloader.coffee":23,"./null_loader.coffee":24,"./objloader.coffee":25,"./pollingLoader.coffee":26,"./renderable.coffee":27,"./stlloader.coffee":28,"./util.coffee":29,"./viewer.coffee":30};function n(e){var t=o(e);return r(t)}function o(e){if(!r.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=o,e.exports=n,n.id=17},function(e,t){GitHub.DDD.BinaryReader=function(e){this._buffer=e,this._pos=0},GitHub.DDD.BinaryReader.prototype={readInt8:function(){return this._decodeInt(8,!0)},readUInt8:function(){return this._decodeInt(8,!1)},readInt16:function(){return this._decodeInt(16,!0)},readUInt16:function(){return this._decodeInt(16,!1)},readInt32:function(){return this._decodeInt(32,!0)},readUInt32:function(){return this._decodeInt(32,!1)},readFloat:function(){return this._decodeFloat(23,8)},readDouble:function(){return this._decodeFloat(52,11)},readChar:function(){return this.readString(1)},readString:function(e){this._checkSize(8*e);var t=this._buffer.substr(this._pos,e);return this._pos+=e,t},seek:function(e){this._pos=e,this._checkSize(0)},getPosition:function(){return this._pos},getSize:function(){return this._buffer.length},_decodeFloat:function(e,t){var r=e+t+1,i=r>>3;this._checkSize(r);var n=Math.pow(2,t-1)-1,o=this._readBits(e+t,1,i),a=this._readBits(e,t,i),s=0,l=2,c=0;do{for(var u=this._readByte(++c,i),h=e%8||8,f=1<<h;f>>=1;)u&f&&(s+=1/l),l*=2}while(e-=h);return this._pos+=i,a==1+(n<<1)?s?NaN:o?-1/0:1/0:(1+-2*o)*(a||s?a?Math.pow(2,a-n)*(1+s):Math.pow(2,1-n)*s:0)},_decodeInt:function(e,t){var r=this._readBits(0,e,e/8),i=Math.pow(2,e),n=t&&r>=i/2?r-i:r;return this._pos+=e/8,n},_shl:function(e,t){for(++t;--t;e=1073741824==(1073741824&(e%=2147483648))?2*e:2*(e-1073741824)+2147483647+1);return e},_readByte:function(e,t){return 255&this._buffer.charCodeAt(this._pos+t-e-1)},_readBits:function(e,t,r){var i=(e+t)%8,n=e%8,o=r-(e>>3)-1,a=r+(-(e+t)>>3),s=o-a,l=this._readByte(o,r)>>n&(1<<(s?8-n:t))-1;for(s&&i&&(l+=(this._readByte(a++,r)&(1<<i)-1)<<(s--<<3)-n);s;)l+=this._shl(this._readByte(a++,r),(s--<<3)-n);return l},_checkSize:function(e){if(!(this._pos+Math.ceil(e/8)<this._buffer.length))throw new Error("Index out of bound")}}},function(e,t,r){"use strict";(function(e,t){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=h(e);if(t){var n=h(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return c(this,r)}}function c(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}r(20);var f,p,d=function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")},m={}.hasOwnProperty;f=window.GitHub.DDD,p=f.Controls=function(){var r=function(r){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(g,r);var i,o,c,h=l(g);function g(t){var r,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),(r=h.call(this,t)).$=r.$.bind(u(r)),r.selectMode=r.selectMode.bind(u(r)),r.initControlModes=r.initControlModes.bind(u(r)),r.initModeMenu=r.initModeMenu.bind(u(r)),r.orbitDistance=r.orbitDistance.bind(u(r)),r.orbitRight=r.orbitRight.bind(u(r)),r.orbitUp=r.orbitUp.bind(u(r)),r.translateUp=r.translateUp.bind(u(r)),r.translateLeft=r.translateLeft.bind(u(r)),r.changeZoom=r.changeZoom.bind(u(r)),r.orbitLeft=r.orbitLeft.bind(u(r)),r.orbitDown=r.orbitDown.bind(u(r)),r.translateDown=r.translateDown.bind(u(r)),r.translateRight=r.translateRight.bind(u(r)),r.update=r.update.bind(u(r)),r.updateCenter=r.updateCenter.bind(u(r)),r.viewer=t,r.viewer.addEventListener("added",r.updateCenter),r.viewer.addEventListener("tick",r.update),r.renderer=r.viewer.renderer,r.camera=r.viewer.camera,r.center=new e.Vector3(0,0,0),i=r.orbitDistance(),r.camera.position.set(0,-i/2,i).setLength(i),r.initModeMenu(),r.initControlModes(),r.updateCenter(),r}return i=g,(o=[{key:"$",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){return d(this,p),null!=this.$container?this.$container:this.$container=t(this.renderer.domElement)}))},{key:"selectMode",value:function(e){var t,r,i,n;for(t in d(this,p),debug("Switching to ".concat(e," mode")),n=[],i=this.viewer.objects)m.call(i,t)&&(r=i[t],n.push(r.switchMode(e)));return n}},{key:"initControlModes",value:function(){var e=this;return d(this,p),this.modes={attract:new f.AttractMode(this,!0),mouse:new f.MouseMode(this)},this.modes.mouse.onUse=function(){var t,r;for(t in r=e.modes)m.call(r,t)&&r[t].deactivate();return e.modes.mouse.activate()},this.modes.mouse.onRelease=function(){var t,r;for(t in r=e.modes)m.call(r,t)&&r[t].deactivate();return e.modes.attract.activate()}}},{key:"initModeMenu",value:function(){return d(this,p),new window.Render.ModeSwitcher(this.selectMode)}},{key:"orbitDistance",value:function(){var e,t,r,i;return d(this,p),i=function(e){return e.geometry.boundingSphere.radius||0},(e=Math.max.apply(Math,n(function(){var e,n;for(t in n=[],e=this.viewer.objects)m.call(e,t)&&(r=e[t],n.push(i(r)));return n}.call(this))))>0?2.4*e:100}},{key:"withoutOriginOffset",value:function(e,t,r){return e.position.sub(t),r(),e.position.add(t)}},{key:"orbitRight",value:function(t){var r=this;return d(this,p),this.withoutOriginOffset(this.camera,this.center,(function(){var i;return i=new e.Vector3(0,0,1),r.camera.position.applyAxisAngle(i,t),r.camera.up.applyAxisAngle(i,t)}))}},{key:"orbitUp",value:function(e){var t=this;return d(this,p),this.withoutOriginOffset(this.camera,this.center,(function(){var r;return r=t.camera.position.clone().cross(t.camera.up).normalize(),t.camera.position.applyAxisAngle(r,e),t.camera.up.applyAxisAngle(r,e)}))}},{key:"translateUp",value:function(e){var t;return d(this,p),t=this.camera.up.clone().normalize().multiplyScalar(e),this.camera.position.add(t),this.center.add(t)}},{key:"translateLeft",value:function(e){var t,r,i;return d(this,p),i=this.camera.up.clone().normalize(),t=this.camera.position.clone().normalize(),r=i.cross(t).multiplyScalar(e),this.camera.position.add(r),this.center.add(r)}},{key:"changeZoom",value:function(e){var t=this;return d(this,p),this.withoutOriginOffset(this.camera,this.center,(function(){return e>0?t.camera.position.multiplyScalar(1.02):e<0?t.camera.position.multiplyScalar(.98):void 0}))}},{key:"orbitLeft",value:function(e){return d(this,p),this.orbitRight(-e)}},{key:"orbitDown",value:function(e){return d(this,p),this.orbitUp(-e)}},{key:"translateDown",value:function(e){return d(this,p),this.translateUp(-e)}},{key:"translateRight",value:function(e){return d(this,p),this.translateLeft(-e)}},{key:"update",value:function(){return d(this,p),this.camera.lookAt(this.center),this.dispatchEvent({type:"tick",data:0})}},{key:"updateCenter",value:function(){var e;return d(this,p),e=void 0,this.viewer.scene.traverse((function(t){var r;if(null==t.mesh&&null!=t.geometry)return(r=t.geometry).computeBoundingBox(),null==e?e=r.boundingBox.clone():(e.expandByPoint(r.boundingBox.min),e.expandByPoint(r.boundingBox.max))})),null!=e&&(this.center=e.center().clone()),debug("Center updated, now:",this.center)}}])&&a(i.prototype,o),c&&a(i,c),g}(e.EventDispatcher);return r.prototype.orbitIncrement=Math.PI/180,r}.call(void 0)}).call(this,r(11),r(0))},function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o,a;(a=window.GitHub.DDD).ControlMode=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];i(this,e),this.activate=this.activate.bind(this),this.deactivate=this.deactivate.bind(this),this.controls=t,this.active=!1,this.init(),n&&a.Utils.defer(this.activate),this.controls.addEventListener("tick",(function(e){if(r.active)return r.tick(e)}))}var t,r,o;return t=e,(r=[{key:"activate",value:function(){if(!this.active)return this.active=!0,this.onActivate()}},{key:"deactivate",value:function(){if(this.active)return this.active=!1,this.onDeactivate()}},{key:"init",value:function(){return"Called when subclasses are created to avoid super()"}},{key:"tick",value:function(e){return"Called every frame if the mode is active"}},{key:"onActivate",value:function(){return"Called when the control mode is activated"}},{key:"onDeactivate",value:function(){return"Called when the control mode is deactivated"}}])&&n(t.prototype,r),o&&n(t,o),e}(),(o=r(21))("./attract.coffee"),o("./mouse.coffee")},function(e,t,r){var i={"./attract.coffee":12,"./mouse.coffee":13};function n(e){var t=o(e);return r(t)}function o(e){if(!r.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=o,e.exports=n,n.id=21},function(e,t,r){"use strict";(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function n(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=s(e);if(t){var n=s(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return o(this,r)}}function o(e,r){return!r||"object"!==t(r)&&"function"!=typeof r?a(e):r}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l,c={}.hasOwnProperty;(l=window.GitHub.DDD).Diff=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(h,e);var t,o,s,u=n(h);function h(e,t,r,i){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(n=u.call(this)).viewer=e,n.slider=new window.Render.Slider({mouseDown:function(){return n.viewer.controls.modes.mouse.hold()},slide:function(e){return n.adjustMaterialOpacity(e/100)},mouseUp:function(){return n.viewer.controls.modes.mouse.release()}},{percentage:100}),n.viewer.addEventListener("resize",n.slider.setDragger),new l.PollingLoader({status:n.viewer.status}).load({added:n.viewer.$().data("added"),removed:n.viewer.$().data("removed"),unchanged:n.viewer.$().data("unchanged")},(function(e,t){var r,o,s,u,h;if(e)return n.viewer.dispatchEvent({type:"error",data:null!=(u=event.data)?u:"Load error"});for(o in s=t.parts,n.diffModes={highlight:new l.Renderable(s.unchanged.geom,{center:!0,name:"highlight",mode:"wireframe",color:5592405,specular:0,parts:[new l.Renderable(s.added.geom,{name:"added",center:!1,color:65280}),new l.Renderable(s.removed.geom,{name:"removed",center:!1,color:16711680})]}),slider:new l.Renderable(s.unchanged.geom,{center:!0,name:"slider",parts:[new l.Renderable(s.added.geom,{name:"added",center:!1,transparent:!0,color:l.DefaultColor}),new l.Renderable(s.removed.geom,{name:"removed",center:!1,transparent:!0,opacity:0,color:l.DefaultColor})],color:l.DefaultColor})},h=n.diffModes)c.call(h,o)&&(r=h[o],n.add(r));return n.switchMode("highlight"),i(a(n))})),n}return t=h,(o=[{key:"opacitySlider",value:function(){var e,t;for(e in this.slider.show(),t=this.diffModes)c.call(t,e)&&t[e].toggle(!1);return this.diffModes.slider.toggle(!0)}},{key:"removeOpacitySlider",value:function(){return this.slider.hide(),this.diffModes.slider.toggle(!1)}},{key:"adjustMaterialOpacity",value:function(e){return e>.97?(this.diffModes.slider.getObjectByName("removed").toggle(!1),this.diffModes.slider.getObjectByName("added").toggle(!0),this.diffModes.slider.getObjectByName("added").updateMaterials({opacity:1})):e<.03?(this.diffModes.slider.getObjectByName("added").toggle(!1),this.diffModes.slider.getObjectByName("removed").toggle(!0),this.diffModes.slider.getObjectByName("removed").updateMaterials({opacity:1})):(this.diffModes.slider.toggle(!0),this.diffModes.slider.getObjectByName("removed").updateMaterials({opacity:1-e}),this.diffModes.slider.getObjectByName("added").updateMaterials({opacity:e}))}},{key:"wireframe",value:function(){var e,t;for(e in t=this.diffModes)c.call(t,e)&&t[e].toggle(!1);return this.diffModes.highlight.toggle(!0)}},{key:"removeWireframe",value:function(){return this.diffModes.highlight.toggle(!1)}},{key:"switchMode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"highlight";switch(e){case"highlight":return this.removeOpacitySlider(),this.wireframe();case"slider":return this.removeWireframe(),this.opacitySlider()}}}])&&r(t.prototype,o),s&&r(t,s),h}(e.Object3D)}).call(this,r(11))},function(e,t,r){"use strict";(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],i=!0,n=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);i=!0);}catch(e){n=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(n)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=c(e);if(t){var n=c(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return l(this,r)}}function l(e,r){return!r||"object"!==t(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):r}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u;(u=window.GitHub.DDD).GenericLoader=function(){var t=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(n,t);var i=s(n);function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=i.call(this)).status=e,t}return o(n,null,[{key:"loaderForUrl",value:function(e,t){var i,n,o,a=r(t.split("?"),2);if(n=a[0],a[1],(o=n.match(/\.([^\.]*)$/))&&(i=o[1].toLowerCase(),null!=this.extensions[i]))return new this.extensions[i](e);if(null==t||""===t.trim())return new u.NULLLoader(e);throw new Error("No fitting loader for url [".concat(t,"]"))}}]),o(n,[{key:"calculateNormal",value:function(t,r,i,n){var o,a;return o=(new e.Vector3).subVectors(t.vertices[r],t.vertices[i]),a=(new e.Vector3).subVectors(t.vertices[r],t.vertices[n]),(new e.Vector3).crossVectors(o,a).normalize()}},{key:"side",value:function(){return e.BackSide}},{key:"load",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return debug("Attempting to load URL: [".concat(e,"]")),this.status.load(e,{attempts:r.attempts,success:function(e,r){var i;return null!=(i=t.parse(e))?t.dispatchEvent({type:"load",content:i}):t.dispatchEvent({type:"error:fatal",message:"Model not valid."})},error:function(r,i){var n,o;return o=403===(n=i.status)?"error:fatal":"error",t.dispatchEvent({type:o,message:"Could not load URL [".concat(e,"] [").concat(n,"]")})},before:function(e){return e.overrideMimeType("text/plain; charset=x-user-defined")}})}}]),n}(e.EventDispatcher);return t.extensions={},t}.call(void 0)}).call(this,r(11))},function(e,t,r){"use strict";(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=l(e);if(t){var n=l(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return a(this,r)}}function a(e,r){return!r||"object"!==t(r)&&"function"!=typeof r?s(e):r}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c,u,h=function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")};c=window.GitHub.DDD,u=c.NULLLoader=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}(p,t);var a,l,c,f=o(p);function p(){var e;return r(this,p),(e=f.apply(this,arguments)).load=e.load.bind(s(e)),e.parse=e.parse.bind(s(e)),e}return a=p,(l=[{key:"load",value:function(e,t){return h(this,u),this.dispatchEvent({type:"load",content:this.parse()})}},{key:"parse",value:function(t){var r;return h(this,u),(r=new e.Geometry).computeFaceNormals(),r.computeCentroids(),r.computeBoundingBox(),r.computeBoundingSphere(),r}}])&&i(a.prototype,l),c&&i(a,c),p}(c.GenericLoader)}).call(this,r(11))},function(e,t,r){"use strict";(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=l(e);if(t){var n=l(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return a(this,r)}}function a(e,r){return!r||"object"!==t(r)&&"function"!=typeof r?s(e):r}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c,u;c=window.GitHub.DDD,u=c.OBJLoader=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}(f,t);var a,l,c,h=o(f);function f(){var e;return r(this,f),(e=h.apply(this,arguments)).parse=e.parse.bind(s(e)),e}return a=f,(l=[{key:"side",value:function(){return e.BackSide}},{key:"parse",value:function(t){var r,i,n,o,a,s,l,c,h,f=this;for(function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")}(this,u),r=new e.Geometry,h=[],s=/^(f|g|o|vn|vt|v) +(.*[^ ]) *$/,n={f:function(t){var i,n,o,a,s,l;if(i=function(){var e,r,i,n;for(n=[],e=0,r=(i=t.split(" ")).length;e<r;e++)a=i[e],n.push(a.split("/"));return n}(),o=[parseInt(i[0][0])-1,parseInt(i[1][0])-1,parseInt(i[2][0])-1,null!=i[3]?parseInt(i[3][0])-1:void 0],l=[parseInt(i[0][1])-1,parseInt(i[1][1])-1,parseInt(i[2][1])-1,null!=i[3]?parseInt(i[3][1])-1:void 0],s=f.calculateNormal(r,o[0],o[1],o[2]),r.faces.push(new e.Face3(o[0],o[1],o[2],s)),(n=null!=l[0]&&!isNaN(l[0]))&&r.faceVertexUvs[0].push([h[l[0]],h[l[1]],h[l[2]]]),4===i.length&&(s=f.calculateNormal(r,o[0],o[2],o[3]),r.faces.push(new e.Face3(o[2],o[3],o[0],s)),n))return r.faceVertexUvs[0].push([h[l[2]],h[l[3]],h[l[0]]])},g:function(e){},o:function(e){return r.name=e},vn:function(e){},vt:function(t){var r,i;return i=function(){var e,i,n,o;for(o=[],e=0,i=(n=t.split(" ")).length;e<i;e++)r=n[e],o.push(parseFloat(r));return o}(),h.push(new e.Vector2(i[0],i[1]))},v:function(t){var i,n;return n=function(){var e,r,n,o;for(o=[],e=0,r=(n=t.split(" ")).length;e<r;e++)i=n[e],o.push(parseFloat(i));return o}(),r.vertices.push(new e.Vector3(n[0],n[2],n[1]))}},i=0,o=(l=t.split("\n")).length;i<o;i++)(c=l[i].match(s))&&null!=(a=n[c[1]])&&a(c[2]);return r.computeFaceNormals(),r.computeCentroids(),r.computeBoundingBox(),r.computeBoundingSphere(),r}}])&&i(a.prototype,l),c&&i(a,c),f}(c.GenericLoader),c.GenericLoader.extensions.obj=c.OBJLoader}).call(this,r(11))},function(e,t,r){"use strict";(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=l(e);if(t){var n=l(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return a(this,r)}}function a(e,r){return!r||"object"!==t(r)&&"function"!=typeof r?s(e):r}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c,u,h=function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")},f={}.hasOwnProperty;c=window.GitHub.DDD,u=c.PollingLoader=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}(d,e);var t,a,l,p=o(d);function d(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,d),(e=p.call(this)).load=e.load.bind(s(e)),e.reset=e.reset.bind(s(e)),e.incompleteCount=e.incompleteCount.bind(s(e)),e.maybeFinished=e.maybeFinished.bind(s(e)),e.completePart=e.completePart.bind(s(e)),e.failPart=e.failPart.bind(s(e)),e.reset(),null==t.timeout&&(t.timeout=10),null==t.tries&&(t.tries=10),null==t.maxLateJobs&&(t.maxLateJobs=1),e.timeout=t.timeout,e.tries=t.tries,e.status=t.status,e.maxLateJobs=t.maxLateJobs,e.addEventListener("ready",(function(){return e.cb(!1,s(e)),e.cb=function(){}})),e.addEventListener("error",(function(){return e.cb(!0,s(e)),e.cb=function(){}})),e}return t=d,(a=[{key:"load",value:function(e,t){var r,i,n,o=this;for(r in h(this,u),this.reset(),null!=t&&(this.cb=t),this.time.start=Date.now(),this.time.end=void 0,i=[],e)f.call(e,r)&&(n=e[r],i.push(function(e,t){var r;return(r=o.parts[e]={name:e,url:t,geom:void 0,loader:c.GenericLoader.loaderForUrl(o.status,t),load:function(){return r.loader.load(r.url,{attempts:o.tries})}}).loader.addEventListener("load",(function(e){return o.completePart(r,e.content)})),r.loader.addEventListener("error",(function(e){return o.failPart(r)})),r.loader.addEventListener("error:fatal",(function(e){return o.failPart(r)})),r.load()}(r,n)));return i}},{key:"reset",value:function(){return h(this,u),this.parts={},this.time={start:void 0,end:void 0},null!=this.cb?this.cb:this.cb=function(){}}},{key:"incompleteCount",value:function(){var e,t,r,i;for(t in h(this,u),e=0,i=0,r=this.parts)f.call(r,t)&&function(t,r){i+=1,null!=r.geom&&(e+=1)}(0,r[t]);return i-e}},{key:"maybeFinished",value:function(){var e,t,r,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(h(this,u),Date.now()>=this.time.start+1e3*this.timeout&&this.incompleteCount()>this.maxLateJobs)return this.dispatchEvent({type:"error",data:"timeout"});for(t in e=!0,r=this.parts)f.call(r,t)&&function(t,r){e=e&&!(null==r.geom)}(0,r[t]);return e?(this.time.end=Date.now(),debug("All parts Ready"),this.dispatchEvent({type:"ready",info:this})):i()}},{key:"completePart",value:function(e,t){return h(this,u),debug("completePart:",e,t),e.geom=t,this.maybeFinished()}},{key:"failPart",value:function(e){return h(this,u),debug("failPart():",e),this.dispatchEvent({type:"error",info:"Too many tries for ".concat(e.url)})}}])&&i(t.prototype,a),l&&i(t,l),d}(e.EventDispatcher)}).call(this,r(11))},function(e,t,r){"use strict";(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=l(e);if(t){var n=l(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return a(this,r)}}function a(e,r){return!r||"object"!==t(r)&&"function"!=typeof r?s(e):r}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c,u,h=function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")},f={}.hasOwnProperty;c=window.GitHub.DDD,u=c.Renderable=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}(d,t);var a,l,c,p=o(d);function d(t){var i,n,o,a,l,c,u,h,f,m,g,v,y,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(r(this,d),(i=p.call(this)).toggle=i.toggle.bind(s(i)),i.updateMaterials=i.updateMaterials.bind(s(i)),i.center=i.center.bind(s(i)),i.switchMode=i.switchMode.bind(s(i)),i.info=x,i.geometry=i.info.clone?t.clone():t,i.url=null!=(u=i.info.url)?u:"x-renderable://".concat(i.id),i.name=null!=(h=null!=(f=i.info.name)?f:i.info.url)?h:"model-".concat(i.id),null==(n=i.info).center&&(n.center=!0),i.info.scale=1,i.info.autoscale&&(null==(o=i.info).scaleTo&&(o.scaleTo=100),i.geometry.computeBoundingSphere(),i.geometry.boundingSphere.radius>i.info.scaleTo&&(i.info.scale=i.info.scaleTo/i.geometry.boundingSphere.radius,y=(new e.Matrix4).makeScale(i.info.scale,i.info.scale,i.info.scale),i.geometry.applyMatrix(y),i.geometry.computeBoundingSphere())),i.mesh=new e.Mesh(i.geometry),i.mesh.name=i.name,i.add(i.mesh),a=0,l=(g=null!=(m=i.info.parts)?m:[]).length;a<l;a++)c=g[a],i.add(c);return i.info.center&&i.center(),i.switchMode(null!=(v=i.info.mode)?v:"solid"),i}return a=d,(l=[{key:"toggle",value:function(e){return h(this,u),this.traverse((function(t){return t.visible=e}))}},{key:"updateMaterials",value:function(e){if(h(this,u),null!=e)return this.traverse((function(t){var r,i,n,o,a;for(r in o=[],e)f.call(e,r)&&(a=e[r],o.push(null!=t&&null!=(i=t.mesh)&&null!=(n=i.material)?n[r]=a:void 0));return o}))}},{key:"center",value:function(){var t,r,i,n,o;return h(this,u),r=void 0,this.traverse((function(e){var t;if((t=e.geometry)&&t.vertices.length>0)return t.computeBoundingBox(),null!=r?(r.expandByPoint(t.boundingBox.min),r.expandByPoint(t.boundingBox.max)):r=t.boundingBox.clone()})),t=r.clone(),i=r.center().negate(),n=r.min.negate(),debug("Total centering transform: ".concat(i.x,", ").concat(i.y,", ").concat(n.z)),debug("Bounds: ",t),o=(new e.Matrix4).makeTranslation(i.x,i.y,n.z),this.traverse((function(e){if(null==e.mesh&&null!=e.geometry)return e.geometry.applyMatrix(o),e.geometry.computeCentroids(),e.geometry.computeBoundingBox(),e.geometry.computeBoundingSphere()})),this}},{key:"switchMode",value:function(){var t,r,i,n,o,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"solid";switch(h(this,u),t={color:null!=(r=this.info.color)?r:16752762,specular:null!=(i=this.info.specular)?i:10066329,transparent:null!=(n=this.info.transparent)&&n,opacity:null!=(o=this.info.opacity)?o:1},a){case"wireframe":this.mesh.material=new e.MeshPhongMaterial(t),this.mesh.material.wireframe=!0;break;case"solid":this.mesh.material=new e.MeshPhongMaterial(t),this.mesh.material.wireframe=!1;break;case"normal":this.mesh.material=new e.MeshNormalMaterial(t),this.mesh.material.wireframe=!1}return this.mesh.material.side=this.info.side,this.mesh.material.needsUpdate=!0,this.geometry.buffersNeedUpdate=!0,this.geometry.uvsNeedUpdate=!0}}])&&i(a.prototype,l),c&&i(a,c),d}(e.Object3D)}).call(this,r(11))},function(e,t,r){"use strict";(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=l(e);if(t){var n=l(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return a(this,r)}}function a(e,r){return!r||"object"!==t(r)&&"function"!=typeof r?s(e):r}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c,u,h=function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")};c=window.GitHub.DDD,u=c.STLLoader=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}(d,t);var a,l,f,p=o(d);function d(){var e;return r(this,d),(e=p.apply(this,arguments)).parse=e.parse.bind(s(e)),e.parseBinary=e.parseBinary.bind(s(e)),e}return a=d,(l=[{key:"side",value:function(){return e.FrontSide}},{key:"parse",value:function(e){return h(this,u),function(e){var t;return(t=new c.BinaryReader(e)).seek(80),84+50*t.readUInt32()===t.getSize()}(e)?this.parseBinary(e):this.parseASCII(e)}},{key:"parseBinary",value:function(t){var r,i,n,o,a,s,l,f,p,d,m;for(h(this,u),s=function(){return[l.readFloat(),l.readFloat(),l.readFloat()]},(l=new c.BinaryReader(t)).seek(80),o=l.readUInt32(),r=new e.Geometry,i=0,f=o;0<=f?i<f:i>f;0<=f?++i:--i){m=s(),new e.Vector3(m[0],m[1],m[2]);for(var g=1;g<=3;g++)m=s(),r.vertices.push(new e.Vector3(m[0],m[1],m[2]));l.readUInt16(),n=r.vertices.length,p=(new e.Vector3).subVectors(r.vertices[n-3],r.vertices[n-2]),d=(new e.Vector3).subVectors(r.vertices[n-3],r.vertices[n-1]),a=(new e.Vector3).crossVectors(p,d).normalize(),r.faces.push(new e.Face3(n-3,n-2,n-1,a))}return r.computeCentroids(),r.computeBoundingBox(),r.computeBoundingSphere(),r}},{key:"parseASCII",value:function(t){var r,i,n,o,a,s,l,c,u,h;for(r=new e.Geometry,o=/facet([\s\S]*?)endfacet/g;null!=(l=o.exec(t));){for(c=l[0],a=/normal[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g;null!=(l=a.exec(c));)new e.Vector3(parseFloat(l[1]),parseFloat(l[3]),parseFloat(l[5]));for(s=/vertex[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g;null!=(l=s.exec(c));)r.vertices.push(new e.Vector3(parseFloat(l[1]),parseFloat(l[3]),parseFloat(l[5])));i=r.vertices.length,u=(new e.Vector3).subVectors(r.vertices[i-3],r.vertices[i-2]),h=(new e.Vector3).subVectors(r.vertices[i-3],r.vertices[i-1]),(new e.Vector3).crossVectors(u,h).normalize(),n=this.calculateNormal(r,i-3,i-2,i-1),r.faces.push(new e.Face3(i-3,i-2,i-1,n))}return r.computeCentroids(),r.computeBoundingBox(),r.computeBoundingSphere(),r}}])&&i(a.prototype,l),f&&i(a,f),d}(c.GenericLoader),c.GenericLoader.extensions.stl=c.STLLoader}).call(this,r(11))},function(e,t,r){"use strict";(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=o(e);if(t){var a=o(this).constructor;r=Reflect.construct(i,arguments,a)}else r=i.apply(this,arguments);return n(this,r)}}function n(e,r){return!r||"object"!==t(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):r}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var a;(a=window.GitHub.DDD).Utils={defer:function(e){return setTimeout((function(){return e()}),0)}},window.GitHub.DDD.Error=function(e){return function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(n,e);var t=i(n);function n(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(r=t.call(this,e)).message=e,r}return n}(e)}.call(void 0,Error),e.EventDispatcher.prototype.once=function(e,t){var r,i=this;return r=function(){return t.apply(void 0,arguments),a.Utils.defer((function(){return i.removeEventListener(e,r)}))},this.addEventListener(e,r)}}).call(this,r(11))},function(e,t,r){"use strict";(function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=c(e);if(t){var n=c(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return s(this,r)}}function s(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u,h,f=function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")},p={}.hasOwnProperty;u=window.GitHub.DDD,h=u.Viewer=function(r){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(v,r);var c,d,m,g=a(v);function v(e){var r,n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(i(this,v),(r=g.call(this)).draw=r.draw.bind(l(r)),r.load=r.load.bind(l(r)),r.destructor=r.destructor.bind(l(r)),r.width=r.width.bind(l(r)),r.height=r.height.bind(l(r)),r.resize=r.resize.bind(l(r)),r.watchdog=r.watchdog.bind(l(r)),r.init=r.init.bind(l(r)),r.objectLoadHandler=r.objectLoadHandler.bind(l(r)),r.updateLight=r.updateLight.bind(l(r)),r.updateGrid=r.updateGrid.bind(l(r)),r.selectRenderer=r.selectRenderer.bind(l(r)),r.$=r.$.bind(l(r)),r.container=e,!r.$().length)return s(r);if(r.$().data("bound"))return s(r);if(o instanceof Function){var c=[{},o];o=c[0],a=c[1]}return r.doctor=new window.Render.Doctor(r.container),r.status=new window.Render.Status("solid"),r.objects={},r.once("loaded",(function(){return r.draw(!0)})),r.addEventListener("loaded",r.objectLoadHandler),r.addEventListener("load",n=function(e){var t;return"error"===(t=e.data)||"error:fatal"===t?r.status.set(t):"finish"===t?r.removeEventListener("load",n):void 0}),r.once("error",(function(e){throw r.status.set("error"),new u.Error(e)})),r.once("loaded",r.resize),t(window).on("resize",r.resize),r.init(o,(function(){var e;r.$container.data("bound",!0);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return(e=a).call.apply(e,[l(r)].concat(i))})),r}return c=v,(d=[{key:"draw",value:function(e){var t,r,i=this;if(f(this,h),r=function(e){return i.dispatchEvent({type:"tick",data:e}),i.updateLight(i.camera.position),i.renderer.render(i.scene,i.camera)},t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(r(e),i.running)return requestAnimationFrame(t)},!1===e)return this.running=!1;if(!0===e){if(this.running)return;return this.running=!0,t()}return r()}},{key:"load",value:function(e){var t,r,i,n,o=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(t in f(this,h),i={},a)p.call(a,t)&&(n=a[t],i[t]=n);return null==i.url&&(i.url=e),null==i.name&&(i.name=e),null==i.center&&(i.center=!0),null==i.autoscale&&(i.autoscale=!1),this.dispatchEvent({type:"load",data:"start"}),r=u.GenericLoader.loaderForUrl(this.status,e),i.side=r.side(),r.addEventListener("load",(function(e){return o.dispatchEvent({type:"load",data:"finish"}),o.dispatchEvent({type:"loaded",object:new u.Renderable(e.content,i)})})),r.addEventListener("error",(function(e){return o.dispatchEvent({type:"load",data:"error"}),debug("Load Error:",e)})),r.addEventListener("error:fatal",(function(e){return o.dispatchEvent({type:"load",data:"error:fatal"}),debug("Load Error:",e)})),r.load(e)}},{key:"destructor",value:function(){return f(this,h),this.draw(!1)}},{key:"width",value:function(){return f(this,h),(window.parent===window?t(window).innerWidth():void 0)||this.$().width()||t(window).width()||500}},{key:"height",value:function(){return f(this,h),(window.parent===window?t(window).innerHeight():void 0)||(this.$().height()||t(window).height()||500)-t(".js-render-bar").outerHeight()}},{key:"resize",value:function(){var e,t;f(this,h);var r=[this.width(),this.height()];if(e=r[1],(t=r[0])&&e)return this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e),this.dispatchEvent({type:"resize",data:{width:t,height:e}}),debug("Viewport now ".concat(t,"x").concat(e))}},{key:"watchdog",value:function(){return f(this,h),t(this.container).length>0?t(document).one("pageUpdate",this.watchdog):this.destructor()}},{key:"init",value:function(){var t,r=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(f(this,h),!this.$container.data("initialized")){if(i instanceof Function){var o=[{},i];i=o[0],n=o[1]}return t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unknown";return n(e||"unknown",r),r.dispatchEvent({type:"error",data:e})},this.once("loaded",(function(){return null!=r.controls?r.controls:r.controls=new u.Controls(r)})),this.once("init",(function(){return r.$container.data("initialized",!0)})),this.once("init",this.watchdog),this.once("init",this.doctor.updateHealth),this.once("init",(function(){return r.resize()})),this.once("init",(function(){return n(!1,r)})),(this.renderer=this.selectRenderer())?(this.renderer.setSize(this.width(),this.height()),this.$().append(this.renderer.domElement),this.scene=new e.Scene,this.scene.up.set(0,0,1),this.cameraFOV=50,this.camera=new e.PerspectiveCamera(this.cameraFOV,this.width()/this.height(),.01,1e4),this.camera.up.set(0,0,1),this.scene.add(this.camera),this.updateGrid(),this.dispatchEvent({type:"init",data:"finished"})):t()&&void 0}}},{key:"objectLoadHandler",value:function(e){var t,r,i,n,o,a=this;if(f(this,h),e&&(n=e.object)&&n.name&&null==this.objects[n.name])return this.objects[n.name]=n,1!==n.info.scale&&(t=n.info.scale>1?"up":"down",this.doctor.addProblem("Object has been scaled ".concat(t," to fit the view"))),o=4*n.geometry.boundingSphere.radius,this.camera.far>o||(this.camera.far=o),this.camera.updateProjectionMatrix(),this.updateGrid(2*n.geometry.boundingSphere.radius),/^file\d+$/.test(n.name)?null==this.objects.diff&&this.objects.file1&&this.objects.file2&&(r=this.objects.file1,i=this.objects.file2,new u.Diff(this,r,i,(function(e){return a.objects.diff=e,a.scene.add(e),a.dispatchEvent({type:"added",data:e}),a.dispatchEvent({type:"diff:ready",data:e}),a.status.set("ready"),debug("Loaded diff:",e)}))):(this.scene.add(n),this.dispatchEvent({type:"added",data:n}),this.status.set("ready")),debug("Loaded:",n)}},{key:"updateLight",value:function(t){var r,i,n;return f(this,h),r=t.x,i=t.y,n=t.z,null!=this.light?this.light.position.set(r,i,n):(this.scene.add(new e.AmbientLight(4210752)),this.light=new e.DirectionalLight(16777215),this.light.position.set(r,i,n),this.scene.add(this.light))}},{key:"updateGrid",value:function(){var t,r,i,n,o,a,s,l,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return f(this,h),l=1.1*c,i=(t=10)*(a=Math.ceil(l/t)+10),o=(new e.Matrix4).makeTranslation(0,0,-.001),a>(r=100)&&(a=r,this.doctor.addProblem("The grid is being scaled because your model is too large")),null==this.grid?((s=new e.PlaneGeometry(i,i,a,a)).applyMatrix(o),n=new e.MeshBasicMaterial({color:3355443,wireframe:!0}),this.grid=new e.Mesh(s,n),this.scene.add(this.grid)):(this.grid.geometry.computeBoundingSphere(),i>this.grid.geometry.boundingSphere.radius?((s=new e.PlaneGeometry(i,i,a,a)).applyMatrix(o),n=this.grid.material,this.scene.remove(this.grid),this.grid.geometry.dispose(),this.grid=new e.Mesh(s,n),this.scene.add(this.grid)):void 0)}},{key:"selectRenderer",value:function(){var t,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(f(this,h),!r||null==window.WebGLRenderingContext)return this.doctor.addProblem("WebGL powered hardware support not available"),new e.CanvasRenderer;try{return new e.WebGLRenderer({antialias:!0,sortObjects:!1})}catch(e){return t=e,debug("Failed to create WebGLRenderer:",t),this.selectRenderer(!1)}}},{key:"$",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){return f(this,h),null!=this.$container?this.$container:this.$container=t(this.container)}))}])&&n(c.prototype,d),m&&n(c,m),v}(e.EventDispatcher)}).call(this,r(11),r(0))}]);
</script>
  </div>

      
  <script>
    var prevScrollpos = window.pageYOffset;
    window.onscroll = function() {
      var currentScrollPos = window.pageYOffset;
      if (prevScrollpos > currentScrollPos) {
        document.getElementById("navbar").style.top = "0";
      } else {
        document.getElementById("navbar").style.top = "-100px";
      }
      prevScrollpos = currentScrollPos;
    }
  </script>
  
  
</div>

  <div class="row">
    <div class="col-xl-12" style="margin-bottom: 30px;">
      <p style="text-align: center; font-family: 'Titillium Web', sans-serif; color: white; "> © Lauren Cooke 2021 </p>
  </div>

</body>
</html>